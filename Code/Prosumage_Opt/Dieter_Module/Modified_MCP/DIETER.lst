GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/25/18 14:14:39 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  32   
  35   
  37   
  39   
  42  * Set star to indicate renewables constraint on electric vehicles - DEFAUL
      T is same quota as for the rest of the electricity system
  46   
  47  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  48  * if nothing is selected, ROR capacity will be set to zero
  49  * if parameter option is selected, set appropriate values in fix.gmx
  50  * if variable option is selected, set appropriate bound in data_input exce
      l
  53   
  54  * Set star to determine loops, otherwise default 100% renewables
  56   
  57  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  59   
  60  * Set star for reporting to Excel
  62   
  63   
  64  **************************************************************************
      ******
  65   
  66  * Definition of strings for report parameters and sanity checks
  67  * (Do not change settings below)
  69   
  71   
  72  * Sanity checks
  74   
  76   
  78   
  82   
  86   
  87   
  88   
  89   
  90  **************************************************************************
      ******
  91   
  92  ****************************
  93  ***** INITIALIZE LOOPS *****
  94  ****************************
  95   
  96  sets
  97  *$ontext
  98  loop_res_share   Solution loop for different shares of renewables       /5
      0/
 101   
      loop_ev          Solution loop for different fleets of EVs              /4
      e+6/
      $ontext
 106   
      loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
      $ontext
 111   
 112  *      loop_res_share                          /50/
 113                               loop_ev                                 /0/
 114                        loop_prosumage                          /0/
 115  ;
 116   
 117   
 118   
 119   
 120  **************************************************************************
      ******
 121   
 122  **************************
 123  ***** SOLVER OPTIONS *****
 124  **************************
 125   
 126  options
 127  optcr = 0.00
 128  reslim = 10000000
 129  lp = cplex
 130  mip = cplex
 131  nlp = conopt
 132  limrow = 0
 133  limcol = 0
 134  ;
 135   
 136  options
 137  dispwidth = 15
 138  limrow = 0
 139  limcol = 0
 140  solprint = off
 141  sysout = off
 142  ;
 143   
 144   
 145   
 146   
 147  **************************************************************************
      ******
 148   
 149  **************************
 150  ***** Dataload *****
 151  **************************
 152   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\dataload.gms
 154   
 155  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 165  **************************************************************************
      ******
 166   
 167   
 168   
 169   
 170  ***************  SETS  ***************************************************
      ******
 171   
 172  ***** Sets used in the model *****
 173  Sets
 174  tech                     Generation technologies
 175   dis(tech)               Dispatchable generation technologies
 176   nondis(tech)            Nondispatchable generation technologies
 177   con(tech)               Conventional generation technologies
 178   res(tech)               Renewable generation technologies
 179  sto                      Storage technologies
 180  rsvr                     Reservoir technologies
 181  dsm                      DSM technologies
 182   dsm_shift(dsm)          DSM load shifting technologies
 183   dsm_curt(dsm)           DSM load curtailment technologies
 184  year                     Base year for temporal data
 185  h                        Hours
 186  n                        Nodes
 187  l                        Lines
 188  ev                       EV types
 189  reserves                         Reserve qualities
 190   reserves_up(reserves)           Positive reserves
 191   reserves_do(reserves)           Negative reserves
 192   reserves_spin(reserves)         Spinning reserves
 193   reserves_nonspin(reserves)      Nonspinning reserves
 194   reserves_prim(reserves)         Primary reserves
 195   reserves_nonprim(reserves)      Nonprimary reserves
 196   reserves_prim_up(reserves)      Primary positive reserves
 197   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 198   reserves_prim_do(reserves)      Primary negative reserves
 199   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 200  bu                       Building archtypes
 201  ch                       Heating combination type
 202   hst(ch)                 Heating technology that feeds to storage
 203   hp(ch)                  Heat pump technologies
 204   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 205   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 206   
 207   
 208  ***** Sets used for data upload *****
 209  headers_tech                     Generation technologies - upload headers
 210   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 211   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 212  headers_sto                      Storage technologies - upload headers
 213  headers_reservoir                Reservoir technologies - upload headers
 214  headers_dsm                      DSM technologies - upload headers
 215   dsm_type                        DSM technologies - shifting or curtailmen
      t
 216  headers_time                     Temporal data - upload headers
 217  headers_topology                 Spatial data - upload headers
 218  headers_ev                       EV data - upload headers
 219  headers_time_ev                  EV temporal data - upload headers
 220  headers_prosumage_generation     Prosumage generation data - upload header
      s
 221  headers_prosumage_storage        Prosumage storage data - upload headers
 222  headers_reserves                 Reserve data - upload headers
 223   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 224   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 225   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 226  headers_heat                     Heat data - upload headers
 227   heat_storage                    Heat data - storage technologies
 228   heat_hp                         Heat data - heat pump technologies
 229   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 230   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 231  headers_time_heat                Heat data - upload headers time data
 232  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 233  ;
 234   
 235   
 236   
 237   
 238  ***************  PARAMETERS  *********************************************
      ******
 239   
 240  Parameters
 241   
 242  ***** Generation technologies *****
 243  *--- Variable and fixed costs ---*
 244  eta              Efficiency of conventional technologies [0 1]
 245  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 246  c_up             Load change costs UP [EUR per MWh]
 247  c_do             Load change costs DOWN [EUR per MWh]
 248  c_fix            Annual fixed costs [EUR per MW per year]
 249  c_vom            Variable O&M costs [EUR per MWh]
 250  CO2price         CO2 price in [EUR per ton]
 251   
 252  *--- Investment ---*
 253  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 254  lifetime         Investment costs: technical lifetime [a]
 255  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 256  interest_rate    Investment costs: Interest rate [%]
 257  m_p              Investment: maximum installable capacity per technology [
      MW]
 258  m_e              Investment: maximum installable energy [TWh per a]
 259   
 260  *--- Flexibility ---*
 261  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 262   
 263   
 264  ***** Fuel and CO2 costs *****
 265  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 266   
 267   
 268  ***** Renewables *****
 269  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 270  phi_min_res      Minimum renewables share [0 1]
 271   
 272   
 273  ***** Storage *****
 274  *--- Variable and fixed costs ---*
 275  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 276  eta_sto          Storage efficiency [0 1]
 277  phi_sto_ini      Initial storage level [0 1]
 278  etop_max         Maximum E to P ratio of storage types [#]
 279  c_fix_sto        Annual fixed costs [EUR per MW]
 280   
 281  *--- Investment ---*
 282  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 283  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 284  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 285  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 286   
 287   
 288  ***** Reservoir*****
 289  *--- Variable and fixed costs ---*
 290  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 291  eta_rsvr                 Generation efficiency [0 1]
 292  phi_rsvr_ini             Initial reservoir level [0 1]
 293  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 294  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 295  phi_rsvr_lev_min         Minimum filling level [0 1]
 296   
 297  *--- Investment ---*
 298  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 299  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 300  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 301  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 302  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 303  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 304   
 305   
 306  ***** DSM *****
 307  *--- Variable and fixed costs ---*
 308  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 309  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 310  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 311  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 312   
 313  *--- Flexibility, efficiency, recovery ---*
 314  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 315  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 316   
 317  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 318  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 319  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 320   
 321  *--- Investment ---*
 322  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 323  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 324  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 325  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 326  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 327  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 328  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 329  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 330   
 331   
 332  ***** Time Data *****
 333  d_y                      Demand hour h for different years [MWh]
 334  d                        Demand hour h [MWh]
 335  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 336  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 337  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 338  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 339  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 340  rsvr_in                  Reservoir inflow in hour h [0 1]
 341  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 342  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 343  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 344  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 345  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 346  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 347  reserves_exogenous       Hourly reserve provision [MW]
 348   
 349  ***** Transmission *****
 350  *--- Investment ---*
 351  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 352  c_fix_ntc                 Fixed costs [EUR per MW per a]
 353  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 354  inv_recovery_ntc          Investment costs: Recovery period in [a]
 355  inv_interest_ntc          Investment costs: Interest rate [%]
 356  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 357   
 358  *--- Topology and distance ---*
 359  inc              Incidence index of link l on node n
 360  dist             Distance covered by link l [km]
 361   
 362   
 363  ***** Electric vehicles *****
 364  *--- Costs and attributes ---*
 365  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 366  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 367  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 368  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 369  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 370   
 371  n_ev_e           Electric vehicle battery capacity [MWh]
 372  ev_quant         Overall number of electirc vehicles [#]
 373  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 374  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 375   
 376  *--- Temporal data ---*
 377  n_ev_p           Electric vehicle power rating [MWh]
 378  ev_ed            Electric vehicle electricity demand [MWh]
 379  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 380   
 381   
 382  ***** Prosumage *****
 383  phi_pro_load             Share of prosumagers among total load [0 1]
 384  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 385  m_res_pro                Maximum installable: renewables capacity [MW]
 386  m_sto_pro_e              Maximum installable: storage energy [MWh]
 387  m_sto_pro_p              Maximum installable: storage capacity [MW]
 388  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 389   
 390   
 391  ***** Reserves *****
 392  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 393  reserves_intercept       Intercept of regression line determining reserves
       demand
 394  reserves_slope           Slope of regression line determining reserves dem
      and
 395  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 396  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 397  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 398  *reserves_exog
 399   
 400   
 401  ***** Heat *****
 402  *--- Time data ---*
 403  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 404  dh_y                     Hourly heat demand per year [MWh per m2]
 405  dh                       Hourly heat demand [MWh per m2]
 406  temp_source              Heat pumps - source temperature [°Celsius]
 407  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 408  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 409  d_dhw                    Hourly DHW demand [MWh per m2]
 410  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 411   
 412  *--- Technololgy attributes ---*
 413  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 414  eta_heat_stat            Static efficiency for heating technologies [0 1]
 415  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 416  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 417  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 418  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 419  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 420  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 421  n_sets_p_out             SETS - Power rating - heat output [MW]
 422  n_sets_e                 SETS - Energy storage capacity [MWh]
 423  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 424  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 425  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 426  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 427  temp_sink                Heat pumps - sink temperature [°Celsius]
 428  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 429  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 430  theta_night              Indicator for night hours {0 1}
 431   
 432   
 433   
 434  ***************  DERIVED PARAMETERS  *************************************
      ******
 435   
 436  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 437  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 438   
 439  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 440  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 441   
 442  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 443  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 444   
 445  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 446  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 447   
 448  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 449  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 450   
 451  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 452   
 453  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 454  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 455   
 456  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 457  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 458  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 459  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 460  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 461  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 462   
 463   
 464   
 465   
 466  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 467   
 468  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 469  technology_data(tech,headers_tech)
 470  storage_data(sto,headers_sto)
 471  reservoir_data(rsvr,headers_reservoir)
 472  time_data_upload(h,year,headers_time)
 473  dsm_data_upload(dsm,dsm_type,headers_dsm)
 474  dsm_data(dsm,headers_dsm)
 475  topology_data(l,headers_topology)
 476  ev_data(ev,headers_ev)
 477  ev_time_data_upload(h,headers_time_ev,ev)
 478  prosumage_data_generation(tech,headers_prosumage_generation)
 479  prosumage_data_storage(sto,headers_prosumage_storage)
 480  reserves_time_data_activation(h,year,reserves)
 481  reserves_time_data_provision(h,year,reserves)
 482  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 483  reserves_data(reserves,headers_reserves)
 484  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 485  heat_data(bu,ch,headers_heat)
 486  dh_upload(h,year,headers_time_heat,bu)
 487  d_dhw_upload(h,year,headers_time_heat,bu)
 488  temp_source_upload
 489  ;
 490   
 491   
 492   
 493   
 494  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 495   
 558   
 559  *%skip_Excel%
 561   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 566  *$load l headers_topology topology_data
 567  *$ontext
 568  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 575  ;
 576   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 582   
 583   
 584  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 585   
 611   
 612   
 613  *
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 617  *$load headers_time_ev ev_time_data_upload
 618  *$load reserves_time_data_activation
 619  *$load reserves_time_data_provision
 620  *$load headers_time_heat dh_upload
 621  *$load theta_night
 622  *$load temp_source_upload
 623  *$load headers_time_dhw d_dhw_upload nets_profile
 624  ;
 625   
 626   
 627   
 628   
 629  ***************  ASSIGNMENTS  ********************************************
      ******
 630   
 631   
 632   
 633  ***** Aliases *****
 634  alias (h,hh) ;
 635  alias (res,resres) ;
 636  alias (reserves,reservesreserves) ;
 637  alias (nondis,nondisnondis) ;
 638   
 639   
 640   
 641  ***** Derived sets *****
 642  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 643  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 644   
 645  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 646  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 647   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 669   
 670   
 671   
 672  ***** Parameters *****
 673   
 674  *--- Generation technologies ---*
 675  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 676  eta(tech) = technology_data(tech,'eta_con') ;
 677  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 678  c_up(dis) =technology_data(dis,'load change costs up') ;
 679  c_do(dis) = technology_data(dis,'load change costs down') ;
 680  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 681  c_vom(tech) = technology_data(tech,'variable_om') ;
 682  CO2price(tech) = technology_data(tech,'CO2_price') ;
 683   
 684  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 685  lifetime(tech) = technology_data(tech,'lifetime') ;
 686  recovery(tech) = technology_data(tech,'recovery_period') ;
 687  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 688  m_p(tech) = technology_data(tech,'max_installable') ;
 689  m_e(tech) = technology_data(tech,'max_energy') ;
 690  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 691  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 692   
 693  c_cu(res) = technology_data(res,'curtailment_costs') ;
 694   
 695   
 696  *--- Storage technologies ---*
 697  c_m_sto(sto) = storage_data(sto,'mc');
 698  eta_sto(sto) = storage_data(sto,'efficiency');
 699  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 700  phi_sto_ini(sto) = storage_data(sto,'level_start');
 701  etop_max(sto) = storage_data(sto,'etop_max') ;
 702   
 703  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 704  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 705  lifetime(sto) = storage_data(sto,'lifetime');
 706  interest_rate(sto) = storage_data(sto,'interest_rate');
 707  m_sto_e(sto) = storage_data(sto,'max_energy');
 708  m_sto_p(sto) = storage_data(sto,'max_power');
 709   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 751   
 752  *--- Temporal data ---*
 753  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 754  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 755   
 756  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 757  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 758  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 759   
 760   
 761  *--- Spatial data ---*
 762  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 763  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 764  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 765  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 766  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 767  *m_ntc(l) = topology_data(l,'max_installable') ;
 768  *dist(l) = topology_data(l,'distance') ;
 769   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 786   
 787  *--- Prosumage ---*
 788  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 789  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 790  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 791  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 792   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 838   
 839   
 840  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 841   
 842  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 843   
 844  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 845                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 846   
 847  c_i_res(res) = c_i(res) ;
 848  c_fix_res(res) = c_fix(res) ;
 849   
 850  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 851                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 852   
 853  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 854                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 883   
 884   
 885  ***************  Adjust costs to model's hourly basis ********************
      ******
 886   
 887  c_i(tech) = c_i(tech)*card(h)/8760 ;
 888  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 889  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 890  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 891  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 892  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 893  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 894  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 895   
 896  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 897  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 898  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 899  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 900  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 901   
 902  m_e('bio') = m_e('bio')*card(h)/8760 ;
 903   
 904  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 905   
 906  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 907  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 908  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 909  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 910   
 911   
 912   
 913  ***************  Check for parameter sanity ******************************
      ******
 914   
 915  *Parameter
 916  *check_heat
 917  *check_heat_agg ;
 918  *check_heat(bu) = sum( ch , phi_heat_type(bu,ch)) ;
 919  *check_heat_agg = smax( (bu) , check_heat(bu) ) ;
 920  *abort$(check_heat_agg > 1) "DATA: heating technologies for a building typ
      e do not add up to 100 percent" ;
 921   
 922   
 923   
 924   
 925   
 926   
 927   
 928   
 929   
 930   
 931   
 932   
 933   
 934  **************************************************************************
      ******
 935   
 936  *************************************
 937  ***** Features for single nodes *****
 938  *************************************
 939   
 940   
 941  *Set
 942  *features /dsm, ev, reserves, prosumage, rsvr_outflow, heat/
 943  *;
 944   
 945   
 946  *Table
 947  *feat_node(features,n)
 948  *                 DE
 949   
 950  *%prosumage%$ontext
 951  *prosumage        1
 952  *$ontext
 953  *$offtext
 954  *rsvr_outflow     0
 955   
 956  *;
 957   
 958   
 959   
 960  *%prosumage%$ontext
 961  *m_res_pro(res)$(feat_node('prosumage',n) = 0) = 0 ;
 962  *m_sto_pro_e(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 963  *m_sto_pro_p(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 964  *$ontext
 965  *$offtext
 966   
 967  *phi_rsvr_min(n) = 0
 968  *feat_node('rsvr_outflow',n)
 969  *;
 970   
 971   
 972   
 973   
 974  Set
 975  map_n_tech(tech)
 976  map_n_sto(sto)
 977  *map_n_rsvr(n,rsvr)
 978  *map_n_dsm(n,dsm)
 979  *map_n_ev(n,ev)
 980  *map_l(l)
 981  map_n_sto_pro(sto)
 982  map_n_res_pro(tech)
 983  ;
 984   
 985  map_n_tech(tech) = yes$m_p(tech) ;
 986  map_n_sto(sto) = yes$m_sto_p(sto) ;
 987  *map_n_rsvr(n,rsvr) = yes$m_rsvr_p(n,rsvr) ;
 988  *map_n_dsm(n,dsm_curt) = yes$m_dsm_cu(n,dsm_curt) ;
 989  *map_n_dsm(n,dsm_shift) = yes$m_dsm_shift(n,dsm_shift) ;
 990  *map_n_ev(n,ev) = yes$ev_data(n,ev,'share_ev') ;
 991  *map_l(l) = yes$m_ntc(l) ;
 992  map_n_sto_pro(sto) = yes$(yes$m_sto_pro_p(sto)) ;
 993  map_n_res_pro(res) = yes$(yes$m_res_pro(res)) ;
 994  ;
 995   
 996   
 997   
 998   
 999  **************************************************************************
      ******
1000   
1001  ***************************
1002  ***** Initialize data *****
1003  ***************************
1004   
1005  * Parameters for default base year
1006  d(h) = d_y('2030',h) ;
1007  phi_res(res,h) = phi_res_y('2030',res,h) ;
1008  *rsvr_in(n,rsvr,h) = rsvr_in_y(n,%base_year%,rsvr,h) ;
1009  *phi_reserves_call(n,reserves,h) = phi_reserves_call_y(n,%base_year%,reser
      ves,h) ;
1010  *phi_mean_reserves_call(n,reserves) = phi_mean_reserves_call_y(n,%base_yea
      r%,reserves) ;
1011  *reserves_exogenous(n,reserves,h) = reserves_exogenous_y(n,%base_year%,res
      erves,h) ;
1012  *dh(n,bu,ch,h) = dh_y(n,%base_year%,bu,ch,h) ;
1013  *d_dhw(n,bu,ch,h) = d_dhw_y(n,%base_year%,bu,ch,h) ;
1014   
1015  *dh(n,bu,ch,h) = area_floor(n,bu,ch) * dh(n,bu,ch,h) ;
1016  *d_dhw(n,bu,ch,h) = area_floor(n,bu,ch) * d_dhw(n,bu,ch,h) ;
1017   
1018   
1019  * No interconnections between non-adjacent or nonuploaded nodes
1020  *m_ntc(l)$( smax(n,inc(l,n)) = 0 OR smin(n,inc(l,n)) = 0 ) = 0 ;
1021   
1022   
1023  * Set loop parameters to default zero
1024  phi_min_res = 0 ;
1025  ev_quant = 0 ;
1026  phi_pro_self = 0 ;
1027  phi_pro_load = 0 ;
1028   
      phi_pro_load = 0.2 ;
      $ontext
1033   
1034   
1035  Parameter
1036  phi_min_res_exog
1037  *min_flh(n,rsvr)
1038  ;
1039   
1040  phi_min_res_exog = 1 ;
1041  *min_flh(n,rsvr) = 0 ;
1042   
1043   
1044   
1045  **************************************************************************
      ******
1046  ***** Model *****
1047  **************************************************************************
      ******
1048   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\model.gms
1050   
1051  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1061  **************************************************************************
      ******
1062   
1063   
1064  Variables
1065  Z                Value objective function [Euro]
1066  F(l,h)           Energy flow over link l in hour h [MWh]
1067  ;
1068   
1069  Positive Variables
1070  G_L(tech,h)            Generation level in hour h [MWh]
1071  G_UP(tech,h)           Generation upshift in hour h [MWh]
1072  G_DO(tech,h)           Generation downshift in hour h [MWh]
1073   
1074  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
1075  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
1076   
1077  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
1078  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
1079  STO_L(sto,h)           Storage level technology sto hour h [MWh]
1080   
1081  N_TECH(tech)           Technology tech built [MW]
1082  N_STO_E(sto)           Storage technology built - Energy [MWh]
1083  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
1084   
1085  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
1086  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
1087  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
1088  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
1089  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
1090  STO_IN_PRO2M(tech,sto,h)       Prosumage: storage loading from generation 
      for discharging to market in hour h [MWh]
1091  STO_IN_M2PRO(sto,h)            Prosumage: storage loading from market for 
      discharging to consumption in hour h [MWh]
1092  STO_IN_M2M(sto,h)              Prosumage: storage loading from market for 
      discharging to market in hour h [MWh]
1093  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
1094  STO_OUT_PRO2M(sto,h)           Prosumage: storage discharging to market fr
      om generation in hour h [MWh]
1095  STO_OUT_M2PRO(sto,h)           Prosumage: storage discharging to consumpti
      on from market in hour h [MWh]
1096  STO_OUT_M2M(sto,h)             Prosumage: storage discharging to market fr
      om market in hour h [MWh]
1097  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
1098  STO_L_PRO2M(sto,h)             Prosumage: storage level generation to mark
      et in hour h [MWh]
1099  STO_L_M2PRO(sto,h)             Prosumage: storage level market to consumot
      ion in hour h [MWh]
1100  STO_L_M2M(sto,h)               Prosumage: storage level market to market i
      n hour h [MWh]
1101  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
1102  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
1103  STO_L_PRO(sto,h)               Prosumage: overall storage level in hour h 
      [MWh]
1104  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
1105   
1106  ;
1107   
1108   
1109   
1110   
1111  **************************************************************************
      ******
1112   
1113  Equations
1114  * Objective
1115  obj                      Objective cost minimization
1116   
1117  * Energy balance
1118  con1a_bal                Energy Balance
1119   
1120  * Load change costs
1121  con2a_loadlevel          Load change costs: Level
1122  con2b_loadlevelstart     Load change costs: Level for first period
1123   
1124  * Capacity contraints and flexibility constraints
1125  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1126  con3e_maxprod_res                Capacity constraints renewables
1127   
1128  * Storage constraints
1129  con4a_stolev_start        Storage Level Dynamics Initial Condition
1130  con4b_stolev              Storage Level Dynamics
1131  con4c_stolev_max          Storage Power Capacity
1132  con4d_maxin_sto           Storage maximum inflow
1133  con4e_maxout_sto          Storage maximum outflow
1134  con4j_ending              End level equal to initial level
1135  con4k_PHS_EtoP            Maximum E to P ratio for PHS
1136   
1137  * Minimum restrictions for renewables and biomass
1138  con5a_minRES             Minimum yearly renewables requirement
1139  con5b_max_energy         Maximum yearly biomass energy
1140   
1141  * Maximum installation conditions
1142  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1143  con8b_max_I_sto_e                Maximum installable energy: Storage in MW
      h
1144  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1145   
1146  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1147  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1148  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1149   
1150  * Prosumage
1151  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1152  con11b_pro_balance                       Prosumage: energy balance
1153  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1154  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1155  con11e_pro_stolev_PRO2M                  Prosumage: storage level prosumag
      ers-to-market
1156  con11f_pro_stolev_M2PRO                  Prosumage: storage level market-t
      o-prosumagers
1157  con11g_pro_stolev_M2M                    Prosumage: storage level market-t
      o-market
1158  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1159  con11h_2_pro_stolev_start_PRO2M          Prosumage: storage level initial 
      conditions
1160  con11h_3_pro_stolev_start_M2PRO          Prosumage: storage level initial 
      conditions
1161  con11h_4_pro_stolev_start_M2M            Prosumage: storage level initial 
      conditions
1162  con11i_pro_stolev                        Prosumage: storage level total
1163  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1164  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1165  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1166  con11m_pro_maxout_lev                    Prosumage: maximum storage outflo
      w linked to level
1167  con11n_pro_maxin_lev                     Prosumage: maximum storage inflow
       linked to level
1168  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1169  ;
1170   
1171   
1172   
1173   
1174  **************************************************************************
      ******
1175   
1176  * ------------------------------------------------------------------------
      ---- *
1177  ***** Objective function *****
1178  * ------------------------------------------------------------------------
      ---- *
1179   
1180  obj..
1181           Z =E=
1182                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1183                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1184                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1185                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1186                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1187                   + sum( tech , c_i(tech)*N_TECH(tech) )
1188                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1189                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1190                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1191                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
       
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2M(sto,h) + sum( 
      res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h)) + STO_OUT_PRO2M
      (sto,h) + STO_OUT_M2M(sto,h) ) )
      $ontext
1202  ;
1203   
1204  * ------------------------------------------------------------------------
      ---- *
1205  ***** Energy balance and load levels *****
1206  * ------------------------------------------------------------------------
      ---- *
1207   
1208  * Energy balance
1209  con1a_bal(hh)..
1210           ( 1 - phi_pro_load )* d(hh) + sum( sto , STO_IN(sto,hh) )
               + G_MARKET_M2PRO(hh)
               + sum( sto , STO_IN_M2PRO(sto,hh))
               + sum( sto , STO_IN_M2M(sto,hh))
      $ontext
1217   
1218           =E=
1219           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
1220   
               + sum( res , G_MARKET_PRO2M(res,hh) )
               + sum( sto , STO_OUT_PRO2M(sto,hh))
               + sum( sto , STO_OUT_M2M(sto,hh))
      $ontext
1227   
1228  ;
1229   
1230  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1231          G_L(dis,h) =E= G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)
1232  ;
1233   
1234  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1235           G_L(dis,h) =E= G_UP(dis,h)
1236  ;
1237   
1238  * ------------------------------------------------------------------------
      ---- *
1239  ***** Hourly maximum generation caps and constraints related to reserves  
       *****
1240  * ------------------------------------------------------------------------
      ---- *
1241   
1242  con3a_maxprod_dispatchable(dis,h)..
1243          G_L(dis,h)
1244   
1245          =L= N_TECH(dis)
1246  ;
1247   
1248  con3e_maxprod_res(nondis,h)..
1249          G_RES(nondis,h) + CU(nondis,h)
1250   
1251          =E= phi_res(nondis,h) * N_TECH(nondis)
1252  ;
1253   
1254  * ------------------------------------------------------------------------
      ---- *
1255  ***** Storage constraints *****
1256  * ------------------------------------------------------------------------
      ---- *
1257   
1258  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1259          STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(
      1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1260  ;
1261   
1262  con4b_stolev(sto,h)$((ord(h)>1))..
1263           STO_L(sto,h) =E= STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/
      2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1264   
1265  ;
1266   
1267  con4c_stolev_max(sto,h)..
1268          STO_L(sto,h) =L= N_STO_E(sto)
1269  ;
1270   
1271  con4d_maxin_sto(sto,h)..
1272          STO_IN(sto,h)
1273   
1274          =L= N_STO_P(sto)
1275  ;
1276   
1277  con4e_maxout_sto(sto,h)..
1278          STO_OUT(sto,h)
1279   
1280          =L= N_STO_P(sto)
1281  ;
1282   
1283  con4j_ending(sto,h)$(ord(h) = card(h))..
1284           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
1285  ;
1286   
1287  con4k_PHS_EtoP(sto)..
1288          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1289  ;
1290   
1291  * ------------------------------------------------------------------------
      ---- *
1292  ***** Quotas for renewables and biomass *****
1293  * ------------------------------------------------------------------------
      ---- *
1294   
1295  con5a_minRES..
1296  sum( h , G_L('bio',h) + sum( nondis , G_RES(nondis,h))
1297   
               + sum( sto , STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h)) + sum
      ( res , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1302  )
1303          =G= phi_min_res * phi_min_res_exog * sum( h ,
1304           sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h))
1305   
               + sum( res , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1310           )
1311  ;
1312   
1313  con5b_max_energy(dis)$(m_e(dis))..
1314           sum( h , G_L(dis,h) ) =L= m_e(dis)
1315  ;
1316   
1317   
1318  * ------------------------------------------------------------------------
      ---- *
1319  ***** Maximum installation constraints *****
1320  * ------------------------------------------------------------------------
      ---- *
1321   
1322  con8a_max_I_power(tech)..
1323           N_TECH(tech) =L= m_p(tech)
1324  ;
1325   
1326  con8b_max_I_sto_e(sto)..
1327           N_STO_E(sto) =L= m_sto_e(sto)
1328  ;
1329   
1330  con8c_max_I_sto_p(sto)..
1331           N_STO_P(sto) =L= m_sto_p(sto)
1332  ;
1333   
1334   
1335   
1336  con8f_max_pro_res(res)..
1337           N_RES_PRO(res) =L= m_res_pro(res)
1338  ;
1339   
1340  con8g_max_pro_sto_e(sto)..
1341           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1342  ;
1343   
1344  con8h_max_sto_pro_p(sto)..
1345           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1346  ;
1347   
1348   
1349   
1350  * ------------------------------------------------------------------------
      ---- *
1351  ***** Prosumage constraints *****
1352  * ------------------------------------------------------------------------
      ---- *
1353   
1354  con11a_pro_distrib(res,h)..
1355           phi_res(res,h) * N_RES_PRO(res)
1356           =E=
1357           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
1358  ;
1359   
1360  con11b_pro_balance(h)..
1361           phi_pro_load * d(h)
1362           =E=
1363           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1364  ;
1365   
1366  con11c_pro_selfcon..
1367           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1368           =G=
1369           phi_pro_self * sum( h , phi_pro_load * d(h))
1370  ;
1371   
1372  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1373           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1374  ;
1375   
1376  con11e_pro_stolev_PRO2M(sto,h)$(ord(h) > 1)..
1377           STO_L_PRO2M(sto,h) =E= STO_L_PRO2M(sto,h-1) + sum( res , STO_IN_P
      RO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2M(sto,h)/(1+eta_sto(sto)
      )*2
1378  ;
1379   
1380  con11f_pro_stolev_M2PRO(sto,h)$(ord(h) > 1)..
1381           STO_L_M2PRO(sto,h) =E= STO_L_M2PRO(sto,h-1) + STO_IN_M2PRO(sto,h)
      *(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta_sto(sto))*2
1382  ;
1383   
1384  con11g_pro_stolev_M2M(sto,h)$(ord(h) > 1)..
1385           STO_L_M2M(sto,h) =E= STO_L_M2M(sto,h-1) + STO_IN_M2M(sto,h)*(1+et
      a_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(sto))*2
1386  ;
1387   
1388  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1389          STO_L_PRO2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO
      (sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT
      _PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1390  ;
1391   
1392  con11h_2_pro_stolev_start_PRO2M(sto,h)$(ord(h) = 1)..
1393          STO_L_PRO2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + sum( res , STO_IN_PRO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO
      2M(sto,h)/(1+eta_sto(sto))*2
1394  ;
1395   
1396  con11h_3_pro_stolev_start_M2PRO(sto,h)$( ord(h) = 1)..
1397          STO_L_M2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + STO_IN_M2PRO(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta
      _sto(sto))*2
1398  ;
1399   
1400  con11h_4_pro_stolev_start_M2M(sto,h)$(ord(h) = 1)..
1401          STO_L_M2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(sto
      ) + STO_IN_M2M(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(s
      to))*2
1402  ;
1403   
1404  con11i_pro_stolev(sto,h)$(ord(h)>1)..
1405           STO_L_PRO(sto,h) =E=   STO_L_PRO2PRO(sto,h) +  STO_L_PRO2M(sto,h)
       + STO_L_M2PRO(sto,h) + STO_L_M2M(sto,h)
1406  ;
1407   
1408  con11j_pro_stolev_max(sto,h)..
1409          STO_L_PRO(sto,h) =L= N_STO_E_PRO(sto)
1410  ;
1411   
1412  con11k_pro_maxin_sto(sto,h)..
1413          sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) ) +
       STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h)
1414          =L= N_STO_P_PRO(sto)
1415  ;
1416   
1417  con11l_pro_maxout_sto(sto,h)..
1418          STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2PRO(sto,
      h) + STO_OUT_M2M(sto,h)
1419          =L= N_STO_P_PRO(sto)
1420  ;
1421   
1422  con11m_pro_maxout_lev(sto,h)..
1423          ( STO_OUT_PRO2PRO(sto,h) + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(st
      o,h) + STO_OUT_M2M(sto,h) ) / (1+eta_sto(sto))*2
1424          =L= STO_L_PRO(sto,h-1)
1425  ;
1426   
1427  con11n_pro_maxin_lev(sto,h)..
1428          ( sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
       + STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h) ) * (1+eta_sto(sto))/2
1429          =L= N_STO_E_PRO(sto) - STO_L_PRO(sto,h-1)
1430  ;
1431   
1432  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1433           STO_L_PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1434  ;
1435   
1436   
1437  **************************************************************************
      ******
1438  ***** MODEL *****
1439  **************************************************************************
      ******
1440   
1441  model DIETER /
1442  obj
1443   
1444  con1a_bal
1445   
1446  con2a_loadlevel
1447  con2b_loadlevelstart
1448   
1449  con3a_maxprod_dispatchable
1450   
1451  con3e_maxprod_res
1452   
1453  con4a_stolev_start
1454  con4b_stolev
1455  con4c_stolev_max
1456  con4d_maxin_sto
1457  con4e_maxout_sto
1458   
1459  con4j_ending
1460  con4k_PHS_EtoP
1461   
1462  con5a_minRES
1463  con5b_max_energy
1464   
1465  con8a_max_I_power
1466  con8b_max_I_sto_e
1467  con8c_max_I_sto_p
1468   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11e_pro_stolev_PRO2M
      con11f_pro_stolev_M2PRO
      con11g_pro_stolev_M2M
      con11h_1_pro_stolev_start_PRO2PRO
      con11h_2_pro_stolev_start_PRO2M
      con11h_3_pro_stolev_start_M2PRO
      con11h_4_pro_stolev_start_M2M
      con11i_pro_stolev
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11m_pro_maxout_lev
      con11n_pro_maxin_lev
      con11o_pro_ending
      $ontext
1493   
1494  /;
1495   
1496   
1497   
1498   
1499  **************************************************************************
      ******
1500  ***** Options, fixings, report preparation *****
1501  **************************************************************************
      ******
1502   
1503  * Solver options
1509   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1520   
1521  dieter.OptFile = 1;
1522  dieter.holdFixed = 1 ;
1523   
1524   
1525   
1526   
1527  **************************************************************************
      ******
1528  ***** Solve *****
1529  **************************************************************************
      ******
1530   
1531  * Preparation of GUSS tool for scenario analysis
1532  phi_min_res = eps ;
1533  ev_quant = eps ;
1534  phi_pro_self = eps ;
1535   
1537   
1538  Set
1539  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1540  superscen        Scenarios                               /scen1*scen1000/
1541  map(superscen,loop_res_share,loop_ev,loop_prosumage)    /#superscen:(#loop
      _res_share.#loop_ev.#loop_prosumage)/
1542  ;
1543   
1544  set
1545  scen(superscen);
1546  scen(superscen) = yes$( sum((loop_res_share,loop_ev,loop_prosumage) , map(
      superscen,loop_res_share,loop_ev,loop_prosumage)) )    ;
1547   
1548  Parameters
1549  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1550  modstats(superscen, modelstats)
1551  min_res
1552  number_ev
1553  pro_selfcon
1554  ;
1555   
1556  min_res(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,loop
      _res_share,loop_ev,loop_prosumage) , loop_res_share.val/100 ) ;
1557  number_ev(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,lo
      op_res_share,loop_ev,loop_prosumage) , loop_ev.val ) ;
1558  pro_selfcon(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,
      loop_res_share,loop_ev,loop_prosumage) , loop_prosumage.val/100 ) ;
1559   
1560  Parameters
1561  * Equations
1562  marginal_con5a(superscen)
1563  marginal_con1a(superscen,*)
1564  marginal_con9a(superscen,*,*,*)
1565  marginal_con9b(superscen,*,*,*)
1566   
1567  * Basic
1568  lev_Z(superscen)
1569  lev_G_L(superscen,tech,h)
1570  lev_G_UP(superscen,tech,h)
1571  lev_G_DO(superscen,tech,h)
1572  lev_G_RES(superscen,tech,h)
1573  lev_CU(superscen,tech,h)
1574  lev_STO_IN(superscen,sto,h)
1575  lev_STO_OUT(superscen,sto,h)
1576  lev_STO_L(superscen,sto,h)
1577  lev_N_TECH(superscen,tech)
1578  lev_N_STO_E(superscen,sto)
1579  lev_N_STO_P(superscen,sto)
1580   
1581   
1582  * Prosumage
1583  lev_CU_PRO(superscen,tech,h)
1584  lev_G_MARKET_PRO2M(superscen,tech,h)
1585  lev_G_MARKET_M2PRO(superscen,h)
1586  lev_G_RES_PRO(superscen,tech,h)
1587  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1588  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1589  lev_STO_IN_M2PRO(superscen,sto,h)
1590  lev_STO_IN_M2M(superscen,sto,h)
1591  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1592  lev_STO_OUT_PRO2M(superscen,sto,h)
1593  lev_STO_OUT_M2PRO(superscen,sto,h)
1594  lev_STO_OUT_M2M(superscen,sto,h)
1595  lev_STO_L_PRO2PRO(superscen,sto,h)
1596  lev_STO_L_PRO2M(superscen,sto,h)
1597  lev_STO_L_M2PRO(superscen,sto,h)
1598  lev_STO_L_M2M(superscen,sto,h)
1599  lev_N_STO_E_PRO(superscen,sto)
1600  lev_N_STO_P_PRO(superscen,sto)
1601  lev_STO_L_PRO(superscen,sto,h)
1602  lev_N_RES_PRO(superscen,tech)
1603  ;
1604   
1605   
1606  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\fix.gms
1608   
1609  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1619  **************************************************************************
      ******
1620   
1621   
1622   
1623  **************************************************************************
      ******
1624  **** Run of river  *******************************************************
      ******
1625  **************************************************************************
      ******
1626   
1627  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1628   
1629  *$ontext
1630  N_TECH.fx('ror') = 5857.47 ;
1631  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
      *RP_NONDIS.fx(reserves,'ror',h) = 0 ;
      $ontext
1636   
1637  * Fix everything to zero in case no ROR option is selected:
1638  *N_TECH.fx('ror') = 0 ;
1639  *G_RES.fx('ror',h) = 0 ;
1640  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1641   
1642   
1643   
1644  **************************************************************************
      ******
1645  **** Exogenous EV  *******************************************************
      ******
1646  **************************************************************************
      ******
1647   
1648   
1649   
1650  **************************************************************************
      ******
1651  **** No storage and DSM in first period  *********************************
      ******
1652  **************************************************************************
      ******
1653   
1654  ** No storage inflow in first period **
1655  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1656   
1657   
1658   
1659  **************************************************************************
      ******
1660  **** No primary reserves by heating devices  *****************************
      ******
1661  **************************************************************************
      ******
1662   
1663   
1664  **************************************************************************
      ******
1665  **** Fixing to reduce model size  ****************************************
      ******
1666  **************************************************************************
      ******
1667   
1668  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1669  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1670   
1671  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1672  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1673  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1674  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1675  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1676  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1677   
1678  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1679  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1680  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1681  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1682  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1683   
1684   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1708   
1709   
1710   
1711  **************************************************************************
      ******
1712  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1713  **************************************************************************
      ******
1714   
1715  * Default level zero for report parameters
1716  lev_Z(scen) = 0 ;
1717  lev_G_L(scen,tech,h) = 0 ;
1718  lev_G_UP(scen,tech,h) = 0 ;
1719  lev_G_DO(scen,tech,h) = 0 ;
1720  lev_G_RES(scen,tech,h) = 0 ;
1721  lev_CU(scen,tech,h) = 0 ;
1722  lev_STO_IN(scen,sto,h) = 0 ;
1723  lev_STO_OUT(scen,sto,h) = 0 ;
1724  lev_STO_L(scen,sto,h) = 0 ;
1725  lev_N_TECH(scen,tech) = 0 ;
1726  lev_N_STO_E(scen,sto) = 0 ;
1727  lev_N_STO_P(scen,sto) = 0 ;
1728  marginal_con1a(scen,h) = 0 ;
1729  marginal_con5a(superscen) = 0 ;
1730  *lev_NTC(superscen,l) = 0 ;
1731  *lev_F(superscen,l,h) = 0 ;
1732  *lev_RSVR_OUT(superscen,rsvr,h) = 0 ;
1733  *lev_RSVR_L(superscen,rsvr,h) = 0 ;
1734  *lev_N_RSVR_E(superscen,rsvr) = 0 ;
1735  *lev_N_RSVR_P(superscen,rsvr) = 0 ;
1736  *lev_G_INFES(superscen,h) = 0 ;
1737   
1738   
1739  * Prosumage
1740  lev_CU_PRO(scen,tech,h) = 0 ;
1741  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1742  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1743  lev_G_RES_PRO(scen,tech,h) = 0  ;
1744  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1745  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1746  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1747  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1748  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1749  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1750  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1751  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1752  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1753  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1754  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1755  lev_STO_L_M2M(scen,sto,h) = 0  ;
1756  lev_N_STO_E_PRO(scen,sto) = 0  ;
1757  lev_N_STO_P_PRO(scen,sto) = 0  ;
1758  lev_STO_L_PRO(scen,sto,h) = 0  ;
1759  lev_N_RES_PRO(scen,tech) = 0  ;
1760   
1761   
1762  * Fixing of report parameters for run-of-river
1763  *$ontext
1764  lev_N_TECH(scen,'ror') = 5857.47 ;
1765  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      *lev_RP_NONDIS(scenreserves,'ror',h) = 0 ;
      $ontext
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1777   
1778   
1779   
1780   
1781   
1782   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\scenario.gms
1784   
1785  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1795  **************************************************************************
      ******
1796   
1797   
1798   
1799   
1800  *****************************************
1801  **** Scenario file                   ****
1802  ****                                 ****
1803  *****************************************
1804   
1805  Parameter
1806  m_exog_p(tech)
1807  m_exog_sto_e(sto)
1808  m_exog_sto_p(sto)
1809  *m_exog_rsvr_p(rsvr)
1810  *m_exog_ntc(l)
1811  ;
1812   
1813  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1814  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1815  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1816  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1817  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1818   
1819   
1820  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1837   
1838  *** Investment model
1839  *$ontext
1840  N_TECH.lo(tech) = 0 ;
1841  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1842  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1843  N_TECH.lo('pv') = m_exog_p('pv') ;
1844  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1845  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1846  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1847  *NTC.lo(l) = m_exog_ntc(l) ;
1848   
1849  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1850  N_TECH.up('wind_on') = inf ;
1851  N_TECH.up('wind_off') = inf ;
1852  N_TECH.up('pv') = inf ;
1853  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1854  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1855  N_STO_P.up('sto1') = inf ;
1856  N_STO_P.up('sto5') = inf ;
1857  N_STO_P.up('sto7') = inf ;
1858  N_STO_E.up('sto1') = inf ;
1859  N_STO_E.up('sto5') = inf ;
1860  N_STO_E.up('sto7') = inf ;
1861  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1862  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1863  *$offtext
1864   
1865   
1866  *** Reservoir assumption - not used here
1867  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1868  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1869  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1870  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1871   
1872   
1873  *** Germany only, no infeasibility
1874  *NTC.fx(l) = 0 ;
1875  *F.fx(l,h) = 0 ;
1876  *G_INFES.fx(h) = 0 ;
1877   
1878   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1909   
1910   
1911  * Definition of dictionary set for GUSS tool
1912   
1913  Set dict(*,*,*) /
1914  scen             .scenario       .''
1915  gussoptions      .opt            .modstats
1916   
1917  phi_min_res      .param          .min_res
1918   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1923   
1924   
1925  con5a_minRES     .marginal       .marginal_con5a
1926  con1a_bal        .marginal       .marginal_con1a
1927   
1928  Z                .level          .lev_Z
1929  G_L              .level          .lev_G_L
1930  G_UP             .level          .lev_G_UP
1931  G_DO             .level          .lev_G_DO
1932  G_RES            .level          .lev_G_RES
1933  CU               .level          .lev_CU
1934  STO_IN           .level          .lev_STO_IN
1935  STO_OUT          .level          .lev_STO_OUT
1936  STO_L            .level          .lev_STO_L
1937  N_TECH           .level          .lev_N_TECH
1938  N_STO_E          .level          .lev_N_STO_E
1939  N_STO_P          .level          .lev_N_STO_P
1940   
1941   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
      STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
      STO_IN_M2M       .level          .lev_STO_IN_M2M
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
      STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
      STO_OUT_M2M      .level          .lev_STO_OUT_M2M
      STO_L_PRO        .level          .lev_STO_L_PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      STO_L_PRO2M      .level          .lev_STO_L_PRO2M
      STO_L_M2PRO      .level          .lev_STO_L_M2PRO
      STO_L_M2M        .level          .lev_STO_L_M2M
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1965  /
1966  ;
1967   
1968  *Test: Get exact same result as in orignal DIETER
1969  CU.fx('pv','h3086') = 0;
1970  CU.fx('pv','h8649') = 0;
1971   
1972  solve DIETER using lp min Z scenario dict;
1973   
1974   
1975  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\report.gms
1977   
1978  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1988  **************************************************************************
      ******
1989   
1991   
1992   
1993   
1994   
1995  **************************************************************************
      ******
1996  **** Parameters for report file  *****************************************
      ******
1997  **************************************************************************
      ******
1998   
1999  Parameter
2000  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
2001  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
2002  corr_fac_sto             Balancing correction factor - storage technologie
      s
2003  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
2004  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
2005  corr_fac_ev              Balancing correction factor - electric vehicles
2006  corr_fac_rsvr            Balancing correction factor - reservoir
2007  corr_fac_sets            Balancing correction factor - SETS
2008  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2009  corr_fac_hp              Balancing correction factor - heat pumps
2010  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
2011   
2012  corr_fac_ev_sep
2013   
2014  gross_energy_demand                      Gross energy demand
2015  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
2016  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2017  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
2018  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
2019   
2020  reserves_activated
2021   
2022  calc_maxprice
2023  calc_minprice
2024   
2025  report
2026  report_tech
2027  report_tech_hours
2028  report_hours
2029  report_node
2030  report_line
2031  report_cost
2032   
2033  report_reserves
2034  report_reserves_hours
2035  report_reserves_tech
2036  report_reserves_tech_hours
2037   
2038  report_prosumage
2039  report_prosumage_tech
2040  report_prosumage_tech_hours
2041  report_market
2042  report_market_tech
2043  report_market_tech_hours
2044   
2045  report_heat_tech_hours
2046  report_heat_tech
2047  ;
2048   
2049   
2050   
2051   
2052  **************************************************************************
      ******
2053  **** Initialize reporting paremetrs  *************************************
      ******
2054  **************************************************************************
      ******
2055   
2056  * Set reporting sensitivity. All results below will be reported as zero
2057  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
2058  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
2059  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
2060   
2061   
2062  * ------------------------------------------------------------------------
      ----
2063   
2064  * Min and max for prices
2065  calc_maxprice = 0 ;
2066  calc_minprice = 1000 ;
2067   
2068   
2069  * ------------------------------------------------------------------------
      ----
2070   
2071  * Default values for correction factors
2072  corr_fac_dis(scen,dis,h) = 0 ;
2073  corr_fac_nondis(scen,nondis,h) = 0 ;
2074  corr_fac_sto(scen,sto,h) = 0 ;
2075  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2076  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2077  *corr_fac_ev(scen,h) = 0 ;
2078  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2079  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2080  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2081  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2082  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2083   
2084  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2085   
2086   
2087  * ------------------------------------------------------------------------
      ----
2088   
2089  * Parameter for hourly nodal reserves activated
2090  reserves_activated(scen,h) = 0 ;
2091   
2092   
2093   
2094   
2095   
2096  * ------------------------------------------------------------------------
      ----
2097   
2098  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2105   
2106   
2107  * ------------------------------------------------------------------------
      ----
2108   
2109  *Determine balancing correction factors
2110   
2111   
2112   
2113   
2114  * ------------------------------------------------------------------------
      ----
2115   
2116  * Define gross energy demand for reporting
2117  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2122   
2123   
2124  )
2125  ;
2126   
2127   
2128  **************************************************************************
      ******
2129  **** Report  *************************************************************
      ******
2130  **************************************************************************
      ******
2131   
2132  * RPEORT model statistics
2133          report('model status',loop_res_share,loop_ev,loop_prosumage) = sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen,'m
      odelstat')) ;
2134          report('solve time',loop_res_share,loop_ev,loop_prosumage) = sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen,'res
      usd')) ;
2135          report('obj value',loop_res_share,loop_ev,loop_prosumage) = sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_Z(scen)* 1) ;
2136   
2137   
2138  * ------------------------------------------------------------------------
      ----
2139   
2140  * REPORT HOURS
2141          report_hours('demand consumers',loop_res_share,loop_ev,loop_prosum
      age,h)= d(h) ;
2142          report_hours('energy generated',loop_res_share,loop_ev,loop_prosum
      age,h)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( 
      dis , lev_G_L(scen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - cor
      r_fac_nondis(scen,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_f
      ac_sto(scen,sto,h))
2143  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2144  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2145  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2146  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2147  *        report_hours('infeasibility',loop_res_share,loop_ev,loop_prosumag
      e,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_
      INFES(scen,h));
2148  *        report_hours('gross exports',loop_res_share,loop_ev,loop_prosumag
      e,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , -min(inc(l)* lev_F(scen,l,h),0) )) ;
2149  *        report_hours('gross imports',loop_res_share,loop_ev,loop_prosumag
      e,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2150          report_hours('price',loop_res_share,loop_ev,loop_prosumage,h)= - s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con1a
      (scen,h)) ;
2151   
2152                   report_hours('energy generated',loop_res_share,loop_ev,lo
      op_prosumage,h)$(report_hours('energy generated',loop_res_share,loop_ev,lo
      op_prosumage,h)< eps_rep_abs ) = 0 ;
2153                   report_hours('energy demanded',loop_res_share,loop_ev,loo
      p_prosumage,h)$(report_hours('energy demanded',loop_res_share,loop_ev,loop
      _prosumage,h)< eps_rep_abs ) = 0 ;
2154  *                 report_hours('gross exports',loop_res_share,loop_ev,loop
      _prosumage,h)$(report_hours('gross exports',loop_res_share,loop_ev,loop_pr
      osumage,h)< eps_rep_abs ) = 0 ;
2155  *                 report_hours('gross imports',loop_res_share,loop_ev,loop
      _prosumage,h)$(report_hours('gross imports',loop_res_share,loop_ev,loop_pr
      osumage,h)< eps_rep_abs ) = 0 ;
2156                   report_hours('demand consumers',loop_res_share,loop_ev,lo
      op_prosumage,h)$(report_hours('demand consumers',loop_res_share,loop_ev,lo
      op_prosumage,h)< eps_rep_abs) = 0 ;
2157                   report_hours('price',loop_res_share,loop_ev,loop_prosumag
      e,h)$(report_hours('price',loop_res_share,loop_ev,loop_prosumage,h)< eps_r
      ep_abs AND report_hours('price',loop_res_share,loop_ev,loop_prosumage,h)> 
      -eps_rep_abs) = eps ;
2158  *                 report_hours('infeasibility',loop_res_share,loop_ev,loop
      _prosumage,h)$(report_hours('infeasibility',loop_res_share,loop_ev,loop_pr
      osumage,h)< eps_rep_abs) = 0 ;
2159   
2160   
2161  * ------------------------------------------------------------------------
      ----
2162   
2163  * REPORT TECH HOURS
2164          report_tech_hours('generation conventional',loop_res_share,loop_ev
      ,loop_prosumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2165  *        report_tech_hours('infeasibility',loop_res_share,loop_ev,loop_pro
      sumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_G_INFES(scen,h) ) ;
2166          report_tech_hours('generation renewable',loop_res_share,loop_ev,lo
      op_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,re
      s,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( s
      to , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)
      ) ) ;
2167  *        report_tech_hours('generation renewable',loop_res_share,loop_ev,l
      oop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_RSVR_OUT(scen,rsvr,h) ) ;
2168  *        report_tech_hours('reservoir inflow',loop_res_share,loop_ev,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , rsvr_in(rsvr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2169  *        report_tech_hours('reservoir level',loop_res_share,loop_ev,loop_p
      rosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_RSVR_L(scen,rsvr,h) ) ;
2170          report_tech_hours('curtailment of fluct res',loop_res_share,loop_e
      v,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2171          report_tech_hours('generation storage',loop_res_share,loop_ev,loop
      _prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_O
      UT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(s
      cen,sto,h) ) ;
2172          report_tech_hours('storage loading',loop_res_share,loop_ev,loop_pr
      osumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)
       + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_
      STO_IN_M2M(scen,sto,h) ) ;
2173          report_tech_hours('storage level',loop_res_share,loop_ev,loop_pros
      umage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2174  *        report_tech_hours('netto exports',loop_res_share,loop_ev,loop_pro
      sumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , - sum( l , inc(l)* lev_F(scen,l,h)) ) ;
2175   
2176                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_ev,loop_prosumage,con,h)$(report_tech_hours('generation conventiona
      l',loop_res_share,loop_ev,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2177                   report_tech_hours('generation renewable',loop_res_share,l
      oop_ev,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loo
      p_res_share,loop_ev,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2178  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_ev,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable
      ',loop_res_share,loop_ev,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2179                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_ev,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct 
      res',loop_res_share,loop_ev,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2180                   report_tech_hours('generation storage',loop_res_share,loo
      p_ev,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_re
      s_share,loop_ev,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2181                   report_tech_hours('storage loading',loop_res_share,loop_e
      v,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_shar
      e,loop_ev,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2182                   report_tech_hours('storage level',loop_res_share,loop_ev,
      loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,lo
      op_ev,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2183  *                 report_tech_hours('netto exports',loop_res_share,loop_ev
      ,loop_prosumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_shar
      e,loop_ev,loop_prosumage,'',h)) < eps_rep_abs ) = 0 ;
2184  *                 report_tech_hours('infeasibility',loop_res_share,loop_ev
      ,loop_prosumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,lo
      op_ev,loop_prosumage,'',h)< eps_rep_abs ) = 0 ;
2185  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _ev,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_
      share,loop_ev,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2186  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      ev,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_sh
      are,loop_ev,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2187   
2188   
2189  * ------------------------------------------------------------------------
      ----
2190   
2191  * RPEORT LINE
2192   
2193  * ------------------------------------------------------------------------
      ----
2194   
2195  * REPORT NODE
2196          report_node('energy demand total',loop_res_share,loop_ev,loop_pros
      umage)= (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_I
      N_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN
      _M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2197   
2198  ;
2199          report_node('energy demand gross',loop_res_share,loop_ev,loop_pros
      umage)= sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gros
      s_energy_demand(scen)) ;
2200          report_node('energy generated net',loop_res_share,loop_ev,loop_pro
      sumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis
      ,h) - corr_fac_nondis(scen,nondis,h))
2201  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2202           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2203          report_node('energy generated gross',loop_res_share,loop_ev,loop_p
      rosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nond
      is,h) - corr_fac_nondis(scen,nondis,h))
2204  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2205           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2206  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2207  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2208  *        report_node('net exports',loop_res_share,loop_ev,loop_prosumage)=
       sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       - inc(l)* lev_F(scen,l,h)) ) ;
2209  *        report_node('gross exports',loop_res_share,loop_ev,loop_prosumage
      )= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , -min(inc(l)* lev_F(scen,l,h),0) ) ) ;
2210  *        report_node('gross imports',loop_res_share,loop_ev,loop_prosumage
      )= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2211  *        report_node('net import share in gross demand',loop_res_share,loo
      p_ev,loop_prosumage)= -min(report_node('net exports',loop_res_share,loop_e
      v,loop_prosumage,n),0)/report_node('energy demand gross',loop_res_share,lo
      op_ev,loop_prosumage);
2212  *        report_node('net export share in net generation',loop_res_share,l
      oop_ev,loop_prosumage)= max(report_node('net exports',loop_res_share,loop_
      ev,loop_prosumage,n),0)/report_node('energy generated net',loop_res_share,
      loop_ev,loop_prosumage);
2213  *        report_node('trade capacity',loop_res_share,loop_ev,loop_prosumag
      e)= sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( l ,
       abs(inc(l)* lev_NTC(scen,l))) ) ;
2214  *        report_node('gross import share',loop_res_share,loop_ev,loop_pros
      umage)= sum( h , report_hours('gross imports',loop_res_share,loop_ev,loop_
      prosumage,h))/ sum( h , report_hours('energy demanded',loop_res_share,loop
      _ev,loop_prosumage,h)) ;
2215  *        report_node('gross export share in net generation',loop_res_share
      ,loop_ev,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_s
      hare,loop_ev,loop_prosumage,h))/sum( h , report_hours('energy generated',l
      oop_res_share,loop_ev,loop_prosumage,h)) ;
2216          report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage
      )= sum( tech , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_N_TECH(scen,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,l
      oop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ))
2217  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_N_RSVR_P(scen,rsvr)))
2218   
2219  ;
2220          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_ev,loop_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h)
      )) * 1 ;
2221          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_ev,loop_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) +
       sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       phi_res(res,h) * lev_N_RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h
      )) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , lev_CU_PRO(scen,res,h))) + sum((nondis,h), sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_CU(scen,nondis,h)))) * 1 / (sum((r
      es,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_re
      s(res,h) * lev_N_RES_PRO(scen,res))) + sum((nondis,h), sum(scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(
      scen,nondis))))) ;
2222          report_node('bio not utilized absolute',loop_res_share,loop_ev,loo
      p_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2223          report_node('bio not utilized relative',loop_res_share,loop_ev,loo
      p_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') 
      ;
2224          report_node('max price',loop_res_share,loop_ev,loop_prosumage)$sum
      (h,d(h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2225          report_node('min price',loop_res_share,loop_ev,loop_prosumage)$sum
      (h,d(h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2226          report_node('mean price',loop_res_share,loop_ev,loop_prosumage)$su
      m(h,d(h)) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , marginal_con1a(scen,h)))/card(h) ;
2227   
2228                   report_node('energy demand total',loop_res_share,loop_ev,
      loop_prosumage)$(report_node('energy demand total',loop_res_share,loop_ev,
      loop_prosumage)< eps_rep_abs) = 0 ;
2229                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_ev,loop_prosumage)$(report_node('curtailment of fluct res absol
      ute',loop_res_share,loop_ev,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2230                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_ev,loop_prosumage)$(report_node('curtailment of fluct res relat
      ive',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
2231                   report_node('bio not utilized absolute',loop_res_share,lo
      op_ev,loop_prosumage)$(report_node('bio not utilized absolute',loop_res_sh
      are,loop_ev,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2232                   report_node('bio not utilized relative',loop_res_share,lo
      op_ev,loop_prosumage)$(report_node('bio not utilized relative',loop_res_sh
      are,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
2233                   report_node('min price',loop_res_share,loop_ev,loop_prosu
      mage)$(report_node('min price',loop_res_share,loop_ev,loop_prosumage)< eps
      _rep_abs AND report_node('min price',loop_res_share,loop_ev,loop_prosumage
      )> -eps_rep_abs) = eps ;
2234  *                 report_node('gross exports',loop_res_share,loop_ev,loop_
      prosumage)$(report_node('gross exports',loop_res_share,loop_ev,loop_prosum
      age)< eps_rep_abs*card(h)) = 0 ;
2235  *                 report_node('gross imports',loop_res_share,loop_ev,loop_
      prosumage)$(report_node('gross imports',loop_res_share,loop_ev,loop_prosum
      age)< eps_rep_abs*card(h)) = 0 ;
2236  *                 report_node('net exports',loop_res_share,loop_ev,loop_pr
      osumage)$(abs(report_node('net exports',loop_res_share,loop_ev,loop_prosum
      age,n)) < eps_rep_abs*card(h)) = 0 ;
2237                   report_node('energy generated net',loop_res_share,loop_ev
      ,loop_prosumage)$(report_node('energy generated net',loop_res_share,loop_e
      v,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2238                   report_node('energy generated gross',loop_res_share,loop_
      ev,loop_prosumage)$(report_node('energy generated gross',loop_res_share,lo
      op_ev,loop_prosumage)< eps_rep_abs) = 0 ;
2239                   report_node('energy demand gross',loop_res_share,loop_ev,
      loop_prosumage)$(report_node('energy demand gross',loop_res_share,loop_ev,
      loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2240  *                 report_node('net import share in gross demand',loop_res_
      share,loop_ev,loop_prosumage)$(report_node('net import share in gross dema
      nd',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
2241  *                 report_node('net export share in net generation',loop_re
      s_share,loop_ev,loop_prosumage)$(report_node('net export share in net gene
      ration',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
2242                   report_node('Capacity total',loop_res_share,loop_ev,loop_
      prosumage)$(report_node('Capacity total',loop_res_share,loop_ev,loop_prosu
      mage)< eps_rep_ins) = 0 ;
2243  *                 report_node('gross import share',loop_res_share,loop_ev,
      loop_prosumage)$(report_node('gross import share',loop_res_share,loop_ev,l
      oop_prosumage)< eps_rep_rel ) = 0 ;
2244  *                 report_node('gross export share in net generation',loop_
      res_share,loop_ev,loop_prosumage)$(report_node('gross export share in net 
      generation',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel ) = 0 ;
2245   
2246   
2247  * ------------------------------------------------------------------------
      ----
2248   
2249  * REPORT COST
2250          report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_pro
      sumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , sum( dis , c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis
      ,h)$(ord(h)>1) + c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nond
      is)*lev_CU(scen,nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,
      sto,h) + lev_STO_IN(scen,sto,h) ) )
2251   
2252  ));
2253           report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev
      ,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , sum( tech , c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(
      scen,tech) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto
      (sto)/2*(lev_N_STO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev
      _N_STO_P(scen,sto) )
2254  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2255   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2260  );
2261   
2262  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,l
      oop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , sum( h , c_infes * lev_G_INFES(scen,h)) ) ;
2263  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_
      prosumage)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , s
      um( (h,ev) , pen_phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2264  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,
      loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , sum( (bu,hst,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,
      hst,h)) ) ;
2265           report_cost('Nodal cost: total',loop_res_share,loop_ev,loop_prosu
      mage)= report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_pros
      umage)+ report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev,
      loop_prosumage)
2266  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,loop_pr
      osumage,n)
2267  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_prosum
      age,n)
2268  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,loop_p
      rosumage,n)
2269   ;
               report_cost('Costs lines',loop_res_share,loop_ev,loop_prosumage,l
      ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , c_i_ntc(l
      ) * lev_NTC(scen,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_ev
      ,loop_prosumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_e
      v,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_ev,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_
      res_share,loop_ev,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_ev,loop_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_sh
      are,loop_ev,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_e
      v,loop_prosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop
      _ev,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_ev,loop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_
      share,loop_ev,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_ev,lo
      op_prosumage)$(report_cost('Nodal cost: total',loop_res_share,loop_ev,loop
      _prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_ev,loop_pro
      sumage,l)$(report_cost('Costs lines',loop_res_share,loop_ev,loop_prosumage
      ,l) < eps_rep_ins) = 0 ;
2281   
2282  * ------------------------------------------------------------------------
      ----
2283   
2284  * REPORT TECH
2285          report_tech('capacities conventional',loop_res_share,loop_ev,loop_
      prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_N_TECH(scen,con)) ;
2286          report_tech('capacities renewable',loop_res_share,loop_ev,loop_pro
      sumage,res)= 0 + sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) ;
2287  *        report_tech('capacities reservoir MW',loop_res_share,loop_ev,loop
      _prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , lev_N_RSVR_P(scen,rsvr));
2288  *        report_tech('capacities reservoir MWh',loop_res_share,loop_ev,loo
      p_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_N_RSVR_E(scen,rsvr));
2289          report_tech('capacities storage MW',loop_res_share,loop_ev,loop_pr
      osumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2290          report_tech('capacities storage MWh',loop_res_share,loop_ev,loop_p
      rosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2291   
2292          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,con)= sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N
      _TECH(scen,con)) / report_node('Capacity total',loop_res_share,loop_ev,loo
      p_prosumage)+ 1e-9 ;
2293          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,res)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      TECH(scen,res)) / report_node('Capacity total',loop_res_share,loop_ev,loop
      _prosumage)+ 1e-9 ;
2294  *        report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumag
      e,rsvr)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      N_RSVR_P(scen,rsvr)) / report_node('Capacity total',loop_res_share,loop_ev
      ,loop_prosumage)+ 1e-9 ;
2295          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,res)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      TECH(scen,res) + lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',
      loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
2296          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,sto)= sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity tota
      l',loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
2297   
2298          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      ev,loop_prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) 
      + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_non
      dis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2299  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _ev,loop_prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h
      )) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross
      _energy_demand(scen)) ;
2300          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      ev,loop_prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , gross_energy_demand(scen)) ;
2301          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_ev,loop_prosumage,res)$report_node('energy generated net',loop_res_share
      ,loop_ev,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) 
      + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h
      )) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , report_node('energy gener
      ated net',loop_res_share,loop_ev,loop_prosumage)) ;
2302  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_ev,loop_prosumage,rsvr)$report_node('energy generated net',loop_res_sha
      re,loop_ev,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , rep
      ort_node('energy generated net',loop_res_share,loop_ev,loop_prosumage)) ;
2303          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_ev,loop_prosumage,con)$report_node('energy generated net',loop_res_share
      ,loop_ev,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , report_node('energy generated net',loop_
      res_share,loop_ev,loop_prosumage)) ;
2304   
2305          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_ev,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2306          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',
      loop_res_share,loop_ev,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_
      RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_
      CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen
      ,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) 
      ))) ) ;
2307   
2308          report_tech('Storage out total non-reserves',loop_res_share,loop_e
      v,loop_prosumage,sto)= sum(h, report_tech_hours('generation storage',loop_
      res_share,loop_ev,loop_prosumage,sto,h)) * 1 ;
2309          report_tech('Storage in total non-reserves',loop_res_share,loop_ev
      ,loop_prosumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_
      share,loop_ev,loop_prosumage,sto,h)) * 1 ;
2310   
2311          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,con)$(sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,c
      on)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2312          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res)$(sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,r
      es)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + s
      um( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) 
      + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,res)) ;
2313  *        report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,rsvr)$(su
      m(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(sc
      en,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      N_RSVR_P(scen,rsvr)) ;
2314          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,
      sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop
      _res_share,loop_ev,loop_prosumage,sto)) / sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2315   
2316   
2317                   report_tech('capacities conventional',loop_res_share,loop
      _ev,loop_prosumage,con)$(report_tech('capacities conventional',loop_res_sh
      are,loop_ev,loop_prosumage,con)< eps_rep_ins) = 0 ;
2318                   report_tech('capacities renewable',loop_res_share,loop_ev
      ,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,lo
      op_ev,loop_prosumage,res)< eps_rep_ins) = 0 ;
2319                   report_tech('capacities storage MW',loop_res_share,loop_e
      v,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,
      loop_ev,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2320                   report_tech('capacities storage MWh',loop_res_share,loop_
      ev,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_shar
      e,loop_ev,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2321  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_ev,loop_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_
      share,loop_ev,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2322  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_ev,loop_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_re
      s_share,loop_ev,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2323                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_ev,loop_prosumage,res)$(report_tech('renshares in nodal gross dem
      and',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel) = 0 ;
2324  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_ev,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross d
      emand',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2325                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_ev,loop_prosumage,con)$(report_tech('conshares in nodal gross dem
      and',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep_rel) = 0 ;
2326                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_ev,loop_prosumage,res)$(report_tech('renshares in nodal net gen
      eration',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel) = 0 ;
2327  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_ev,loop_prosumage,rsvr)$(report_tech('renshares in nodal net g
      eneration',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2328                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_ev,loop_prosumage,con)$(report_tech('conshares in nodal net gen
      eration',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep_rel) = 0 ;
2329                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res a
      bsolute',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_abs*card(h)*1
      ) = 0 ;
2330                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res r
      elative',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel) = 0 ;
2331                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,con)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_p
      rosumage,con)< eps_rep_rel) = 0 ;
2332                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_p
      rosumage,res)< eps_rep_rel) = 0 ;
2333  *                 report_tech('Capacity share',loop_res_share,loop_ev,loop
      _prosumage,rsvr)$(report_tech('Capacity share',loop_res_share,loop_ev,loop
      _prosumage,rsvr)< eps_rep_rel) = 0 ;
2334                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_p
      rosumage,sto)< eps_rep_rel) = 0 ;
2335                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,c
      on)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep
      _abs) = 0 ;
2336                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,r
      es)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep
      _abs) = 0 ;
2337  *                 report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,
      rsvr)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_
      rep_abs) = 0 ;
2338                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,s
      to)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2339                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,sto)$(report_tech('Storage out total non-reserve
      s',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 
      ;
2340                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_ev,loop_prosumage,sto)$(report_tech('Storage in total non-reserves'
      ,loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2341   
2342   
2343  * ------------------------------------------------------------------------
      ----
2344   
2345  * REPORT NODE
2346          report_node('renshare in nodal gross demand',loop_res_share,loop_e
      v,loop_prosumage)= sum(res, report_tech('renshares in nodal gross demand',
      loop_res_share,loop_ev,loop_prosumage,res))
2347  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_ev,loop_prosumage,rsvr,n))
2348           ;
2349          report_node('conshare in nodal gross demand',loop_res_share,loop_e
      v,loop_prosumage)= sum(con, report_tech('conshares in nodal gross demand',
      loop_res_share,loop_ev,loop_prosumage,con)) ;
2350  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_ev,loop_prosumage)= - report_node('net exports',loop_res_share,loo
      p_ev,loop_prosumage)/ sum( scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , gross_energy_demand(scen)) ;
2351          report_node('renshare in nodal net generation',loop_res_share,loop
      _ev,loop_prosumage)= sum(res, report_tech('renshares in nodal net generati
      on',loop_res_share,loop_ev,loop_prosumage,res))
2352  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_ev,loop_prosumage,rsvr,n))
2353           ;
2354          report_node('conshare in nodal net generation',loop_res_share,loop
      _ev,loop_prosumage)= sum(con, report_tech('conshares in nodal net generati
      on',loop_res_share,loop_ev,loop_prosumage,con)) ;
2355   
2356                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_ev,loop_prosumage)$(report_node('renshare in nodal gross demand',l
      oop_res_share,loop_ev,loop_prosumage)< eps_rep_rel ) = 0 ;
2357                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_ev,loop_prosumage)$(report_node('conshare in nodal gross demand',l
      oop_res_share,loop_ev,loop_prosumage)< eps_rep_rel ) = 0 ;
2358                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_ev,loop_prosumage)$(report_node('renshare in nodal net generatio
      n',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel ) = 0 ;
2359                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_ev,loop_prosumage)$(report_node('conshare in nodal net generatio
      n',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel ) = 0 ;
2360   
2361   
2362   
2363  * ------------------------------------------------------------------------
      ----
2364   
2365  * REPORT TECH
2366          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,
      con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_G_L(scen,con,h) ) ) ;
2367          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,
      res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO
      _IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RE
      S_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) 
      ;
2368  *        report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage
      ,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2369          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,
      sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_ST
      O_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,s
      to,h) - corr_fac_sto(scen,sto,h)) ) ;
2370   
2371          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_ev,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy g
      enerated gross',loop_res_share,loop_ev,loop_prosumage)* 1 + 1e-9 ;
2372          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_ev,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,r
      es,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(sc
      en,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_
      fac_nondis(scen,res,h))) / report_node('energy generated gross',loop_res_s
      hare,loop_ev,loop_prosumage)* 1 + 1e-9 ;
2373  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_ev,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(sce
      n,rsvr,h) ) ) / report_node('energy generated gross',loop_res_share,loop_e
      v,loop_prosumage)* %sec_hour% + 1e-9 ;
2374          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_ev,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_P
      RO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,st
      o,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node
      ('energy generated gross',loop_res_share,loop_ev,loop_prosumage)* 1 + 1e-9
       ;
2375   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto) + 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out tota
      l non-reserves',loop_res_share,loop_ev,loop_prosumage,sto)/ sum(scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev
      _N_STO_P_PRO(scen,sto) ) ;
2376   report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto)$(
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(s
      cen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Stora
      ge out total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto)/ sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen
      ,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2377   
2378                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_p
      rosumage,con)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_pro
      sumage,con)< eps_rep_ins ) = 0 ;
2379                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_p
      rosumage,res)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_pro
      sumage,res)< eps_rep_ins ) = 0 ;
2380  *                 report_tech('Yearly energy',loop_res_share,loop_ev,loop_
      prosumage,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_p
      rosumage,rsvr)< eps_rep_ins ) = 0 ;
2381                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_p
      rosumage,sto)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_pro
      sumage,sto)< eps_rep_ins ) = 0 ;
2382   
2383                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_ev,loop_prosumage,con)$(report_tech('Energy share in nodal
       gross generation',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep_rel
      ) = 0 ;
2384                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_ev,loop_prosumage,res)$(report_tech('Energy share in nodal
       gross generation',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel
      ) = 0 ;
2385  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_ev,loop_prosumage,rsvr)$(report_tech('Energy share in nod
      al gross generation',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep_
      rel) = 0 ;
2386                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_ev,loop_prosumage,sto)$(report_tech('Energy share in nodal
       gross generation',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel
      ) = 0 ;
2387         report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(repor
      t_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs) = 0 
      ;
2388         report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,
      sto)$(report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,s
      to)< eps_rep_abs) = 0 ;
2389   
2390   
2391  * ------------------------------------------------------------------------
      ----
2392   
2393  * RPEORT
2394          report('curtailment of fluct res absolute',loop_res_share,loop_ev,
      loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res
      _share,loop_ev,loop_prosumage)  ;
2395          report('curtailment of fluct res relative',loop_res_share,loop_ev,
      loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res
      _share,loop_ev,loop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + 
      lev_N_RES_PRO(scen,res)) )) ;
2396          report('bio not utilized absolute',loop_res_share,loop_ev,loop_pro
      sumage)$( m_e('bio')) = report_node('bio not utilized absolute',loop_res_s
      hare,loop_ev,loop_prosumage)  ;
2397          report('bio not utilized relative',loop_res_share,loop_ev,loop_pro
      sumage)$( m_e('bio')) = report('bio not utilized absolute',loop_res_share,
      loop_ev,loop_prosumage) /m_e('bio') ;
2398          report('Capacity total',loop_res_share,loop_ev,loop_prosumage) = r
      eport_node('Capacity total',loop_res_share,loop_ev,loop_prosumage) ;
2399          report('energy demand gross',loop_res_share,loop_ev,loop_prosumage
      ) = report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumag
      e)  ;
2400          report('energy demand total',loop_res_share,loop_ev,loop_prosumage
      ) = report_node('energy demand total',loop_res_share,loop_ev,loop_prosumag
      e)  ;
2401          report('energy generated net',loop_res_share,loop_ev,loop_prosumag
      e) =  report_node('energy generated net',loop_res_share,loop_ev,loop_prosu
      mage) ;
2402          report('energy generated gross',loop_res_share,loop_ev,loop_prosum
      age) =  report_node('energy generated gross',loop_res_share,loop_ev,loop_p
      rosumage) ;
2403  *        report('gross trade share',loop_res_share,loop_ev,loop_prosumage)
       = sum( (h), report_hours('gross imports',loop_res_share,loop_ev,loop_pros
      umage,h))/ sum( (h), report_hours('energy demanded',loop_res_share,loop_ev
      ,loop_prosumage,h)) ;
2404          report('renshare total',loop_res_share,loop_ev,loop_prosumage) = s
      um( (h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum
      ( res , lev_G_L(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen
      ,res,h) + phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h
      ))
2405  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2406           ))/ sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       gross_energy_demand(scen) ) ;
2407          report('conshare total',loop_res_share,loop_ev,loop_prosumage) = s
      um( (h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum
      ( con , lev_G_L(scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_
      ev,loop_prosumage)) , gross_energy_demand(scen) ) ;
2408          report('Energy total',loop_res_share,loop_ev,loop_prosumage) = rep
      ort_node('Energy total',loop_res_share,loop_ev,loop_prosumage) ;
2409   
2410                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_ev,loop_prosumage)$(report('curtailment of fluct res absolute',loop_
      res_share,loop_ev,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2411                   report('curtailment of fluct res relative',loop_res_share
      ,loop_ev,loop_prosumage)$(report('curtailment of fluct res relative',loop_
      res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2412                   report('bio not utilized absolute',loop_res_share,loop_ev
      ,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2413                   report('bio not utilized relative',loop_res_share,loop_ev
      ,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_rel) = 0 ;
2414                   report('Capacity total',loop_res_share,loop_ev,loop_prosu
      mage)$(report('Capacity total',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_ins) = 0 ;
2415                   report('gross trade share',loop_res_share,loop_ev,loop_pr
      osumage)$(report('gross trade share',loop_res_share,loop_ev,loop_prosumage
      ) < eps_rep_rel ) = 0 ;
2416                   report('renshare total',loop_res_share,loop_ev,loop_prosu
      mage)$(report('renshare total',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_rel ) = 0 ;
2417                   report('conshare total',loop_res_share,loop_ev,loop_prosu
      mage)$(report('conshare total',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_rel ) = 0 ;
2418                   report('Energy total',loop_res_share,loop_ev,loop_prosuma
      ge)$(report('Energy total',loop_res_share,loop_ev,loop_prosumage) < eps_re
      p_abs) = 0 ;
2419   
2420   
2421  * ------------------------------------------------------------------------
      ----
2422   
2423  * DSM
2424   
2425   
2426  * ------------------------------------------------------------------------
      ----
2427   
2428  * EV
2429   
2430   
2431   
2432  * ------------------------------------------------------------------------
      ----
2433   
2434  * Reserves
2435   
2436   
2437   
2438   
2439  * ------------------------------------------------------------------------
      ----
2440   
2441  * Reserves and DSM
2442   
2443   
2444  * ------------------------------------------------------------------------
      ----
2445   
2446  * ------------------------------------------------------------------------
      ----
2447   
2448  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_ev,loop_prosum
      age,h)$feat_node('prosumage')= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_ev,loop_prosumage
      ,h)$feat_node('prosumage')= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_ev,loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(sc
      en,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_ev,loop_prosumage,res,h)$feat_node('prosumage')=  sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,re
      s,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_ev,loop_prosumage,res,h)$feat_node('prosumage')= sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES_PRO(sc
      en,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_ev,loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen
      ,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_ev,loop_prosumage,'',h)$feat_node('prosumage')= sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(sce
      n,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_
      IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN
      _PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2PRO(scen
      ,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2M(scen,sto
      ,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2
      PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2M(
      scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2PRO(
      scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2M(scen
      ,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO2PRO(sce
      n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO2M(scen,st
      o,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_M2PRO(scen,st
      o,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)
      ) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,con,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen
      ,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen
      ,res,h) + lev_G_RES(scen,res,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,rsvr,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_r
      svr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_ev,loop_prosumage,res,h)$feat_node('prosumage')=  sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,l
      oop_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loo
      p_ev,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node(
      'prosumage')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , sum( sto , lev_STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node('p
      rosumage')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      sum( sto , lev_STO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node(
      'prosumage')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node('p
      rosumage')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      sum( sto , lev_STO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosum
      age')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_ev,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosum
      age')=  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( 
      res , lev_G_MARKET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_ev,lo
      op_prosumage)$feat_node('prosumage')= sum( scen$(map(scen,loop_res_share,l
      oop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n)) ;
              report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_ev,loop_prosumage)$feat_node('prosumage')= sum( scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers
      _selfgen(scen,n)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_ev,loop_prosumage,res)$feat_node('prosumage')=  sum( scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_ev,loop_prosumage,sto)$feat_node('prosumage')=  sum( scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)
      ) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, repo
      rt_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share
      ,loop_ev,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, repo
      rt_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share
      ,loop_ev,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report
      _prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loo
      p_ev,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report
      _prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loo
      p_ev,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_p
      rosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_ev
      ,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, rep
      ort_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_s
      hare,loop_ev,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, repor
      t_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share
      ,loop_ev,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, repor
      t_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share
      ,loop_ev,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( h, report
      _prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,lo
      op_ev,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= report_prosumage_te
      ch('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosu
      mage,sto)+ report_prosumage_tech('Storage out total prosumers PRO2M',loop_
      res_share,loop_ev,loop_prosumage,sto)+ report_prosumage_tech('Storage out 
      total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto)+ report_
      prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_ev,lo
      op_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage')=  sum( (h,res) ,
       report_prosumage_tech_hours('generation prosumers to market',loop_res_sha
      re,loop_ev,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage')=  sum( h , repor
      t_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,l
      oop_ev,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage')=  sum( (res
      ,h) , report_prosumage_tech_hours('generation prosumers self-consumption',
      loop_res_share,loop_ev,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage')AND sum( scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load * d(h)
       )) ) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum(
       h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum( scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load * d(h)
       )) ) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum(
       h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / 
      sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi
      _pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,'market',n)$sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO
      (scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage')=  su
      m(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_P
      RO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('cur
      tailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_pros
      umage,res)AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_res(res,
      h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage
       in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto)> e
      ps_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev
      ,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage
      _tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage i
      n total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto)> eps_r
      ep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loo
      p_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech(
      'Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,s
      to);
              report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage i
      n total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto)> eps_r
      ep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loo
      p_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in 
      total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto)> eps_rep_a
      bs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_pr
      osumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storag
      e out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto)>
       eps_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_
      ev,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storag
      e in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage 
      out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto)> eps
      _rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,l
      oop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in t
      otal prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage 
      out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto)> eps
      _rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,l
      oop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in t
      otal prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage ou
      t total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto)> eps_rep
      _abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_
      prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total p
      rosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Generation
       total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'')> eps_rep
      _abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_
      prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Gen
      eration total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Withdrawal
       total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'')> eps_rep
      _abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_
      prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total pr
      osumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('generati
      on prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'')> 
      eps_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_e
      v,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('g
      eneration prosumers self-consumption',loop_res_share,loop_ev,loop_prosumag
      e,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_
      prosumage,res,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = s
      um( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h))
       + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
      %reserves% report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,lo
      op_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins
      ) = report_prosumage_tech('Storage out total prosumers',loop_res_share,loo
      p_ev,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
      %reserves% report_prosumage_tech('Storage cycles prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > 
      eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_re
      s_share,loop_ev,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > 
      eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)
       ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,lo
      op_ev,loop_prosumage,res,n)$feat_node('prosumage')=  sum( scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
              report_market_tech('capacities reservoir MW market',loop_res_share
      ,loop_ev,loop_prosumage,rsvr,n)$feat_node('prosumage')=  sum( scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
              report_market_tech('capacities reservoir MWh market',loop_res_shar
      e,loop_ev,loop_prosumage,rsvr,n)$feat_node('prosumage')=  sum( scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,l
      oop_ev,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,
      loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(map(scen
      ,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_h
      our% ;
              report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage')=  sum(h, s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,re
      s,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('curtailment 
      of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res)AN
      D sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h))) > card
      (h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_CU(scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(
      scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share
      ,loop_ev,loop_prosumage,con,n)$feat_node('prosumage')=  sum( scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum(h, repor
      t_market_tech_hours('generation storage market',loop_res_share,loop_ev,loo
      p_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage')= sum(h, report
      _market_tech_hours('storage loading market',loop_res_share,loop_ev,loop_pr
      osumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_e
      v,loop_prosumage,res,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins)
       = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(sc
      en,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_e
      v,loop_prosumage,con,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins)
       = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_N_TECH(scen,con)) ;
      %reserves% report_market_tech('FLH market non-reserves',loop_res_share,loo
      p_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = report_market_tech('Storage out total market non-reserves',loop_res
      _share,loop_ev,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
      %reserves% report_market_tech('Storage cycles market non-reserves',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto))
       > eps_rep_ins) = report_market_tech('Storage out total market non-reserve
      s',loop_res_share,loop_ev,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_e
      v,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_in
      s AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_S
      TO_E(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% / 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(s
      cen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_ev,loop_prosumage,n)$feat_node('prosumage')= sum( scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n))
       ;
              report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum( scen$(map
      (scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosum
      ers_market(scen,n)) ;
              report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum( scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_pr
      osumers_selfgen(scen,n)) ;
              report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumer
      s(scen))) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , g
      ross_energy_demand_prosumers_selfgen(scen,n)) / sum( scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_ev,l
      oop_prosumage,n)$(feat_node('prosumage')AND  sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = su
      m(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_de
      mand_prosumers_market(scen,n)) / sum( scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum((res,h),
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(s
      cen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res
      (res,h) * lev_N_RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , ph
      i_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,
      loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * le
      v_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h)
       * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(re
      s,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , ph
      i_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,
      loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * le
      v_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_re
      s(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h)
       * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_ev
      ,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) 
      )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (re
      s,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen
      ,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h) *
       lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) /
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h)
       , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_ev
      ,loop_prosumage,n)$feat_node('prosumage')= sum( res , sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum(
       sto , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      STO_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_ev,loop_prosumage,res,n)$report_prosumage('Capacity total prosumers',lo
      op_res_share,loop_ev,loop_prosumage)= sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) / report_prosumage('Cap
      acity total prosumers',loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_ev,loop_prosumage,sto,n)$report_prosumage('Capacity total prosumers',lo
      op_res_share,loop_ev,loop_prosumage)= sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) / report_prosumage('C
      apacity total prosumers',loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_ev,
      loop_prosumage,n)$feat_node('prosumage')= sum( scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n)) ;
              report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h)
      )) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_
      share,loop_ev,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , phi_res(res,h
      )*lev_N_TECH(scen,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res,h)
      , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen
      ,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , su
      m( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum
      ( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MA
      RKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= s
      um( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( s
      to , lev_STO_IN_M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum
      ( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto
       , lev_STO_IN_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= sum
      ( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res
       , lev_G_MARKET_PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')=
       sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum(
       sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage')= s
      um( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( s
      to , lev_STO_OUT_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Capacity total market',loop_res_share,loop_ev,loop_
      prosumage,n)$feat_node('prosumage')= sum( tech , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(sc
      en,sto) )) + sum( rsvr ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_N_RSVR_P(scen,rsvr))) + sum( dsm_curt ,  sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,dsm_curt)))
       + sum( dsm_shift ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_N_DSM_SHIFT(scen,dsm_shift))) ;
              report_market('Energy demand total market',loop_res_share,loop_ev,
      loop_prosumage,n)$feat_node('prosumage')= (sum( h , (1 - phi_pro_load) * d
      (h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen,loop_
      res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M
      2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_
      ev,loop_prosumage,n)$feat_node('prosumage')= sum( h , sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + 
      sum( nondis ,lev_G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h) - corr_fac_nondis(scen,res,h)) + sum( rsvr , lev_RSVR_OUT(scen,rs
      vr,h)- corr_fac_rsvr(scen,rsvr,h)) + sum( sto , lev_STO_OUT_M2M(scen,sto,h
      ) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) + sum( dsm_shift ,
       lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h
      )) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCH
      ARGE(scen,ev,h)) - corr_fac_ev(scen,h) )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_ev,
      loop_prosumage,tech)$(feat_node('prosumage')AND report_market('Capacity to
      tal market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,tech) ) / repo
      rt_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage)+ 
      1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_ev,
      loop_prosumage,rsvr,n)$feat_node('prosumage')= sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_marke
      t('Capacity total market',loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_ev,
      loop_prosumage,sto,n)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('
      Capacity total market',loop_res_share,loop_ev,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_ev,loop_prosumage,con,n)$(feat_node('prosumage')AND r
      eport_market('energy generated gross market',loop_res_share,loop_ev,loop_p
      rosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_G_L(scen,con,h)) ) / report_market('energy generated gross 
      market',loop_res_share,loop_ev,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage')AND r
      eport_market('energy generated gross market',loop_res_share,loop_ev,loop_p
      rosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RE
      S(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / report_market('energy gen
      erated gross market',loop_res_share,loop_ev,loop_prosumage)* %sec_hour% + 
      1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(feat_node('prosumage')AND 
      report_market('energy generated gross market',loop_res_share,loop_ev,loop_
      prosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / re
      port_market('energy generated gross market',loop_res_share,loop_ev,loop_pr
      osumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage')AND r
      eport_market('energy generated gross market',loop_res_share,loop_ev,loop_p
      rosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fa
      c_sto(scen,sto,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_ev,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_ev,lo
      op_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_ev,lo
      op_prosumage,h)< eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_ev,loop_
      prosumage,h)$(report_hours('demand market',loop_res_share,loop_ev,loop_pro
      sumage,h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tech_hours('gener
      ation prosumers',loop_res_share,loop_ev,loop_prosumage,res,h)< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tec
      h_hours('curtailment of fluct res prosumers',loop_res_share,loop_ev,loop_p
      rosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_
      tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,
      loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tech_ho
      urs('generation prosumers to market',loop_res_share,loop_ev,loop_prosumage
      ,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_ev,loop_prosumage,'',h)$(report_prosumage_tech_h
      ours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosum
      age,'',h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech
      _hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,s
      to,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_t
      ech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,lo
      op_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tec
      h_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tec
      h_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_
      hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers',loop_res_share,loop_ev,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage level prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage level prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,s
      to,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage level prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,s
      to,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hours
      ('storage level prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h
      )< eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,con,h)$(report_market_tech_hours('generation mar
      ket',loop_res_share,loop_ev,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,res,h)$(report_market_tech_hours('generation mar
      ket',loop_res_share,loop_ev,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation ma
      rket',loop_res_share,loop_ev,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_market_tech_hours('
      curtailment of fluct res market',loop_res_share,loop_ev,loop_prosumage,res
      ,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('generation storage market',loop
      _res_share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('genera
      tion storage market',loop_res_share,loop_ev,loop_prosumage,sto,h)< eps_rep
      _abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_re
      s_share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('storage l
      oading market',loop_res_share,loop_ev,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
                       report_market_tech_hours('storage level market',loop_res_
      share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('storage lev
      el market',loop_res_share,loop_ev,loop_prosumage,sto,h)< eps_rep_abs) = 0 
      ;
                       report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(
      report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share
      ,loop_ev,loop_prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 
      ;
                       report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(re
      port_market_tech_hours('market to prosumer storage M2M',loop_res_share,loo
      p_ev,loop_prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(
      report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share
      ,loop_ev,loop_prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 
      ;
                       report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(re
      port_market_tech_hours('prosumer storage to market M2M',loop_res_share,loo
      p_ev,loop_prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(report_
      market_tech_hours('energy market to prosumer',loop_res_share,loop_ev,loop_
      prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(report_
      market_tech_hours('energy prosumer to market',loop_res_share,loop_ev,loop_
      prosumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('capacit
      ies renewable prosumers',loop_res_share,loop_ev,loop_prosumage,res)< eps_r
      ep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('capaci
      ties storage MW prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps
      _rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('capac
      ities storage MWh prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< e
      ps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('consumptio
      n share prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel
      ) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('consumptio
      n share prosumers',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel
      ) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,'market',n)$(report_prosumage_tech('consu
      mption share prosumers',loop_res_share,loop_ev,loop_prosumage,'market')< e
      ps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_
      tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,
      loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_
      tech('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,
      loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Sto
      rage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto
      ,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Stora
      ge in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)<
       eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Stora
      ge in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)<
       eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage
       in total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps
      _rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('St
      orage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,s
      to,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Stor
      age out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n
      )< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Stor
      age out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n
      )< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storag
      e out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< e
      ps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage ou
      t total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_a
      bs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Genera
      tion total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'')< eps
      _rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Withdr
      awal total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'')< eps
      _rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('g
      eneration prosumers self-consumption',loop_res_share,loop_ev,loop_prosumag
      e,'')< eps_rep_abs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech
      ('average market value storage in PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('
      average market value storage in PRO2M',loop_res_share,loop_ev,loop_prosuma
      ge,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('
      average market value storage in M2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('av
      erage market value storage in M2M',loop_res_share,loop_ev,loop_prosumage,s
      to)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tec
      h('average market value storage out PRO2PRO',loop_res_share,loop_ev,loop_p
      rosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech(
      'average market value storage out PRO2M',loop_res_share,loop_ev,loop_prosu
      mage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech(
      'average market value storage out M2PRO',loop_res_share,loop_ev,loop_prosu
      mage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('a
      verage market value storage out M2M',loop_res_share,loop_ev,loop_prosumage
      ,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('a
      verage market value generation PRO2M',loop_res_share,loop_ev,loop_prosumag
      e,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('a
      verage market value withdrawal M2PRO',loop_res_share,loop_ev,loop_prosumag
      e,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech(
      'average market value generation PRO2PRO',loop_res_share,loop_ev,loop_pros
      umage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('Capacity shar
      e prosumers',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_rel) = 0 
      ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Capacity shar
      e prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel) = 0 
      ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _ev,loop_prosumage,res,n)$(report_prosumage_tech('FLH prosumers',loop_res_
      share,loop_ev,loop_prosumage,res)< eps_rep_abs) = 0 ;
      %reserves%       report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage cycle
      s prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs) = 0 
      ;
      %reserves%       report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_p
      rosumage,sto,n)$(report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_p
      rosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage EP-
      ratio prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel) 
      = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_ev,loop_prosumage,res,n)$(report_market_tech('capacities renew
      able market',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_abs) =  0
       ;
                       report_market_tech('capacities reservoir MW market',loop_
      res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('capacities r
      eservoir MW market',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep_i
      ns) = 0 ;
                       report_market_tech('capacities reservoir MWh market',loop
      _res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('capacities 
      reservoir MWh market',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep
      _ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities stor
      age MW market',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs) = 
       0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities sto
      rage MWh market',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs) 
      =  0 ;
                       report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('cur
      tailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosuma
      ge,res)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('cur
      tailment of fluct res relative market',loop_res_share,loop_ev,loop_prosuma
      ge,res)< eps_rep_rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_
      res_share,loop_ev,loop_prosumage,con,n)$(report_market_tech('capacities co
      nventional market',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep_ins
      ) = 0 ;
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_ev,loop_prosumage,res,n)$(report_market_tech('capacities renew
      able market',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_ins) = 0 
      ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities stor
      age MW market',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_ins) = 
       0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities sto
      rage MWh market',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_ins) 
      = 0 ;
                       report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storag
      e out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto
      )< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage
       in total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto)<
       eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,res,n)$(report_market_tech('FLH market non-reser
      ves',loop_res_share,loop_ev,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,con,n)$(report_market_tech('FLH market non-reser
      ves',loop_res_share,loop_ev,loop_prosumage,con)< eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,sto,n)$(report_market_tech('FLH market non-reser
      ves',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage c
      ycles market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage EP-ratio mar
      ket',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_ev,loop_prosumage,n)$(report_prosumage('gross energy demand pr
      osumers',loop_res_share,loop_ev,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('gross ener
      gy demand prosumers from market',loop_res_share,loop_ev,loop_prosumage)< e
      ps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('gross 
      energy demand prosumers self generation',loop_res_share,loop_ev,loop_prosu
      mage)< eps_rep_ins) = 0 ;
                       report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('self-generatio
      n share prosumage total',loop_res_share,loop_ev,loop_prosumage)< eps_rep_r
      el) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,
      loop_ev,loop_prosumage,n)$(report_prosumage('market share prosumage',loop_
      res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('curtailm
      ent of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage
      )< eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('curtailm
      ent of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generatio
      n curtailed',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-
      generation direct consumption',loop_res_share,loop_ev,loop_prosumage)< eps
      _rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_r
      es_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generatio
      n to market',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-gene
      ration stored PRO2PRO',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel
      ) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-genera
      tion stored PRO2M',loop_res_share,loop_ev,loop_prosumage)< eps_rep_rel) = 
      0 ;
                       report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_ev,loop_prosumage,n)$(report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_ev,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share
      ,loop_ev,loop_prosumage,n)$(report_market('gross energy demand market',loo
      p_res_share,loop_ev,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_ev,loop_prosumage,n)$(report_market('curtailment of fl
      uct res absolute market',loop_res_share,loop_ev,loop_prosumage)< eps_rep_a
      bs) = 0 ;
                       report_market('curtailment of fluct res relative market',
      loop_res_share,loop_ev,loop_prosumage,n)$(report_market('curtailment of fl
      uct res relative market',loop_res_share,loop_ev,loop_prosumage)< eps_rep_r
      el) = 0 ;
                       report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Sh
      are market energy transferred to prosumer consumption',loop_res_share,loop
      _ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('
      Share market energy transferred to prosumer storage M2PRO',loop_res_share,
      loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Sh
      are market energy transferred to prosumer storage M2M',loop_res_share,loop
      _ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Sh
      are market energy tranferred from prosumer generation',loop_res_share,loop
      _ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market
      ('Share market energy transferred from prosumer storage PRO2M',loop_res_sh
      are,loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('
      Share market energy transferred from prosumer storage M2M',loop_res_share,
      loop_ev,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop
      _ev,loop_prosumage,n)$(report_market('Capacity total market',loop_res_shar
      e,loop_ev,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share
      ,loop_ev,loop_prosumage,n)$(report_market('Energy demand total market',loo
      p_res_share,loop_ev,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_sh
      are,loop_ev,loop_prosumage,n)$(report_market('energy generated gross marke
      t',loop_res_share,loop_ev,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,tech)$(report_market_tech('Capacity share market',
      loop_res_share,loop_ev,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Capacity share market'
      ,loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('Capacity share market
      ',loop_res_share,loop_ev,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_market_tech
      ('Energy share in gross nodal market generation',loop_res_share,loop_ev,lo
      op_prosumage,con)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech
      ('Energy share in gross nodal market generation',loop_res_share,loop_ev,lo
      op_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech
      ('Energy share in gross nodal market generation',loop_res_share,loop_ev,lo
      op_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tec
      h('Energy share in gross nodal market generation',loop_res_share,loop_ev,l
      oop_prosumage,rsvr)< eps_rep_rel) = 0 ;
      $ontext
2715   
2716   
2717  * ------------------------------------------------------------------------
      ----
2718   
2719  * PROSUMAGE & DSM
2720   
2721   
2722   
2723  * ------------------------------------------------------------------------
      ----
2724   
2725   
2726   
2727  * ------------------------------------------------------------------------
      ----
2728   
2729  * HEAT
2730   
2731  * ------------------------------------------------------------------------
      ----
2732   
2733  * Reserves and heat
2734   
2735   
2736  * ------------------------------------------------------------------------
      ---- *
2737  * ------------------------------------------------------------------------
      ---- *
2738  * ------------------------------------------------------------------------
      ---- *
2739   
2740   
2741  execute_unload "results", report, report_tech, report_node,
2742  *report_line,
2743  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
      $ontext
2748  ;
2749   
2750   
      $include report_to_excel.gms
      $ontext
2755   
2756   
2757   
2758  * ------------------------------------------------------------------------
      ---- *
2759  * ------------------------------------------------------------------------
      ---- *
2760  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/25/18 14:14:39 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          Modified_MCP\DIETER.gms
     2      153 INCLUDE        1     153  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\dataload.gms
     3      560 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      562 GDXIN          2     409  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\Data_input.gdx
     5      614 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      615 GDXIN          2     462  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\time_series.gdx
     7     1049 INCLUDE        1     273  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\model.gms
     8     1607 INCLUDE        1     386  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\fix.gms
     9     1783 INCLUDE        1     387  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\scenario.gms
    10     1976 INCLUDE        1     455  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\report.gms


COMPILATION TIME     =       34.734 SECONDS      6 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/25/18 14:14:39 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1972


MODEL STATISTICS

BLOCKS OF EQUATIONS          18     SINGLE EQUATIONS      385,493
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      324,143  5 projected
NON ZERO ELEMENTS     1,362,750     NON LINEAR N-Z         87,601
DERIVATIVE POOL              20     CONSTANT POOL              17
CODE LENGTH             122,646


GENERATION TIME      =      110.016 SECONDS    125 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =      110.141 SECONDS    125 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/25/18 14:14:39 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1972


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1972

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         52.938  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.61 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 51.92sec (det. 17590.31 ticks)
Optimal solution found.
Objective : 33544542852.728615

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544542852.7286
---   Resource Usage   53016
---   Total Time (ms)  53235

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/25/18 14:14:39 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.828 SECONDS     41 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.lst
