GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/22/18 08:12:14 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24   
  25  * Choose base year
  27   
  28  * Germany only - also adjust Excel inputs!
  30   
  31  * Set star to activate options
  32   
  34   
  35  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  36  * if nothing is selected, ROR capacity will be set to zero
  37  * if parameter option is selected, set appropriate values in fix.gmx
  38  * if variable option is selected, set appropriate bound in data_input exce
      l
  41   
  42  * Set star to determine loops, otherwise default 100% renewables
  44   
  45  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  47   
  48  * Set star for reporting to Excel
  50   
  51   
  52  **************************************************************************
      ******
  53   
  54  * Definition of strings for report parameters and sanity checks
  55  * (Do not change settings below)
  57   
  58  * Sanity checks
  60   
  61  **************************************************************************
      ******
  62   
  63  ****************************
  64  ***** INITIALIZE LOOPS *****
  65  ****************************
  66   
  67  sets
  68  *$ontext
  69  loop_res_share   Solution loop for different shares of renewables       /5
      0/
  72   
      loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
      $ontext
  77   
  78  *      loop_res_share                          /50/
  79                        loop_prosumage                          /0/
  80  ;
  81   
  82   
  83   
  84   
  85  **************************************************************************
      ******
  86   
  87  **************************
  88  ***** SOLVER OPTIONS *****
  89  **************************
  90   
  91  options
  92  optcr = 0.00
  93  reslim = 10000000
  94  lp = cplex
  95  mip = cplex
  96  nlp = conopt
  97  limrow = 0
  98  limcol = 0
  99  ;
 100   
 101  options
 102  dispwidth = 15
 103  limrow = 0
 104  limcol = 0
 105  solprint = off
 106  sysout = off
 107  ;
 108   
 109   
 110   
 111   
 112  **************************************************************************
      ******
 113   
 114  **************************
 115  ***** Dataload *****
 116  **************************
 117   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\dataload.gms
 119   
 120  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 130  **************************************************************************
      ******
 131   
 132   
 133   
 134   
 135  ***************  SETS  ***************************************************
      ******
 136   
 137  ***** Sets used in the model *****
 138  Sets
 139  tech                     Generation technologies
 140   dis(tech)               Dispatchable generation technologies
 141   nondis(tech)            Nondispatchable generation technologies
 142   con(tech)               Conventional generation technologies
 143   res(tech)               Renewable generation technologies
 144  sto                      Storage technologies
 145  rsvr                     Reservoir technologies
 146  dsm                      DSM technologies
 147   dsm_shift(dsm)          DSM load shifting technologies
 148   dsm_curt(dsm)           DSM load curtailment technologies
 149  year                     Base year for temporal data
 150  h                        Hours
 151  n                        Nodes
 152  l                        Lines
 153  ev                       EV types
 154  reserves                         Reserve qualities
 155   reserves_up(reserves)           Positive reserves
 156   reserves_do(reserves)           Negative reserves
 157   reserves_spin(reserves)         Spinning reserves
 158   reserves_nonspin(reserves)      Nonspinning reserves
 159   reserves_prim(reserves)         Primary reserves
 160   reserves_nonprim(reserves)      Nonprimary reserves
 161   reserves_prim_up(reserves)      Primary positive reserves
 162   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 163   reserves_prim_do(reserves)      Primary negative reserves
 164   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 165  bu                       Building archtypes
 166  ch                       Heating combination type
 167   hst(ch)                 Heating technology that feeds to storage
 168   hp(ch)                  Heat pump technologies
 169   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 170   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 171   
 172   
 173  ***** Sets used for data upload *****
 174  headers_tech                     Generation technologies - upload headers
 175   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 176   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 177  headers_sto                      Storage technologies - upload headers
 178  headers_reservoir                Reservoir technologies - upload headers
 179  headers_dsm                      DSM technologies - upload headers
 180   dsm_type                        DSM technologies - shifting or curtailmen
      t
 181  headers_time                     Temporal data - upload headers
 182  headers_topology                 Spatial data - upload headers
 183  headers_ev                       EV data - upload headers
 184  headers_time_ev                  EV temporal data - upload headers
 185  headers_prosumage_generation     Prosumage generation data - upload header
      s
 186  headers_prosumage_storage        Prosumage storage data - upload headers
 187  headers_reserves                 Reserve data - upload headers
 188   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 189   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 190   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 191  headers_heat                     Heat data - upload headers
 192   heat_storage                    Heat data - storage technologies
 193   heat_hp                         Heat data - heat pump technologies
 194   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 195   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 196  headers_time_heat                Heat data - upload headers time data
 197  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 198  ;
 199   
 200   
 201   
 202   
 203  ***************  PARAMETERS  *********************************************
      ******
 204   
 205  Parameters
 206   
 207  ***** Generation technologies *****
 208  *--- Variable and fixed costs ---*
 209  eta              Efficiency of conventional technologies [0 1]
 210  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 211  c_up             Load change costs UP [EUR per MWh]
 212  c_do             Load change costs DOWN [EUR per MWh]
 213  c_fix            Annual fixed costs [EUR per MW per year]
 214  c_vom            Variable O&M costs [EUR per MWh]
 215  CO2price         CO2 price in [EUR per ton]
 216   
 217  *--- Investment ---*
 218  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 219  lifetime         Investment costs: technical lifetime [a]
 220  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 221  interest_rate    Investment costs: Interest rate [%]
 222  m_p              Investment: maximum installable capacity per technology [
      MW]
 223  m_e              Investment: maximum installable energy [TWh per a]
 224   
 225  *--- Flexibility ---*
 226  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 227   
 228   
 229  ***** Fuel and CO2 costs *****
 230  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 231   
 232   
 233  ***** Renewables *****
 234  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 235  phi_min_res      Minimum renewables share [0 1]
 236   
 237   
 238  ***** Storage *****
 239  *--- Variable and fixed costs ---*
 240  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 241  eta_sto          Storage efficiency [0 1]
 242  phi_sto_ini      Initial storage level [0 1]
 243  etop_max         Maximum E to P ratio of storage types [#]
 244  c_fix_sto        Annual fixed costs [EUR per MW]
 245   
 246  *--- Investment ---*
 247  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 248  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 249  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 250  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 251   
 252   
 253  ***** Reservoir*****
 254  *--- Variable and fixed costs ---*
 255  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 256  eta_rsvr                 Generation efficiency [0 1]
 257  phi_rsvr_ini             Initial reservoir level [0 1]
 258  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 259  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 260  phi_rsvr_lev_min         Minimum filling level [0 1]
 261   
 262  *--- Investment ---*
 263  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 264  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 265  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 266  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 267  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 268  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 269   
 270   
 271  ***** DSM *****
 272  *--- Variable and fixed costs ---*
 273  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 274  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 275  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 276  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 277   
 278  *--- Flexibility, efficiency, recovery ---*
 279  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 280  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 281   
 282  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 283  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 284  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 285   
 286  *--- Investment ---*
 287  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 288  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 289  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 290  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 291  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 292  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 293  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 294  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 295   
 296   
 297  ***** Time Data *****
 298  d_y                      Demand hour h for different years [MWh]
 299  d                        Demand hour h [MWh]
 300  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 301  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 302  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 303  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 304  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 305  rsvr_in                  Reservoir inflow in hour h [0 1]
 306  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 307  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 308  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 309  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 310  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 311  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 312  reserves_exogenous       Hourly reserve provision [MW]
 313   
 314  ***** Transmission *****
 315  *--- Investment ---*
 316  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 317  c_fix_ntc                 Fixed costs [EUR per MW per a]
 318  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 319  inv_recovery_ntc          Investment costs: Recovery period in [a]
 320  inv_interest_ntc          Investment costs: Interest rate [%]
 321  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 322   
 323  *--- Topology and distance ---*
 324  inc              Incidence index of link l on node n
 325  dist             Distance covered by link l [km]
 326   
 327   
 328  ***** Electric vehicles *****
 329  *--- Costs and attributes ---*
 330  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 331  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 332  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 333  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 334  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 335   
 336  n_ev_e           Electric vehicle battery capacity [MWh]
 337  ev_quant         Overall number of electirc vehicles [#]
 338  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 339  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 340   
 341  *--- Temporal data ---*
 342  n_ev_p           Electric vehicle power rating [MWh]
 343  ev_ed            Electric vehicle electricity demand [MWh]
 344  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 345   
 346   
 347  ***** Prosumage *****
 348  phi_pro_load             Share of prosumagers among total load [0 1]
 349  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 350  m_res_pro                Maximum installable: renewables capacity [MW]
 351  m_sto_pro_e              Maximum installable: storage energy [MWh]
 352  m_sto_pro_p              Maximum installable: storage capacity [MW]
 353  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 354   
 355   
 356  ***** Reserves *****
 357  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 358  reserves_intercept       Intercept of regression line determining reserves
       demand
 359  reserves_slope           Slope of regression line determining reserves dem
      and
 360  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 361  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 362  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 363  *reserves_exog
 364   
 365   
 366  ***** Heat *****
 367  *--- Time data ---*
 368  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 369  dh_y                     Hourly heat demand per year [MWh per m2]
 370  dh                       Hourly heat demand [MWh per m2]
 371  temp_source              Heat pumps - source temperature [°Celsius]
 372  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 373  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 374  d_dhw                    Hourly DHW demand [MWh per m2]
 375  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 376   
 377  *--- Technololgy attributes ---*
 378  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 379  eta_heat_stat            Static efficiency for heating technologies [0 1]
 380  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 381  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 382  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 383  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 384  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 385  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 386  n_sets_p_out             SETS - Power rating - heat output [MW]
 387  n_sets_e                 SETS - Energy storage capacity [MWh]
 388  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 389  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 390  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 391  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 392  temp_sink                Heat pumps - sink temperature [°Celsius]
 393  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 394  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 395  theta_night              Indicator for night hours {0 1}
 396   
 397   
 398   
 399  ***************  DERIVED PARAMETERS  *************************************
      ******
 400   
 401  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 402  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 403   
 404  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 405  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 406   
 407  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 408  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 409   
 410  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 411  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 412   
 413  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 414  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 415   
 416  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 417   
 418  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 419  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 420   
 421  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 422  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 423  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 424  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 425  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 426  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 427   
 428   
 429   
 430   
 431  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 432   
 433  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 434  technology_data(tech,headers_tech)
 435  storage_data(sto,headers_sto)
 436  reservoir_data(rsvr,headers_reservoir)
 437  time_data_upload(h,year,headers_time)
 438  dsm_data_upload(dsm,dsm_type,headers_dsm)
 439  dsm_data(dsm,headers_dsm)
 440  topology_data(l,headers_topology)
 441  ev_data(ev,headers_ev)
 442  ev_time_data_upload(h,headers_time_ev,ev)
 443  prosumage_data_generation(tech,headers_prosumage_generation)
 444  prosumage_data_storage(sto,headers_prosumage_storage)
 445  reserves_time_data_activation(h,year,reserves)
 446  reserves_time_data_provision(h,year,reserves)
 447  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 448  reserves_data(reserves,headers_reserves)
 449  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 450  heat_data(bu,ch,headers_heat)
 451  dh_upload(h,year,headers_time_heat,bu)
 452  d_dhw_upload(h,year,headers_time_heat,bu)
 453  temp_source_upload
 454  ;
 455   
 456   
 457   
 458   
 459  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 460   
 523   
 524  *%skip_Excel%
 526   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 531  *$load l headers_topology topology_data
 532  *$ontext
 533  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 540  ;
 541   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 547   
 548   
 549  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 550   
 576   
 577   
 578  *
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 582  *$load headers_time_ev ev_time_data_upload
 583  *$load reserves_time_data_activation
 584  *$load reserves_time_data_provision
 585  *$load headers_time_heat dh_upload
 586  *$load theta_night
 587  *$load temp_source_upload
 588  *$load headers_time_dhw d_dhw_upload nets_profile
 589  ;
 590   
 591   
 592   
 593   
 594  ***************  ASSIGNMENTS  ********************************************
      ******
 595   
 596   
 597   
 598  ***** Aliases *****
 599  alias (h,hh) ;
 600  alias (res,resres) ;
 601  alias (reserves,reservesreserves) ;
 602  alias (nondis,nondisnondis) ;
 603   
 604   
 605   
 606  ***** Derived sets *****
 607  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 608  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 609   
 610  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 611  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 612   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 634   
 635   
 636   
 637  ***** Parameters *****
 638   
 639  *--- Generation technologies ---*
 640  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 641  eta(tech) = technology_data(tech,'eta_con') ;
 642  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 643  c_up(dis) =technology_data(dis,'load change costs up') ;
 644  c_do(dis) = technology_data(dis,'load change costs down') ;
 645  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 646  c_vom(tech) = technology_data(tech,'variable_om') ;
 647  CO2price(tech) = technology_data(tech,'CO2_price') ;
 648   
 649  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 650  lifetime(tech) = technology_data(tech,'lifetime') ;
 651  recovery(tech) = technology_data(tech,'recovery_period') ;
 652  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 653  m_p(tech) = technology_data(tech,'max_installable') ;
 654  m_e(tech) = technology_data(tech,'max_energy') ;
 655  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 656  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 657   
 658  c_cu(res) = technology_data(res,'curtailment_costs') ;
 659   
 660   
 661  *--- Storage technologies ---*
 662  c_m_sto(sto) = storage_data(sto,'mc');
 663  eta_sto(sto) = storage_data(sto,'efficiency');
 664  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 665  phi_sto_ini(sto) = storage_data(sto,'level_start');
 666  etop_max(sto) = storage_data(sto,'etop_max') ;
 667   
 668  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 669  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 670  lifetime(sto) = storage_data(sto,'lifetime');
 671  interest_rate(sto) = storage_data(sto,'interest_rate');
 672  m_sto_e(sto) = storage_data(sto,'max_energy');
 673  m_sto_p(sto) = storage_data(sto,'max_power');
 674   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 716   
 717  *--- Temporal data ---*
 718  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 719  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 720   
 721  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 722  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 723  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 724   
 725   
 726  *--- Spatial data ---*
 727  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 728  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 729  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 730  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 731  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 732  *m_ntc(l) = topology_data(l,'max_installable') ;
 733  *dist(l) = topology_data(l,'distance') ;
 734   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 751   
 752  *--- Prosumage ---*
 753  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 754  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 755  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 756  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 757   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 803   
 804   
 805  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 806   
 807  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 808   
 809  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 810                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 811   
 812  c_i_res(res) = c_i(res) ;
 813  c_fix_res(res) = c_fix(res) ;
 814   
 815  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 816                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 817   
 818  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 819                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 848   
 849   
 850  ***************  Adjust costs to model's hourly basis ********************
      ******
 851   
 852  c_i(tech) = c_i(tech)*card(h)/8760 ;
 853  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 854  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 855  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 856  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 857  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 858  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 859  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 860   
 861  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 862  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 863  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 864  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 865  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 866   
 867  m_e('bio') = m_e('bio')*card(h)/8760 ;
 868   
 869  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 870   
 871  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 872  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 873  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 874  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 875   
 876   
 877   
 878  **************************************************************************
      ******
 879   
 880   
 881   
 882   
 883   
 884   
 885   
 886   
 887   
 888  **************************************************************************
      ******
 889   
 890  ***************************
 891  ***** Initialize data *****
 892  ***************************
 893   
 894  * Parameters for default base year
 895  d(h) = d_y('2030',h) ;
 896  phi_res(res,h) = phi_res_y('2030',res,h) ;
 897  phi_min_res = 0 ;
 898  phi_pro_self = 0 ;
 899  phi_pro_load = 0 ;
 900   
      phi_pro_load = 0.2 ;
      $ontext
 905   
 906   
 907  Parameter
 908  phi_min_res_exog;
 909  phi_min_res_exog = 1 ;
 910   
 911  Sets
 912  h_ini(h)                       First hour  /h1/
 913  h_end(h)                       Last hour   /h8760/
 914  ;
 915   
 916  **************************************************************************
      ******
 917  ***** Model *****
 918  **************************************************************************
      ******
 919   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\model.gms
 921   
 922  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 932  **************************************************************************
      ******
 933   
 934   
 935  Variables
 936  Z                  Value objective function [Euro]
 937  lambda_enerbal     Dual variable on energy balance (1a)
 938  lambda_resgen      Dual variable on renewable generation (3e)
 939  lambda_convgen     Dual variable on conventional generation level (2a)
 940  lambda_stolev      Dual variable on storage level  (4b)
 941  ;
 942   
 943  Positive Variables
 944  G_L(tech,h)            Generation level in hour h [MWh]
 945  G_UP(tech,h)           Generation upshift in hour h [MWh]
 946  G_DO(tech,h)           Generation downshift in hour h [MWh]
 947   
 948  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 949  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
 950   
 951  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 952  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 953  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 954   
 955  N_TECH(tech)           Technology tech built [MW]
 956  N_STO_E(sto)           Storage technology built - Energy [MWh]
 957  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
 958   
 959  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
 960  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
 961  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
 962  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
 963  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
 964  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
 965  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
 966  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 967  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 968  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
 969   
 970   
 971  mu_stoin_cap          Dual variable on storage loading capacity constraint
       (4d)
 972  mu_stout_cap          Dual variable on storage discharging capacity constr
      aint (4e)
 973  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 974  mu_conv_cap           Dual variable on conventional generation capacity co
      nstraint (3a)
 975  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 976  mu_dis_max_i          Dual variable on dispatchable installation constrain
      t (8a)
 977  mu_nondis_max_i       Dual variable on nondispatchable installation constr
      aint (8a)
 978  mu_stop_max_i         Dual variable on storage power installation constrai
      nt  (8c)
 979  mu_stoe_max_i         Dual variable on storage energy installation constra
      int  (8b)
 980  mu_minRES             Dual variable on minimum renewable share constraint 
      (5a)
 981   
 982  ;
 983   
 984   
 985   
 986  **************************************************************************
      ******
 987   
 988  Equations
 989  * Objective
 990  obj                      Objective cost minimization
 991   
 992  * Energy balance
 993  con1a_bal                Energy Balance
 994   
 995  * Load change costs
 996  con2a_loadlevel          Load change costs: Level
 997  con2b_loadlevelstart     Load change costs: Level for first period
 998   
 999  * Capacity contraints and flexibility constraints
1000  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1001  con3e_maxprod_res                Capacity constraints renewables
1002   
1003  * Storage constraints
1004  con4a_stolev_start        Storage Level Dynamics Initial Condition
1005  con4b_stolev              Storage Level Dynamics
1006  con4c_stolev_max          Storage Power Capacity
1007  con4d_maxin_sto           Storage maximum inflow
1008  con4e_maxout_sto          Storage maximum outflow
1009  con4j_ending              End level equal to initial level
1010   
1011  * Minimum restrictions for renewables and biomass
1012  con5a_minRES             Minimum yearly renewables requirement
1013  con5b_max_energy         Maximum yearly biomass energy
1014   
1015  * Maximum installation conditions
1016  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1017  con8b_max_I_sto_e                Maximum installable energy: Storage energ
      y in MWh
1018  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1019   
1020  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1021  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1022  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1023   
1024  * Prosumage
1025  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1026  con11b_pro_balance                       Prosumage: energy balance
1027  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1028  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1029  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1030  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1031  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1032  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1033  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1034   
1035   
1036  * KKT optimality conditions
1037  KKTG_L                   KKT w.r.t. G_L
1038  KKTG_UP                  KKT w.r.t. G_UP
1039  KKTG_DO                  KKT w.r.t. G_DO
1040  KKTG_RES                 KKT w.r.t. G_RES
1041  KKTCU                    KKT w.r.t. CU
1042  KKTSTO_IN                KKT w.r.t. STO_IN
1043  KKTSTO_OUT               KKT w.r.t. STO_OUT
1044  KKTSTO_L                 KKT w.r.t. STO_L
1045  KKTN_TECH                KKT w.r.t. N_TECH
1046  KKTN_STO_E               KKT w.r.t. N_STO_E
1047  KKTN_STO_P               KKT w.r.t. N_STO_P
1048  ;
1049   
1050   
1051  **************************************************************************
      ******
1052   
1053  * ------------------------------------------------------------------------
      ---- *
1054  ***** Objective function *****
1055  * ------------------------------------------------------------------------
      ---- *
1056   
1057  obj..
1058           Z =E=
1059                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1060                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1061                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1062                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1063                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1064                   + sum( tech , c_i(tech)*N_TECH(tech) )
1065                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1066                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1067                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1068                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
       
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1079  ;
1080   
1081  * ------------------------------------------------------------------------
      ---- *
1082  ***** Energy balance and load levels *****
1083  * ------------------------------------------------------------------------
      ---- *
1084   
1085  * Energy balance
1086  con1a_bal(hh)..
1087   
1088           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
               + sum( res , G_MARKET_PRO2M(res,hh) )
      $ontext
1093           -  ( 1 - phi_pro_load )* d(hh)
1094           -   sum( sto , STO_IN(sto,hh) )
1095   
               - G_MARKET_M2PRO(hh)
      $ontext
1100   
1101         =E= 0
1102  ;
1103   
1104  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1105           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1106  ;
1107   
1108  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1109          G_UP(dis,h) - G_L(dis,h) =E= 0
1110  ;
1111   
1112  * ------------------------------------------------------------------------
      ---- *
1113  ***** Hourly maximum generation caps *****
1114  * ------------------------------------------------------------------------
      ---- *
1115   
1116  con3a_maxprod_dispatchable(dis,h)..
1117   
1118           N_TECH(dis) -  G_L(dis,h)  =G= 0
1119   
1120  ;
1121   
1122  con3e_maxprod_res(nondis,h)..
1123   
1124   
1125         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =
      E= 0
1126  ;
1127   
1128  * ------------------------------------------------------------------------
      ---- *
1129  ***** Storage constraints *****
1130  * ------------------------------------------------------------------------
      ---- *
1131   
1132  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1133          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2
       - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1134  ;
1135   
1136  con4b_stolev(sto,h)$(ord(h)>1)..
1137          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)
      /(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1138  ;
1139   
1140  con4c_stolev_max(sto,h)..
1141         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1142  ;
1143   
1144  con4d_maxin_sto(sto,h)..
1145   
1146          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1147  ;
1148   
1149  con4e_maxout_sto(sto,h)..
1150   
1151          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1152  ;
1153   
1154  con4j_ending(sto,h)$(ord(h) = card(h))..
1155   
1156          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1157  ;
1158   
1159   
1160  * ------------------------------------------------------------------------
      ---- *
1161  ***** Quotas for renewables and biomass *****
1162  * ------------------------------------------------------------------------
      ---- *
1163   
1164  con5a_minRES..
1165  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1166   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h)) + s
      um( (res) , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1171  )
1172          - phi_min_res * phi_min_res_exog * sum( h ,
1173           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1174   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1179           )  =G= 0
1180  ;
1181   
1182  con5b_max_energy(dis)$(m_e(dis))..
1183           m_e(dis) -  sum( h , G_L(dis,h) ) =G= 0
1184  ;
1185   
1186   
1187  * ------------------------------------------------------------------------
      ---- *
1188  ***** Maximum installation constraints *****
1189  * ------------------------------------------------------------------------
      ---- *
1190   
1191  con8a_max_I_power(tech)..
1192         m_p(tech) - N_TECH(tech)     =G= 0
1193  ;
1194   
1195  con8b_max_I_sto_e(sto)..
1196         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1197  ;
1198   
1199  con8c_max_I_sto_p(sto)..
1200         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1201  ;
1202   
1203   
1204   
1205  con8f_max_pro_res(res)..
1206         m_res_pro(res) -  N_RES_PRO(res) =G= 0
1207  ;
1208   
1209  con8g_max_pro_sto_e(sto)..
1210         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1211  ;
1212   
1213  con8h_max_sto_pro_p(sto)..
1214          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1215  ;
1216   
1217  * ------------------------------------------------------------------------
      ---- *
1218  ***** Prosumage constraints *****
1219  * ------------------------------------------------------------------------
      ---- *
1220   
1221  con11a_pro_distrib(res,h)..
1222           phi_res(res,h) * N_RES_PRO(res)
1223           =E=
1224           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) )
1225  ;
1226   
1227  con11b_pro_balance(h)..
1228           phi_pro_load * d(h)
1229           =E=
1230           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      ) + G_MARKET_M2PRO(h)
1231  ;
1232   
1233  con11c_pro_selfcon..
1234           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1235           =G=
1236           phi_pro_self * sum( h , phi_pro_load * d(h))
1237  ;
1238   
1239  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1240           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1241  ;
1242   
1243   
1244  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1245          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
       + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2
      PRO(sto,h)/(1+eta_sto(sto))*2
1246  ;
1247   
1248   
1249  con11j_pro_stolev_max(sto,h)..
1250         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1251  ;
1252   
1253  con11k_pro_maxin_sto(sto,h)..
1254          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1255          =G= 0
1256  ;
1257   
1258  con11l_pro_maxout_sto(sto,h)..
1259          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1260          =G= 0
1261  ;
1262   
1263  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1264           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1265  ;
1266   
1267  * ------------------------------------------------------------------------
      ---- *
1268  ***** FOC conditions *****
1269  * ------------------------------------------------------------------------
      ---- *
      KKTG_L(dis,h)..
      ;
       
      KKTG_UP(dis,h)..
      ;
       
      KKTG_DO(dis,h)..
      ;
       
      KKTG_RES(nondis,h)..
      ;
       
      KKTCU(nondis,h)..
      ;
       
      KKTSTO_IN(sto,h)..
      ;
       
      KKTSTO_OUT(sto,h)..
      ;
       
      KKTSTO_L(sto,h)..
      ;
       
      KKTN_TECH_NONDIS(nondis)..
      ;
       
      KKTN_TECH_NDIS(dis)..
      ;
       
      KKTN_STO_E(sto)..
      ;
       
      KKTN_STO_P(sto)..
      ;
       
1308   
1309   
1310   
1311  **************************************************************************
      ******
1312  ***** MODEL *****
1313  **************************************************************************
      ******
1314   
1315  model DIETER /
1316  obj
1317   
1318  con1a_bal
1319   
1320  con2a_loadlevel
1321  con2b_loadlevelstart
1322   
1323  con3a_maxprod_dispatchable
1324   
1325  con3e_maxprod_res
1326   
1327  con4a_stolev_start
1328  con4b_stolev
1329  con4c_stolev_max
1330  con4d_maxin_sto
1331  con4e_maxout_sto
1332  con4j_ending
1333   
1334  con5a_minRES
1335  con5b_max_energy
1336   
1337  con8a_max_I_power
1338  con8b_max_I_sto_e
1339  con8c_max_I_sto_p
1340   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1356   
1357  /;
1358   
1359  **************************************************************************
      ******
1360  ***** Options, fixings, report preparation *****
1361  **************************************************************************
      ******
1362   
1363  * Solver options
1369   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1380   
1381  dieter.OptFile = 1;
1382  dieter.holdFixed = 1 ;
1383   
1384   
1385  **************************************************************************
      ******
1386  ***** Solve *****
1387  **************************************************************************
      ******
1388   
1389  * Preparation of GUSS tool for scenario analysis
1390  phi_min_res = eps ;
1391  phi_pro_self = eps ;
1392   
1394   
1395  Set
1396  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1397  superscen        Scenarios                               /scen1*scen1000/
1398  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1399  ;
1400   
1401  set
1402  scen(superscen);
1403  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1404   
1405  Parameters
1406  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1407  modstats(superscen, modelstats)
1408  min_res
1409  pro_selfcon
1410  ;
1411   
1412  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_res_share.val/100 ) ;
1413  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1414   
1415  Parameters
1416  * Equations
1417  marginal_con5a(superscen)
1418  marginal_con1a(superscen,*)
1419  marginal_con9a(superscen,*,*,*)
1420  marginal_con9b(superscen,*,*,*)
1421   
1422  * Basic
1423  lev_Z(superscen)
1424  lev_G_L(superscen,tech,h)
1425  lev_G_UP(superscen,tech,h)
1426  lev_G_DO(superscen,tech,h)
1427  lev_G_RES(superscen,tech,h)
1428  lev_CU(superscen,tech,h)
1429  lev_STO_IN(superscen,sto,h)
1430  lev_STO_OUT(superscen,sto,h)
1431  lev_STO_L(superscen,sto,h)
1432  lev_N_TECH(superscen,tech)
1433  lev_N_STO_E(superscen,sto)
1434  lev_N_STO_P(superscen,sto)
1435   
1436   
1437  * Prosumage
1438  lev_CU_PRO(superscen,tech,h)
1439  lev_G_MARKET_PRO2M(superscen,tech,h)
1440  lev_G_MARKET_M2PRO(superscen,h)
1441  lev_G_RES_PRO(superscen,tech,h)
1442  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1443  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1444  lev_STO_IN_M2PRO(superscen,sto,h)
1445  lev_STO_IN_M2M(superscen,sto,h)
1446  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1447  lev_STO_OUT_PRO2M(superscen,sto,h)
1448  lev_STO_OUT_M2PRO(superscen,sto,h)
1449  lev_STO_OUT_M2M(superscen,sto,h)
1450  lev_STO_L_PRO2PRO(superscen,sto,h)
1451  lev_STO_L_PRO2M(superscen,sto,h)
1452  lev_STO_L_M2PRO(superscen,sto,h)
1453  lev_STO_L_M2M(superscen,sto,h)
1454  lev_N_STO_E_PRO(superscen,sto)
1455  lev_N_STO_P_PRO(superscen,sto)
1456  lev_STO_L_PRO(superscen,sto,h)
1457  lev_N_RES_PRO(superscen,tech)
1458  ;
1459   
1460   
1461  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\fix.gms
1463   
1464  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1474  **************************************************************************
      ******
1475   
1476   
1477   
1478  **************************************************************************
      ******
1479  **** Run of river  *******************************************************
      ******
1480  **************************************************************************
      ******
1481   
1482  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1483   
1484  *$ontext
1485  N_TECH.fx('ror') = 5857.47 ;
1486  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1489   
1490  * Fix everything to zero in case no ROR option is selected:
1491  *N_TECH.fx('ror') = 0 ;
1492  *G_RES.fx('ror',h) = 0 ;
1493  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1494   
1495   
1496  **************************************************************************
      ******
1497  **** No storage and DSM in first period  *********************************
      ******
1498  **************************************************************************
      ******
1499   
1500  ** No storage inflow in first period **
1501  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1502   
1503   
1504   
1505  **************************************************************************
      ******
1506  **** No primary reserves by heating devices  *****************************
      ******
1507  **************************************************************************
      ******
1508   
1509   
1510  **************************************************************************
      ******
1511  **** Fixing to reduce model size  ****************************************
      ******
1512  **************************************************************************
      ******
1513   
1514  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1515  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1516   
1517  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1518  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1519  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1520  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1521  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1522  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1523   
1524  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1525  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1526  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1527  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1528  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1529   
1530   
1531  Variables
1532  STO_IN_PRO2M(tech,sto,h)
1533  STO_IN_M2PRO(sto,h)
1534  STO_IN_M2M(sto,h)
1535  STO_OUT_PRO2M(sto,h)
1536  STO_OUT_M2PRO(sto,h)
1537  STO_OUT_M2M(sto,h)
1538  STO_L_PRO(sto,h)
1539  STO_L_PRO2M(sto,h)
1540  STO_L_M2PRO(sto,h)
1541  STO_L_M2M(sto,h)
1542  ;
1543   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1567   
1568  * Deactivated market storage links
1569   
1570  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1571  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1572  STO_IN_M2M.fx(sto,h)       = 0 ;
1573  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1574  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1575  STO_OUT_M2M.fx(sto,h)      = 0 ;
1576  STO_L_PRO.fx(sto,h)        = 0 ;
1577  STO_L_PRO2M.fx(sto,h)      = 0 ;
1578  STO_L_M2PRO.fx(sto,h)      = 0 ;
1579  STO_L_M2M.fx(sto,h)        = 0 ;
1580   
1581  **************************************************************************
      ******
1582  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1583  **************************************************************************
      ******
1584   
1585  * Default level zero for report parameters
1586  lev_Z(scen) = 0 ;
1587  lev_G_L(scen,tech,h) = 0 ;
1588  lev_G_UP(scen,tech,h) = 0 ;
1589  lev_G_DO(scen,tech,h) = 0 ;
1590  lev_G_RES(scen,tech,h) = 0 ;
1591  lev_CU(scen,tech,h) = 0 ;
1592  lev_STO_IN(scen,sto,h) = 0 ;
1593  lev_STO_OUT(scen,sto,h) = 0 ;
1594  lev_STO_L(scen,sto,h) = 0 ;
1595  lev_N_TECH(scen,tech) = 0 ;
1596  lev_N_STO_E(scen,sto) = 0 ;
1597  lev_N_STO_P(scen,sto) = 0 ;
1598  marginal_con1a(scen,h) = 0 ;
1599  marginal_con5a(superscen) = 0 ;
1600   
1601  * Prosumage
1602  lev_CU_PRO(scen,tech,h) = 0 ;
1603  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1604  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1605  lev_G_RES_PRO(scen,tech,h) = 0  ;
1606  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1607  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1608  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1609  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1610  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1611  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1612  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1613  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1614  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1615  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1616  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1617  lev_STO_L_M2M(scen,sto,h) = 0  ;
1618  lev_N_STO_E_PRO(scen,sto) = 0  ;
1619  lev_N_STO_P_PRO(scen,sto) = 0  ;
1620  lev_STO_L_PRO(scen,sto,h) = 0  ;
1621  lev_N_RES_PRO(scen,tech) = 0  ;
1622   
1623   
1624  * Fixing of report parameters for run-of-river
1625  *$ontext
1626  lev_N_TECH(scen,'ror') = 5857.47 ;
1627  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1637   
1638   
1639   
1640   
1641   
1642   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\scenario.gms
1644   
1645  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1655  **************************************************************************
      ******
1656   
1657   
1658   
1659   
1660  *****************************************
1661  **** Scenario file                   ****
1662  ****                                 ****
1663  *****************************************
1664   
1665  Parameter
1666  m_exog_p(tech)
1667  m_exog_sto_e(sto)
1668  m_exog_sto_p(sto)
1669  *m_exog_rsvr_p(rsvr)
1670  *m_exog_ntc(l)
1671  ;
1672   
1673  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1674  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1675  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1676  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1677  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1678   
1679   
1680  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1697   
1698  *** Investment model
1699  *$ontext
1700  N_TECH.lo(tech) = 0 ;
1701  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1702  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1703  N_TECH.lo('pv') = m_exog_p('pv') ;
1704  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1705  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1706  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1707  *NTC.lo(l) = m_exog_ntc(l) ;
1708   
1709  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1710  N_TECH.up('wind_on') = inf ;
1711  N_TECH.up('wind_off') = inf ;
1712  N_TECH.up('pv') = inf ;
1713  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1714  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1715  N_STO_P.up('sto1') = inf ;
1716  N_STO_P.up('sto5') = inf ;
1717  N_STO_P.up('sto7') = inf ;
1718  N_STO_E.up('sto1') = inf ;
1719  N_STO_E.up('sto5') = inf ;
1720  N_STO_E.up('sto7') = inf ;
1721  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1722  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1723  *$offtext
1724   
1725   
1726  *** Reservoir assumption - not used here
1727  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1728  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1729  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1730  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1731   
1732   
1733  *** Germany only, no infeasibility
1734  *NTC.fx(l) = 0 ;
1735  *F.fx(l,h) = 0 ;
1736  *G_INFES.fx(h) = 0 ;
1737   
1738   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1769   
1770   
1771  * Definition of dictionary set for GUSS tool
1772   
1773  Set dict(*,*,*) /
1774  scen             .scenario       .''
1775  gussoptions      .opt            .modstats
1776   
1777  phi_min_res      .param          .min_res
1778   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1783   
1784   
1785  con5a_minRES     .marginal       .marginal_con5a
1786  con1a_bal        .marginal       .marginal_con1a
1787   
1788  Z                .level          .lev_Z
1789  G_L              .level          .lev_G_L
1790  G_UP             .level          .lev_G_UP
1791  G_DO             .level          .lev_G_DO
1792  G_RES            .level          .lev_G_RES
1793  CU               .level          .lev_CU
1794  STO_IN           .level          .lev_STO_IN
1795  STO_OUT          .level          .lev_STO_OUT
1796  STO_L            .level          .lev_STO_L
1797  N_TECH           .level          .lev_N_TECH
1798  N_STO_E          .level          .lev_N_STO_E
1799  N_STO_P          .level          .lev_N_STO_P
1800   
1801   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1815  /
1816  ;
1817   
1818  solve DIETER using lp min Z scenario dict;
1819   
1820   
1821  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\report.gms
1823   
1824  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1834  **************************************************************************
      ******
1835   
1837   
1838   
1839   
1840   
1841  **************************************************************************
      ******
1842  **** Parameters for report file  *****************************************
      ******
1843  **************************************************************************
      ******
1844   
1845  Parameter
1846  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1847  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1848  corr_fac_sto             Balancing correction factor - storage technologie
      s
1849  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1850  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1851  corr_fac_ev              Balancing correction factor - electric vehicles
1852  corr_fac_rsvr            Balancing correction factor - reservoir
1853  corr_fac_sets            Balancing correction factor - SETS
1854  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1855  corr_fac_hp              Balancing correction factor - heat pumps
1856  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
1857   
1858  corr_fac_ev_sep
1859   
1860  gross_energy_demand                      Gross energy demand
1861  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
1862  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1863  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
1864  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
1865   
1866  reserves_activated
1867   
1868  calc_maxprice
1869  calc_minprice
1870   
1871  report
1872  report_tech
1873  report_tech_hours
1874  report_hours
1875  report_node
1876  report_line
1877  report_cost
1878   
1879  report_reserves
1880  report_reserves_hours
1881  report_reserves_tech
1882  report_reserves_tech_hours
1883   
1884  report_prosumage
1885  report_prosumage_tech
1886  report_prosumage_tech_hours
1887  report_market
1888  report_market_tech
1889  report_market_tech_hours
1890   
1891  report_heat_tech_hours
1892  report_heat_tech
1893  ;
1894   
1895   
1896   
1897   
1898  **************************************************************************
      ******
1899  **** Initialize reporting paremetrs  *************************************
      ******
1900  **************************************************************************
      ******
1901   
1902  * Set reporting sensitivity. All results below will be reported as zero
1903  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
1904  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
1905  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
1906   
1907   
1908  * ------------------------------------------------------------------------
      ----
1909   
1910  * Min and max for prices
1911  calc_maxprice = 0 ;
1912  calc_minprice = 1000 ;
1913   
1914   
1915  * ------------------------------------------------------------------------
      ----
1916   
1917  * Default values for correction factors
1918  corr_fac_dis(scen,dis,h) = 0 ;
1919  corr_fac_nondis(scen,nondis,h) = 0 ;
1920  corr_fac_sto(scen,sto,h) = 0 ;
1921  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
1922  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
1923  *corr_fac_ev(scen,h) = 0 ;
1924  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
1925  *corr_fac_sets(scen,bu,ch,h) = 0 ;
1926  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
1927  *corr_fac_hp(scen,bu,ch,h) = 0 ;
1928  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
1929   
1930  *corr_fac_ev_sep(scen,ev,h) = 0 ;
1931   
1932   
1933  * ------------------------------------------------------------------------
      ----
1934   
1935  * Parameter for hourly nodal reserves activated
1936  reserves_activated(scen,h) = 0 ;
1937   
1938   
1939   
1940   
1941   
1942  * ------------------------------------------------------------------------
      ----
1943   
1944  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
1951   
1952   
1953  * ------------------------------------------------------------------------
      ----
1954   
1955  *Determine balancing correction factors
1956   
1957   
1958   
1959   
1960  * ------------------------------------------------------------------------
      ----
1961   
1962  * Define gross energy demand for reporting
1963  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
1968   
1969   
1970  )
1971  ;
1972   
1973   
1974  **************************************************************************
      ******
1975  **** Report  *************************************************************
      ******
1976  **************************************************************************
      ******
1977   
1978  * RPEORT model statistics
1979          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
1980          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
1981          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
1982   
1983   
1984  * ------------------------------------------------------------------------
      ----
1985   
1986  * REPORT HOURS
1987          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
1988          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
1989  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
1990  *- corr_fac_dsm_shift(scen,dsm_shift,h))
1991  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
1992  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
1993  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
1994  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
1995  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
1996          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
1997   
1998                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
1999                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
2000  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2001  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2002                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2003                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2004  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
2005   
2006   
2007  * ------------------------------------------------------------------------
      ----
2008   
2009  * REPORT TECH HOURS
2010          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2011  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
2012          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2013  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
2014  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2015  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
2016          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2017          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2018          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
2019          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2020  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
2021   
2022                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2023                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2024  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2025                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2026                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2027                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
2028                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
2029  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
2030  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
2031  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2032  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2033   
2034   
2035  * ------------------------------------------------------------------------
      ----
2036   
2037  * RPEORT LINE
2038   
2039  * ------------------------------------------------------------------------
      ----
2040   
2041  * REPORT NODE
2042          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2043   
2044  ;
2045          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
2046          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
2047  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2048           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2049          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
2050  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2051           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2052  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2053  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2054  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2055  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2056  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2057  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2058  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2059  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2060  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2061  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2062          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2063  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2064   
2065  ;
2066          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2067          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2068          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2069          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2070          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2071          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2072          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2073   
2074                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2075                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2076                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2077                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2078                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2079                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2080  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2081  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2082  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_
      abs*card(h)) = 0 ;
2083                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2084                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2085                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2086  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2087  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2088                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2089  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2090  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2091   
2092   
2093  * ------------------------------------------------------------------------
      ----
2094   
2095  * REPORT COST
2096          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2097   
2098  ));
2099           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2100  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2101   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2106  );
2107   
2108  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2109  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2110  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2111           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2112  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2113  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2114  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      )
2115   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2127   
2128  * ------------------------------------------------------------------------
      ----
2129   
2130  * REPORT TECH
2131          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2132          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2133  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2134  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2135          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2136          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2137   
2138          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2139          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2140  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2141          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2142          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2143   
2144          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2145  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2146          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2147          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2148  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2149          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2150   
2151          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2152          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2153   
2154          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2155          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2156   
2157          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2158          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2159  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2160          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2161   
2162   
2163                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2164                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2165                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2166                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2167  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2168  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2169                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2170  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2171                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2172                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2173  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2174                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2175                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2176                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2177                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2178                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2179  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2180                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2181                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2182                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2183  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2184                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2185                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2186                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2187   
2188   
2189  * ------------------------------------------------------------------------
      ----
2190   
2191  * REPORT NODE
2192          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2193  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr))
2194           ;
2195          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2196  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2197          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2198  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr))
2199           ;
2200          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2201   
2202                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2203                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2204                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2205                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2206   
2207   
2208   
2209  * ------------------------------------------------------------------------
      ----
2210   
2211  * REPORT TECH
2212          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2213          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2214  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2215          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2216   
2217          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2218          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2219  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2220          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2221          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2222          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(s
      cen,sto) ) * 1 ;
2223   
2224                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2225                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2226  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2227                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2228   
2229                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2230                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2231  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2232                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2233                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2234                   report_tech('Storage cycles',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
2235   
2236   
2237  * ------------------------------------------------------------------------
      ----
2238   
2239  * RPEORT
2240          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2241          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2242          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2243          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2244          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2245          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2246          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2247          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2248          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2249  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2250          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2251  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2252           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2253          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2254          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2255   
2256                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2257                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2258                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2259                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2260                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2261                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2262                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2263                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2264                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2265   
2266   
2267  * ------------------------------------------------------------------------
      ----
2268   
2269  * DSM
2270   
2271   
2272  * ------------------------------------------------------------------------
      ----
2273   
2274  * EV
2275   
2276   
2277   
2278  * ------------------------------------------------------------------------
      ----
2279   
2280  * Reserves
2281   
2282   
2283   
2284   
2285  * ------------------------------------------------------------------------
      ----
2286   
2287  * Reserves and DSM
2288   
2289   
2290  * ------------------------------------------------------------------------
      ----
2291   
2292  * ------------------------------------------------------------------------
      ----
2293   
2294  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 
      - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )
        ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage load
      ing prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage
       generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage ge
      neration prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers P
      RO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage
       out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pro
      sumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosum
      age,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res
      _share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawa
      l prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(s
      cen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) )
      ;
              report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loo
      p_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour%
       ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_re
      p_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E
      _PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_shar
      e,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_sha
      re,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( sum
      (h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,r
      es,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac
      _dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec
      _hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) *
       %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( s
      cen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosum
      ers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(sce
      n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (r
      es,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
              report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (
      sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )
      ) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr
      ,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fa
      c_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,
      h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_pr
      osumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share
      ,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1
      e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* %
      sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation
      ',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated
       gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_
      rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_sh
      are,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',l
      oop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
                       report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
      *                 report_market_tech('capacities reservoir MW market',loop
      _res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir 
      MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
      *                 report_market_tech('capacities reservoir MWh market',loo
      p_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir
       MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
                       report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
                       report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
                       report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
                       report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_shar
      e,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy 
      share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr
      )< eps_rep_rel) = 0 ;
      $ontext
2566   
2567   
2568  * ------------------------------------------------------------------------
      ----
2569   
2570  * PROSUMAGE & DSM
2571   
2572   
2573   
2574  * ------------------------------------------------------------------------
      ----
2575   
2576   
2577   
2578  * ------------------------------------------------------------------------
      ----
2579   
2580  * HEAT
2581   
2582  * ------------------------------------------------------------------------
      ----
2583   
2584  * Reserves and heat
2585   
2586   
2587  * ------------------------------------------------------------------------
      ---- *
2588  * ------------------------------------------------------------------------
      ---- *
2589  * ------------------------------------------------------------------------
      ---- *
2590   
2591   
2592  execute_unload "results", report, report_tech, report_node,
2593  *report_line,
2594  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
      $ontext
2599  ;
2600   
2601   
      $include report_to_excel.gms
      $ontext
2606   
2607   
2608   
2609  * ------------------------------------------------------------------------
      ---- *
2610  * ------------------------------------------------------------------------
      ---- *
2611  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/22/18 08:12:14 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          Modified_MCP\DIETER.gms
     2      118 INCLUDE        1     118  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\dataload.gms
     3      525 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      527 GDXIN          2     409  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\Data_input.gdx
     5      579 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      580 GDXIN          2     462  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\time_series.gdx
     7      920 INCLUDE        1     153  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\model.gms
     8     1462 INCLUDE        1     258  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\fix.gms
     9     1643 INCLUDE        1     259  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\scenario.gms
    10     1822 INCLUDE        1     313  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\report.gms


COMPILATION TIME     =       29.422 SECONDS      6 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/22/18 08:12:14 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1818


MODEL STATISTICS

BLOCKS OF EQUATIONS          17     SINGLE EQUATIONS      385,486
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      324,145  5 projected
NON ZERO ELEMENTS     1,362,738     NON LINEAR N-Z         87,601
DERIVATIVE POOL              20     CONSTANT POOL              17
CODE LENGTH             122,646


GENERATION TIME      =       70.735 SECONDS    207 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =       70.969 SECONDS    207 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/22/18 08:12:14 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1818


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1818

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         39.328  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.61 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 38.77sec (det. 17442.27 ticks)
Optimal solution found.
Objective : 33544542852.728615

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544542852.7286
---   Resource Usage   39391
---   Total Time (ms)  39531

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/22/18 08:12:14 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.797 SECONDS    124 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.lst
