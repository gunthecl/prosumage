GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/30/18 17:31:17 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  31   
  34   
  36   
  37  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  38  * if nothing is selected, ROR capacity will be set to zero
  39  * if parameter option is selected, set appropriate values in fix.gmx
  40  * if variable option is selected, set appropriate bound in data_input exce
      l
  43   
  44  * Set star to determine loops, otherwise default 100% renewables
  46   
  47  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  49   
  50  * Set star for reporting to Excel
  52   
  53   
  54  **************************************************************************
      ******
  55   
  56  * Definition of strings for report parameters and sanity checks
  57  * (Do not change settings below)
  59   
  60  * Sanity checks
  62   
  63  **************************************************************************
      ******
  64   
  65  ****************************
  66  ***** INITIALIZE LOOPS *****
  67  ****************************
  68   
  69  sets
  70  *$ontext
  71  loop_res_share   Solution loop for different shares of renewables       /5
      0/
  74   
  75  *$ontext
  76  loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
  79   
  80  *      loop_res_share                          /50/
  81  *                      loop_prosumage                          /0/
  82  ;
  83   
  84   
  85   
  86   
  87  **************************************************************************
      ******
  88   
  89  **************************
  90  ***** SOLVER OPTIONS *****
  91  **************************
  92   
  93  options
  94  optcr = 0.00
  95  reslim = 10000000
  96  lp = cplex
  97  mip = cplex
  98  nlp = conopt
  99  limrow = 0
 100  limcol = 0
 101  ;
 102   
 103  options
 104  dispwidth = 15
 105  limrow = 0
 106  limcol = 0
 107  solprint = off
 108  sysout = off
 109  ;
 110   
 111   
 112   
 113   
 114  **************************************************************************
      ******
 115   
 116  **************************
 117  ***** Dataload *****
 118  **************************
 119   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\dataload.gms
 121   
 122  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 132  **************************************************************************
      ******
 133   
 134   
 135   
 136   
 137  ***************  SETS  ***************************************************
      ******
 138   
 139  ***** Sets used in the model *****
 140  Sets
 141  tech                     Generation technologies
 142   dis(tech)               Dispatchable generation technologies
 143   nondis(tech)            Nondispatchable generation technologies
 144   con(tech)               Conventional generation technologies
 145   res(tech)               Renewable generation technologies
 146  sto                      Storage technologies
 147  rsvr                     Reservoir technologies
 148  dsm                      DSM technologies
 149   dsm_shift(dsm)          DSM load shifting technologies
 150   dsm_curt(dsm)           DSM load curtailment technologies
 151  year                     Base year for temporal data
 152  h                        Hours
 153  n                        Nodes
 154  l                        Lines
 155  ev                       EV types
 156  reserves                         Reserve qualities
 157   reserves_up(reserves)           Positive reserves
 158   reserves_do(reserves)           Negative reserves
 159   reserves_spin(reserves)         Spinning reserves
 160   reserves_nonspin(reserves)      Nonspinning reserves
 161   reserves_prim(reserves)         Primary reserves
 162   reserves_nonprim(reserves)      Nonprimary reserves
 163   reserves_prim_up(reserves)      Primary positive reserves
 164   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 165   reserves_prim_do(reserves)      Primary negative reserves
 166   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 167  bu                       Building archtypes
 168  ch                       Heating combination type
 169   hst(ch)                 Heating technology that feeds to storage
 170   hp(ch)                  Heat pump technologies
 171   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 172   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 173   
 174   
 175  ***** Sets used for data upload *****
 176  headers_tech                     Generation technologies - upload headers
 177   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 178   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 179  headers_sto                      Storage technologies - upload headers
 180  headers_reservoir                Reservoir technologies - upload headers
 181  headers_dsm                      DSM technologies - upload headers
 182   dsm_type                        DSM technologies - shifting or curtailmen
      t
 183  headers_time                     Temporal data - upload headers
 184  headers_topology                 Spatial data - upload headers
 185  headers_ev                       EV data - upload headers
 186  headers_time_ev                  EV temporal data - upload headers
 187  headers_prosumage_generation     Prosumage generation data - upload header
      s
 188  headers_prosumage_storage        Prosumage storage data - upload headers
 189  headers_reserves                 Reserve data - upload headers
 190   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 191   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 192   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 193  headers_heat                     Heat data - upload headers
 194   heat_storage                    Heat data - storage technologies
 195   heat_hp                         Heat data - heat pump technologies
 196   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 197   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 198  headers_time_heat                Heat data - upload headers time data
 199  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 200  ;
 201   
 202   
 203   
 204   
 205  ***************  PARAMETERS  *********************************************
      ******
 206   
 207  Parameters
 208   
 209  ***** Generation technologies *****
 210  *--- Variable and fixed costs ---*
 211  eta              Efficiency of conventional technologies [0 1]
 212  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 213  c_up             Load change costs UP [EUR per MWh]
 214  c_do             Load change costs DOWN [EUR per MWh]
 215  c_fix            Annual fixed costs [EUR per MW per year]
 216  c_vom            Variable O&M costs [EUR per MWh]
 217  CO2price         CO2 price in [EUR per ton]
 218   
 219  *--- Investment ---*
 220  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 221  lifetime         Investment costs: technical lifetime [a]
 222  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 223  interest_rate    Investment costs: Interest rate [%]
 224  m_p              Investment: maximum installable capacity per technology [
      MW]
 225  m_e              Investment: maximum installable energy [TWh per a]
 226   
 227  *--- Flexibility ---*
 228  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 229   
 230   
 231  ***** Fuel and CO2 costs *****
 232  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 233   
 234   
 235  ***** Renewables *****
 236  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 237  phi_min_res      Minimum renewables share [0 1]
 238   
 239   
 240  ***** Storage *****
 241  *--- Variable and fixed costs ---*
 242  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 243  eta_sto          Storage efficiency [0 1]
 244  phi_sto_ini      Initial storage level [0 1]
 245  etop_max         Maximum E to P ratio of storage types [#]
 246  c_fix_sto        Annual fixed costs [EUR per MW]
 247   
 248  *--- Investment ---*
 249  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 250  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 251  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 252  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 253   
 254   
 255  ***** Reservoir*****
 256  *--- Variable and fixed costs ---*
 257  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 258  eta_rsvr                 Generation efficiency [0 1]
 259  phi_rsvr_ini             Initial reservoir level [0 1]
 260  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 261  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 262  phi_rsvr_lev_min         Minimum filling level [0 1]
 263   
 264  *--- Investment ---*
 265  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 266  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 267  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 268  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 269  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 270  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 271   
 272   
 273  ***** DSM *****
 274  *--- Variable and fixed costs ---*
 275  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 276  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 277  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 278  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 279   
 280  *--- Flexibility, efficiency, recovery ---*
 281  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 282  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 283   
 284  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 285  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 286  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 287   
 288  *--- Investment ---*
 289  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 290  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 291  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 292  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 293  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 294  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 295  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 296  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 297   
 298   
 299  ***** Time Data *****
 300  d_y                      Demand hour h for different years [MWh]
 301  d                        Demand hour h [MWh]
 302  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 303  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 304  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 305  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 306  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 307  rsvr_in                  Reservoir inflow in hour h [0 1]
 308  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 309  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 310  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 311  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 312  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 313  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 314  reserves_exogenous       Hourly reserve provision [MW]
 315   
 316  ***** Transmission *****
 317  *--- Investment ---*
 318  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 319  c_fix_ntc                 Fixed costs [EUR per MW per a]
 320  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 321  inv_recovery_ntc          Investment costs: Recovery period in [a]
 322  inv_interest_ntc          Investment costs: Interest rate [%]
 323  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 324   
 325  *--- Topology and distance ---*
 326  inc              Incidence index of link l on node n
 327  dist             Distance covered by link l [km]
 328   
 329   
 330  ***** Electric vehicles *****
 331  *--- Costs and attributes ---*
 332  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 333  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 334  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 335  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 336  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 337   
 338  n_ev_e           Electric vehicle battery capacity [MWh]
 339  ev_quant         Overall number of electirc vehicles [#]
 340  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 341  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 342   
 343  *--- Temporal data ---*
 344  n_ev_p           Electric vehicle power rating [MWh]
 345  ev_ed            Electric vehicle electricity demand [MWh]
 346  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 347   
 348   
 349  ***** Prosumage *****
 350  phi_pro_load             Share of prosumagers among total load [0 1]
 351  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 352  m_res_pro                Maximum installable: renewables capacity [MW]
 353  m_sto_pro_e              Maximum installable: storage energy [MWh]
 354  m_sto_pro_p              Maximum installable: storage capacity [MW]
 355  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 356   
 357   
 358  ***** Reserves *****
 359  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 360  reserves_intercept       Intercept of regression line determining reserves
       demand
 361  reserves_slope           Slope of regression line determining reserves dem
      and
 362  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 363  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 364  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 365  *reserves_exog
 366   
 367   
 368  ***** Heat *****
 369  *--- Time data ---*
 370  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 371  dh_y                     Hourly heat demand per year [MWh per m2]
 372  dh                       Hourly heat demand [MWh per m2]
 373  temp_source              Heat pumps - source temperature [°Celsius]
 374  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 375  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 376  d_dhw                    Hourly DHW demand [MWh per m2]
 377  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 378   
 379  *--- Technololgy attributes ---*
 380  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 381  eta_heat_stat            Static efficiency for heating technologies [0 1]
 382  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 383  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 384  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 385  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 386  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 387  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 388  n_sets_p_out             SETS - Power rating - heat output [MW]
 389  n_sets_e                 SETS - Energy storage capacity [MWh]
 390  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 391  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 392  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 393  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 394  temp_sink                Heat pumps - sink temperature [°Celsius]
 395  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 396  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 397  theta_night              Indicator for night hours {0 1}
 398   
 399   
 400   
 401  ***************  DERIVED PARAMETERS  *************************************
      ******
 402   
 403  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 404  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 405   
 406  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 407  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 408   
 409  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 410  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 411   
 412  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 413  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 414   
 415  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 416  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 417   
 418  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 419   
 420  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 421  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 422   
 423  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 424  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 425  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 426  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 427  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 428  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 429   
 430   
 431   
 432   
 433  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 434   
 435  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 436  technology_data(tech,headers_tech)
 437  storage_data(sto,headers_sto)
 438  reservoir_data(rsvr,headers_reservoir)
 439  time_data_upload(h,year,headers_time)
 440  dsm_data_upload(dsm,dsm_type,headers_dsm)
 441  dsm_data(dsm,headers_dsm)
 442  topology_data(l,headers_topology)
 443  ev_data(ev,headers_ev)
 444  ev_time_data_upload(h,headers_time_ev,ev)
 445  prosumage_data_generation(tech,headers_prosumage_generation)
 446  prosumage_data_storage(sto,headers_prosumage_storage)
 447  reserves_time_data_activation(h,year,reserves)
 448  reserves_time_data_provision(h,year,reserves)
 449  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 450  reserves_data(reserves,headers_reserves)
 451  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 452  heat_data(bu,ch,headers_heat)
 453  dh_upload(h,year,headers_time_heat,bu)
 454  d_dhw_upload(h,year,headers_time_heat,bu)
 455  temp_source_upload
 456  ;
 457   
 458   
 459   
 460   
 461  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 462   
 525   
 526  *%skip_Excel%
 528   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 533  *$load l headers_topology topology_data
 534  *$ontext
 535  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 542  ;
 543   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 549   
 550   
 551  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 552   
 578   
 579   
 580  *
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 584  *$load headers_time_ev ev_time_data_upload
 585  *$load reserves_time_data_activation
 586  *$load reserves_time_data_provision
 587  *$load headers_time_heat dh_upload
 588  *$load theta_night
 589  *$load temp_source_upload
 590  *$load headers_time_dhw d_dhw_upload nets_profile
 591  ;
 592   
 593   
 594   
 595   
 596  ***************  ASSIGNMENTS  ********************************************
      ******
 597   
 598   
 599   
 600  ***** Aliases *****
 601  alias (h,hh) ;
 602  alias (res,resres) ;
 603  alias (reserves,reservesreserves) ;
 604  alias (nondis,nondisnondis) ;
 605   
 606   
 607   
 608  ***** Derived sets *****
 609  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 610  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 611   
 612  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 613  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 614   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 636   
 637   
 638   
 639  ***** Parameters *****
 640   
 641  *--- Generation technologies ---*
 642  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 643  eta(tech) = technology_data(tech,'eta_con') ;
 644  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 645  c_up(dis) =technology_data(dis,'load change costs up') ;
 646  c_do(dis) = technology_data(dis,'load change costs down') ;
 647  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 648  c_vom(tech) = technology_data(tech,'variable_om') ;
 649  CO2price(tech) = technology_data(tech,'CO2_price') ;
 650   
 651  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 652  lifetime(tech) = technology_data(tech,'lifetime') ;
 653  recovery(tech) = technology_data(tech,'recovery_period') ;
 654  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 655  m_p(tech) = technology_data(tech,'max_installable') ;
 656  m_e(tech) = technology_data(tech,'max_energy') ;
 657  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 658  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 659   
 660  c_cu(res) = technology_data(res,'curtailment_costs') ;
 661   
 662   
 663  *--- Storage technologies ---*
 664  c_m_sto(sto) = storage_data(sto,'mc');
 665  eta_sto(sto) = storage_data(sto,'efficiency');
 666  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 667  phi_sto_ini(sto) = storage_data(sto,'level_start');
 668  etop_max(sto) = storage_data(sto,'etop_max') ;
 669   
 670  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 671  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 672  lifetime(sto) = storage_data(sto,'lifetime');
 673  interest_rate(sto) = storage_data(sto,'interest_rate');
 674  m_sto_e(sto) = storage_data(sto,'max_energy');
 675  m_sto_p(sto) = storage_data(sto,'max_power');
 676   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 718   
 719  *--- Temporal data ---*
 720  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 721  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 722   
 723  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 724  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 725  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 726   
 727   
 728  *--- Spatial data ---*
 729  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 730  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 731  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 732  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 733  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 734  *m_ntc(l) = topology_data(l,'max_installable') ;
 735  *dist(l) = topology_data(l,'distance') ;
 736   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 753   
 754  *--- Prosumage ---*
 755  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 756  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 757  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 758  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 759   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 805   
 806   
 807  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 808   
 809  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 810   
 811  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 812                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 813   
 814  c_i_res(res) = c_i(res) ;
 815  c_fix_res(res) = c_fix(res) ;
 816   
 817  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 818                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 819   
 820  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 821                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 850   
 851   
 852  ***************  Adjust costs to model's hourly basis ********************
      ******
 853   
 854  c_i(tech) = c_i(tech)*card(h)/8760 ;
 855  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 856  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 857  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 858  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 859  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 860  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 861  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 862   
 863  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 864  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 865  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 866  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 867  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 868   
 869  m_e('bio') = m_e('bio')*card(h)/8760 ;
 870   
 871  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 872   
 873  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 874  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 875  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 876  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 877   
 878   
 879   
 880  **************************************************************************
      ******
 881   
 882   
 883   
 884   
 885   
 886   
 887   
 888   
 889   
 890  **************************************************************************
      ******
 891   
 892  ***************************
 893  ***** Initialize data *****
 894  ***************************
 895   
 896  * Parameters for default base year
 897  d(h) = d_y('2030',h) ;
 898  phi_res(res,h) = phi_res_y('2030',res,h) ;
 899  phi_min_res = 0 ;
 900  ev_quant = 0 ;
 901  phi_pro_self = 0 ;
 902  phi_pro_load = 0 ;
 903   
 904  *$ontext
 905  phi_pro_load = 0.2 ;
 908   
 909   
 910  Parameter
 911  phi_min_res_exog;
 912  phi_min_res_exog = 1 ;
 913   
 914  Sets
 915  h_ini(h)                       First hour  /h1/
 916  h_end(h)                       Last hour   /h8760/
 917  ;
 918   
 919  **************************************************************************
      ******
 920  ***** Model *****
 921  **************************************************************************
      ******
 922   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\model.gms
 924   
 925  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 935  **************************************************************************
      ******
 936   
 937   
 938  Variables
 939  Z                Value objective function [Euro]
 940  ;
 941   
 942  Positive Variables
 943  G_L(tech,h)            Generation level in hour h [MWh]
 944  G_UP(tech,h)           Generation upshift in hour h [MWh]
 945  G_DO(tech,h)           Generation downshift in hour h [MWh]
 946   
 947  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 948  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
 949   
 950  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 951  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 952  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 953   
 954  N_TECH(tech)           Technology tech built [MW]
 955  N_STO_E(sto)           Storage technology built - Energy [MWh]
 956  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
 957   
 958  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
 959  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
 960  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
 961  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
 962  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
 963  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
 964  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
 965  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 966  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 967  STO_L_PRO(sto,h)               Prosumage: overall storage level in hour h 
      [MWh]
 968  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
 969   
 970  ;
 971   
 972   
 973   
 974   
 975  **************************************************************************
      ******
 976   
 977  Equations
 978  * Objective
 979  obj                      Objective cost minimization
 980   
 981  * Energy balance
 982  con1a_bal                Energy Balance
 983   
 984  * Load change costs
 985  con2a_loadlevel          Load change costs: Level
 986  con2b_loadlevelstart     Load change costs: Level for first period
 987   
 988  * Capacity contraints and flexibility constraints
 989  con3a_maxprod_dispatchable       Capacity Constraint conventionals
 990  con3e_maxprod_res                Capacity constraints renewables
 991   
 992  * Storage constraints
 993  con4a_stolev_start        Storage Level Dynamics Initial Condition
 994  con4b_stolev              Storage Level Dynamics
 995  con4c_stolev_max          Storage Power Capacity
 996  con4d_maxin_sto           Storage maximum inflow
 997  con4e_maxout_sto          Storage maximum outflow
 998  con4j_ending              End level equal to initial level
 999  con4k_PHS_EtoP            Maximum E to P ratio for PHS
1000   
1001  * Minimum restrictions for renewables and biomass
1002  con5a_minRES             Minimum yearly renewables requirement
1003  con5b_max_energy         Maximum yearly biomass energy
1004   
1005  * Maximum installation conditions
1006  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1007  con8b_max_I_sto_e                Maximum installable energy: Storage in MW
      h
1008  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1009   
1010  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1011  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1012  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1013   
1014  * Prosumage
1015  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1016  con11b_pro_balance                       Prosumage: energy balance
1017  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1018  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1019  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1020  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1021  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1022  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1023  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1024  ;
1025   
1026   
1027   
1028   
1029  **************************************************************************
      ******
1030   
1031  * ------------------------------------------------------------------------
      ---- *
1032  ***** Objective function *****
1033  * ------------------------------------------------------------------------
      ---- *
1034   
1035  obj..
1036           Z =E=
1037                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1038                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1039                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1040                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1041                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1042                   + sum( tech , c_i(tech)*N_TECH(tech) )
1043                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1044                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1045                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1046                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
1047  *$ontext
1048                   + sum( res , c_i(res)*N_RES_PRO(res) )
1049                   + sum( res , c_fix(res)*N_RES_PRO(res) )
1050   
1051                   + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
1052                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
1053                   + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
1054                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
1057  ;
1058   
1059  * ------------------------------------------------------------------------
      ---- *
1060  ***** Energy balance and load levels *****
1061  * ------------------------------------------------------------------------
      ---- *
1062   
1063  * Energy balance
1064  con1a_bal(hh)..
1065           ( 1 - phi_pro_load )* d(hh) + sum( sto , STO_IN(sto,hh) )
1066  *$ontext
1067           + G_MARKET_M2PRO(hh)
1070   
1071           =E=
1072           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
1073   
1074  *$ontext
1075           + sum( res , G_MARKET_PRO2M(res,hh) )
1078   
1079  ;
1080   
1081  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1082          G_L(dis,h) =E= G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)
1083  ;
1084   
1085  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1086           G_L(dis,h) =E= G_UP(dis,h)
1087  ;
1088   
1089  * ------------------------------------------------------------------------
      ---- *
1090  ***** Hourly maximum generation caps *****
1091  * ------------------------------------------------------------------------
      ---- *
1092   
1093  con3a_maxprod_dispatchable(dis,h)..
1094          G_L(dis,h)
1095   
1096          =L= N_TECH(dis)
1097  ;
1098   
1099  con3e_maxprod_res(nondis,h)..
1100          G_RES(nondis,h) + CU(nondis,h)
1101   
1102          =E= phi_res(nondis,h) * N_TECH(nondis)
1103  ;
1104   
1105  * ------------------------------------------------------------------------
      ---- *
1106  ***** Storage constraints *****
1107  * ------------------------------------------------------------------------
      ---- *
1108   
1109  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1110          STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(
      1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1111  ;
1112   
1113  con4b_stolev(sto,h)$(ord(h)>1)..
1114           STO_L(sto,h) =E=  STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))
      /2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1115  ;
1116   
1117  con4c_stolev_max(sto,h)..
1118          STO_L(sto,h) =L= N_STO_E(sto)
1119  ;
1120   
1121  con4d_maxin_sto(sto,h)..
1122          STO_IN(sto,h)
1123   
1124          =L= N_STO_P(sto)
1125  ;
1126   
1127  con4e_maxout_sto(sto,h)..
1128          STO_OUT(sto,h)
1129   
1130          =L= N_STO_P(sto)
1131  ;
1132   
1133  con4j_ending(sto,h)$(ord(h) = card(h))..
1134           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
1135  ;
1136   
1137  con4k_PHS_EtoP(sto)..
1138          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1139  ;
1140   
1141  * ------------------------------------------------------------------------
      ---- *
1142  ***** Quotas for renewables and biomass *****
1143  * ------------------------------------------------------------------------
      ---- *
1144   
1145  con5a_minRES..
1146  sum( h , G_L('bio',h) + sum( nondis , G_RES(nondis,h))
1147   
1148  *$ontext
1149           + sum( sto , STO_OUT_PRO2PRO(sto,h)) + sum( res , G_MARKET_PRO2M(
      res,h) + G_RES_PRO(res,h))
1152  )
1153          =G= phi_min_res * phi_min_res_exog * sum( h ,
1154           sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h))
1155   
1156  *$ontext
1157           + sum( res , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
1160           )
1161  ;
1162   
1163  con5b_max_energy(dis)$(m_e(dis))..
1164           sum( h , G_L(dis,h) ) =L= m_e(dis)
1165  ;
1166   
1167   
1168  * ------------------------------------------------------------------------
      ---- *
1169  ***** Maximum installation constraints *****
1170  * ------------------------------------------------------------------------
      ---- *
1171   
1172  con8a_max_I_power(tech)..
1173           N_TECH(tech) =L= m_p(tech)
1174  ;
1175   
1176  con8b_max_I_sto_e(sto)..
1177           N_STO_E(sto) =L= m_sto_e(sto)
1178  ;
1179   
1180  con8c_max_I_sto_p(sto)..
1181           N_STO_P(sto) =L= m_sto_p(sto)
1182  ;
1183   
1184   
1185   
1186  con8f_max_pro_res(res)..
1187           N_RES_PRO(res) =L= m_res_pro(res)
1188  ;
1189   
1190  con8g_max_pro_sto_e(sto)..
1191           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1192  ;
1193   
1194  con8h_max_sto_pro_p(sto)..
1195           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1196  ;
1197   
1198   
1199   
1200  * ------------------------------------------------------------------------
      ---- *
1201  ***** Prosumage constraints *****
1202  * ------------------------------------------------------------------------
      ---- *
1203   
1204  con11a_pro_distrib(res,h)..
1205           phi_res(res,h) * N_RES_PRO(res)
1206           =E=
1207           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) )
1208  ;
1209   
1210  con11b_pro_balance(h)..
1211           phi_pro_load * d(h)
1212           =E=
1213           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      ) + G_MARKET_M2PRO(h)
1214  ;
1215   
1216  con11c_pro_selfcon..
1217           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1218           =G=
1219           phi_pro_self * sum( h , phi_pro_load * d(h))
1220  ;
1221   
1222  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1223           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1224  ;
1225   
1226   
1227  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1228          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
       + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2
      PRO(sto,h)/(1+eta_sto(sto))*2
1229  ;
1230   
1231   
1232  con11j_pro_stolev_max(sto,h)..
1233          STO_L_PRO2PRO(sto,h) =L= N_STO_E_PRO(sto)
1234  ;
1235   
1236  con11k_pro_maxin_sto(sto,h)..
1237          sum( res , STO_IN_PRO2PRO(res,sto,h) )
1238          =L= N_STO_P_PRO(sto)
1239  ;
1240   
1241  con11l_pro_maxout_sto(sto,h)..
1242          STO_OUT_PRO2PRO(sto,h)
1243          =L= N_STO_P_PRO(sto)
1244  ;
1245   
1246  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1247           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1248  ;
1249   
1250   
1251  **************************************************************************
      ******
1252  ***** MODEL *****
1253  **************************************************************************
      ******
1254   
1255  model DIETER /
1256  obj
1257   
1258  con1a_bal
1259   
1260  con2a_loadlevel
1261  con2b_loadlevelstart
1262   
1263  con3a_maxprod_dispatchable
1264   
1265  con3e_maxprod_res
1266   
1267  con4a_stolev_start
1268  con4b_stolev
1269  con4c_stolev_max
1270  con4d_maxin_sto
1271  con4e_maxout_sto
1272   
1273  con4j_ending
1274  con4k_PHS_EtoP
1275   
1276  con5a_minRES
1277  con5b_max_energy
1278   
1279  con8a_max_I_power
1280  con8b_max_I_sto_e
1281  con8c_max_I_sto_p
1282   
1283  *$ontext
1284  con8f_max_pro_res
1285  con8g_max_pro_sto_e
1286  con8h_max_sto_pro_p
1287  con11a_pro_distrib
1288  con11b_pro_balance
1289  con11c_pro_selfcon
1290  con11d_pro_stolev_PRO2PRO
1291  con11h_1_pro_stolev_start_PRO2PRO
1292  con11j_pro_stolev_max
1293  con11k_pro_maxin_sto
1294  con11l_pro_maxout_sto
1295  con11o_pro_ending
1298   
1299  /;
1300   
1301  **************************************************************************
      ******
1302  ***** Options, fixings, report preparation *****
1303  **************************************************************************
      ******
1304   
1305  * Solver options
1311   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1322   
1323  dieter.OptFile = 1;
1324  dieter.holdFixed = 1 ;
1325   
1326   
1327  **************************************************************************
      ******
1328  ***** Solve *****
1329  **************************************************************************
      ******
1330   
1331  * Preparation of GUSS tool for scenario analysis
1332  phi_min_res = eps ;
1333  phi_pro_self = eps ;
1334   
1336   
1337  Set
1338  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1339  superscen        Scenarios                               /scen1*scen1000/
1340  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1341  ;
1342   
1343  set
1344  scen(superscen);
1345  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1346   
1347  Parameters
1348  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1349  modstats(superscen, modelstats)
1350  min_res
1351  pro_selfcon
1352  ;
1353   
1354  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_res_share.val/100 ) ;
1355  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1356   
1357  Parameters
1358  * Equations
1359  marginal_con5a(superscen)
1360  marginal_con1a(superscen,*)
1361  marginal_con9a(superscen,*,*,*)
1362  marginal_con9b(superscen,*,*,*)
1363   
1364  * Basic
1365  lev_Z(superscen)
1366  lev_G_L(superscen,tech,h)
1367  lev_G_UP(superscen,tech,h)
1368  lev_G_DO(superscen,tech,h)
1369  lev_G_RES(superscen,tech,h)
1370  lev_CU(superscen,tech,h)
1371  lev_STO_IN(superscen,sto,h)
1372  lev_STO_OUT(superscen,sto,h)
1373  lev_STO_L(superscen,sto,h)
1374  lev_N_TECH(superscen,tech)
1375  lev_N_STO_E(superscen,sto)
1376  lev_N_STO_P(superscen,sto)
1377   
1378   
1379  * Prosumage
1380  lev_CU_PRO(superscen,tech,h)
1381  lev_G_MARKET_PRO2M(superscen,tech,h)
1382  lev_G_MARKET_M2PRO(superscen,h)
1383  lev_G_RES_PRO(superscen,tech,h)
1384  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1385  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1386  lev_STO_IN_M2PRO(superscen,sto,h)
1387  lev_STO_IN_M2M(superscen,sto,h)
1388  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1389  lev_STO_OUT_PRO2M(superscen,sto,h)
1390  lev_STO_OUT_M2PRO(superscen,sto,h)
1391  lev_STO_OUT_M2M(superscen,sto,h)
1392  lev_STO_L_PRO2PRO(superscen,sto,h)
1393  lev_STO_L_PRO2M(superscen,sto,h)
1394  lev_STO_L_M2PRO(superscen,sto,h)
1395  lev_STO_L_M2M(superscen,sto,h)
1396  lev_N_STO_E_PRO(superscen,sto)
1397  lev_N_STO_P_PRO(superscen,sto)
1398  lev_STO_L_PRO(superscen,sto,h)
1399  lev_N_RES_PRO(superscen,tech)
1400  ;
1401   
1402   
1403  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\fix.gms
1405   
1406  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1416  **************************************************************************
      ******
1417   
1418   
1419   
1420  **************************************************************************
      ******
1421  **** Run of river  *******************************************************
      ******
1422  **************************************************************************
      ******
1423   
1424  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1425   
1426  *$ontext
1427  N_TECH.fx('ror') = 5857.47 ;
1428  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1431   
1432  * Fix everything to zero in case no ROR option is selected:
1433  *N_TECH.fx('ror') = 0 ;
1434  *G_RES.fx('ror',h) = 0 ;
1435  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1436   
1437   
1438  **************************************************************************
      ******
1439  **** No storage and DSM in first period  *********************************
      ******
1440  **************************************************************************
      ******
1441   
1442  ** No storage inflow in first period **
1443  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1444   
1445   
1446   
1447  **************************************************************************
      ******
1448  **** No primary reserves by heating devices  *****************************
      ******
1449  **************************************************************************
      ******
1450   
1451   
1452  **************************************************************************
      ******
1453  **** Fixing to reduce model size  ****************************************
      ******
1454  **************************************************************************
      ******
1455   
1456  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1457  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1458   
1459  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1460  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1461  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1462  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1463  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1464  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1465   
1466  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1467  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1468  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1469  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1470  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1471   
1472   
1473  Variables
1474  STO_IN_PRO2M(tech,sto,h)
1475  STO_IN_M2PRO(sto,h)
1476  STO_IN_M2M(sto,h)
1477  STO_OUT_PRO2M(sto,h)
1478  STO_OUT_M2PRO(sto,h)
1479  STO_OUT_M2M(sto,h)
1480  STO_L_PRO(sto,h)
1481  STO_L_PRO2M(sto,h)
1482  STO_L_M2PRO(sto,h)
1483  STO_L_M2M(sto,h)
1484  ;
1485   
1486  *$ontext
1487  CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
1488  G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1489  *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
1490  G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1491  STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1492  STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1493  STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1494  STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1495  STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1496  STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1497  STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1498  STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1499  STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1500  STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1501  STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1502  STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1503  N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1504  N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1505  STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1506  N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
1509   
1510  * Deactivated market storage links
1511   
1512  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1513  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1514  STO_IN_M2M.fx(sto,h)       = 0 ;
1515  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1516  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1517  STO_OUT_M2M.fx(sto,h)      = 0 ;
1518  STO_L_PRO.fx(sto,h)        = 0 ;
1519  STO_L_PRO2M.fx(sto,h)      = 0 ;
1520  STO_L_M2PRO.fx(sto,h)      = 0 ;
1521  STO_L_M2M.fx(sto,h)        = 0 ;
1522   
1523  **************************************************************************
      ******
1524  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1525  **************************************************************************
      ******
1526   
1527  * Default level zero for report parameters
1528  lev_Z(scen) = 0 ;
1529  lev_G_L(scen,tech,h) = 0 ;
1530  lev_G_UP(scen,tech,h) = 0 ;
1531  lev_G_DO(scen,tech,h) = 0 ;
1532  lev_G_RES(scen,tech,h) = 0 ;
1533  lev_CU(scen,tech,h) = 0 ;
1534  lev_STO_IN(scen,sto,h) = 0 ;
1535  lev_STO_OUT(scen,sto,h) = 0 ;
1536  lev_STO_L(scen,sto,h) = 0 ;
1537  lev_N_TECH(scen,tech) = 0 ;
1538  lev_N_STO_E(scen,sto) = 0 ;
1539  lev_N_STO_P(scen,sto) = 0 ;
1540  marginal_con1a(scen,h) = 0 ;
1541  marginal_con5a(superscen) = 0 ;
1542   
1543  * Prosumage
1544  lev_CU_PRO(scen,tech,h) = 0 ;
1545  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1546  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1547  lev_G_RES_PRO(scen,tech,h) = 0  ;
1548  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1549  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1550  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1551  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1552  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1553  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1554  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1555  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1556  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1557  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1558  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1559  lev_STO_L_M2M(scen,sto,h) = 0  ;
1560  lev_N_STO_E_PRO(scen,sto) = 0  ;
1561  lev_N_STO_P_PRO(scen,sto) = 0  ;
1562  lev_STO_L_PRO(scen,sto,h) = 0  ;
1563  lev_N_RES_PRO(scen,tech) = 0  ;
1564   
1565   
1566  * Fixing of report parameters for run-of-river
1567  *$ontext
1568  lev_N_TECH(scen,'ror') = 5857.47 ;
1569  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1579   
1580   
1581   
1582   
1583   
1584   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\scenario.gms
1586   
1587  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1597  **************************************************************************
      ******
1598   
1599   
1600   
1601   
1602  *****************************************
1603  **** Scenario file                   ****
1604  ****                                 ****
1605  *****************************************
1606   
1607  Parameter
1608  m_exog_p(tech)
1609  m_exog_sto_e(sto)
1610  m_exog_sto_p(sto)
1611  *m_exog_rsvr_p(rsvr)
1612  *m_exog_ntc(l)
1613  ;
1614   
1615  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1616  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1617  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1618  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1619  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1620   
1621   
1622  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1639   
1640  *** Investment model
1641  *$ontext
1642  N_TECH.lo(tech) = 0 ;
1643  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1644  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1645  N_TECH.lo('pv') = m_exog_p('pv') ;
1646  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1647  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1648  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1649  *NTC.lo(l) = m_exog_ntc(l) ;
1650   
1651  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1652  N_TECH.up('wind_on') = inf ;
1653  N_TECH.up('wind_off') = inf ;
1654  N_TECH.up('pv') = inf ;
1655  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1656  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1657  N_STO_P.up('sto1') = inf ;
1658  N_STO_P.up('sto5') = inf ;
1659  N_STO_P.up('sto7') = inf ;
1660  N_STO_E.up('sto1') = inf ;
1661  N_STO_E.up('sto5') = inf ;
1662  N_STO_E.up('sto7') = inf ;
1663  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1664  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1665  *$offtext
1666   
1667   
1668  *** Reservoir assumption - not used here
1669  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1670  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1671  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1672  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1673   
1674   
1675  *** Germany only, no infeasibility
1676  *NTC.fx(l) = 0 ;
1677  *F.fx(l,h) = 0 ;
1678  *G_INFES.fx(h) = 0 ;
1679   
1680   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1711   
1712   
1713  * Definition of dictionary set for GUSS tool
1714   
1715  Set dict(*,*,*) /
1716  scen             .scenario       .''
1717  gussoptions      .opt            .modstats
1718   
1719  phi_min_res      .param          .min_res
1720   
1721  *$ontext
1722  phi_pro_self     .param          .pro_selfcon
1725   
1726   
1727  con5a_minRES     .marginal       .marginal_con5a
1728  con1a_bal        .marginal       .marginal_con1a
1729   
1730  Z                .level          .lev_Z
1731  G_L              .level          .lev_G_L
1732  G_UP             .level          .lev_G_UP
1733  G_DO             .level          .lev_G_DO
1734  G_RES            .level          .lev_G_RES
1735  CU               .level          .lev_CU
1736  STO_IN           .level          .lev_STO_IN
1737  STO_OUT          .level          .lev_STO_OUT
1738  STO_L            .level          .lev_STO_L
1739  N_TECH           .level          .lev_N_TECH
1740  N_STO_E          .level          .lev_N_STO_E
1741  N_STO_P          .level          .lev_N_STO_P
1742   
1743   
1744  *$ontext
1745  CU_PRO           .level          .lev_CU_PRO
1746  G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
1747  G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
1748  G_RES_PRO        .level          .lev_G_RES_PRO
1749  STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
1750  *STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
1751  *STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
1752  *STO_IN_M2M       .level          .lev_STO_IN_M2M
1753  STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
1754  *STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
1755  *STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
1756  *STO_OUT_M2M      .level          .lev_STO_OUT_M2M
1757  *STO_L_PRO        .level          .lev_STO_L_PRO
1758  STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
1759  *STO_L_PRO2M      .level          .lev_STO_L_PRO2M
1760  *STO_L_M2PRO      .level          .lev_STO_L_M2PRO
1761  *STO_L_M2M        .level          .lev_STO_L_M2M
1762  N_STO_E_PRO      .level          .lev_N_STO_E_PRO
1763  N_STO_P_PRO      .level          .lev_N_STO_P_PRO
1764  N_RES_PRO        .level          .lev_N_RES_PRO
1767  /
1768  ;
1769   
1770  solve DIETER using lp min Z scenario dict;
1771   
1772   
1773  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\report.gms
1775   
1776  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1786  **************************************************************************
      ******
1787   
1789   
1790   
1791   
1792   
1793  **************************************************************************
      ******
1794  **** Parameters for report file  *****************************************
      ******
1795  **************************************************************************
      ******
1796   
1797  Parameter
1798  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1799  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1800  corr_fac_sto             Balancing correction factor - storage technologie
      s
1801  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1802  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1803  corr_fac_ev              Balancing correction factor - electric vehicles
1804  corr_fac_rsvr            Balancing correction factor - reservoir
1805  corr_fac_sets            Balancing correction factor - SETS
1806  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1807  corr_fac_hp              Balancing correction factor - heat pumps
1808  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
1809   
1810  corr_fac_ev_sep
1811   
1812  gross_energy_demand                      Gross energy demand
1813  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
1814  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1815  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
1816  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
1817   
1818  reserves_activated
1819   
1820  calc_maxprice
1821  calc_minprice
1822   
1823  report
1824  report_tech
1825  report_tech_hours
1826  report_hours
1827  report_node
1828  report_line
1829  report_cost
1830   
1831  report_reserves
1832  report_reserves_hours
1833  report_reserves_tech
1834  report_reserves_tech_hours
1835   
1836  report_prosumage
1837  report_prosumage_tech
1838  report_prosumage_tech_hours
1839  report_market
1840  report_market_tech
1841  report_market_tech_hours
1842   
1843  report_heat_tech_hours
1844  report_heat_tech
1845  ;
1846   
1847   
1848   
1849   
1850  **************************************************************************
      ******
1851  **** Initialize reporting paremetrs  *************************************
      ******
1852  **************************************************************************
      ******
1853   
1854  * Set reporting sensitivity. All results below will be reported as zero
1855  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
1856  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
1857  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
1858   
1859   
1860  * ------------------------------------------------------------------------
      ----
1861   
1862  * Min and max for prices
1863  calc_maxprice = 0 ;
1864  calc_minprice = 1000 ;
1865   
1866   
1867  * ------------------------------------------------------------------------
      ----
1868   
1869  * Default values for correction factors
1870  corr_fac_dis(scen,dis,h) = 0 ;
1871  corr_fac_nondis(scen,nondis,h) = 0 ;
1872  corr_fac_sto(scen,sto,h) = 0 ;
1873  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
1874  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
1875  *corr_fac_ev(scen,h) = 0 ;
1876  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
1877  *corr_fac_sets(scen,bu,ch,h) = 0 ;
1878  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
1879  *corr_fac_hp(scen,bu,ch,h) = 0 ;
1880  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
1881   
1882  *corr_fac_ev_sep(scen,ev,h) = 0 ;
1883   
1884   
1885  * ------------------------------------------------------------------------
      ----
1886   
1887  * Parameter for hourly nodal reserves activated
1888  reserves_activated(scen,h) = 0 ;
1889   
1890   
1891   
1892   
1893   
1894  * ------------------------------------------------------------------------
      ----
1895   
1896  * Prepare prosumage reporting parameters
1897  *$ontext
1898  gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
1899  gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
1900  gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
1903   
1904   
1905  * ------------------------------------------------------------------------
      ----
1906   
1907  *Determine balancing correction factors
1908   
1909   
1910   
1911   
1912  * ------------------------------------------------------------------------
      ----
1913   
1914  * Define gross energy demand for reporting
1915  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
1916  *$ontext
1917           + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
1920   
1921   
1922  )
1923  ;
1924   
1925   
1926  **************************************************************************
      ******
1927  **** Report  *************************************************************
      ******
1928  **************************************************************************
      ******
1929   
1930  * RPEORT model statistics
1931          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
1932          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
1933          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
1934   
1935   
1936  * ------------------------------------------------------------------------
      ----
1937   
1938  * REPORT HOURS
1939          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
1940          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
1941  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
1942  *- corr_fac_dsm_shift(scen,dsm_shift,h))
1943  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
1944  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
1945  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
1946  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
1947  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
1948          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
1949   
1950                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
1951                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
1952  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
1953  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
1954                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
1955                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
1956  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
1957   
1958   
1959  * ------------------------------------------------------------------------
      ----
1960   
1961  * REPORT TECH HOURS
1962          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
1963  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
1964          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
1965  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
1966  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
1967  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
1968          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
1969          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
1970          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
1971          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
1972  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
1973   
1974                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
1975                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
1976  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1977                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
1978                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
1979                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
1980                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
1981  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
1982  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
1983  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1984  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1985   
1986   
1987  * ------------------------------------------------------------------------
      ----
1988   
1989  * RPEORT LINE
1990   
1991  * ------------------------------------------------------------------------
      ----
1992   
1993  * REPORT NODE
1994          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
1995   
1996  ;
1997          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
1998          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
1999  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2000           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2001          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
2002  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2003           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2004  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2005  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2006  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2007  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2008  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2009  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2010  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2011  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2012  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2013  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2014          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2015  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2016   
2017  ;
2018          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2019          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2020          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2021          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2022          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2023          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2024          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2025   
2026                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2027                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2028                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2029                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2030                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2031                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2032  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2033  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2034  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_
      abs*card(h)) = 0 ;
2035                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2036                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2037                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2038  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2039  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2040                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2041  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2042  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2043   
2044   
2045  * ------------------------------------------------------------------------
      ----
2046   
2047  * REPORT COST
2048          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2049   
2050  ));
2051           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2052  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2053   
2054  *$ontext
2055                   + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
2058  );
2059   
2060  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2061  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2062  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2063           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2064  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2065  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2066  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      )
2067   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2079   
2080  * ------------------------------------------------------------------------
      ----
2081   
2082  * REPORT TECH
2083          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2084          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2085  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2086  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2087          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2088          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2089   
2090          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2091          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2092  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2093          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2094          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2095   
2096          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2097  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2098          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2099          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2100  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2101          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2102   
2103          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2104          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2105   
2106          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2107          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2108   
2109          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2110          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2111  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2112          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2113   
2114   
2115                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2116                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2117                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2118                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2119  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2120  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2121                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2122  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2123                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2124                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2125  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2126                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2127                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2128                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2129                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2130                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2131  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2132                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2133                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2134                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2135  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2136                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2137                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2138                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2139   
2140   
2141  * ------------------------------------------------------------------------
      ----
2142   
2143  * REPORT NODE
2144          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2145  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr))
2146           ;
2147          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2148  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2149          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2150  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr))
2151           ;
2152          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2153   
2154                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2155                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2156                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2157                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2158   
2159   
2160   
2161  * ------------------------------------------------------------------------
      ----
2162   
2163  * REPORT TECH
2164          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2165          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2166  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2167          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2168   
2169          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2170          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2171  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2172          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2173          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2174          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(s
      cen,sto) ) * 1 ;
2175   
2176                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2177                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2178  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2179                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2180   
2181                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2182                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2183  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2184                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2185                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2186                   report_tech('Storage cycles',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
2187   
2188   
2189  * ------------------------------------------------------------------------
      ----
2190   
2191  * RPEORT
2192          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2193          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2194          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2195          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2196          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2197          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2198          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2199          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2200          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2201  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2202          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2203  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2204           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2205          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2206          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2207   
2208                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2209                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2210                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2211                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2212                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2213                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2214                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2215                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2216                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2217   
2218   
2219  * ------------------------------------------------------------------------
      ----
2220   
2221  * DSM
2222   
2223   
2224  * ------------------------------------------------------------------------
      ----
2225   
2226  * EV
2227   
2228   
2229   
2230  * ------------------------------------------------------------------------
      ----
2231   
2232  * Reserves
2233   
2234   
2235   
2236   
2237  * ------------------------------------------------------------------------
      ----
2238   
2239  * Reserves and DSM
2240   
2241   
2242  * ------------------------------------------------------------------------
      ----
2243   
2244  * ------------------------------------------------------------------------
      ----
2245   
2246  * PROSUMAGE
2247  *$ontext
2248          report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      phi_pro_load * d(h) ;
2249          report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 
      - phi_pro_load) * d(h) ;
2250          gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
2251   
2252          report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
2253          report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
2254          report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
2255          report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
2256          report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
2257          report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
2258          report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
2259          report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
2260          report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
2261          report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
2262          report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
2263          report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
2264          report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
2265          report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_STO_L_PRO(scen,sto,h)) ;
2266          report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
2267          report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
2268          report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
2269          report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
2270   
2271          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2272          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
2273  *        report_market_tech_hours('generation market',loop_res_share,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
2274          report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)) ;
2275          report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
2276          report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
2277          report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
2278          report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
2279          report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
2280          report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
2281          report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2282          report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
2283          report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )
        ;
2284   
2285          report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
2286          report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2287   
2288          report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
2289          report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
2290          report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2291          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2292          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
2293          report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
2294          report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
2295          report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage load
      ing prosumers M2M',loop_res_share,loop_prosumage,sto,h));
2296          report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage
       generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2297          report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
2298          report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2299          report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage ge
      neration prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
2300          report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers P
      RO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage
       out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pro
      sumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosum
      age,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res
      _share,loop_prosumage,sto);
2301          report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
2302          report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawa
      l prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
2303          report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
2304          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(s
      cen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
2305          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
2306          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) )
      ;
2307          report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * 1 ;
2308          report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2309          report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
2310          report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
2311          report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
2312          report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
2313          report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
2314          report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
2315          report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
2316          report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
2317          report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loo
      p_res_share,loop_prosumage,'');
2318          report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
2319          report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
2320          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
2321          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
2322          report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2323          report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * 1 > eps_rep_ins ) =
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen
      ,sto) ) * 1 / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P_PRO(scen,sto) ) ;
2324   
2325          report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
2326  *        report_market_tech('capacities reservoir MW market',loop_res_shar
      e,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_RSVR_P(scen,rsvr) );
2327  *        report_market_tech('capacities reservoir MWh market',loop_res_sha
      re,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RSVR_E(scen,rsvr) );
2328          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
2329          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * 1 ;
2330          report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h) )) * 1 ;
2331          report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( sum
      (h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,r
      es,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
2332          report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
2333          report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2334          report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2335          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac
      _dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_TECH(scen,res)) ;
2336          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2337          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2338          report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * 1 ;
2339          report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * 1 > eps_rep_ins ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * 1 / sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
2340   
2341          report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
2342          report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
2343          report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2344          report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( s
      cen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosum
      ers(scen)) ;
2345          report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
2346          report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * 1 ;
2347          report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2348          report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2349          report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2350          report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(sce
      n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (r
      es,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2351          report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2352          report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2353          report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
2354   
2355          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
2356          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
2357   
2358          report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
2359          report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) * 1 ;
2360          report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
2361          report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
2362          report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2363          report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
2364          report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2365          report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
2366          report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
2367  * line below changed
2368          report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
2369          report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (
      sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )
      ) * 1
2370  *$ontext
2371  *$ontext
2372  *$ontext
2373  *$ontext
2374  ;
2375          report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_fac_nondis(scen,res,h))
2376  *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr
      ,h))
2377           + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))
2378  *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fa
      c_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,
      h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2379            )) ;
2380   
2381          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2382  *        report_market_tech('Capacity share market',loop_res_share,loop_pr
      osumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share
      ,loop_prosumage)+ 1e-9 ;
2383          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2384          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2385          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* 1
       + 1e-9 ;
2386  *        report_market_tech('Energy share in gross nodal market generation
      ',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated
       gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_
      rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2387          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2388   
2389                   report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2390                   report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
2391   
2392                   report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2393                   report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
2394                   report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
2395                   report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
2396                   report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
2397                   report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
2398                   report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2399                   report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2400                   report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2401                   report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
2402                   report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2403                   report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2404                   report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
2405                   report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2406                   report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2407                   report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2408                   report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2409                   report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
2410   
2411                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2412                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2413  *                 report_market_tech_hours('generation market',loop_res_sh
      are,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',l
      oop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2414                   report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
2415                   report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
2416                   report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2417                   report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2418                   report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2419                   report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2420                   report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2421                   report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2422                   report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2423                   report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2424   
2425                   report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
2426                   report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2427                   report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2428                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2429                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2430                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
2431                   report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
2432                   report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
2433                   report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2434                   report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2435                   report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2436                   report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
2437                   report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
2438                   report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2439                   report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2440                   report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
2441                   report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
2442                   report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2443                   report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2444                   report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
2445                   report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
2446                   report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2447                   report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2448                   report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
2449                   report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2450                   report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2451                   report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2452                   report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
2453                   report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2454                   report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2455                   report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
2456                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2457                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2458                   report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
2459                   report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2460                   report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2461                   report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2462   
2463                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
2464  *                 report_market_tech('capacities reservoir MW market',loop
      _res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir 
      MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2465  *                 report_market_tech('capacities reservoir MWh market',loo
      p_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir
       MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2466                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2467                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2468                   report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
2469                   report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
2470                   report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2471                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2472                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2473                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2474                   report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2475                   report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2476                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2477                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2478                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2479                   report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2480                   report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2481   
2482                   report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2483                   report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2484                   report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
2485                   report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2486                   report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
2487                   report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
2488                   report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
2489                   report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2490                   report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2491                   report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2492                   report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2493                   report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2494                   report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
2495   
2496                   report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2497                   report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2498                   report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2499                   report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2500                   report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2501                   report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2502                   report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2503                   report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
2504                   report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2505                   report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
2506                   report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2507                   report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
2508   
2509                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
2510                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2511  *                 report_market_tech('Capacity share market',loop_res_shar
      e,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2512                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
2513                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
2514                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
2515                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy 
      share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr
      )< eps_rep_rel) = 0 ;
2518   
2519   
2520  * ------------------------------------------------------------------------
      ----
2521   
2522  * PROSUMAGE & DSM
2523   
2524   
2525   
2526  * ------------------------------------------------------------------------
      ----
2527   
2528   
2529   
2530  * ------------------------------------------------------------------------
      ----
2531   
2532  * HEAT
2533   
2534  * ------------------------------------------------------------------------
      ----
2535   
2536  * Reserves and heat
2537   
2538   
2539  * ------------------------------------------------------------------------
      ---- *
2540  * ------------------------------------------------------------------------
      ---- *
2541  * ------------------------------------------------------------------------
      ---- *
2542   
2543   
2544  execute_unload "results", report, report_tech, report_node,
2545  *report_line,
2546  report_tech_hours, report_hours, report_cost
2547  *$ontext
2548  , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
2551  ;
2552   
2553   
      $include report_to_excel.gms
      $ontext
2558   
2559   
2560   
2561  * ------------------------------------------------------------------------
      ---- *
2562  * ------------------------------------------------------------------------
      ---- *
2563  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/30/18 17:31:17 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          Modified_MCP\DIETER.gms
     2      120 INCLUDE        1     120  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\dataload.gms
     3      527 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      529 GDXIN          2     409  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\Data_input.gdx
     5      581 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      582 GDXIN          2     462  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\time_series.gdx
     7      923 INCLUDE        1     156  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\model.gms
     8     1404 INCLUDE        1     261  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\fix.gms
     9     1585 INCLUDE        1     262  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\scenario.gms
    10     1774 INCLUDE        1     326  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\report.gms


COMPILATION TIME     =       28.609 SECONDS      6 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/30/18 17:31:17 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1770


MODEL STATISTICS

BLOCKS OF EQUATIONS          30     SINGLE EQUATIONS      473,098
BLOCKS OF VARIABLES          24     SINGLE VARIABLES      420,509  5 projected
NON ZERO ELEMENTS     1,744,349     NON LINEAR N-Z         96,362
DERIVATIVE POOL              20     CONSTANT POOL              18
CODE LENGTH             131,408


GENERATION TIME      =      145.812 SECONDS    263 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =      146.203 SECONDS    263 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/30/18 17:31:17 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1770


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1770

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         59.781  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res
--- Scenario Variable with potential updates identified: phi_pro_self

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 28.21 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 59.08sec (det. 23140.52 ticks)
Optimal solution found.
Objective : 36495564680.712975

--- Scenario scen1:     Records read:    2
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  36495564680.713
---   Resource Usage   59875
---   Total Time (ms)  60031

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 10/30/18 17:31:17 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.984 SECONDS    159 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.lst
