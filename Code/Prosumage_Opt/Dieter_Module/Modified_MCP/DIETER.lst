GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/21/18 10:27:16 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  31   
  33   
  34  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  35  * if nothing is selected, ROR capacity will be set to zero
  36  * if parameter option is selected, set appropriate values in fix.gmx
  37  * if variable option is selected, set appropriate bound in data_input exce
      l
  40   
  41  * Set star to determine loops, otherwise default 100% renewables
  43   
  44  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  46   
  47  * Set star for reporting to Excel
  49   
  50   
  51  **************************************************************************
      ******
  52   
  53  * Definition of strings for report parameters and sanity checks
  54  * (Do not change settings below)
  56   
  57  * Sanity checks
  59   
  60  **************************************************************************
      ******
  61   
  62  ****************************
  63  ***** INITIALIZE LOOPS *****
  64  ****************************
  65   
  66  sets
  67  *$ontext
  68  loop_res_share   Solution loop for different shares of renewables       /5
      0/
  71   
  72  *$ontext
  73  loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
  76   
  77  *      loop_res_share                          /50/
  78  *                      loop_prosumage                          /0/
  79  ;
  80   
  81   
  82   
  83   
  84  **************************************************************************
      ******
  85   
  86  **************************
  87  ***** SOLVER OPTIONS *****
  88  **************************
  89   
  90  options
  91  optcr = 0.00
  92  reslim = 10000000
  93  lp = cplex
  94  mip = cplex
  95  nlp = conopt
  96  limrow = 0
  97  limcol = 0
  98  ;
  99   
 100  options
 101  dispwidth = 15
 102  limrow = 0
 103  limcol = 0
 104  solprint = off
 105  sysout = off
 106  ;
 107   
 108   
 109   
 110   
 111  **************************************************************************
      ******
 112   
 113  **************************
 114  ***** Dataload *****
 115  **************************
 116   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\dataload.gms
 118   
 119  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 129  **************************************************************************
      ******
 130   
 131   
 132   
 133   
 134  ***************  SETS  ***************************************************
      ******
 135   
 136  ***** Sets used in the model *****
 137  Sets
 138  tech                     Generation technologies
 139   dis(tech)               Dispatchable generation technologies
 140   nondis(tech)            Nondispatchable generation technologies
 141   con(tech)               Conventional generation technologies
 142   res(tech)               Renewable generation technologies
 143  sto                      Storage technologies
 144  rsvr                     Reservoir technologies
 145  dsm                      DSM technologies
 146   dsm_shift(dsm)          DSM load shifting technologies
 147   dsm_curt(dsm)           DSM load curtailment technologies
 148  year                     Base year for temporal data
 149  h                        Hours
 150  n                        Nodes
 151  l                        Lines
 152  ev                       EV types
 153  reserves                         Reserve qualities
 154   reserves_up(reserves)           Positive reserves
 155   reserves_do(reserves)           Negative reserves
 156   reserves_spin(reserves)         Spinning reserves
 157   reserves_nonspin(reserves)      Nonspinning reserves
 158   reserves_prim(reserves)         Primary reserves
 159   reserves_nonprim(reserves)      Nonprimary reserves
 160   reserves_prim_up(reserves)      Primary positive reserves
 161   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 162   reserves_prim_do(reserves)      Primary negative reserves
 163   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 164  bu                       Building archtypes
 165  ch                       Heating combination type
 166   hst(ch)                 Heating technology that feeds to storage
 167   hp(ch)                  Heat pump technologies
 168   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 169   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 170   
 171   
 172  ***** Sets used for data upload *****
 173  headers_tech                     Generation technologies - upload headers
 174   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 175   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 176  headers_sto                      Storage technologies - upload headers
 177  headers_reservoir                Reservoir technologies - upload headers
 178  headers_dsm                      DSM technologies - upload headers
 179   dsm_type                        DSM technologies - shifting or curtailmen
      t
 180  headers_time                     Temporal data - upload headers
 181  headers_topology                 Spatial data - upload headers
 182  headers_ev                       EV data - upload headers
 183  headers_time_ev                  EV temporal data - upload headers
 184  headers_prosumage_generation     Prosumage generation data - upload header
      s
 185  headers_prosumage_storage        Prosumage storage data - upload headers
 186  headers_reserves                 Reserve data - upload headers
 187   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 188   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 189   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 190  headers_heat                     Heat data - upload headers
 191   heat_storage                    Heat data - storage technologies
 192   heat_hp                         Heat data - heat pump technologies
 193   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 194   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 195  headers_time_heat                Heat data - upload headers time data
 196  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 197  ;
 198   
 199   
 200   
 201   
 202  ***************  PARAMETERS  *********************************************
      ******
 203   
 204  Parameters
 205   
 206  ***** Generation technologies *****
 207  *--- Variable and fixed costs ---*
 208  eta              Efficiency of conventional technologies [0 1]
 209  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 210  c_up             Load change costs UP [EUR per MWh]
 211  c_do             Load change costs DOWN [EUR per MWh]
 212  c_fix            Annual fixed costs [EUR per MW per year]
 213  c_vom            Variable O&M costs [EUR per MWh]
 214  CO2price         CO2 price in [EUR per ton]
 215   
 216  *--- Investment ---*
 217  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 218  lifetime         Investment costs: technical lifetime [a]
 219  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 220  interest_rate    Investment costs: Interest rate [%]
 221  m_p              Investment: maximum installable capacity per technology [
      MW]
 222  m_e              Investment: maximum installable energy [TWh per a]
 223   
 224  *--- Flexibility ---*
 225  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 226   
 227   
 228  ***** Fuel and CO2 costs *****
 229  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 230   
 231   
 232  ***** Renewables *****
 233  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 234  phi_min_res      Minimum renewables share [0 1]
 235   
 236   
 237  ***** Storage *****
 238  *--- Variable and fixed costs ---*
 239  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 240  eta_sto          Storage efficiency [0 1]
 241  phi_sto_ini      Initial storage level [0 1]
 242  etop_max         Maximum E to P ratio of storage types [#]
 243  c_fix_sto        Annual fixed costs [EUR per MW]
 244   
 245  *--- Investment ---*
 246  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 247  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 248  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 249  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 250   
 251   
 252  ***** Reservoir*****
 253  *--- Variable and fixed costs ---*
 254  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 255  eta_rsvr                 Generation efficiency [0 1]
 256  phi_rsvr_ini             Initial reservoir level [0 1]
 257  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 258  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 259  phi_rsvr_lev_min         Minimum filling level [0 1]
 260   
 261  *--- Investment ---*
 262  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 263  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 264  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 265  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 266  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 267  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 268   
 269   
 270  ***** DSM *****
 271  *--- Variable and fixed costs ---*
 272  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 273  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 274  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 275  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 276   
 277  *--- Flexibility, efficiency, recovery ---*
 278  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 279  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 280   
 281  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 282  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 283  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 284   
 285  *--- Investment ---*
 286  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 287  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 288  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 289  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 290  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 291  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 292  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 293  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 294   
 295   
 296  ***** Time Data *****
 297  d_y                      Demand hour h for different years [MWh]
 298  d                        Demand hour h [MWh]
 299  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 300  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 301  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 302  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 303  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 304  rsvr_in                  Reservoir inflow in hour h [0 1]
 305  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 306  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 307  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 308  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 309  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 310  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 311  reserves_exogenous       Hourly reserve provision [MW]
 312   
 313  ***** Transmission *****
 314  *--- Investment ---*
 315  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 316  c_fix_ntc                 Fixed costs [EUR per MW per a]
 317  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 318  inv_recovery_ntc          Investment costs: Recovery period in [a]
 319  inv_interest_ntc          Investment costs: Interest rate [%]
 320  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 321   
 322  *--- Topology and distance ---*
 323  inc              Incidence index of link l on node n
 324  dist             Distance covered by link l [km]
 325   
 326   
 327  ***** Electric vehicles *****
 328  *--- Costs and attributes ---*
 329  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 330  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 331  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 332  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 333  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 334   
 335  n_ev_e           Electric vehicle battery capacity [MWh]
 336  ev_quant         Overall number of electirc vehicles [#]
 337  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 338  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 339   
 340  *--- Temporal data ---*
 341  n_ev_p           Electric vehicle power rating [MWh]
 342  ev_ed            Electric vehicle electricity demand [MWh]
 343  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 344   
 345   
 346  ***** Prosumage *****
 347  phi_pro_load             Share of prosumagers among total load [0 1]
 348  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 349  m_res_pro                Maximum installable: renewables capacity [MW]
 350  m_sto_pro_e              Maximum installable: storage energy [MWh]
 351  m_sto_pro_p              Maximum installable: storage capacity [MW]
 352  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 353   
 354   
 355  ***** Reserves *****
 356  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 357  reserves_intercept       Intercept of regression line determining reserves
       demand
 358  reserves_slope           Slope of regression line determining reserves dem
      and
 359  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 360  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 361  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 362  *reserves_exog
 363   
 364   
 365  ***** Heat *****
 366  *--- Time data ---*
 367  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 368  dh_y                     Hourly heat demand per year [MWh per m2]
 369  dh                       Hourly heat demand [MWh per m2]
 370  temp_source              Heat pumps - source temperature [°Celsius]
 371  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 372  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 373  d_dhw                    Hourly DHW demand [MWh per m2]
 374  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 375   
 376  *--- Technololgy attributes ---*
 377  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 378  eta_heat_stat            Static efficiency for heating technologies [0 1]
 379  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 380  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 381  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 382  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 383  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 384  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 385  n_sets_p_out             SETS - Power rating - heat output [MW]
 386  n_sets_e                 SETS - Energy storage capacity [MWh]
 387  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 388  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 389  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 390  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 391  temp_sink                Heat pumps - sink temperature [°Celsius]
 392  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 393  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 394  theta_night              Indicator for night hours {0 1}
 395   
 396   
 397   
 398  ***************  DERIVED PARAMETERS  *************************************
      ******
 399   
 400  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 401  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 402   
 403  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 404  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 405   
 406  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 407  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 408   
 409  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 410  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 411   
 412  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 413  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 414   
 415  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 416   
 417  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 418  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 419   
 420  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 421  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 422  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 423  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 424  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 425  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 426   
 427   
 428   
 429   
 430  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 431   
 432  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 433  technology_data(tech,headers_tech)
 434  storage_data(sto,headers_sto)
 435  reservoir_data(rsvr,headers_reservoir)
 436  time_data_upload(h,year,headers_time)
 437  dsm_data_upload(dsm,dsm_type,headers_dsm)
 438  dsm_data(dsm,headers_dsm)
 439  topology_data(l,headers_topology)
 440  ev_data(ev,headers_ev)
 441  ev_time_data_upload(h,headers_time_ev,ev)
 442  prosumage_data_generation(tech,headers_prosumage_generation)
 443  prosumage_data_storage(sto,headers_prosumage_storage)
 444  reserves_time_data_activation(h,year,reserves)
 445  reserves_time_data_provision(h,year,reserves)
 446  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 447  reserves_data(reserves,headers_reserves)
 448  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 449  heat_data(bu,ch,headers_heat)
 450  dh_upload(h,year,headers_time_heat,bu)
 451  d_dhw_upload(h,year,headers_time_heat,bu)
 452  temp_source_upload
 453  ;
 454   
 455   
 456   
 457   
 458  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 459   
 522   
 523  *%skip_Excel%
 525   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 530  *$load l headers_topology topology_data
 531  *$ontext
 532  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 539  ;
 540   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 546   
 547   
 548  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 549   
 575   
 576   
 577  *
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 581  *$load headers_time_ev ev_time_data_upload
 582  *$load reserves_time_data_activation
 583  *$load reserves_time_data_provision
 584  *$load headers_time_heat dh_upload
 585  *$load theta_night
 586  *$load temp_source_upload
 587  *$load headers_time_dhw d_dhw_upload nets_profile
 588  ;
 589   
 590   
 591   
 592   
 593  ***************  ASSIGNMENTS  ********************************************
      ******
 594   
 595   
 596   
 597  ***** Aliases *****
 598  alias (h,hh) ;
 599  alias (res,resres) ;
 600  alias (reserves,reservesreserves) ;
 601  alias (nondis,nondisnondis) ;
 602   
 603   
 604   
 605  ***** Derived sets *****
 606  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 607  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 608   
 609  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 610  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 611   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 633   
 634   
 635   
 636  ***** Parameters *****
 637   
 638  *--- Generation technologies ---*
 639  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 640  eta(tech) = technology_data(tech,'eta_con') ;
 641  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 642  c_up(dis) =technology_data(dis,'load change costs up') ;
 643  c_do(dis) = technology_data(dis,'load change costs down') ;
 644  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 645  c_vom(tech) = technology_data(tech,'variable_om') ;
 646  CO2price(tech) = technology_data(tech,'CO2_price') ;
 647   
 648  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 649  lifetime(tech) = technology_data(tech,'lifetime') ;
 650  recovery(tech) = technology_data(tech,'recovery_period') ;
 651  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 652  m_p(tech) = technology_data(tech,'max_installable') ;
 653  m_e(tech) = technology_data(tech,'max_energy') ;
 654  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 655  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 656   
 657  c_cu(res) = technology_data(res,'curtailment_costs') ;
 658   
 659   
 660  *--- Storage technologies ---*
 661  c_m_sto(sto) = storage_data(sto,'mc');
 662  eta_sto(sto) = storage_data(sto,'efficiency');
 663  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 664  phi_sto_ini(sto) = storage_data(sto,'level_start');
 665  etop_max(sto) = storage_data(sto,'etop_max') ;
 666   
 667  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 668  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 669  lifetime(sto) = storage_data(sto,'lifetime');
 670  interest_rate(sto) = storage_data(sto,'interest_rate');
 671  m_sto_e(sto) = storage_data(sto,'max_energy');
 672  m_sto_p(sto) = storage_data(sto,'max_power');
 673   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 715   
 716  *--- Temporal data ---*
 717  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 718  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 719   
 720  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 721  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 722  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 723   
 724   
 725  *--- Spatial data ---*
 726  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 727  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 728  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 729  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 730  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 731  *m_ntc(l) = topology_data(l,'max_installable') ;
 732  *dist(l) = topology_data(l,'distance') ;
 733   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 750   
 751  *--- Prosumage ---*
 752  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 753  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 754  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 755  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 756   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 802   
 803   
 804  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 805   
 806  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 807   
 808  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 809                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 810   
 811  c_i_res(res) = c_i(res) ;
 812  c_fix_res(res) = c_fix(res) ;
 813   
 814  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 815                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 816   
 817  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 818                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 847   
 848   
 849  ***************  Adjust costs to model's hourly basis ********************
      ******
 850   
 851  c_i(tech) = c_i(tech)*card(h)/8760 ;
 852  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 853  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 854  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 855  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 856  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 857  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 858  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 859   
 860  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 861  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 862  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 863  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 864  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 865   
 866  m_e('bio') = m_e('bio')*card(h)/8760 ;
 867   
 868  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 869   
 870  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 871  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 872  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 873  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 874   
 875   
 876   
 877  **************************************************************************
      ******
 878   
 879   
 880   
 881   
 882   
 883   
 884   
 885   
 886   
 887  **************************************************************************
      ******
 888   
 889  ***************************
 890  ***** Initialize data *****
 891  ***************************
 892   
 893  * Parameters for default base year
 894  d(h) = d_y('2030',h) ;
 895  phi_res(res,h) = phi_res_y('2030',res,h) ;
 896  phi_min_res = 0 ;
 897  phi_pro_self = 0 ;
 898  phi_pro_load = 0 ;
 899   
 900  *$ontext
 901  phi_pro_load = 0.2 ;
 904   
 905   
 906  Parameter
 907  phi_min_res_exog;
 908  phi_min_res_exog = 1 ;
 909   
 910  Sets
 911  h_ini(h)                       First hour  /h1/
 912  h_end(h)                       Last hour   /h8760/
 913  ;
 914   
 915  **************************************************************************
      ******
 916  ***** Model *****
 917  **************************************************************************
      ******
 918   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\model.gms
 920   
 921  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 931  **************************************************************************
      ******
 932   
 933   
 934  Variables
 935  Z                Value objective function [Euro]
 936  ;
 937   
 938  Positive Variables
 939  G_L(tech,h)            Generation level in hour h [MWh]
 940  G_UP(tech,h)           Generation upshift in hour h [MWh]
 941  G_DO(tech,h)           Generation downshift in hour h [MWh]
 942   
 943  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 944  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
 945   
 946  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 947  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 948  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 949   
 950  N_TECH(tech)           Technology tech built [MW]
 951  N_STO_E(sto)           Storage technology built - Energy [MWh]
 952  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
 953   
 954  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
 955  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
 956  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
 957  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
 958  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
 959  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
 960  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
 961  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 962  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 963  STO_L_PRO(sto,h)               Prosumage: overall storage level in hour h 
      [MWh]
 964  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
 965   
 966  ;
 967   
 968   
 969   
 970   
 971  **************************************************************************
      ******
 972   
 973  Equations
 974  * Objective
 975  obj                      Objective cost minimization
 976   
 977  * Energy balance
 978  con1a_bal                Energy Balance
 979   
 980  * Load change costs
 981  con2a_loadlevel          Load change costs: Level
 982  con2b_loadlevelstart     Load change costs: Level for first period
 983   
 984  * Capacity contraints and flexibility constraints
 985  con3a_maxprod_dispatchable       Capacity Constraint conventionals
 986  con3e_maxprod_res                Capacity constraints renewables
 987   
 988  * Storage constraints
 989  con4a_stolev_start        Storage Level Dynamics Initial Condition
 990  con4b_stolev              Storage Level Dynamics
 991  con4c_stolev_max          Storage Power Capacity
 992  con4d_maxin_sto           Storage maximum inflow
 993  con4e_maxout_sto          Storage maximum outflow
 994  con4j_ending              End level equal to initial level
 995  con4k_PHS_EtoP            Maximum E to P ratio for PHS
 996   
 997  * Minimum restrictions for renewables and biomass
 998  con5a_minRES             Minimum yearly renewables requirement
 999  con5b_max_energy         Maximum yearly biomass energy
1000   
1001  * Maximum installation conditions
1002  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1003  con8b_max_I_sto_e                Maximum installable energy: Storage in MW
      h
1004  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1005   
1006  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1007  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1008  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1009   
1010  * Prosumage
1011  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1012  con11b_pro_balance                       Prosumage: energy balance
1013  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1014  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1015  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1016  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1017  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1018  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1019  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1020  ;
1021   
1022   
1023   
1024   
1025  **************************************************************************
      ******
1026   
1027  * ------------------------------------------------------------------------
      ---- *
1028  ***** Objective function *****
1029  * ------------------------------------------------------------------------
      ---- *
1030   
1031  obj..
1032           Z =E=
1033                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1034                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1035                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1036                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1037                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1038                   + sum( tech , c_i(tech)*N_TECH(tech) )
1039                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1040                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1041                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1042                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
1043  *$ontext
1044                   + sum( res , c_i(res)*N_RES_PRO(res) )
1045                   + sum( res , c_fix(res)*N_RES_PRO(res) )
1046   
1047                   + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
1048                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
1049                   + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
1050                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
1053  ;
1054   
1055  * ------------------------------------------------------------------------
      ---- *
1056  ***** Energy balance and load levels *****
1057  * ------------------------------------------------------------------------
      ---- *
1058   
1059  * Energy balance
1060  con1a_bal(hh)..
1061           ( 1 - phi_pro_load )* d(hh) + sum( sto , STO_IN(sto,hh) )
1062  *$ontext
1063           + G_MARKET_M2PRO(hh)
1066   
1067           =E=
1068           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
1069   
1070  *$ontext
1071           + sum( res , G_MARKET_PRO2M(res,hh) )
1074   
1075  ;
1076   
1077  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1078          G_L(dis,h) =E= G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)
1079  ;
1080   
1081  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1082           G_L(dis,h) =E= G_UP(dis,h)
1083  ;
1084   
1085  * ------------------------------------------------------------------------
      ---- *
1086  ***** Hourly maximum generation caps *****
1087  * ------------------------------------------------------------------------
      ---- *
1088   
1089  con3a_maxprod_dispatchable(dis,h)..
1090          G_L(dis,h)
1091   
1092          =L= N_TECH(dis)
1093  ;
1094   
1095  con3e_maxprod_res(nondis,h)..
1096          G_RES(nondis,h) + CU(nondis,h)
1097   
1098          =E= phi_res(nondis,h) * N_TECH(nondis)
1099  ;
1100   
1101  * ------------------------------------------------------------------------
      ---- *
1102  ***** Storage constraints *****
1103  * ------------------------------------------------------------------------
      ---- *
1104   
1105  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1106          STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(
      1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1107  ;
1108   
1109  con4b_stolev(sto,h)$(ord(h)>1)..
1110           STO_L(sto,h) =E=  STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))
      /2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1111  ;
1112   
1113  con4c_stolev_max(sto,h)..
1114          STO_L(sto,h) =L= N_STO_E(sto)
1115  ;
1116   
1117  con4d_maxin_sto(sto,h)..
1118          STO_IN(sto,h)
1119   
1120          =L= N_STO_P(sto)
1121  ;
1122   
1123  con4e_maxout_sto(sto,h)..
1124          STO_OUT(sto,h)
1125   
1126          =L= N_STO_P(sto)
1127  ;
1128   
1129  con4j_ending(sto,h)$(ord(h) = card(h))..
1130           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
1131  ;
1132   
1133  con4k_PHS_EtoP(sto)..
1134          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1135  ;
1136   
1137  * ------------------------------------------------------------------------
      ---- *
1138  ***** Quotas for renewables and biomass *****
1139  * ------------------------------------------------------------------------
      ---- *
1140   
1141  con5a_minRES..
1142  sum( h , G_L('bio',h) + sum( nondis , G_RES(nondis,h))
1143   
1144  *$ontext
1145           + sum( sto , STO_OUT_PRO2PRO(sto,h)) + sum( res , G_MARKET_PRO2M(
      res,h) + G_RES_PRO(res,h))
1148  )
1149          =G= phi_min_res * phi_min_res_exog * sum( h ,
1150           sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h))
1151   
1152  *$ontext
1153           + sum( res , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
1156           )
1157  ;
1158   
1159  con5b_max_energy(dis)$(m_e(dis))..
1160           sum( h , G_L(dis,h) ) =L= m_e(dis)
1161  ;
1162   
1163   
1164  * ------------------------------------------------------------------------
      ---- *
1165  ***** Maximum installation constraints *****
1166  * ------------------------------------------------------------------------
      ---- *
1167   
1168  con8a_max_I_power(tech)..
1169           N_TECH(tech) =L= m_p(tech)
1170  ;
1171   
1172  con8b_max_I_sto_e(sto)..
1173           N_STO_E(sto) =L= m_sto_e(sto)
1174  ;
1175   
1176  con8c_max_I_sto_p(sto)..
1177           N_STO_P(sto) =L= m_sto_p(sto)
1178  ;
1179   
1180   
1181   
1182  con8f_max_pro_res(res)..
1183           N_RES_PRO(res) =L= m_res_pro(res)
1184  ;
1185   
1186  con8g_max_pro_sto_e(sto)..
1187           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1188  ;
1189   
1190  con8h_max_sto_pro_p(sto)..
1191           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1192  ;
1193   
1194  * ------------------------------------------------------------------------
      ---- *
1195  ***** Prosumage constraints *****
1196  * ------------------------------------------------------------------------
      ---- *
1197   
1198  con11a_pro_distrib(res,h)..
1199           phi_res(res,h) * N_RES_PRO(res)
1200           =E=
1201           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) )
1202  ;
1203   
1204  con11b_pro_balance(h)..
1205           phi_pro_load * d(h)
1206           =E=
1207           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      ) + G_MARKET_M2PRO(h)
1208  ;
1209   
1210  con11c_pro_selfcon..
1211           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1212           =G=
1213           phi_pro_self * sum( h , phi_pro_load * d(h))
1214  ;
1215   
1216  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1217           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1218  ;
1219   
1220   
1221  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1222          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
       + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2
      PRO(sto,h)/(1+eta_sto(sto))*2
1223  ;
1224   
1225   
1226  con11j_pro_stolev_max(sto,h)..
1227          STO_L_PRO2PRO(sto,h) =L= N_STO_E_PRO(sto)
1228  ;
1229   
1230  con11k_pro_maxin_sto(sto,h)..
1231          sum( res , STO_IN_PRO2PRO(res,sto,h) )
1232          =L= N_STO_P_PRO(sto)
1233  ;
1234   
1235  con11l_pro_maxout_sto(sto,h)..
1236          STO_OUT_PRO2PRO(sto,h)
1237          =L= N_STO_P_PRO(sto)
1238  ;
1239   
1240  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1241           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1242  ;
1243   
1244   
1245  **************************************************************************
      ******
1246  ***** MODEL *****
1247  **************************************************************************
      ******
1248   
1249  model DIETER /
1250  obj
1251   
1252  con1a_bal
1253   
1254  con2a_loadlevel
1255  con2b_loadlevelstart
1256   
1257  con3a_maxprod_dispatchable
1258   
1259  con3e_maxprod_res
1260   
1261  con4a_stolev_start
1262  con4b_stolev
1263  con4c_stolev_max
1264  con4d_maxin_sto
1265  con4e_maxout_sto
1266   
1267  con4j_ending
1268  con4k_PHS_EtoP
1269   
1270  con5a_minRES
1271  con5b_max_energy
1272   
1273  con8a_max_I_power
1274  con8b_max_I_sto_e
1275  con8c_max_I_sto_p
1276   
1277  *$ontext
1278  con8f_max_pro_res
1279  con8g_max_pro_sto_e
1280  con8h_max_sto_pro_p
1281  con11a_pro_distrib
1282  con11b_pro_balance
1283  con11c_pro_selfcon
1284  con11d_pro_stolev_PRO2PRO
1285  con11h_1_pro_stolev_start_PRO2PRO
1286  con11j_pro_stolev_max
1287  con11k_pro_maxin_sto
1288  con11l_pro_maxout_sto
1289  con11o_pro_ending
1292   
1293  /;
1294   
1295  **************************************************************************
      ******
1296  ***** Options, fixings, report preparation *****
1297  **************************************************************************
      ******
1298   
1299  * Solver options
1305   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1316   
1317  dieter.OptFile = 1;
1318  dieter.holdFixed = 1 ;
1319   
1320   
1321  **************************************************************************
      ******
1322  ***** Solve *****
1323  **************************************************************************
      ******
1324   
1325  * Preparation of GUSS tool for scenario analysis
1326  phi_min_res = eps ;
1327  phi_pro_self = eps ;
1328   
1330   
1331  Set
1332  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1333  superscen        Scenarios                               /scen1*scen1000/
1334  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1335  ;
1336   
1337  set
1338  scen(superscen);
1339  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1340   
1341  Parameters
1342  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1343  modstats(superscen, modelstats)
1344  min_res
1345  pro_selfcon
1346  ;
1347   
1348  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_res_share.val/100 ) ;
1349  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1350   
1351  Parameters
1352  * Equations
1353  marginal_con5a(superscen)
1354  marginal_con1a(superscen,*)
1355  marginal_con9a(superscen,*,*,*)
1356  marginal_con9b(superscen,*,*,*)
1357   
1358  * Basic
1359  lev_Z(superscen)
1360  lev_G_L(superscen,tech,h)
1361  lev_G_UP(superscen,tech,h)
1362  lev_G_DO(superscen,tech,h)
1363  lev_G_RES(superscen,tech,h)
1364  lev_CU(superscen,tech,h)
1365  lev_STO_IN(superscen,sto,h)
1366  lev_STO_OUT(superscen,sto,h)
1367  lev_STO_L(superscen,sto,h)
1368  lev_N_TECH(superscen,tech)
1369  lev_N_STO_E(superscen,sto)
1370  lev_N_STO_P(superscen,sto)
1371   
1372   
1373  * Prosumage
1374  lev_CU_PRO(superscen,tech,h)
1375  lev_G_MARKET_PRO2M(superscen,tech,h)
1376  lev_G_MARKET_M2PRO(superscen,h)
1377  lev_G_RES_PRO(superscen,tech,h)
1378  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1379  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1380  lev_STO_IN_M2PRO(superscen,sto,h)
1381  lev_STO_IN_M2M(superscen,sto,h)
1382  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1383  lev_STO_OUT_PRO2M(superscen,sto,h)
1384  lev_STO_OUT_M2PRO(superscen,sto,h)
1385  lev_STO_OUT_M2M(superscen,sto,h)
1386  lev_STO_L_PRO2PRO(superscen,sto,h)
1387  lev_STO_L_PRO2M(superscen,sto,h)
1388  lev_STO_L_M2PRO(superscen,sto,h)
1389  lev_STO_L_M2M(superscen,sto,h)
1390  lev_N_STO_E_PRO(superscen,sto)
1391  lev_N_STO_P_PRO(superscen,sto)
1392  lev_STO_L_PRO(superscen,sto,h)
1393  lev_N_RES_PRO(superscen,tech)
1394  ;
1395   
1396   
1397  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\fix.gms
1399   
1400  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1410  **************************************************************************
      ******
1411   
1412   
1413   
1414  **************************************************************************
      ******
1415  **** Run of river  *******************************************************
      ******
1416  **************************************************************************
      ******
1417   
1418  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1419   
1420  *$ontext
1421  N_TECH.fx('ror') = 5857.47 ;
1422  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1425   
1426  * Fix everything to zero in case no ROR option is selected:
1427  *N_TECH.fx('ror') = 0 ;
1428  *G_RES.fx('ror',h) = 0 ;
1429  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1430   
1431   
1432  **************************************************************************
      ******
1433  **** No storage and DSM in first period  *********************************
      ******
1434  **************************************************************************
      ******
1435   
1436  ** No storage inflow in first period **
1437  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1438   
1439   
1440   
1441  **************************************************************************
      ******
1442  **** No primary reserves by heating devices  *****************************
      ******
1443  **************************************************************************
      ******
1444   
1445   
1446  **************************************************************************
      ******
1447  **** Fixing to reduce model size  ****************************************
      ******
1448  **************************************************************************
      ******
1449   
1450  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1451  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1452   
1453  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1454  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1455  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1456  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1457  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1458  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1459   
1460  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1461  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1462  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1463  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1464  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1465   
1466   
1467  Variables
1468  STO_IN_PRO2M(tech,sto,h)
1469  STO_IN_M2PRO(sto,h)
1470  STO_IN_M2M(sto,h)
1471  STO_OUT_PRO2M(sto,h)
1472  STO_OUT_M2PRO(sto,h)
1473  STO_OUT_M2M(sto,h)
1474  STO_L_PRO(sto,h)
1475  STO_L_PRO2M(sto,h)
1476  STO_L_M2PRO(sto,h)
1477  STO_L_M2M(sto,h)
1478  ;
1479   
1480  *$ontext
1481  CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
1482  G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1483  *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
1484  G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1485  STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1486  STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1487  STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1488  STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1489  STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1490  STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1491  STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1492  STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1493  STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1494  STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1495  STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1496  STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1497  N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1498  N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1499  STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1500  N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
1503   
1504  * Deactivated market storage links
1505   
1506  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1507  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1508  STO_IN_M2M.fx(sto,h)       = 0 ;
1509  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1510  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1511  STO_OUT_M2M.fx(sto,h)      = 0 ;
1512  STO_L_PRO.fx(sto,h)        = 0 ;
1513  STO_L_PRO2M.fx(sto,h)      = 0 ;
1514  STO_L_M2PRO.fx(sto,h)      = 0 ;
1515  STO_L_M2M.fx(sto,h)        = 0 ;
1516   
1517  **************************************************************************
      ******
1518  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1519  **************************************************************************
      ******
1520   
1521  * Default level zero for report parameters
1522  lev_Z(scen) = 0 ;
1523  lev_G_L(scen,tech,h) = 0 ;
1524  lev_G_UP(scen,tech,h) = 0 ;
1525  lev_G_DO(scen,tech,h) = 0 ;
1526  lev_G_RES(scen,tech,h) = 0 ;
1527  lev_CU(scen,tech,h) = 0 ;
1528  lev_STO_IN(scen,sto,h) = 0 ;
1529  lev_STO_OUT(scen,sto,h) = 0 ;
1530  lev_STO_L(scen,sto,h) = 0 ;
1531  lev_N_TECH(scen,tech) = 0 ;
1532  lev_N_STO_E(scen,sto) = 0 ;
1533  lev_N_STO_P(scen,sto) = 0 ;
1534  marginal_con1a(scen,h) = 0 ;
1535  marginal_con5a(superscen) = 0 ;
1536   
1537  * Prosumage
1538  lev_CU_PRO(scen,tech,h) = 0 ;
1539  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1540  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1541  lev_G_RES_PRO(scen,tech,h) = 0  ;
1542  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1543  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1544  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1545  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1546  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1547  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1548  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1549  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1550  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1551  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1552  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1553  lev_STO_L_M2M(scen,sto,h) = 0  ;
1554  lev_N_STO_E_PRO(scen,sto) = 0  ;
1555  lev_N_STO_P_PRO(scen,sto) = 0  ;
1556  lev_STO_L_PRO(scen,sto,h) = 0  ;
1557  lev_N_RES_PRO(scen,tech) = 0  ;
1558   
1559   
1560  * Fixing of report parameters for run-of-river
1561  *$ontext
1562  lev_N_TECH(scen,'ror') = 5857.47 ;
1563  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1573   
1574   
1575   
1576   
1577   
1578   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\scenario.gms
1580   
1581  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1591  **************************************************************************
      ******
1592   
1593   
1594   
1595   
1596  *****************************************
1597  **** Scenario file                   ****
1598  ****                                 ****
1599  *****************************************
1600   
1601  Parameter
1602  m_exog_p(tech)
1603  m_exog_sto_e(sto)
1604  m_exog_sto_p(sto)
1605  *m_exog_rsvr_p(rsvr)
1606  *m_exog_ntc(l)
1607  ;
1608   
1609  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1610  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1611  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1612  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1613  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1614   
1615   
1616  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1633   
1634  *** Investment model
1635  *$ontext
1636  N_TECH.lo(tech) = 0 ;
1637  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1638  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1639  N_TECH.lo('pv') = m_exog_p('pv') ;
1640  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1641  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1642  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1643  *NTC.lo(l) = m_exog_ntc(l) ;
1644   
1645  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1646  N_TECH.up('wind_on') = inf ;
1647  N_TECH.up('wind_off') = inf ;
1648  N_TECH.up('pv') = inf ;
1649  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1650  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1651  N_STO_P.up('sto1') = inf ;
1652  N_STO_P.up('sto5') = inf ;
1653  N_STO_P.up('sto7') = inf ;
1654  N_STO_E.up('sto1') = inf ;
1655  N_STO_E.up('sto5') = inf ;
1656  N_STO_E.up('sto7') = inf ;
1657  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1658  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1659  *$offtext
1660   
1661   
1662  *** Reservoir assumption - not used here
1663  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1664  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1665  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1666  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1667   
1668   
1669  *** Germany only, no infeasibility
1670  *NTC.fx(l) = 0 ;
1671  *F.fx(l,h) = 0 ;
1672  *G_INFES.fx(h) = 0 ;
1673   
1674   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1705   
1706   
1707  * Definition of dictionary set for GUSS tool
1708   
1709  Set dict(*,*,*) /
1710  scen             .scenario       .''
1711  gussoptions      .opt            .modstats
1712   
1713  phi_min_res      .param          .min_res
1714   
1715  *$ontext
1716  phi_pro_self     .param          .pro_selfcon
1719   
1720   
1721  con5a_minRES     .marginal       .marginal_con5a
1722  con1a_bal        .marginal       .marginal_con1a
1723   
1724  Z                .level          .lev_Z
1725  G_L              .level          .lev_G_L
1726  G_UP             .level          .lev_G_UP
1727  G_DO             .level          .lev_G_DO
1728  G_RES            .level          .lev_G_RES
1729  CU               .level          .lev_CU
1730  STO_IN           .level          .lev_STO_IN
1731  STO_OUT          .level          .lev_STO_OUT
1732  STO_L            .level          .lev_STO_L
1733  N_TECH           .level          .lev_N_TECH
1734  N_STO_E          .level          .lev_N_STO_E
1735  N_STO_P          .level          .lev_N_STO_P
1736   
1737   
1738  *$ontext
1739  CU_PRO           .level          .lev_CU_PRO
1740  G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
1741  G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
1742  G_RES_PRO        .level          .lev_G_RES_PRO
1743  STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
1744  *STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
1745  *STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
1746  *STO_IN_M2M       .level          .lev_STO_IN_M2M
1747  STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
1748  *STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
1749  *STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
1750  *STO_OUT_M2M      .level          .lev_STO_OUT_M2M
1751  *STO_L_PRO        .level          .lev_STO_L_PRO
1752  STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
1753  *STO_L_PRO2M      .level          .lev_STO_L_PRO2M
1754  *STO_L_M2PRO      .level          .lev_STO_L_M2PRO
1755  *STO_L_M2M        .level          .lev_STO_L_M2M
1756  N_STO_E_PRO      .level          .lev_N_STO_E_PRO
1757  N_STO_P_PRO      .level          .lev_N_STO_P_PRO
1758  N_RES_PRO        .level          .lev_N_RES_PRO
1761  /
1762  ;
1763   
1764  solve DIETER using lp min Z scenario dict;
1765   
1766   
1767  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\report.gms
1769   
1770  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1780  **************************************************************************
      ******
1781   
1783   
1784   
1785   
1786   
1787  **************************************************************************
      ******
1788  **** Parameters for report file  *****************************************
      ******
1789  **************************************************************************
      ******
1790   
1791  Parameter
1792  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1793  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1794  corr_fac_sto             Balancing correction factor - storage technologie
      s
1795  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1796  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1797  corr_fac_ev              Balancing correction factor - electric vehicles
1798  corr_fac_rsvr            Balancing correction factor - reservoir
1799  corr_fac_sets            Balancing correction factor - SETS
1800  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1801  corr_fac_hp              Balancing correction factor - heat pumps
1802  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
1803   
1804  corr_fac_ev_sep
1805   
1806  gross_energy_demand                      Gross energy demand
1807  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
1808  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1809  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
1810  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
1811   
1812  reserves_activated
1813   
1814  calc_maxprice
1815  calc_minprice
1816   
1817  report
1818  report_tech
1819  report_tech_hours
1820  report_hours
1821  report_node
1822  report_line
1823  report_cost
1824   
1825  report_reserves
1826  report_reserves_hours
1827  report_reserves_tech
1828  report_reserves_tech_hours
1829   
1830  report_prosumage
1831  report_prosumage_tech
1832  report_prosumage_tech_hours
1833  report_market
1834  report_market_tech
1835  report_market_tech_hours
1836   
1837  report_heat_tech_hours
1838  report_heat_tech
1839  ;
1840   
1841   
1842   
1843   
1844  **************************************************************************
      ******
1845  **** Initialize reporting paremetrs  *************************************
      ******
1846  **************************************************************************
      ******
1847   
1848  * Set reporting sensitivity. All results below will be reported as zero
1849  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
1850  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
1851  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
1852   
1853   
1854  * ------------------------------------------------------------------------
      ----
1855   
1856  * Min and max for prices
1857  calc_maxprice = 0 ;
1858  calc_minprice = 1000 ;
1859   
1860   
1861  * ------------------------------------------------------------------------
      ----
1862   
1863  * Default values for correction factors
1864  corr_fac_dis(scen,dis,h) = 0 ;
1865  corr_fac_nondis(scen,nondis,h) = 0 ;
1866  corr_fac_sto(scen,sto,h) = 0 ;
1867  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
1868  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
1869  *corr_fac_ev(scen,h) = 0 ;
1870  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
1871  *corr_fac_sets(scen,bu,ch,h) = 0 ;
1872  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
1873  *corr_fac_hp(scen,bu,ch,h) = 0 ;
1874  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
1875   
1876  *corr_fac_ev_sep(scen,ev,h) = 0 ;
1877   
1878   
1879  * ------------------------------------------------------------------------
      ----
1880   
1881  * Parameter for hourly nodal reserves activated
1882  reserves_activated(scen,h) = 0 ;
1883   
1884   
1885   
1886   
1887   
1888  * ------------------------------------------------------------------------
      ----
1889   
1890  * Prepare prosumage reporting parameters
1891  *$ontext
1892  gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
1893  gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
1894  gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
1897   
1898   
1899  * ------------------------------------------------------------------------
      ----
1900   
1901  *Determine balancing correction factors
1902   
1903   
1904   
1905   
1906  * ------------------------------------------------------------------------
      ----
1907   
1908  * Define gross energy demand for reporting
1909  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
1910  *$ontext
1911           + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
1914   
1915   
1916  )
1917  ;
1918   
1919   
1920  **************************************************************************
      ******
1921  **** Report  *************************************************************
      ******
1922  **************************************************************************
      ******
1923   
1924  * RPEORT model statistics
1925          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
1926          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
1927          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
1928   
1929   
1930  * ------------------------------------------------------------------------
      ----
1931   
1932  * REPORT HOURS
1933          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
1934          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
1935  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
1936  *- corr_fac_dsm_shift(scen,dsm_shift,h))
1937  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
1938  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
1939  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
1940  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
1941  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
1942          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
1943   
1944                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
1945                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
1946  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
1947  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
1948                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
1949                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
1950  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
1951   
1952   
1953  * ------------------------------------------------------------------------
      ----
1954   
1955  * REPORT TECH HOURS
1956          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
1957  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
1958          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
1959  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
1960  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
1961  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
1962          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
1963          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
1964          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
1965          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
1966  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
1967   
1968                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
1969                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
1970  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1971                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
1972                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
1973                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
1974                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
1975  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
1976  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
1977  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1978  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
1979   
1980   
1981  * ------------------------------------------------------------------------
      ----
1982   
1983  * RPEORT LINE
1984   
1985  * ------------------------------------------------------------------------
      ----
1986   
1987  * REPORT NODE
1988          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
1989   
1990  ;
1991          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
1992          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
1993  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
1994           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
1995          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
1996  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
1997           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
1998  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
1999  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2000  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2001  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2002  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2003  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2004  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2005  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2006  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2007  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2008          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2009  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2010   
2011  ;
2012          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2013          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2014          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2015          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2016          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2017          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2018          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2019   
2020                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2021                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2022                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2023                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2024                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2025                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2026  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2027  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2028  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_
      abs*card(h)) = 0 ;
2029                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2030                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2031                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2032  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2033  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2034                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2035  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2036  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2037   
2038   
2039  * ------------------------------------------------------------------------
      ----
2040   
2041  * REPORT COST
2042          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2043   
2044  ));
2045           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2046  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2047   
2048  *$ontext
2049                   + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
2052  );
2053   
2054  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2055  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2056  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2057           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2058  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2059  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2060  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      )
2061   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2073   
2074  * ------------------------------------------------------------------------
      ----
2075   
2076  * REPORT TECH
2077          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2078          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2079  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2080  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2081          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2082          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2083   
2084          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2085          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2086  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2087          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2088          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2089   
2090          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2091  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2092          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2093          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2094  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2095          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2096   
2097          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2098          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2099   
2100          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2101          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2102   
2103          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2104          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2105  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2106          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2107   
2108   
2109                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2110                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2111                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2112                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2113  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2114  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2115                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2116  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2117                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2118                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2119  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2120                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2121                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2122                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2123                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2124                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2125  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2126                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2127                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2128                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2129  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2130                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2131                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2132                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2133   
2134   
2135  * ------------------------------------------------------------------------
      ----
2136   
2137  * REPORT NODE
2138          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2139  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr))
2140           ;
2141          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2142  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2143          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2144  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr))
2145           ;
2146          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2147   
2148                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2149                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2150                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2151                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2152   
2153   
2154   
2155  * ------------------------------------------------------------------------
      ----
2156   
2157  * REPORT TECH
2158          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2159          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2160  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2161          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2162   
2163          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2164          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2165  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2166          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2167          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2168          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(s
      cen,sto) ) * 1 ;
2169   
2170                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2171                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2172  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2173                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2174   
2175                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2176                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2177  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2178                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2179                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2180                   report_tech('Storage cycles',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
2181   
2182   
2183  * ------------------------------------------------------------------------
      ----
2184   
2185  * RPEORT
2186          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2187          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2188          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2189          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2190          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2191          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2192          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2193          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2194          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2195  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2196          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2197  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2198           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2199          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2200          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2201   
2202                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2203                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2204                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2205                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2206                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2207                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2208                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2209                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2210                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2211   
2212   
2213  * ------------------------------------------------------------------------
      ----
2214   
2215  * DSM
2216   
2217   
2218  * ------------------------------------------------------------------------
      ----
2219   
2220  * EV
2221   
2222   
2223   
2224  * ------------------------------------------------------------------------
      ----
2225   
2226  * Reserves
2227   
2228   
2229   
2230   
2231  * ------------------------------------------------------------------------
      ----
2232   
2233  * Reserves and DSM
2234   
2235   
2236  * ------------------------------------------------------------------------
      ----
2237   
2238  * ------------------------------------------------------------------------
      ----
2239   
2240  * PROSUMAGE
2241  *$ontext
2242          report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      phi_pro_load * d(h) ;
2243          report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 
      - phi_pro_load) * d(h) ;
2244          gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
2245   
2246          report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
2247          report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
2248          report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
2249          report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
2250          report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
2251          report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
2252          report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
2253          report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
2254          report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
2255          report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
2256          report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
2257          report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
2258          report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
2259          report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_STO_L_PRO(scen,sto,h)) ;
2260          report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
2261          report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
2262          report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
2263          report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
2264   
2265          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2266          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
2267  *        report_market_tech_hours('generation market',loop_res_share,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
2268          report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)) ;
2269          report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
2270          report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
2271          report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
2272          report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
2273          report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
2274          report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
2275          report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2276          report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
2277          report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )
        ;
2278   
2279          report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
2280          report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2281   
2282          report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
2283          report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
2284          report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2285          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2286          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
2287          report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
2288          report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
2289          report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage load
      ing prosumers M2M',loop_res_share,loop_prosumage,sto,h));
2290          report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage
       generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2291          report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
2292          report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2293          report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage ge
      neration prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
2294          report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers P
      RO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage
       out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pro
      sumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosum
      age,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res
      _share,loop_prosumage,sto);
2295          report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
2296          report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawa
      l prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
2297          report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
2298          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(s
      cen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
2299          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
2300          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) )
      ;
2301          report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * 1 ;
2302          report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2303          report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
2304          report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
2305          report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
2306          report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
2307          report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
2308          report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
2309          report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
2310          report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
2311          report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loo
      p_res_share,loop_prosumage,'');
2312          report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
2313          report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
2314          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
2315          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
2316          report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2317          report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * 1 > eps_rep_ins ) =
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen
      ,sto) ) * 1 / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P_PRO(scen,sto) ) ;
2318   
2319          report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
2320  *        report_market_tech('capacities reservoir MW market',loop_res_shar
      e,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_RSVR_P(scen,rsvr) );
2321  *        report_market_tech('capacities reservoir MWh market',loop_res_sha
      re,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RSVR_E(scen,rsvr) );
2322          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
2323          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * 1 ;
2324          report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h) )) * 1 ;
2325          report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( sum
      (h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,r
      es,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
2326          report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
2327          report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2328          report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2329          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac
      _dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_TECH(scen,res)) ;
2330          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2331          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2332          report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * 1 ;
2333          report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * 1 > eps_rep_ins ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * 1 / sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
2334   
2335          report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
2336          report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
2337          report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2338          report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( s
      cen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosum
      ers(scen)) ;
2339          report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
2340          report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * 1 ;
2341          report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2342          report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2343          report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2344          report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(sce
      n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (r
      es,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2345          report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2346          report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2347          report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
2348   
2349          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
2350          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
2351   
2352          report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
2353          report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) * 1 ;
2354          report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
2355          report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
2356          report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2357          report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
2358          report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2359          report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
2360          report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
2361  * line below changed
2362          report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
2363          report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (
      sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )
      ) * 1
2364  *$ontext
2365  *$ontext
2366  *$ontext
2367  *$ontext
2368  ;
2369          report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_fac_nondis(scen,res,h))
2370  *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr
      ,h))
2371           + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))
2372  *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fa
      c_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,
      h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2373            )) ;
2374   
2375          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2376  *        report_market_tech('Capacity share market',loop_res_share,loop_pr
      osumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share
      ,loop_prosumage)+ 1e-9 ;
2377          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2378          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2379          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* 1
       + 1e-9 ;
2380  *        report_market_tech('Energy share in gross nodal market generation
      ',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated
       gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_
      rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2381          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2382   
2383                   report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2384                   report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
2385   
2386                   report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2387                   report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
2388                   report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
2389                   report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
2390                   report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
2391                   report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
2392                   report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2393                   report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2394                   report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2395                   report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
2396                   report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2397                   report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2398                   report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
2399                   report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2400                   report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2401                   report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2402                   report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2403                   report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
2404   
2405                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2406                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2407  *                 report_market_tech_hours('generation market',loop_res_sh
      are,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',l
      oop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2408                   report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
2409                   report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
2410                   report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2411                   report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2412                   report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2413                   report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2414                   report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2415                   report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2416                   report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2417                   report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2418   
2419                   report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
2420                   report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2421                   report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2422                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2423                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2424                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
2425                   report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
2426                   report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
2427                   report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2428                   report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2429                   report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2430                   report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
2431                   report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
2432                   report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2433                   report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2434                   report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
2435                   report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
2436                   report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2437                   report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2438                   report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
2439                   report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
2440                   report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2441                   report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2442                   report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
2443                   report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2444                   report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2445                   report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2446                   report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
2447                   report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2448                   report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2449                   report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
2450                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2451                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2452                   report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
2453                   report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2454                   report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2455                   report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2456   
2457                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
2458  *                 report_market_tech('capacities reservoir MW market',loop
      _res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir 
      MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2459  *                 report_market_tech('capacities reservoir MWh market',loo
      p_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir
       MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2460                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2461                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2462                   report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
2463                   report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
2464                   report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2465                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2466                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2467                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2468                   report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2469                   report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2470                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2471                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2472                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2473                   report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2474                   report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2475   
2476                   report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2477                   report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2478                   report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
2479                   report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2480                   report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
2481                   report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
2482                   report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
2483                   report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2484                   report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2485                   report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2486                   report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2487                   report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2488                   report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
2489   
2490                   report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2491                   report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2492                   report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2493                   report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2494                   report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2495                   report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2496                   report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2497                   report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
2498                   report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2499                   report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
2500                   report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2501                   report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
2502   
2503                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
2504                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2505  *                 report_market_tech('Capacity share market',loop_res_shar
      e,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2506                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
2507                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
2508                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
2509                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy 
      share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr
      )< eps_rep_rel) = 0 ;
2512   
2513   
2514  * ------------------------------------------------------------------------
      ----
2515   
2516  * PROSUMAGE & DSM
2517   
2518   
2519   
2520  * ------------------------------------------------------------------------
      ----
2521   
2522   
2523   
2524  * ------------------------------------------------------------------------
      ----
2525   
2526  * HEAT
2527   
2528  * ------------------------------------------------------------------------
      ----
2529   
2530  * Reserves and heat
2531   
2532   
2533  * ------------------------------------------------------------------------
      ---- *
2534  * ------------------------------------------------------------------------
      ---- *
2535  * ------------------------------------------------------------------------
      ---- *
2536   
2537   
2538  execute_unload "results", report, report_tech, report_node,
2539  *report_line,
2540  report_tech_hours, report_hours, report_cost
2541  *$ontext
2542  , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
2545  ;
2546   
2547   
      $include report_to_excel.gms
      $ontext
2552   
2553   
2554   
2555  * ------------------------------------------------------------------------
      ---- *
2556  * ------------------------------------------------------------------------
      ---- *
2557  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/21/18 10:27:16 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          Modified_MCP\DIETER.gms
     2      117 INCLUDE        1     117  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\dataload.gms
     3      524 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      526 GDXIN          2     409  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\Data_input.gdx
     5      578 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      579 GDXIN          2     462  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\time_series.gdx
     7      919 INCLUDE        1     152  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\model.gms
     8     1398 INCLUDE        1     257  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\fix.gms
     9     1579 INCLUDE        1     258  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\scenario.gms
    10     1768 INCLUDE        1     322  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\report.gms


COMPILATION TIME     =       27.485 SECONDS      6 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/21/18 10:27:16 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1764


MODEL STATISTICS

BLOCKS OF EQUATIONS          30     SINGLE EQUATIONS      473,098
BLOCKS OF VARIABLES          24     SINGLE VARIABLES      420,509  5 projected
NON ZERO ELEMENTS     1,744,349     NON LINEAR N-Z         96,362
DERIVATIVE POOL              20     CONSTANT POOL              18
CODE LENGTH             131,408


GENERATION TIME      =      133.797 SECONDS    263 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =      134.172 SECONDS    263 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/21/18 10:27:16 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1764


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1764

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         60.078  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res
--- Scenario Variable with potential updates identified: phi_pro_self

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 28.21 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 59.38sec (det. 23140.52 ticks)
Optimal solution found.
Objective : 36495564680.712975

--- Scenario scen1:     Records read:    2
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  36495564680.713
---   Resource Usage   60156
---   Total Time (ms)  60344

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/21/18 10:27:16 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.938 SECONDS    159 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.lst
