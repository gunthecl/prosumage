GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 12:04:04 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  32   
  35   
  37   
  39   
  42  * Set star to indicate renewables constraint on electric vehicles - DEFAUL
      T is same quota as for the rest of the electricity system
  46   
  47  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  48  * if nothing is selected, ROR capacity will be set to zero
  49  * if parameter option is selected, set appropriate values in fix.gmx
  50  * if variable option is selected, set appropriate bound in data_input exce
      l
  53   
  54  * Set star to determine loops, otherwise default 100% renewables
  56   
  57  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  59   
  60  * Set star for reporting to Excel
  62   
  63   
  64  **************************************************************************
      ******
  65   
  66  * Definition of strings for report parameters and sanity checks
  67  * (Do not change settings below)
  69   
  71   
  72  * Sanity checks
  74   
  76   
  78   
  82   
  86   
  87   
  88   
  89   
  90  **************************************************************************
      ******
  91   
  92  ****************************
  93  ***** INITIALIZE LOOPS *****
  94  ****************************
  95   
  96  sets
  97  *$ontext
  98  loop_res_share   Solution loop for different shares of renewables       /5
      0/
 101   
      loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
      $ontext
 106   
 107  *      loop_res_share                          /50/
 108                               loop_ev                                 /0/
 109                        loop_prosumage                          /0/
 110  ;
 111   
 112   
 113   
 114   
 115  **************************************************************************
      ******
 116   
 117  **************************
 118  ***** SOLVER OPTIONS *****
 119  **************************
 120   
 121  options
 122  optcr = 0.00
 123  reslim = 10000000
 124  lp = cplex
 125  mip = cplex
 126  nlp = conopt
 127  limrow = 0
 128  limcol = 0
 129  ;
 130   
 131  options
 132  dispwidth = 15
 133  limrow = 0
 134  limcol = 0
 135  solprint = off
 136  sysout = off
 137  ;
 138   
 139   
 140   
 141   
 142  **************************************************************************
      ******
 143   
 144  **************************
 145  ***** Dataload *****
 146  **************************
 147   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\dataload.gms
 149   
 150  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 160  **************************************************************************
      ******
 161   
 162   
 163   
 164   
 165  ***************  SETS  ***************************************************
      ******
 166   
 167  ***** Sets used in the model *****
 168  Sets
 169  tech                     Generation technologies
 170   dis(tech)               Dispatchable generation technologies
 171   nondis(tech)            Nondispatchable generation technologies
 172   con(tech)               Conventional generation technologies
 173   res(tech)               Renewable generation technologies
 174  sto                      Storage technologies
 175  rsvr                     Reservoir technologies
 176  dsm                      DSM technologies
 177   dsm_shift(dsm)          DSM load shifting technologies
 178   dsm_curt(dsm)           DSM load curtailment technologies
 179  year                     Base year for temporal data
 180  h                        Hours
 181  n                        Nodes
 182  l                        Lines
 183  ev                       EV types
 184  reserves                         Reserve qualities
 185   reserves_up(reserves)           Positive reserves
 186   reserves_do(reserves)           Negative reserves
 187   reserves_spin(reserves)         Spinning reserves
 188   reserves_nonspin(reserves)      Nonspinning reserves
 189   reserves_prim(reserves)         Primary reserves
 190   reserves_nonprim(reserves)      Nonprimary reserves
 191   reserves_prim_up(reserves)      Primary positive reserves
 192   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 193   reserves_prim_do(reserves)      Primary negative reserves
 194   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 195  bu                       Building archtypes
 196  ch                       Heating combination type
 197   hst(ch)                 Heating technology that feeds to storage
 198   hp(ch)                  Heat pump technologies
 199   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 200   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 201   
 202   
 203  ***** Sets used for data upload *****
 204  headers_tech                     Generation technologies - upload headers
 205   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 206   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 207  headers_sto                      Storage technologies - upload headers
 208  headers_reservoir                Reservoir technologies - upload headers
 209  headers_dsm                      DSM technologies - upload headers
 210   dsm_type                        DSM technologies - shifting or curtailmen
      t
 211  headers_time                     Temporal data - upload headers
 212  headers_topology                 Spatial data - upload headers
 213  headers_ev                       EV data - upload headers
 214  headers_time_ev                  EV temporal data - upload headers
 215  headers_prosumage_generation     Prosumage generation data - upload header
      s
 216  headers_prosumage_storage        Prosumage storage data - upload headers
 217  headers_reserves                 Reserve data - upload headers
 218   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 219   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 220   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 221  headers_heat                     Heat data - upload headers
 222   heat_storage                    Heat data - storage technologies
 223   heat_hp                         Heat data - heat pump technologies
 224   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 225   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 226  headers_time_heat                Heat data - upload headers time data
 227  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 228  ;
 229   
 230   
 231   
 232   
 233  ***************  PARAMETERS  *********************************************
      ******
 234   
 235  Parameters
 236   
 237  ***** Generation technologies *****
 238  *--- Variable and fixed costs ---*
 239  eta              Efficiency of conventional technologies [0 1]
 240  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 241  c_up             Load change costs UP [EUR per MWh]
 242  c_do             Load change costs DOWN [EUR per MWh]
 243  c_fix            Annual fixed costs [EUR per MW per year]
 244  c_vom            Variable O&M costs [EUR per MWh]
 245  CO2price         CO2 price in [EUR per ton]
 246   
 247  *--- Investment ---*
 248  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 249  lifetime         Investment costs: technical lifetime [a]
 250  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 251  interest_rate    Investment costs: Interest rate [%]
 252  m_p              Investment: maximum installable capacity per technology [
      MW]
 253  m_e              Investment: maximum installable energy [TWh per a]
 254   
 255  *--- Flexibility ---*
 256  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 257   
 258   
 259  ***** Fuel and CO2 costs *****
 260  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 261   
 262   
 263  ***** Renewables *****
 264  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 265  phi_min_res      Minimum renewables share [0 1]
 266   
 267   
 268  ***** Storage *****
 269  *--- Variable and fixed costs ---*
 270  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 271  eta_sto          Storage efficiency [0 1]
 272  phi_sto_ini      Initial storage level [0 1]
 273  etop_max         Maximum E to P ratio of storage types [#]
 274  c_fix_sto        Annual fixed costs [EUR per MW]
 275   
 276  *--- Investment ---*
 277  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 278  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 279  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 280  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 281   
 282   
 283  ***** Reservoir*****
 284  *--- Variable and fixed costs ---*
 285  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 286  eta_rsvr                 Generation efficiency [0 1]
 287  phi_rsvr_ini             Initial reservoir level [0 1]
 288  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 289  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 290  phi_rsvr_lev_min         Minimum filling level [0 1]
 291   
 292  *--- Investment ---*
 293  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 294  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 295  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 296  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 297  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 298  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 299   
 300   
 301  ***** DSM *****
 302  *--- Variable and fixed costs ---*
 303  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 304  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 305  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 306  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 307   
 308  *--- Flexibility, efficiency, recovery ---*
 309  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 310  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 311   
 312  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 313  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 314  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 315   
 316  *--- Investment ---*
 317  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 318  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 319  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 320  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 321  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 322  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 323  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 324  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 325   
 326   
 327  ***** Time Data *****
 328  d_y                      Demand hour h for different years [MWh]
 329  d                        Demand hour h [MWh]
 330  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 331  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 332  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 333  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 334  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 335  rsvr_in                  Reservoir inflow in hour h [0 1]
 336  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 337  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 338  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 339  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 340  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 341  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 342  reserves_exogenous       Hourly reserve provision [MW]
 343   
 344  ***** Transmission *****
 345  *--- Investment ---*
 346  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 347  c_fix_ntc                 Fixed costs [EUR per MW per a]
 348  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 349  inv_recovery_ntc          Investment costs: Recovery period in [a]
 350  inv_interest_ntc          Investment costs: Interest rate [%]
 351  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 352   
 353  *--- Topology and distance ---*
 354  inc              Incidence index of link l on node n
 355  dist             Distance covered by link l [km]
 356   
 357   
 358  ***** Electric vehicles *****
 359  *--- Costs and attributes ---*
 360  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 361  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 362  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 363  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 364  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 365   
 366  n_ev_e           Electric vehicle battery capacity [MWh]
 367  ev_quant         Overall number of electirc vehicles [#]
 368  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 369  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 370   
 371  *--- Temporal data ---*
 372  n_ev_p           Electric vehicle power rating [MWh]
 373  ev_ed            Electric vehicle electricity demand [MWh]
 374  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 375   
 376   
 377  ***** Prosumage *****
 378  phi_pro_load             Share of prosumagers among total load [0 1]
 379  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 380  m_res_pro                Maximum installable: renewables capacity [MW]
 381  m_sto_pro_e              Maximum installable: storage energy [MWh]
 382  m_sto_pro_p              Maximum installable: storage capacity [MW]
 383  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 384   
 385   
 386  ***** Reserves *****
 387  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 388  reserves_intercept       Intercept of regression line determining reserves
       demand
 389  reserves_slope           Slope of regression line determining reserves dem
      and
 390  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 391  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 392  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 393  *reserves_exog
 394   
 395   
 396  ***** Heat *****
 397  *--- Time data ---*
 398  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 399  dh_y                     Hourly heat demand per year [MWh per m2]
 400  dh                       Hourly heat demand [MWh per m2]
 401  temp_source              Heat pumps - source temperature [°Celsius]
 402  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 403  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 404  d_dhw                    Hourly DHW demand [MWh per m2]
 405  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 406   
 407  *--- Technololgy attributes ---*
 408  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 409  eta_heat_stat            Static efficiency for heating technologies [0 1]
 410  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 411  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 412  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 413  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 414  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 415  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 416  n_sets_p_out             SETS - Power rating - heat output [MW]
 417  n_sets_e                 SETS - Energy storage capacity [MWh]
 418  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 419  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 420  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 421  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 422  temp_sink                Heat pumps - sink temperature [°Celsius]
 423  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 424  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 425  theta_night              Indicator for night hours {0 1}
 426   
 427   
 428   
 429  ***************  DERIVED PARAMETERS  *************************************
      ******
 430   
 431  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 432  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 433   
 434  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 435  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 436   
 437  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 438  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 439   
 440  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 441  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 442   
 443  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 444  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 445   
 446  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 447   
 448  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 449  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 450   
 451  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 452  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 453  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 454  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 455  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 456  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 457   
 458   
 459   
 460   
 461  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 462   
 463  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 464  technology_data(tech,headers_tech)
 465  storage_data(sto,headers_sto)
 466  reservoir_data(rsvr,headers_reservoir)
 467  time_data_upload(h,year,headers_time)
 468  dsm_data_upload(dsm,dsm_type,headers_dsm)
 469  dsm_data(dsm,headers_dsm)
 470  topology_data(l,headers_topology)
 471  ev_data(ev,headers_ev)
 472  ev_time_data_upload(h,headers_time_ev,ev)
 473  prosumage_data_generation(tech,headers_prosumage_generation)
 474  prosumage_data_storage(sto,headers_prosumage_storage)
 475  reserves_time_data_activation(h,year,reserves)
 476  reserves_time_data_provision(h,year,reserves)
 477  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 478  reserves_data(reserves,headers_reserves)
 479  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 480  heat_data(bu,ch,headers_heat)
 481  dh_upload(h,year,headers_time_heat,bu)
 482  d_dhw_upload(h,year,headers_time_heat,bu)
 483  temp_source_upload
 484  ;
 485   
 486   
 487   
 488   
 489  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 490   
 553   
 554  *%skip_Excel%
 556   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
        Module\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 561  *$load l headers_topology topology_data
 562  *$ontext
 563  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 570  ;
 571   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 577   
 578   
 579  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 580   
 606   
 607   
 608  *
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
        Module\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 612  *$load headers_time_ev ev_time_data_upload
 613  *$load reserves_time_data_activation
 614  *$load reserves_time_data_provision
 615  *$load headers_time_heat dh_upload
 616  *$load theta_night
 617  *$load temp_source_upload
 618  *$load headers_time_dhw d_dhw_upload nets_profile
 619  ;
 620   
 621   
 622   
 623   
 624  ***************  ASSIGNMENTS  ********************************************
      ******
 625   
 626   
 627   
 628  ***** Aliases *****
 629  alias (h,hh) ;
 630  alias (res,resres) ;
 631  alias (reserves,reservesreserves) ;
 632  alias (nondis,nondisnondis) ;
 633   
 634   
 635   
 636  ***** Derived sets *****
 637  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 638  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 639   
 640  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 641  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 642   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 664   
 665   
 666   
 667  ***** Parameters *****
 668   
 669  *--- Generation technologies ---*
 670  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 671  eta(tech) = technology_data(tech,'eta_con') ;
 672  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 673  c_up(dis) =technology_data(dis,'load change costs up') ;
 674  c_do(dis) = technology_data(dis,'load change costs down') ;
 675  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 676  c_vom(tech) = technology_data(tech,'variable_om') ;
 677  CO2price(tech) = technology_data(tech,'CO2_price') ;
 678   
 679  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 680  lifetime(tech) = technology_data(tech,'lifetime') ;
 681  recovery(tech) = technology_data(tech,'recovery_period') ;
 682  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 683  m_p(tech) = technology_data(tech,'max_installable') ;
 684  m_e(tech) = technology_data(tech,'max_energy') ;
 685  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 686  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 687   
 688  c_cu(res) = technology_data(res,'curtailment_costs') ;
 689   
 690   
 691  *--- Storage technologies ---*
 692  c_m_sto(sto) = storage_data(sto,'mc');
 693  eta_sto(sto) = storage_data(sto,'efficiency');
 694  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 695  phi_sto_ini(sto) = storage_data(sto,'level_start');
 696  etop_max(sto) = storage_data(sto,'etop_max') ;
 697   
 698  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 699  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 700  lifetime(sto) = storage_data(sto,'lifetime');
 701  interest_rate(sto) = storage_data(sto,'interest_rate');
 702  m_sto_e(sto) = storage_data(sto,'max_energy');
 703  m_sto_p(sto) = storage_data(sto,'max_power');
 704   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 746   
 747  *--- Temporal data ---*
 748  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 749  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 750   
 751  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 752  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 753  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 754   
 755   
 756  *--- Spatial data ---*
 757  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 758  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 759  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 760  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 761  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 762  *m_ntc(l) = topology_data(l,'max_installable') ;
 763  *dist(l) = topology_data(l,'distance') ;
 764   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 781   
 782  *--- Prosumage ---*
 783  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 784  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 785  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 786  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 787   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 833   
 834   
 835  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 836   
 837  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 838   
 839  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 840                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 841   
 842  c_i_res(res) = c_i(res) ;
 843  c_fix_res(res) = c_fix(res) ;
 844   
 845  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 846                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 847   
 848  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 849                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 878   
 879   
 880  ***************  Adjust costs to model's hourly basis ********************
      ******
 881   
 882  c_i(tech) = c_i(tech)*card(h)/8760 ;
 883  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 884  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 885  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 886  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 887  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 888  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 889  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 890   
 891  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 892  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 893  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 894  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 895  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 896   
 897  m_e('bio') = m_e('bio')*card(h)/8760 ;
 898   
 899  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 900   
 901  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 902  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 903  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 904  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 905   
 906   
 907   
 908  ***************  Check for parameter sanity ******************************
      ******
 909   
 910  *Parameter
 911  *check_heat
 912  *check_heat_agg ;
 913  *check_heat(bu) = sum( ch , phi_heat_type(bu,ch)) ;
 914  *check_heat_agg = smax( (bu) , check_heat(bu) ) ;
 915  *abort$(check_heat_agg > 1) "DATA: heating technologies for a building typ
      e do not add up to 100 percent" ;
 916   
 917   
 918   
 919   
 920   
 921   
 922   
 923   
 924   
 925   
 926   
 927   
 928   
 929  **************************************************************************
      ******
 930   
 931  *************************************
 932  ***** Features for single nodes *****
 933  *************************************
 934   
 935   
 936  *Set
 937  *features /dsm, ev, reserves, prosumage, rsvr_outflow, heat/
 938  *;
 939   
 940   
 941  *Table
 942  *feat_node(features,n)
 943  *                 DE
 944   
 945  *%prosumage%$ontext
 946  *prosumage        1
 947  *$ontext
 948  *$offtext
 949  *rsvr_outflow     0
 950   
 951  *;
 952   
 953   
 954   
 955  *%prosumage%$ontext
 956  *m_res_pro(res)$(feat_node('prosumage',n) = 0) = 0 ;
 957  *m_sto_pro_e(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 958  *m_sto_pro_p(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 959  *$ontext
 960  *$offtext
 961   
 962  *phi_rsvr_min(n) = 0
 963  *feat_node('rsvr_outflow',n)
 964  *;
 965   
 966   
 967   
 968   
 969  Set
 970  map_n_tech(tech)
 971  map_n_sto(sto)
 972  *map_n_rsvr(n,rsvr)
 973  *map_n_dsm(n,dsm)
 974  *map_n_ev(n,ev)
 975  *map_l(l)
 976  map_n_sto_pro(sto)
 977  map_n_res_pro(tech)
 978  ;
 979   
 980  map_n_tech(tech) = yes$m_p(tech) ;
 981  map_n_sto(sto) = yes$m_sto_p(sto) ;
 982  *map_n_rsvr(n,rsvr) = yes$m_rsvr_p(n,rsvr) ;
 983  *map_n_dsm(n,dsm_curt) = yes$m_dsm_cu(n,dsm_curt) ;
 984  *map_n_dsm(n,dsm_shift) = yes$m_dsm_shift(n,dsm_shift) ;
 985  *map_n_ev(n,ev) = yes$ev_data(n,ev,'share_ev') ;
 986  *map_l(l) = yes$m_ntc(l) ;
 987  map_n_sto_pro(sto) = yes$(yes$m_sto_pro_p(sto)) ;
 988  map_n_res_pro(res) = yes$(yes$m_res_pro(res)) ;
 989  ;
 990   
 991   
 992   
 993   
 994  **************************************************************************
      ******
 995   
 996  ***************************
 997  ***** Initialize data *****
 998  ***************************
 999   
1000  * Parameters for default base year
1001  d(h) = d_y('2030',h) ;
1002  phi_res(res,h) = phi_res_y('2030',res,h) ;
1003  *rsvr_in(n,rsvr,h) = rsvr_in_y(n,%base_year%,rsvr,h) ;
1004  *phi_reserves_call(n,reserves,h) = phi_reserves_call_y(n,%base_year%,reser
      ves,h) ;
1005  *phi_mean_reserves_call(n,reserves) = phi_mean_reserves_call_y(n,%base_yea
      r%,reserves) ;
1006  *reserves_exogenous(n,reserves,h) = reserves_exogenous_y(n,%base_year%,res
      erves,h) ;
1007  *dh(n,bu,ch,h) = dh_y(n,%base_year%,bu,ch,h) ;
1008  *d_dhw(n,bu,ch,h) = d_dhw_y(n,%base_year%,bu,ch,h) ;
1009   
1010  *dh(n,bu,ch,h) = area_floor(n,bu,ch) * dh(n,bu,ch,h) ;
1011  *d_dhw(n,bu,ch,h) = area_floor(n,bu,ch) * d_dhw(n,bu,ch,h) ;
1012   
1013   
1014  * No interconnections between non-adjacent or nonuploaded nodes
1015  *m_ntc(l)$( smax(n,inc(l,n)) = 0 OR smin(n,inc(l,n)) = 0 ) = 0 ;
1016   
1017   
1018  * Set loop parameters to default zero
1019  phi_min_res = 0 ;
1020  ev_quant = 0 ;
1021  phi_pro_self = 0 ;
1022  phi_pro_load = 0 ;
1023   
      phi_pro_load = 0.2 ;
      $ontext
1028   
1029   
1030  Parameter
1031  phi_min_res_exog
1032  *min_flh(n,rsvr)
1033  ;
1034   
1035  phi_min_res_exog = 1 ;
1036  *min_flh(n,rsvr) = 0 ;
1037   
1038   
1039   
1040  **************************************************************************
      ******
1041  ***** Model *****
1042  **************************************************************************
      ******
1043   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\model.gms
1045   
1046  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1056  **************************************************************************
      ******
1057   
1058   
1059  Variables
1060  Z                Value objective function [Euro]
1061  F(l,h)           Energy flow over link l in hour h [MWh]
1062  ;
1063   
1064  Positive Variables
1065  G_L(tech,h)            Generation level in hour h [MWh]
1066  G_UP(tech,h)           Generation upshift in hour h [MWh]
1067  G_DO(tech,h)           Generation downshift in hour h [MWh]
1068   
1069  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
1070  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
1071   
1072  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
1073  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
1074  STO_L(sto,h)           Storage level technology sto hour h [MWh]
1075   
1076  N_TECH(tech)           Technology tech built [MW]
1077  N_STO_E(sto)           Storage technology built - Energy [MWh]
1078  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
1079   
1080  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
1081  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
1082  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
1083  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
1084  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
1085  STO_IN_PRO2M(tech,sto,h)       Prosumage: storage loading from generation 
      for discharging to market in hour h [MWh]
1086  STO_IN_M2PRO(sto,h)            Prosumage: storage loading from market for 
      discharging to consumption in hour h [MWh]
1087  STO_IN_M2M(sto,h)              Prosumage: storage loading from market for 
      discharging to market in hour h [MWh]
1088  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
1089  STO_OUT_PRO2M(sto,h)           Prosumage: storage discharging to market fr
      om generation in hour h [MWh]
1090  STO_OUT_M2PRO(sto,h)           Prosumage: storage discharging to consumpti
      on from market in hour h [MWh]
1091  STO_OUT_M2M(sto,h)             Prosumage: storage discharging to market fr
      om market in hour h [MWh]
1092  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
1093  STO_L_PRO2M(sto,h)             Prosumage: storage level generation to mark
      et in hour h [MWh]
1094  STO_L_M2PRO(sto,h)             Prosumage: storage level market to consumot
      ion in hour h [MWh]
1095  STO_L_M2M(sto,h)               Prosumage: storage level market to market i
      n hour h [MWh]
1096  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
1097  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
1098  STO_L_PRO(sto,h)               Prosumage: overall storage level in hour h 
      [MWh]
1099  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
1100   
1101  ;
1102   
1103   
1104   
1105   
1106  **************************************************************************
      ******
1107   
1108  Equations
1109  * Objective
1110  obj                      Objective cost minimization
1111   
1112  * Energy balance
1113  con1a_bal                Energy Balance
1114   
1115  * Load change costs
1116  con2a_loadlevel          Load change costs: Level
1117  con2b_loadlevelstart     Load change costs: Level for first period
1118   
1119  * Capacity contraints and flexibility constraints
1120  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1121  con3e_maxprod_res                Capacity constraints renewables
1122   
1123  * Storage constraints
1124  con4a_stolev_start        Storage Level Dynamics Initial Condition
1125  con4b_stolev              Storage Level Dynamics
1126  con4c_stolev_max          Storage Power Capacity
1127  con4d_maxin_sto           Storage maximum inflow
1128  con4e_maxout_sto          Storage maximum outflow
1129  con4j_ending              End level equal to initial level
1130  con4k_PHS_EtoP            Maximum E to P ratio for PHS
1131   
1132  * Minimum restrictions for renewables and biomass
1133  con5a_minRES             Minimum yearly renewables requirement
1134  con5b_max_energy         Maximum yearly biomass energy
1135   
1136  * Maximum installation conditions
1137  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1138  con8b_max_I_sto_e                Maximum installable energy: Storage in MW
      h
1139  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1140   
1141  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1142  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1143  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1144   
1145  * Prosumage
1146  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1147  con11b_pro_balance                       Prosumage: energy balance
1148  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1149  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1150  con11e_pro_stolev_PRO2M                  Prosumage: storage level prosumag
      ers-to-market
1151  con11f_pro_stolev_M2PRO                  Prosumage: storage level market-t
      o-prosumagers
1152  con11g_pro_stolev_M2M                    Prosumage: storage level market-t
      o-market
1153  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1154  con11h_2_pro_stolev_start_PRO2M          Prosumage: storage level initial 
      conditions
1155  con11h_3_pro_stolev_start_M2PRO          Prosumage: storage level initial 
      conditions
1156  con11h_4_pro_stolev_start_M2M            Prosumage: storage level initial 
      conditions
1157  con11i_pro_stolev                        Prosumage: storage level total
1158  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1159  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1160  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1161  con11m_pro_maxout_lev                    Prosumage: maximum storage outflo
      w linked to level
1162  con11n_pro_maxin_lev                     Prosumage: maximum storage inflow
       linked to level
1163  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1164  ;
1165   
1166   
1167   
1168   
1169  **************************************************************************
      ******
1170   
1171  * ------------------------------------------------------------------------
      ---- *
1172  ***** Objective function *****
1173  * ------------------------------------------------------------------------
      ---- *
1174   
1175  obj..
1176           Z =E=
1177                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1178                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1179                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1180                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1181                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1182                   + sum( tech , c_i(tech)*N_TECH(tech) )
1183                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1184                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1185                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1186                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
       
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2M(sto,h) + sum( 
      res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h)) + STO_OUT_PRO2M
      (sto,h) + STO_OUT_M2M(sto,h) ) )
      $ontext
1197  ;
1198   
1199  * ------------------------------------------------------------------------
      ---- *
1200  ***** Energy balance and load levels *****
1201  * ------------------------------------------------------------------------
      ---- *
1202   
1203  * Energy balance
1204  con1a_bal(hh)..
1205           ( 1 - phi_pro_load )* d(hh) + sum( sto , STO_IN(sto,hh) )
               + G_MARKET_M2PRO(hh)
               + sum( sto , STO_IN_M2PRO(sto,hh))
               + sum( sto , STO_IN_M2M(sto,hh))
      $ontext
1212   
1213           =E=
1214           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
1215   
               + sum( res , G_MARKET_PRO2M(res,hh) )
               + sum( sto , STO_OUT_PRO2M(sto,hh))
               + sum( sto , STO_OUT_M2M(sto,hh))
      $ontext
1222   
1223  ;
1224   
1225  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1226          G_L(dis,h) =E= G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)
1227  ;
1228   
1229  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1230           G_L(dis,h) =E= G_UP(dis,h)
1231  ;
1232   
1233  * ------------------------------------------------------------------------
      ---- *
1234  ***** Hourly maximum generation caps and constraints related to reserves  
       *****
1235  * ------------------------------------------------------------------------
      ---- *
1236   
1237  con3a_maxprod_dispatchable(dis,h)..
1238          G_L(dis,h)
1239   
1240          =L= N_TECH(dis)
1241  ;
1242   
1243  con3e_maxprod_res(nondis,h)..
1244          G_RES(nondis,h) + CU(nondis,h)
1245   
1246          =E= phi_res(nondis,h) * N_TECH(nondis)
1247  ;
1248   
1249  * ------------------------------------------------------------------------
      ---- *
1250  ***** Storage constraints *****
1251  * ------------------------------------------------------------------------
      ---- *
1252   
1253  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1254          STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(
      1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1255  ;
1256   
1257  con4b_stolev(sto,h)$((ord(h)>1))..
1258           STO_L(sto,h) =E= STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/
      2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1259   
1260  ;
1261   
1262  con4c_stolev_max(sto,h)..
1263          STO_L(sto,h) =L= N_STO_E(sto)
1264  ;
1265   
1266  con4d_maxin_sto(sto,h)..
1267          STO_IN(sto,h)
1268   
1269          =L= N_STO_P(sto)
1270  ;
1271   
1272  con4e_maxout_sto(sto,h)..
1273          STO_OUT(sto,h)
1274   
1275          =L= N_STO_P(sto)
1276  ;
1277   
1278  con4j_ending(sto,h)$(ord(h) = card(h))..
1279           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
1280  ;
1281   
1282  con4k_PHS_EtoP(sto)..
1283          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1284  ;
1285   
1286  * ------------------------------------------------------------------------
      ---- *
1287  ***** Quotas for renewables and biomass *****
1288  * ------------------------------------------------------------------------
      ---- *
1289   
1290  con5a_minRES..
1291  sum( h , G_L('bio',h) + sum( nondis , G_RES(nondis,h))
1292   
               + sum( sto , STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h)) + sum
      ( res , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1297  )
1298          =G= phi_min_res * phi_min_res_exog * sum( h ,
1299           sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h))
1300   
               + sum( res , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1305           )
1306  ;
1307   
1308  con5b_max_energy(dis)$(m_e(dis))..
1309           sum( h , G_L(dis,h) ) =L= m_e(dis)
1310  ;
1311   
1312   
1313  * ------------------------------------------------------------------------
      ---- *
1314  ***** Maximum installation constraints *****
1315  * ------------------------------------------------------------------------
      ---- *
1316   
1317  con8a_max_I_power(tech)..
1318           N_TECH(tech) =L= m_p(tech)
1319  ;
1320   
1321  con8b_max_I_sto_e(sto)..
1322           N_STO_E(sto) =L= m_sto_e(sto)
1323  ;
1324   
1325  con8c_max_I_sto_p(sto)..
1326           N_STO_P(sto) =L= m_sto_p(sto)
1327  ;
1328   
1329   
1330   
1331  con8f_max_pro_res(res)..
1332           N_RES_PRO(res) =L= m_res_pro(res)
1333  ;
1334   
1335  con8g_max_pro_sto_e(sto)..
1336           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1337  ;
1338   
1339  con8h_max_sto_pro_p(sto)..
1340           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1341  ;
1342   
1343   
1344   
1345  * ------------------------------------------------------------------------
      ---- *
1346  ***** Prosumage constraints *****
1347  * ------------------------------------------------------------------------
      ---- *
1348   
1349  con11a_pro_distrib(res,h)..
1350           phi_res(res,h) * N_RES_PRO(res)
1351           =E=
1352           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
1353  ;
1354   
1355  con11b_pro_balance(h)..
1356           phi_pro_load * d(h)
1357           =E=
1358           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1359  ;
1360   
1361  con11c_pro_selfcon..
1362           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1363           =G=
1364           phi_pro_self * sum( h , phi_pro_load * d(h))
1365  ;
1366   
1367  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1368           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1369  ;
1370   
1371  con11e_pro_stolev_PRO2M(sto,h)$(ord(h) > 1)..
1372           STO_L_PRO2M(sto,h) =E= STO_L_PRO2M(sto,h-1) + sum( res , STO_IN_P
      RO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2M(sto,h)/(1+eta_sto(sto)
      )*2
1373  ;
1374   
1375  con11f_pro_stolev_M2PRO(sto,h)$(ord(h) > 1)..
1376           STO_L_M2PRO(sto,h) =E= STO_L_M2PRO(sto,h-1) + STO_IN_M2PRO(sto,h)
      *(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta_sto(sto))*2
1377  ;
1378   
1379  con11g_pro_stolev_M2M(sto,h)$(ord(h) > 1)..
1380           STO_L_M2M(sto,h) =E= STO_L_M2M(sto,h-1) + STO_IN_M2M(sto,h)*(1+et
      a_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(sto))*2
1381  ;
1382   
1383  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1384          STO_L_PRO2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO
      (sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT
      _PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1385  ;
1386   
1387  con11h_2_pro_stolev_start_PRO2M(sto,h)$(ord(h) = 1)..
1388          STO_L_PRO2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + sum( res , STO_IN_PRO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO
      2M(sto,h)/(1+eta_sto(sto))*2
1389  ;
1390   
1391  con11h_3_pro_stolev_start_M2PRO(sto,h)$( ord(h) = 1)..
1392          STO_L_M2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + STO_IN_M2PRO(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta
      _sto(sto))*2
1393  ;
1394   
1395  con11h_4_pro_stolev_start_M2M(sto,h)$(ord(h) = 1)..
1396          STO_L_M2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(sto
      ) + STO_IN_M2M(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(s
      to))*2
1397  ;
1398   
1399  con11i_pro_stolev(sto,h)$(ord(h)>1)..
1400           STO_L_PRO(sto,h) =E=   STO_L_PRO2PRO(sto,h) +  STO_L_PRO2M(sto,h)
       + STO_L_M2PRO(sto,h) + STO_L_M2M(sto,h)
1401  ;
1402   
1403  con11j_pro_stolev_max(sto,h)..
1404          STO_L_PRO(sto,h) =L= N_STO_E_PRO(sto)
1405  ;
1406   
1407  con11k_pro_maxin_sto(sto,h)..
1408          sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) ) +
       STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h)
1409          =L= N_STO_P_PRO(sto)
1410  ;
1411   
1412  con11l_pro_maxout_sto(sto,h)..
1413          STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2PRO(sto,
      h) + STO_OUT_M2M(sto,h)
1414          =L= N_STO_P_PRO(sto)
1415  ;
1416   
1417  con11m_pro_maxout_lev(sto,h)..
1418          ( STO_OUT_PRO2PRO(sto,h) + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(st
      o,h) + STO_OUT_M2M(sto,h) ) / (1+eta_sto(sto))*2
1419          =L= STO_L_PRO(sto,h-1)
1420  ;
1421   
1422  con11n_pro_maxin_lev(sto,h)..
1423          ( sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
       + STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h) ) * (1+eta_sto(sto))/2
1424          =L= N_STO_E_PRO(sto) - STO_L_PRO(sto,h-1)
1425  ;
1426   
1427  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1428           STO_L_PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1429  ;
1430   
1431   
1432  **************************************************************************
      ******
1433  ***** MODEL *****
1434  **************************************************************************
      ******
1435   
1436  model DIETER /
1437  obj
1438   
1439  con1a_bal
1440   
1441  con2a_loadlevel
1442  con2b_loadlevelstart
1443   
1444  con3a_maxprod_dispatchable
1445   
1446  con3e_maxprod_res
1447   
1448  con4a_stolev_start
1449  con4b_stolev
1450  con4c_stolev_max
1451  con4d_maxin_sto
1452  con4e_maxout_sto
1453   
1454  con4j_ending
1455  con4k_PHS_EtoP
1456   
1457  con5a_minRES
1458  con5b_max_energy
1459   
1460  con8a_max_I_power
1461  con8b_max_I_sto_e
1462  con8c_max_I_sto_p
1463   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11e_pro_stolev_PRO2M
      con11f_pro_stolev_M2PRO
      con11g_pro_stolev_M2M
      con11h_1_pro_stolev_start_PRO2PRO
      con11h_2_pro_stolev_start_PRO2M
      con11h_3_pro_stolev_start_M2PRO
      con11h_4_pro_stolev_start_M2M
      con11i_pro_stolev
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11m_pro_maxout_lev
      con11n_pro_maxin_lev
      con11o_pro_ending
      $ontext
1488   
1489  /;
1490   
1491   
1492   
1493   
1494  **************************************************************************
      ******
1495  ***** Options, fixings, report preparation *****
1496  **************************************************************************
      ******
1497   
1498  * Solver options
1504   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1515   
1516  dieter.OptFile = 1;
1517  dieter.holdFixed = 1 ;
1518   
1519   
1520   
1521   
1522  **************************************************************************
      ******
1523  ***** Solve *****
1524  **************************************************************************
      ******
1525   
1526  * Preparation of GUSS tool for scenario analysis
1527  phi_min_res = eps ;
1528  ev_quant = eps ;
1529  phi_pro_self = eps ;
1530   
1532   
1533  Set
1534  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1535  superscen        Scenarios                               /scen1*scen1000/
1536  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1537  ;
1538   
1539  set
1540  scen(superscen);
1541  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1542   
1543  Parameters
1544  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1545  modstats(superscen, modelstats)
1546  min_res
1547  number_ev
1548  pro_selfcon
1549  ;
1550   
1551  min_res(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_sha
      re,loop_prosumage) , loop_res_share.val/100 ) ;
1552  *number_ev(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_
      share,loop_prosumage) , loop_ev.val ) ;
1553  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1554   
1555  Parameters
1556  * Equations
1557  marginal_con5a(superscen)
1558  marginal_con1a(superscen,*)
1559  marginal_con9a(superscen,*,*,*)
1560  marginal_con9b(superscen,*,*,*)
1561   
1562  * Basic
1563  lev_Z(superscen)
1564  lev_G_L(superscen,tech,h)
1565  lev_G_UP(superscen,tech,h)
1566  lev_G_DO(superscen,tech,h)
1567  lev_G_RES(superscen,tech,h)
1568  lev_CU(superscen,tech,h)
1569  lev_STO_IN(superscen,sto,h)
1570  lev_STO_OUT(superscen,sto,h)
1571  lev_STO_L(superscen,sto,h)
1572  lev_N_TECH(superscen,tech)
1573  lev_N_STO_E(superscen,sto)
1574  lev_N_STO_P(superscen,sto)
1575   
1576   
1577  * Prosumage
1578  lev_CU_PRO(superscen,tech,h)
1579  lev_G_MARKET_PRO2M(superscen,tech,h)
1580  lev_G_MARKET_M2PRO(superscen,h)
1581  lev_G_RES_PRO(superscen,tech,h)
1582  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1583  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1584  lev_STO_IN_M2PRO(superscen,sto,h)
1585  lev_STO_IN_M2M(superscen,sto,h)
1586  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1587  lev_STO_OUT_PRO2M(superscen,sto,h)
1588  lev_STO_OUT_M2PRO(superscen,sto,h)
1589  lev_STO_OUT_M2M(superscen,sto,h)
1590  lev_STO_L_PRO2PRO(superscen,sto,h)
1591  lev_STO_L_PRO2M(superscen,sto,h)
1592  lev_STO_L_M2PRO(superscen,sto,h)
1593  lev_STO_L_M2M(superscen,sto,h)
1594  lev_N_STO_E_PRO(superscen,sto)
1595  lev_N_STO_P_PRO(superscen,sto)
1596  lev_STO_L_PRO(superscen,sto,h)
1597  lev_N_RES_PRO(superscen,tech)
1598  ;
1599   
1600   
1601  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\fix.gms
1603   
1604  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1614  **************************************************************************
      ******
1615   
1616   
1617   
1618  **************************************************************************
      ******
1619  **** Run of river  *******************************************************
      ******
1620  **************************************************************************
      ******
1621   
1622  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1623   
1624  *$ontext
1625  N_TECH.fx('ror') = 5857.47 ;
1626  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
      *RP_NONDIS.fx(reserves,'ror',h) = 0 ;
      $ontext
1631   
1632  * Fix everything to zero in case no ROR option is selected:
1633  *N_TECH.fx('ror') = 0 ;
1634  *G_RES.fx('ror',h) = 0 ;
1635  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1636   
1637   
1638   
1639  **************************************************************************
      ******
1640  **** Exogenous EV  *******************************************************
      ******
1641  **************************************************************************
      ******
1642   
1643   
1644   
1645  **************************************************************************
      ******
1646  **** No storage and DSM in first period  *********************************
      ******
1647  **************************************************************************
      ******
1648   
1649  ** No storage inflow in first period **
1650  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1651   
1652   
1653   
1654  **************************************************************************
      ******
1655  **** No primary reserves by heating devices  *****************************
      ******
1656  **************************************************************************
      ******
1657   
1658   
1659  **************************************************************************
      ******
1660  **** Fixing to reduce model size  ****************************************
      ******
1661  **************************************************************************
      ******
1662   
1663  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1664  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1665   
1666  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1667  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1668  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1669  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1670  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1671  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1672   
1673  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1674  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1675  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1676  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1677  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1678   
1679   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1703   
1704   
1705   
1706  **************************************************************************
      ******
1707  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1708  **************************************************************************
      ******
1709   
1710  * Default level zero for report parameters
1711  lev_Z(scen) = 0 ;
1712  lev_G_L(scen,tech,h) = 0 ;
1713  lev_G_UP(scen,tech,h) = 0 ;
1714  lev_G_DO(scen,tech,h) = 0 ;
1715  lev_G_RES(scen,tech,h) = 0 ;
1716  lev_CU(scen,tech,h) = 0 ;
1717  lev_STO_IN(scen,sto,h) = 0 ;
1718  lev_STO_OUT(scen,sto,h) = 0 ;
1719  lev_STO_L(scen,sto,h) = 0 ;
1720  lev_N_TECH(scen,tech) = 0 ;
1721  lev_N_STO_E(scen,sto) = 0 ;
1722  lev_N_STO_P(scen,sto) = 0 ;
1723  marginal_con1a(scen,h) = 0 ;
1724  marginal_con5a(superscen) = 0 ;
1725  *lev_NTC(superscen,l) = 0 ;
1726  *lev_F(superscen,l,h) = 0 ;
1727  *lev_RSVR_OUT(superscen,rsvr,h) = 0 ;
1728  *lev_RSVR_L(superscen,rsvr,h) = 0 ;
1729  *lev_N_RSVR_E(superscen,rsvr) = 0 ;
1730  *lev_N_RSVR_P(superscen,rsvr) = 0 ;
1731  *lev_G_INFES(superscen,h) = 0 ;
1732   
1733   
1734  * Prosumage
1735  lev_CU_PRO(scen,tech,h) = 0 ;
1736  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1737  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1738  lev_G_RES_PRO(scen,tech,h) = 0  ;
1739  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1740  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1741  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1742  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1743  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1744  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1745  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1746  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1747  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1748  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1749  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1750  lev_STO_L_M2M(scen,sto,h) = 0  ;
1751  lev_N_STO_E_PRO(scen,sto) = 0  ;
1752  lev_N_STO_P_PRO(scen,sto) = 0  ;
1753  lev_STO_L_PRO(scen,sto,h) = 0  ;
1754  lev_N_RES_PRO(scen,tech) = 0  ;
1755   
1756   
1757  * Fixing of report parameters for run-of-river
1758  *$ontext
1759  lev_N_TECH(scen,'ror') = 5857.47 ;
1760  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      *lev_RP_NONDIS(scenreserves,'ror',h) = 0 ;
      $ontext
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1772   
1773   
1774   
1775   
1776   
1777   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\scenario.gms
1779   
1780  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1790  **************************************************************************
      ******
1791   
1792   
1793   
1794   
1795  *****************************************
1796  **** Scenario file                   ****
1797  ****                                 ****
1798  *****************************************
1799   
1800  Parameter
1801  m_exog_p(tech)
1802  m_exog_sto_e(sto)
1803  m_exog_sto_p(sto)
1804  *m_exog_rsvr_p(rsvr)
1805  *m_exog_ntc(l)
1806  ;
1807   
1808  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1809  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1810  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1811  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1812  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1813   
1814   
1815  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1832   
1833  *** Investment model
1834  *$ontext
1835  N_TECH.lo(tech) = 0 ;
1836  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1837  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1838  N_TECH.lo('pv') = m_exog_p('pv') ;
1839  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1840  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1841  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1842  *NTC.lo(l) = m_exog_ntc(l) ;
1843   
1844  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1845  N_TECH.up('wind_on') = inf ;
1846  N_TECH.up('wind_off') = inf ;
1847  N_TECH.up('pv') = inf ;
1848  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1849  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1850  N_STO_P.up('sto1') = inf ;
1851  N_STO_P.up('sto5') = inf ;
1852  N_STO_P.up('sto7') = inf ;
1853  N_STO_E.up('sto1') = inf ;
1854  N_STO_E.up('sto5') = inf ;
1855  N_STO_E.up('sto7') = inf ;
1856  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1857  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1858  *$offtext
1859   
1860   
1861  *** Reservoir assumption - not used here
1862  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1863  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1864  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1865  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1866   
1867   
1868  *** Germany only, no infeasibility
1869  *NTC.fx(l) = 0 ;
1870  *F.fx(l,h) = 0 ;
1871  *G_INFES.fx(h) = 0 ;
1872   
1873   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1904   
1905   
1906  * Definition of dictionary set for GUSS tool
1907   
1908  Set dict(*,*,*) /
1909  scen             .scenario       .''
1910  gussoptions      .opt            .modstats
1911   
1912  phi_min_res      .param          .min_res
1913   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1918   
1919   
1920  con5a_minRES     .marginal       .marginal_con5a
1921  con1a_bal        .marginal       .marginal_con1a
1922   
1923  Z                .level          .lev_Z
1924  G_L              .level          .lev_G_L
1925  G_UP             .level          .lev_G_UP
1926  G_DO             .level          .lev_G_DO
1927  G_RES            .level          .lev_G_RES
1928  CU               .level          .lev_CU
1929  STO_IN           .level          .lev_STO_IN
1930  STO_OUT          .level          .lev_STO_OUT
1931  STO_L            .level          .lev_STO_L
1932  N_TECH           .level          .lev_N_TECH
1933  N_STO_E          .level          .lev_N_STO_E
1934  N_STO_P          .level          .lev_N_STO_P
1935   
1936   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
      STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
      STO_IN_M2M       .level          .lev_STO_IN_M2M
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
      STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
      STO_OUT_M2M      .level          .lev_STO_OUT_M2M
      STO_L_PRO        .level          .lev_STO_L_PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      STO_L_PRO2M      .level          .lev_STO_L_PRO2M
      STO_L_M2PRO      .level          .lev_STO_L_M2PRO
      STO_L_M2M        .level          .lev_STO_L_M2M
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1960  /
1961  ;
1962   
1963  solve DIETER using lp min Z scenario dict;
1964   
1965   
1966  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\report.gms
1968   
1969  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1979  **************************************************************************
      ******
1980   
1982   
1983   
1984   
1985   
1986  **************************************************************************
      ******
1987  **** Parameters for report file  *****************************************
      ******
1988  **************************************************************************
      ******
1989   
1990  Parameter
1991  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1992  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1993  corr_fac_sto             Balancing correction factor - storage technologie
      s
1994  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1995  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1996  corr_fac_ev              Balancing correction factor - electric vehicles
1997  corr_fac_rsvr            Balancing correction factor - reservoir
1998  corr_fac_sets            Balancing correction factor - SETS
1999  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2000  corr_fac_hp              Balancing correction factor - heat pumps
2001  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
2002   
2003  corr_fac_ev_sep
2004   
2005  gross_energy_demand                      Gross energy demand
2006  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
2007  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2008  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
2009  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
2010   
2011  reserves_activated
2012   
2013  calc_maxprice
2014  calc_minprice
2015   
2016  report
2017  report_tech
2018  report_tech_hours
2019  report_hours
2020  report_node
2021  report_line
2022  report_cost
2023   
2024  report_reserves
2025  report_reserves_hours
2026  report_reserves_tech
2027  report_reserves_tech_hours
2028   
2029  report_prosumage
2030  report_prosumage_tech
2031  report_prosumage_tech_hours
2032  report_market
2033  report_market_tech
2034  report_market_tech_hours
2035   
2036  report_heat_tech_hours
2037  report_heat_tech
2038  ;
2039   
2040   
2041   
2042   
2043  **************************************************************************
      ******
2044  **** Initialize reporting paremetrs  *************************************
      ******
2045  **************************************************************************
      ******
2046   
2047  * Set reporting sensitivity. All results below will be reported as zero
2048  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
2049  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
2050  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
2051   
2052   
2053  * ------------------------------------------------------------------------
      ----
2054   
2055  * Min and max for prices
2056  calc_maxprice = 0 ;
2057  calc_minprice = 1000 ;
2058   
2059   
2060  * ------------------------------------------------------------------------
      ----
2061   
2062  * Default values for correction factors
2063  corr_fac_dis(scen,dis,h) = 0 ;
2064  corr_fac_nondis(scen,nondis,h) = 0 ;
2065  corr_fac_sto(scen,sto,h) = 0 ;
2066  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2067  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2068  *corr_fac_ev(scen,h) = 0 ;
2069  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2070  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2071  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2072  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2073  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2074   
2075  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2076   
2077   
2078  * ------------------------------------------------------------------------
      ----
2079   
2080  * Parameter for hourly nodal reserves activated
2081  reserves_activated(scen,h) = 0 ;
2082   
2083   
2084   
2085   
2086   
2087  * ------------------------------------------------------------------------
      ----
2088   
2089  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2096   
2097   
2098  * ------------------------------------------------------------------------
      ----
2099   
2100  *Determine balancing correction factors
2101   
2102   
2103   
2104   
2105  * ------------------------------------------------------------------------
      ----
2106   
2107  * Define gross energy demand for reporting
2108  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2113   
2114   
2115  )
2116  ;
2117   
2118   
2119  **************************************************************************
      ******
2120  **** Report  *************************************************************
      ******
2121  **************************************************************************
      ******
2122   
2123  * RPEORT model statistics
2124          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2125          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2126          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2127   
2128   
2129  * ------------------------------------------------------------------------
      ----
2130   
2131  * REPORT HOURS
2132          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
2133          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
2134  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2135  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2136  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2137  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2138  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2139  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
2140  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
2141          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2142   
2143                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
2144                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
2145  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2146  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2147                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2148                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2149  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
2150   
2151   
2152  * ------------------------------------------------------------------------
      ----
2153   
2154  * REPORT TECH HOURS
2155          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2156  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
2157          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2158  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
2159  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2160  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
2161          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2162          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2163          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
2164          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2165  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
2166   
2167                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2168                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2169  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2170                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2171                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2172                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
2173                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
2174  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
2175  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
2176  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2177  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2178   
2179   
2180  * ------------------------------------------------------------------------
      ----
2181   
2182  * RPEORT LINE
2183   
2184  * ------------------------------------------------------------------------
      ----
2185   
2186  * REPORT NODE
2187          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2188   
2189  ;
2190          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
2191          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
2192  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2193           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2194          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
2195  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2196           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2197  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2198  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2199  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2200  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2201  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2202  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ,n),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2203  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e,n),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2204  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2205  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2206  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2207          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2208  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2209   
2210  ;
2211          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2212          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2213          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2214          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2215          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2216          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2217          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2218   
2219                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2220                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2221                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2222                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2223                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2224                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2225  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2226  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2227  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage,n)) < eps_re
      p_abs*card(h)) = 0 ;
2228                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2229                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2230                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2231  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2232  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2233                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2234  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2235  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2236   
2237   
2238  * ------------------------------------------------------------------------
      ----
2239   
2240  * REPORT COST
2241          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2242   
2243  ));
2244           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2245  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2246   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2251  );
2252   
2253  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2254  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2255  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2256           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2257  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage,
      n)
2258  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage,n)
2259  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      ,n)
2260   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2272   
2273  * ------------------------------------------------------------------------
      ----
2274   
2275  * REPORT TECH
2276          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2277          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2278  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2279  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2280          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2281          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2282   
2283          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2284          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2285  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2286          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2287          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2288   
2289          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2290  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2291          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2292          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2293  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2294          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2295   
2296          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2297          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2298   
2299          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2300          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2301   
2302          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2303          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2304  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2305          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2306   
2307   
2308                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2309                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2310                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2311                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2312  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2313  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2314                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2315  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2316                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2317                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2318  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2319                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2320                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2321                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2322                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2323                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2324  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2325                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2326                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2327                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2328  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2329                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2330                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2331                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2332   
2333   
2334  * ------------------------------------------------------------------------
      ----
2335   
2336  * REPORT NODE
2337          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2338  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr,n))
2339           ;
2340          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2341  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2342          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2343  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr,n))
2344           ;
2345          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2346   
2347                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2348                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2349                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2350                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2351   
2352   
2353   
2354  * ------------------------------------------------------------------------
      ----
2355   
2356  * REPORT TECH
2357          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2358          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2359  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2360          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2361   
2362          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2363          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2364  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2365          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2366   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(
      scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',
      loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2367   report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N
      _STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non
      -reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto
      ) ) * 1 ;
2368   
2369                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2370                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2371  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2372                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2373   
2374                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2375                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2376  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2377                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2378         report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('
      FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2379         report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(re
      port_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
2380   
2381   
2382  * ------------------------------------------------------------------------
      ----
2383   
2384  * RPEORT
2385          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2386          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2387          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2388          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2389          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2390          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2391          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2392          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2393          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2394  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2395          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2396  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2397           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2398          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2399          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2400   
2401                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2402                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2403                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2404                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2405                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2406                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2407                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2408                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2409                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2410   
2411   
2412  * ------------------------------------------------------------------------
      ----
2413   
2414  * DSM
2415   
2416   
2417  * ------------------------------------------------------------------------
      ----
2418   
2419  * EV
2420   
2421   
2422   
2423  * ------------------------------------------------------------------------
      ----
2424   
2425  * Reserves
2426   
2427   
2428   
2429   
2430  * ------------------------------------------------------------------------
      ----
2431   
2432  * Reserves and DSM
2433   
2434   
2435  * ------------------------------------------------------------------------
      ----
2436   
2437  * ------------------------------------------------------------------------
      ----
2438   
2439  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)$f
      eat_node('prosumage')= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)$feat
      _node('prosumage')= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)$feat_node('prosumage')=  sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)$feat_node('prosumage')= sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)$feat_node('prosumage')= sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,
      res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,
      sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))
       ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_
      RES(scen,res,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,rsvr,h)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)
      ) ;
              report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)$feat_node('prosumage')=  sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,loop_r
      es_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)$feat_node('prosumage')=  sum(scen$(map(scen,loop_res_sh
      are,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosuma
      ge')=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev
      _STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosumage
      ')=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_S
      TO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosuma
      ge')=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev
      _STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosumage
      ')=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_S
      TO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosumage')=  
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(sc
      en,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)$feat_node('prosumage')=  
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARK
      ET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)$feat_node('prosumage')= sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , gross_energy_demand_market(scen,n)) ;
              report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)$feat_node('prosumage')= sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen,n)
      ) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)$feat_node('prosumage')=  sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)$feat_node('prosumage')=  sum( scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosu
      mage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_pr
      osumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosu
      mage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_pr
      osumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosuma
      ge_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosum
      age,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosuma
      ge_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosum
      age,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosumage
      _tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,
      sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_pros
      umage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loo
      p_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosum
      age_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_pr
      osumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto,n)$feat_node('prosumage')= sum( h, report_prosum
      age_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_pr
      osumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto,n)$feat_node('prosumage')=  sum( h, report_prosuma
      ge_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosu
      mage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto,n)$feat_node('prosumage')= report_prosumage_tech('Stor
      age out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)+ repor
      t_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_p
      rosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'',n)$feat_node('prosumage')=  sum( (h,res) , report_
      prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_
      prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'',n)$feat_node('prosumage')=  sum( h , report_prosum
      age_tech_hours('withdrawal prosumers from market',loop_res_share,loop_pros
      umage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'',n)$feat_node('prosumage')=  sum( (res,h) , re
      port_prosumage_tech_hours('generation prosumers self-consumption',loop_res
      _share,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res,n)$(feat_node('prosumage')AND sum( scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( h , lev_G_RES_PRO(scen,
      res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h ,
       phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum( scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO
      (scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market',n)$sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_sh
      are,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$
      (map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )
       );
              report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res,n)$feat_node('prosumage')=  sum(h, sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )
      ) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res,n)$(report_prosumage_tech('curtailment
       of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)
      ) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumer
      s PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(s
      cen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2
      M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))
      ) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_shar
      e,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / re
      port_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_p
      rosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*car
      d(h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(sce
      n,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,
      h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_s
      hare,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,
      h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_s
      hare,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) /
       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loo
      p_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'',n)$(report_prosumage_tech('Generation total p
      rosumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(s
      cen,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',l
      oop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'',n)$(report_prosumage_tech('Withdrawal total p
      rosumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / 
      report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,lo
      op_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'',n)$(report_prosumage_tech('generation prosu
      mers self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card
      (h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO
      (scen,res,h)))) / report_prosumage_tech('generation prosumers self-consump
      tion',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h
      ) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,re
      s,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_P
      RO(scen,res) ) ;
      %reserves% report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosu
      mage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosu
      mage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)
      / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(sce
      n,sto)) ;
      %reserves% report_prosumage_tech('Storage cycles prosumers',loop_res_share
      ,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = r
      eport_prosumage_tech('Storage out total prosumers',loop_res_share,loop_pro
      sumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_r
      es_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,
      sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
              report_market_tech('capacities reservoir MW market',loop_res_share
      ,loop_prosumage,rsvr,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
              report_market_tech('capacities reservoir MWh market',loop_res_shar
      e,loop_prosumage,rsvr,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop_re
      s_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res,n)$feat_node('prosumage')=  sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_h
      our% ;
              report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res,n)$(report_market_tech('curtailment of fluct
       res absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr
      _fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( s
      um(h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen
      ,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_r
      es_share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con,n)$feat_node('prosumage')=  sum( scen$(map(scen,loop_r
      es_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto,n)$feat_node('prosumage')= sum(h, report_market
      _tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,
      h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto,n)$feat_node('prosumage')= sum(h, report_market_
      tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)) 
      * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) + l
      ev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       ;
      %reserves% report_market_tech('FLH market non-reserves',loop_res_share,loo
      p_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_ma
      rket_tech('Storage out total market non-reserves',loop_res_share,loop_pros
      umage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO
      _P(scen,sto)) ;
      %reserves% report_market_tech('Storage cycles market non-reserves',loop_re
      s_share,loop_prosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) 
      = report_market_tech('Storage out total market non-reserves',loop_res_shar
      e,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_
      hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_STO_E(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage,n)$feat_node('prosumage')= sum( scen$(map(scen,loop_res_share
      ,loop_prosumage)) , gross_energy_demand_prosumers(scen,n)) ;
              report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage,n)$feat_node('prosumage')= sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(scen,
      n)) ;
              report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( scen$(map(sce
      n,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(
      scen,n)) ;
              report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosu
      mers_selfgen(scen,n)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)
      ) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage,n)$(feat_node('prosumage')AND  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(sc
      en,n)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage,n)$feat_node('prosumage')= sum((res,h), sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %
      sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen
      ,res)) )) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,r
      es) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES
      _PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen
      ,res))) ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,r
      es) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,re
      s)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO
      (scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RE
      S_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(s
      cen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (
      h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PR
      O(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage,n)$feat_node('prosumage')= sum( res , sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res,n)$report_prosumage('Capacity total prosumers',loop_res_s
      hare,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto,n)$report_prosumage('Capacity total prosumers',loop_res_s
      hare,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers'
      ,loop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_pro
      sumage,n)$feat_node('prosumage')= sum( scen$(map(scen,loop_res_share,loop_
      prosumage)) , gross_energy_demand_market(scen,n)) ;
              report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage,n)$feat_node('prosumage')= sum((res,h), sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) * %sec_hour% 
      ;
              report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage,n)$(feat_node('prosumage')AND sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_TECH(sce
      n,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res,h), sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * le
      v_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h, sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,
      h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy
      _demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h, s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_
      M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)
      ) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h, sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2
      M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h, sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_
      PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)
      ) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h,
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_O
      UT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage,n)$feat_node('prosumage')= sum( h, s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT
      _M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , gross_energy_demand_market(scen)) ;
              report_market('Capacity total market',loop_res_share,loop_prosumag
      e,n)$feat_node('prosumage')= sum( tech , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) )) + sum( rsvr ,
        sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,r
      svr))) + sum( dsm_curt ,  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_DSM_CU(scen,dsm_curt))) + sum( dsm_shift ,  sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_DSM_SHIFT(scen,dsm_shift))) ;
              report_market('Energy demand total market',loop_res_share,loop_pro
      sumage,n)$feat_node('prosumage')= (sum( h , (1 - phi_pro_load) * d(h) ) + 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET
      _M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO
      _IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_
      prosumage,n)$feat_node('prosumage')= sum( h , sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev
      _G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_
      fac_nondis(scen,res,h)) + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_
      rsvr(scen,rsvr,h)) + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(
      scen,sto,h) - corr_fac_sto(scen,sto,h)) + sum( dsm_shift , lev_DSM_DO_DEMA
      ND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_cu
      rt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h))
       - corr_fac_ev(scen,h) )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(feat_node('prosumage')AND report_market('Capacity total mark
      et',loop_res_share,loop_prosumage,n)) = sum( scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_TECH(scen,tech) ) / report_market('Capacity tota
      l market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,rsvr,n)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_market('Capacity tota
      l market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto,n)$feat_node('prosumage')= sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total m
      arket',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con,n)$(feat_node('prosumage')AND report_ma
      rket('energy generated gross market',loop_res_share,loop_prosumage,n)) = s
      um( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,
      con,h)) ) / report_market('energy generated gross market',loop_res_share,l
      oop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res,n)$(feat_node('prosumage')AND report_ma
      rket('energy generated gross market',loop_res_share,loop_prosumage,n)) = s
      um( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,
      res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac
      _nondis(scen,res,h)) ) / report_market('energy generated gross market',loo
      p_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,rsvr,n)$(feat_node('prosumage')AND report_m
      arket('energy generated gross market',loop_res_share,loop_prosumage,n)) = 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / report_market('energy gene
      rated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto,n)$(feat_node('prosumage')AND report_ma
      rket('energy generated gross market',loop_res_share,loop_prosumage,n)) = s
      um( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M
      2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / r
      eport_market('energy generated gross market',loop_res_share,loop_prosumage
      )* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',lo
      op_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
                       report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res,n)$(report_prosumage_tech('capacities rene
      wable prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('capacities sto
      rage MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('capacities st
      orage MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0
       ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto,n)$(report_prosumage_tech('consumption share 
      prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res,n)$(report_prosumage_tech('consumption share 
      prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market',n)$(report_prosumage_tech('consumption s
      hare prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 
      ;
                       report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res,n)$(report_prosumage_tech('cu
      rtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,r
      es)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res,n)$(report_prosumage_tech('cu
      rtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,r
      es)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs
      *card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage ou
      t total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,n)< eps_rep_a
      bs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out 
      total prosumers PRO2M',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*c
      ard(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out 
      total prosumers M2PRO',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*c
      ard(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out to
      tal prosumers M2M',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*card(
      h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total 
      prosumers',loop_res_share,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 
      ;
                       report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('Generation tot
      al prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('Withdrawal tot
      al prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('generatio
      n prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_a
      bs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('averag
      e market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average 
      market value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average 
      market value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average ma
      rket value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('avera
      ge market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average
       market value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average
       market value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto,n)$(report_prosumage_tech('average m
      arket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('average m
      arket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('average m
      arket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'',n)$(report_prosumage_tech('average
       market value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res,n)$(report_prosumage_tech('Capacity share prosum
      ers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto,n)$(report_prosumage_tech('Capacity share prosum
      ers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res,n)$(report_prosumage_tech('FLH prosumers',loop_res_share,lo
      op_prosumage,res)< eps_rep_abs) = 0 ;
      %reserves%       report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage cycles prosum
      ers',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
      %reserves%       report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto,n)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto,n)$(report_prosumage_tech('Storage EP-ratio pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res,n)$(report_market_tech('capacities renewable mar
      ket',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities reservoir MW market',loop_
      res_share,loop_prosumage,rsvr,n)$(report_market_tech('capacities reservoir
       MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities reservoir MWh market',loop
      _res_share,loop_prosumage,rsvr,n)$(report_market_tech('capacities reservoi
      r MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto,n)$(report_market_tech('capacities storage MW m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto,n)$(report_market_tech('capacities storage MWh
       market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res,n)$(report_market_tech('curtailment
       of fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep
      _abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res,n)$(report_market_tech('curtailment
       of fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep
      _rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con,n)$(report_market_tech('capacities convention
      al market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res,n)$(report_market_tech('capacities renewable mar
      ket',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto,n)$(report_market_tech('capacities storage MW m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto,n)$(report_market_tech('capacities storage MWh
       market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto,n)$(report_market_tech('Storage out to
      tal market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto,n)$(report_market_tech('Storage in tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res,n)$(report_market_tech('FLH market non-reserves',loo
      p_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con,n)$(report_market_tech('FLH market non-reserves',loo
      p_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto,n)$(report_market_tech('FLH market non-reserves',loo
      p_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto,n)$(report_market_tech('Storage cycles ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto,n)$(report_market_tech('Storage EP-ratio market',loo
      p_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage,n)$(report_prosumage('gross energy demand prosumers'
      ,loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage,n)$(report_prosumage('gross energy deman
      d prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 
      ;
                       report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage,n)$(report_prosumage('gross energy d
      emand prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
                       report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage,n)$(report_prosumage('self-generation share 
      prosumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage,n)$(report_prosumage('market share prosumage',loop_res_shar
      e,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage,n)$(report_prosumage('curtailment of f
      luct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) 
      = 0 ;
                       report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage,n)$(report_prosumage('curtailment of f
      luct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) 
      = 0 ;
                       report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage,n)$(report_prosumage('share self-generation curtai
      led',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage,n)$(report_prosumage('share self-generati
      on direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage,n)$(report_prosumage('share self-generation to mar
      ket',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage,n)$(report_prosumage('share self-generation s
      tored PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage,n)$(report_prosumage('share self-generation sto
      red PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage,n)$(report_prosumage('Capacity total prosumers',loop_res_
      share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share
      ,loop_prosumage,n)$(report_market('gross energy demand market',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage,n)$(report_market('curtailment of fluct res 
      absolute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage,n)$(report_market('curtailment of fluct res 
      relative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage,n)$(report_market('Share mark
      et energy transferred to prosumer consumption',loop_res_share,loop_prosuma
      ge)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage,n)$(report_market('Share ma
      rket energy transferred to prosumer storage M2PRO',loop_res_share,loop_pro
      sumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage,n)$(report_market('Share mark
      et energy transferred to prosumer storage M2M',loop_res_share,loop_prosuma
      ge)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage,n)$(report_market('Share mark
      et energy tranferred from prosumer generation',loop_res_share,loop_prosuma
      ge)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage,n)$(report_market('Share 
      market energy transferred from prosumer storage PRO2M',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage,n)$(report_market('Share ma
      rket energy transferred from prosumer storage M2M',loop_res_share,loop_pro
      sumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop
      _prosumage,n)$(report_market('Capacity total market',loop_res_share,loop_p
      rosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share
      ,loop_prosumage,n)$(report_market('Energy demand total market',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage,n)$(report_market('energy generated gross market',loop_
      res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto,n)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,rsvr,n)$(report_market_tech('Capacity share market',loop_r
      es_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con,n)$(report_market_tech('Energy
       share in gross nodal market generation',loop_res_share,loop_prosumage,con
      )< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res,n)$(report_market_tech('Energy
       share in gross nodal market generation',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto,n)$(report_market_tech('Energy
       share in gross nodal market generation',loop_res_share,loop_prosumage,sto
      )< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr,n)$(report_market_tech('Energ
      y share in gross nodal market generation',loop_res_share,loop_prosumage,rs
      vr)< eps_rep_rel) = 0 ;
      $ontext
2706   
2707   
2708  * ------------------------------------------------------------------------
      ----
2709   
2710  * PROSUMAGE & DSM
2711   
2712   
2713   
2714  * ------------------------------------------------------------------------
      ----
2715   
2716   
2717   
2718  * ------------------------------------------------------------------------
      ----
2719   
2720  * HEAT
2721   
2722  * ------------------------------------------------------------------------
      ----
2723   
2724  * Reserves and heat
2725   
2726   
2727  * ------------------------------------------------------------------------
      ---- *
2728  * ------------------------------------------------------------------------
      ---- *
2729  * ------------------------------------------------------------------------
      ---- *
2730   
2731   
2732  execute_unload "results", report, report_tech, report_node,
2733  *report_line,
2734  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
      $ontext
2739  ;
2740   
2741   
      $include report_to_excel.gms
      $ontext
2746   
2747   
2748   
2749  * ------------------------------------------------------------------------
      ---- *
2750  * ------------------------------------------------------------------------
      ---- *
2751  * ------------------------------------------------------------------------
      ---- *
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 12:04:04 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\pr
                                          osumage\Code\Prosumage_Opt\Dieter_Modu
                                          le\Modified_MCP\DIETER.gms
     2      148 INCLUDE        1     148  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\dataload.gms
     3      555 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      557 GDXIN          2     409  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\Data_input.gdx
     5      609 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      610 GDXIN          2     462  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\time_series.gdx
     7     1044 INCLUDE        1     268  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\model.gms
     8     1602 INCLUDE        1     381  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\fix.gms
     9     1778 INCLUDE        1     382  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\scenario.gms
    10     1967 INCLUDE        1     446  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\report.gms


COMPILATION TIME     =       16.864 SECONDS      6 MB  24.2.3 r46072 WEX-WEI
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 12:04:04 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1963


MODEL STATISTICS

BLOCKS OF EQUATIONS          18     SINGLE EQUATIONS      385,493
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      324,145  5 projected
NON ZERO ELEMENTS     1,362,752     NON LINEAR N-Z         87,601
DERIVATIVE POOL              10     CONSTANT POOL              17
CODE LENGTH             122,646


GENERATION TIME      =       36.973 SECONDS    125 MB  24.2.3 r46072 WEX-WEI


EXECUTION TIME       =       37.035 SECONDS    125 MB  24.2.3 r46072 WEX-WEI
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 12:04:04 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1963


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1963

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         20.499  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.2.3 r46072 Released May 22, 2014 WEI x86_64/MS Windows    
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   24.2.3 r46072 Released May 22, 2014 WEI x86_64/MS Windows    
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Pr
                               osumage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosum
                                   age_Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.61 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 20.05sec (det. 17694.09 ticks)
Optimal solution found.
Objective : 33544542852.728622

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544542852.7286
---   Resource Usage   20514
---   Total Time (ms)  20608

No solution returned
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 12:04:04 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.546 SECONDS     41 MB  24.2.3 r46072 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\DIETER.lst
