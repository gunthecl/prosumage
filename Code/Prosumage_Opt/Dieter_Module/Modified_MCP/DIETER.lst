GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/23/18 09:28:04 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24   
  25  * Choose base year
  27   
  28  * Germany only - also adjust Excel inputs!
  30   
  31  * Set star to activate options
  32   
  34   
  35  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  36  * if nothing is selected, ROR capacity will be set to zero
  37  * if parameter option is selected, set appropriate values in fix.gmx
  38  * if variable option is selected, set appropriate bound in data_input exce
      l
  41   
  42  * Set star to determine loops, otherwise default 100% renewables
  44   
  45  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  47   
  48  * Set star for reporting to Excel
  50   
  51   
  52  * ----------------- Select if to use MCP or LP format --------------------
      ------
  53   
  54  * Set to "*" to select linear program, leave blank to select MCP
  56   
  57  * Do not change these two lines
  60   
  61  **************************************************************************
      ******
  62   
  63  * Definition of strings for report parameters and sanity checks
  64  * (Do not change settings below)
  66   
  67  * Sanity checks
  69   
  70  **************************************************************************
      ******
  71   
  72  ****************************
  73  ***** INITIALIZE LOOPS *****
  74  ****************************
  75   
  76  sets
  77  *$ontext
  78  loop_res_share   Solution loop for different shares of renewables       /1
      0,50,80/
  81   
      loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
      $ontext
  86   
  87  *      loop_res_share                          /50/
  88                        loop_prosumage                          /0/
  89  ;
  90   
  91   
  92   
  93   
  94  **************************************************************************
      ******
  95   
  96  **************************
  97  ***** SOLVER OPTIONS *****
  98  **************************
  99   
 100  options
 101  optcr = 0.00
 102  reslim = 10000000
 103  lp = cplex
 104  mip = cplex
 105  nlp = conopt
 106  limrow = 0
 107  limcol = 0
 108  ;
 109   
 110  options
 111  dispwidth = 15
 112  limrow = 0
 113  limcol = 0
 114  solprint = off
 115  sysout = off
 116  ;
 117   
 118   
 119   
 120   
 121  **************************************************************************
      ******
 122   
 123  **************************
 124  ***** Dataload *****
 125  **************************
 126   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\dataload.gms
 128   
 129  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 139  **************************************************************************
      ******
 140   
 141   
 142   
 143   
 144  ***************  SETS  ***************************************************
      ******
 145   
 146  ***** Sets used in the model *****
 147  Sets
 148  tech                     Generation technologies
 149   dis(tech)               Dispatchable generation technologies
 150   nondis(tech)            Nondispatchable generation technologies
 151   con(tech)               Conventional generation technologies
 152   res(tech)               Renewable generation technologies
 153  sto                      Storage technologies
 154  rsvr                     Reservoir technologies
 155  dsm                      DSM technologies
 156   dsm_shift(dsm)          DSM load shifting technologies
 157   dsm_curt(dsm)           DSM load curtailment technologies
 158  year                     Base year for temporal data
 159  h                        Hours
 160  n                        Nodes
 161  l                        Lines
 162  ev                       EV types
 163  reserves                         Reserve qualities
 164   reserves_up(reserves)           Positive reserves
 165   reserves_do(reserves)           Negative reserves
 166   reserves_spin(reserves)         Spinning reserves
 167   reserves_nonspin(reserves)      Nonspinning reserves
 168   reserves_prim(reserves)         Primary reserves
 169   reserves_nonprim(reserves)      Nonprimary reserves
 170   reserves_prim_up(reserves)      Primary positive reserves
 171   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 172   reserves_prim_do(reserves)      Primary negative reserves
 173   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 174  bu                       Building archtypes
 175  ch                       Heating combination type
 176   hst(ch)                 Heating technology that feeds to storage
 177   hp(ch)                  Heat pump technologies
 178   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 179   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 180   
 181   
 182  ***** Sets used for data upload *****
 183  headers_tech                     Generation technologies - upload headers
 184   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 185   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 186  headers_sto                      Storage technologies - upload headers
 187  headers_reservoir                Reservoir technologies - upload headers
 188  headers_dsm                      DSM technologies - upload headers
 189   dsm_type                        DSM technologies - shifting or curtailmen
      t
 190  headers_time                     Temporal data - upload headers
 191  headers_topology                 Spatial data - upload headers
 192  headers_ev                       EV data - upload headers
 193  headers_time_ev                  EV temporal data - upload headers
 194  headers_prosumage_generation     Prosumage generation data - upload header
      s
 195  headers_prosumage_storage        Prosumage storage data - upload headers
 196  headers_reserves                 Reserve data - upload headers
 197   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 198   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 199   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 200  headers_heat                     Heat data - upload headers
 201   heat_storage                    Heat data - storage technologies
 202   heat_hp                         Heat data - heat pump technologies
 203   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 204   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 205  headers_time_heat                Heat data - upload headers time data
 206  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 207  ;
 208   
 209   
 210   
 211   
 212  ***************  PARAMETERS  *********************************************
      ******
 213   
 214  Parameters
 215   
 216  ***** Generation technologies *****
 217  *--- Variable and fixed costs ---*
 218  eta              Efficiency of conventional technologies [0 1]
 219  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 220  c_up             Load change costs UP [EUR per MWh]
 221  c_do             Load change costs DOWN [EUR per MWh]
 222  c_fix            Annual fixed costs [EUR per MW per year]
 223  c_vom            Variable O&M costs [EUR per MWh]
 224  CO2price         CO2 price in [EUR per ton]
 225   
 226  *--- Investment ---*
 227  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 228  lifetime         Investment costs: technical lifetime [a]
 229  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 230  interest_rate    Investment costs: Interest rate [%]
 231  m_p              Investment: maximum installable capacity per technology [
      MW]
 232  m_e              Investment: maximum installable energy [TWh per a]
 233   
 234  *--- Flexibility ---*
 235  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 236   
 237   
 238  ***** Fuel and CO2 costs *****
 239  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 240   
 241   
 242  ***** Renewables *****
 243  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 244  phi_min_res      Minimum renewables share [0 1]
 245   
 246   
 247  ***** Storage *****
 248  *--- Variable and fixed costs ---*
 249  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 250  eta_sto          Storage efficiency [0 1]
 251  phi_sto_ini      Initial storage level [0 1]
 252  etop_max         Maximum E to P ratio of storage types [#]
 253  c_fix_sto        Annual fixed costs [EUR per MW]
 254   
 255  *--- Investment ---*
 256  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 257  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 258  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 259  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 260   
 261   
 262  ***** Reservoir*****
 263  *--- Variable and fixed costs ---*
 264  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 265  eta_rsvr                 Generation efficiency [0 1]
 266  phi_rsvr_ini             Initial reservoir level [0 1]
 267  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 268  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 269  phi_rsvr_lev_min         Minimum filling level [0 1]
 270   
 271  *--- Investment ---*
 272  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 273  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 274  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 275  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 276  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 277  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 278   
 279   
 280  ***** DSM *****
 281  *--- Variable and fixed costs ---*
 282  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 283  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 284  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 285  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 286   
 287  *--- Flexibility, efficiency, recovery ---*
 288  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 289  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 290   
 291  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 292  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 293  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 294   
 295  *--- Investment ---*
 296  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 297  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 298  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 299  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 300  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 301  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 302  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 303  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 304   
 305   
 306  ***** Time Data *****
 307  d_y                      Demand hour h for different years [MWh]
 308  d                        Demand hour h [MWh]
 309  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 310  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 311  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 312  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 313  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 314  rsvr_in                  Reservoir inflow in hour h [0 1]
 315  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 316  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 317  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 318  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 319  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 320  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 321  reserves_exogenous       Hourly reserve provision [MW]
 322   
 323  ***** Transmission *****
 324  *--- Investment ---*
 325  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 326  c_fix_ntc                 Fixed costs [EUR per MW per a]
 327  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 328  inv_recovery_ntc          Investment costs: Recovery period in [a]
 329  inv_interest_ntc          Investment costs: Interest rate [%]
 330  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 331   
 332  *--- Topology and distance ---*
 333  inc              Incidence index of link l on node n
 334  dist             Distance covered by link l [km]
 335   
 336   
 337  ***** Electric vehicles *****
 338  *--- Costs and attributes ---*
 339  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 340  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 341  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 342  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 343  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 344   
 345  n_ev_e           Electric vehicle battery capacity [MWh]
 346  ev_quant         Overall number of electirc vehicles [#]
 347  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 348  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 349   
 350  *--- Temporal data ---*
 351  n_ev_p           Electric vehicle power rating [MWh]
 352  ev_ed            Electric vehicle electricity demand [MWh]
 353  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 354   
 355   
 356  ***** Prosumage *****
 357  phi_pro_load             Share of prosumagers among total load [0 1]
 358  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 359  m_res_pro                Maximum installable: renewables capacity [MW]
 360  m_sto_pro_e              Maximum installable: storage energy [MWh]
 361  m_sto_pro_p              Maximum installable: storage capacity [MW]
 362  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 363   
 364   
 365  ***** Reserves *****
 366  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 367  reserves_intercept       Intercept of regression line determining reserves
       demand
 368  reserves_slope           Slope of regression line determining reserves dem
      and
 369  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 370  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 371  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 372  *reserves_exog
 373   
 374   
 375  ***** Heat *****
 376  *--- Time data ---*
 377  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 378  dh_y                     Hourly heat demand per year [MWh per m2]
 379  dh                       Hourly heat demand [MWh per m2]
 380  temp_source              Heat pumps - source temperature [°Celsius]
 381  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 382  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 383  d_dhw                    Hourly DHW demand [MWh per m2]
 384  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 385   
 386  *--- Technololgy attributes ---*
 387  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 388  eta_heat_stat            Static efficiency for heating technologies [0 1]
 389  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 390  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 391  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 392  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 393  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 394  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 395  n_sets_p_out             SETS - Power rating - heat output [MW]
 396  n_sets_e                 SETS - Energy storage capacity [MWh]
 397  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 398  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 399  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 400  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 401  temp_sink                Heat pumps - sink temperature [°Celsius]
 402  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 403  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 404  theta_night              Indicator for night hours {0 1}
 405   
 406   
 407   
 408  ***************  DERIVED PARAMETERS  *************************************
      ******
 409   
 410  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 411  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 412   
 413  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 414  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 415   
 416  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 417  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 418   
 419  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 420  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 421   
 422  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 423  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 424   
 425  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 426   
 427  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 428  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 429   
 430  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 431  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 432  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 433  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 434  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 435  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 436   
 437   
 438   
 439   
 440  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 441   
 442  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 443  technology_data(tech,headers_tech)
 444  storage_data(sto,headers_sto)
 445  reservoir_data(rsvr,headers_reservoir)
 446  time_data_upload(h,year,headers_time)
 447  dsm_data_upload(dsm,dsm_type,headers_dsm)
 448  dsm_data(dsm,headers_dsm)
 449  topology_data(l,headers_topology)
 450  ev_data(ev,headers_ev)
 451  ev_time_data_upload(h,headers_time_ev,ev)
 452  prosumage_data_generation(tech,headers_prosumage_generation)
 453  prosumage_data_storage(sto,headers_prosumage_storage)
 454  reserves_time_data_activation(h,year,reserves)
 455  reserves_time_data_provision(h,year,reserves)
 456  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 457  reserves_data(reserves,headers_reserves)
 458  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 459  heat_data(bu,ch,headers_heat)
 460  dh_upload(h,year,headers_time_heat,bu)
 461  d_dhw_upload(h,year,headers_time_heat,bu)
 462  temp_source_upload
 463  ;
 464   
 465   
 466   
 467   
 468  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 469   
 532   
 533  *%skip_Excel%
 535   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 540  *$load l headers_topology topology_data
 541  *$ontext
 542  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 549  ;
 550   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 556   
 557   
 558  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 559   
 585   
 586   
 587  *
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 591  *$load headers_time_ev ev_time_data_upload
 592  *$load reserves_time_data_activation
 593  *$load reserves_time_data_provision
 594  *$load headers_time_heat dh_upload
 595  *$load theta_night
 596  *$load temp_source_upload
 597  *$load headers_time_dhw d_dhw_upload nets_profile
 598  ;
 599   
 600   
 601   
 602   
 603  ***************  ASSIGNMENTS  ********************************************
      ******
 604   
 605   
 606   
 607  ***** Aliases *****
 608  alias (h,hh) ;
 609  alias (res,resres) ;
 610  alias (reserves,reservesreserves) ;
 611  alias (nondis,nondisnondis) ;
 612   
 613   
 614   
 615  ***** Derived sets *****
 616  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 617  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 618   
 619  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 620  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 621   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 643   
 644   
 645   
 646  ***** Parameters *****
 647   
 648  *--- Generation technologies ---*
 649  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 650  eta(tech) = technology_data(tech,'eta_con') ;
 651  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 652  c_up(dis) =technology_data(dis,'load change costs up') ;
 653  c_do(dis) = technology_data(dis,'load change costs down') ;
 654  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 655  c_vom(tech) = technology_data(tech,'variable_om') ;
 656  CO2price(tech) = technology_data(tech,'CO2_price') ;
 657   
 658  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 659  lifetime(tech) = technology_data(tech,'lifetime') ;
 660  recovery(tech) = technology_data(tech,'recovery_period') ;
 661  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 662  m_p(tech) = technology_data(tech,'max_installable') ;
 663  m_e(tech) = technology_data(tech,'max_energy') ;
 664  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 665  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 666   
 667  c_cu(res) = technology_data(res,'curtailment_costs') ;
 668   
 669   
 670  *--- Storage technologies ---*
 671  c_m_sto(sto) = storage_data(sto,'mc');
 672  eta_sto(sto) = storage_data(sto,'efficiency');
 673  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 674  phi_sto_ini(sto) = storage_data(sto,'level_start');
 675  etop_max(sto) = storage_data(sto,'etop_max') ;
 676   
 677  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 678  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 679  lifetime(sto) = storage_data(sto,'lifetime');
 680  interest_rate(sto) = storage_data(sto,'interest_rate');
 681  m_sto_e(sto) = storage_data(sto,'max_energy');
 682  m_sto_p(sto) = storage_data(sto,'max_power');
 683   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 725   
 726  *--- Temporal data ---*
 727  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 728  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 729   
 730  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 731  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 732  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 733   
 734   
 735  *--- Spatial data ---*
 736  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 737  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 738  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 739  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 740  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 741  *m_ntc(l) = topology_data(l,'max_installable') ;
 742  *dist(l) = topology_data(l,'distance') ;
 743   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 760   
 761  *--- Prosumage ---*
 762  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 763  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 764  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 765  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 766   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 812   
 813   
 814  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 815   
 816  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 817   
 818  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 819                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 820   
 821  c_i_res(res) = c_i(res) ;
 822  c_fix_res(res) = c_fix(res) ;
 823   
 824  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 825                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 826   
 827  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 828                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 857   
 858   
 859  ***************  Adjust costs to model's hourly basis ********************
      ******
 860   
 861  c_i(tech) = c_i(tech)*card(h)/8760 ;
 862  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 863  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 864  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 865  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 866  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 867  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 868  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 869   
 870  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 871  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 872  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 873  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 874  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 875   
 876  m_e('bio') = m_e('bio')*card(h)/8760 ;
 877   
 878  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 879   
 880  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 881  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 882  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 883  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 884   
 885   
 886   
 887  **************************************************************************
      ******
 888   
 889   
 890   
 891   
 892   
 893   
 894   
 895   
 896   
 897  **************************************************************************
      ******
 898   
 899  ***************************
 900  ***** Initialize data *****
 901  ***************************
 902   
 903  * Parameters for default base year
 904  d(h) = d_y('2030',h) ;
 905  phi_res(res,h) = phi_res_y('2030',res,h) ;
 906  phi_min_res = 0 ;
 907  phi_pro_self = 0 ;
 908  phi_pro_load = 0 ;
 909   
      phi_pro_load = 0.2 ;
      $ontext
 914   
 915   
 916  Parameter
 917  phi_min_res_exog;
 918  phi_min_res_exog = 1 ;
 919   
 920  Sets
 921  h_ini(h)                       First hour  /h1/
 922  h_end(h)                       Last hour   /h8760/
 923  ;
 924   
 925  **************************************************************************
      ******
 926  ***** Model *****
 927  **************************************************************************
      ******
 928   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\model.gms
 930   
 931  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 941  **************************************************************************
      ******
 942   
 943   
 944  Variables
 945  Z                  Value objective function [Euro]
 946  lambda_enerbal     Dual variable on energy balance (1a)
 947  lambda_resgen      Dual variable on renewable generation (3e)
 948  lambda_convgen     Dual variable on conventional generation level (2a)
 949  lambda_stolev      Dual variable on storage level  (4b)
 950  ;
 951   
 952  Positive Variables
 953  G_L(tech,h)            Generation level in hour h [MWh]
 954  G_UP(tech,h)           Generation upshift in hour h [MWh]
 955  G_DO(tech,h)           Generation downshift in hour h [MWh]
 956   
 957  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 958  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
 959   
 960  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 961  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 962  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 963   
 964  N_TECH(tech)           Technology tech built [MW]
 965  N_STO_E(sto)           Storage technology built - Energy [MWh]
 966  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
 967   
 968  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
 969  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
 970  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
 971  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
 972  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
 973  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
 974  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
 975  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 976  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 977  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
 978   
 979   
 980  mu_stoin_cap          Dual variable on storage loading capacity constraint
       (4d)
 981  mu_stout_cap          Dual variable on storage discharging capacity constr
      aint (4e)
 982  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 983  mu_conv_cap           Dual variable on conventional generation capacity co
      nstraint (3a)
 984  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 985  mu_dis_max_i          Dual variable on dispatchable installation constrain
      t (8a)
 986  mu_nondis_max_i       Dual variable on nondispatchable installation constr
      aint (8a)
 987  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 988  mu_stop_max_i         Dual variable on storage power installation constrai
      nt  (8c)
 989  mu_stoe_max_i         Dual variable on storage energy installation constra
      int  (8b)
 990  mu_minRES             Dual variable on minimum renewable share constraint 
      (5a)
 991   
 992  ;
 993   
 994  Set
 995  dis_bio(tech)          Subset of dispatchable technology: Bio mass        
      /bio/
 996  ;
 997   
 998  **************************************************************************
      ******
 999   
1000  Equations
1001  * Objective
1002  obj                      Objective cost minimization
1003   
1004  * Energy balance
1005  con1a_bal                Energy Balance
1006   
1007  * Load change costs
1008  con2a_loadlevel          Load change costs: Level
1009  con2b_loadlevelstart     Load change costs: Level for first period
1010  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
1011  * Capacity contraints and flexibility constraints
1012  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1013  con3e_maxprod_res                Capacity constraints renewables
1014   
1015  * Storage constraints
1016  con4a_stolev_start        Storage Level Dynamics Initial Condition
1017  con4b_stolev              Storage Level Dynamics
1018  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
1019  con4c_stolev_max          Storage Power Capacity
1020  con4d_maxin_sto           Storage maximum inflow
1021  con4e_maxout_sto          Storage maximum outflow
1022  con4j_ending              End level equal to initial level
1023  con4k_PHS_EtoP            Maximum E-P ratio
1024   
1025  * Minimum restrictions for renewables and biomass
1026  con5a_minRES             Minimum yearly renewables requirement
1027  con5b_max_energy         Maximum yearly biomass energy
1028   
1029  * Maximum installation conditions
1030  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1031  con8b_max_I_sto_e                Maximum installable energy: Storage energ
      y in MWh
1032  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1033   
1034  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1035  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1036  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1037   
1038  * Prosumage
1039  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1040  con11b_pro_balance                       Prosumage: energy balance
1041  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1042  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1043  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1044  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1045  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1046  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1047  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1048   
1049   
1050  * KKT optimality conditions
1051  KKTG_L                   KKT w.r.t. G_L
1052  KKTG_UP                  KKT w.r.t. G_UP
1053  KKTG_DO                  KKT w.r.t. G_DO
1054  KKTG_RES                 KKT w.r.t. G_RES
1055  KKTCU                    KKT w.r.t. CU
1056  KKTSTO_IN                KKT w.r.t. STO_IN
1057  KKTSTO_OUT               KKT w.r.t. STO_OUT
1058  KKTSTO_L                 KKT w.r.t. STO_L
1059  KKTN_TECH_NONDIS         KKT w.r.t. N_TECH(nondis)
1060  KKTN_TECH_DIS            KKT w.r.t. N_TECH(dis)
1061  KKTN_TECH                KKT w.r.t. N_TECH
1062  KKTN_STO_E               KKT w.r.t. N_STO_E
1063  KKTN_STO_P               KKT w.r.t. N_STO_P
1064  ;
1065   
1066   
1067  **************************************************************************
      ******
1068   
1069  * ------------------------------------------------------------------------
      ---- *
1070  ***** Objective function *****
1071  * ------------------------------------------------------------------------
      ---- *
1072   
1073  obj..
1074           Z =E=
1075                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1076                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1077                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1078                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1079                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1080                   + sum( tech , c_i(tech)*N_TECH(tech) )
1081                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1082                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1083                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1084                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1094  ;
1095   
1096  * ------------------------------------------------------------------------
      ---- *
1097  ***** Energy balance and load levels *****
1098  * ------------------------------------------------------------------------
      ---- *
1099   
1100  * Energy balance
1101  con1a_bal(hh)..
1102   
1103             sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum
      ( sto , STO_OUT(sto,hh) )
               + sum( res , G_MARKET_PRO2M(res,hh) )
      $ontext
1108           -  ( 1 - phi_pro_load )* d(hh)
1109           -   sum( sto , STO_IN(sto,hh) )
1110   
               - G_MARKET_M2PRO(hh)
      $ontext
1115   
1116         =E= 0
1117  ;
1118   
1119  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1120           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1121  ;
1122   
1123  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1124          G_UP(dis,h) - G_L(dis,h) =E= 0
1125  ;
1126   
1127  con2_loadlevel(dis,h)..
1128             G_UP(dis,h)  - G_L(dis,h)
1129          +  G_L(dis,h-1)$(ord(h) > 1)
1130          -  G_DO(dis,h)$(ord(h)  > 1)
1131   
1132           =E= 0
1133  ;
1134   
1135   
1136   
1137  * ------------------------------------------------------------------------
      ---- *
1138  ***** Hourly maximum generation caps *****
1139  * ------------------------------------------------------------------------
      ---- *
1140   
1141  con3a_maxprod_dispatchable(dis,h)..
1142   
1143           N_TECH(dis) -  G_L(dis,h)  =G= 0
1144   
1145  ;
1146   
1147  con3e_maxprod_res(nondis,h)..
1148   
1149   
1150         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =
      E= 0
1151  ;
1152   
1153  * ------------------------------------------------------------------------
      ---- *
1154  ***** Storage constraints *****
1155  * ------------------------------------------------------------------------
      ---- *
1156   
1157  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1158          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2
       - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1159  ;
1160   
1161  con4b_stolev(sto,h)$(ord(h)>1)..
1162          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)
      /(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1163  ;
1164   
1165  con4_stolev(sto,h)..
1166   
1167         + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto)
      )*2  -  STO_L(sto,h)
1168         + STO_L(sto,h-1)$(ord(h)>1)
1169         + phi_sto_ini(sto)*N_STO_E(sto)$(ord(h) = 1)
1170         =E= 0
1171  ;
1172   
1173   
1174  con4c_stolev_max(sto,h)..
1175         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1176  ;
1177   
1178  con4d_maxin_sto(sto,h)..
1179   
1180          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1181  ;
1182   
1183  con4e_maxout_sto(sto,h)..
1184   
1185          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1186  ;
1187   
1188  con4j_ending(sto,h)$(ord(h) = card(h))..
1189   
1190          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1191  ;
1192   
1193   
1194  con4k_PHS_EtoP(sto)..
1195          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1196  ;
1197   
1198  * ------------------------------------------------------------------------
      ---- *
1199  ***** Quotas for renewables and biomass *****
1200  * ------------------------------------------------------------------------
      ---- *
1201   
1202  con5a_minRES..
1203  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1204   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + sum( (res) , G_MARKET_PRO
      2M(res,h) + G_RES_PRO(res,h))
      $ontext
1209  )
1210          - phi_min_res * phi_min_res_exog * sum( h ,
1211           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1212   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1217           )  =G= 0
1218  ;
1219   
1220  *con5b_max_energy(tech)$dis_bio(tech)..
1221  con5b_max_energy(dis)..
1222           m_e(dis) -  sum( h , G_L(dis,h) ) =G= 0
1223  ;
1224   
1225   
1226  * ------------------------------------------------------------------------
      ---- *
1227  ***** Maximum installation constraints *****
1228  * ------------------------------------------------------------------------
      ---- *
1229   
1230  con8a_max_I_power(tech)..
1231         m_p(tech) - N_TECH(tech)     =G= 0
1232  ;
1233   
1234  con8b_max_I_sto_e(sto)..
1235         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1236  ;
1237   
1238  con8c_max_I_sto_p(sto)..
1239         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1240  ;
1241   
1242   
1243   
1244  con8f_max_pro_res(res)..
1245         m_res_pro(res) -  N_RES_PRO(res)     =G= 0
1246  ;
1247   
1248  con8g_max_pro_sto_e(sto)..
1249         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1250  ;
1251   
1252  con8h_max_sto_pro_p(sto)..
1253          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1254  ;
1255   
1256  * ------------------------------------------------------------------------
      ---- *
1257  ***** Prosumage constraints *****
1258  * ------------------------------------------------------------------------
      ---- *
1259   
1260  con11a_pro_distrib(res,h)..
1261           phi_res(res,h) * N_RES_PRO(res)
1262           =E=
1263           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) )
1264  ;
1265   
1266  con11b_pro_balance(h)..
1267           phi_pro_load * d(h)
1268           =E=
1269           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      ) + G_MARKET_M2PRO(h)
1270  ;
1271   
1272  con11c_pro_selfcon..
1273           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1274           =G=
1275           phi_pro_self * sum( h , phi_pro_load * d(h))
1276  ;
1277   
1278  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1279           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1280  ;
1281   
1282   
1283  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1284          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
       + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2
      PRO(sto,h)/(1+eta_sto(sto))*2
1285  ;
1286   
1287   
1288  con11j_pro_stolev_max(sto,h)..
1289         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1290  ;
1291   
1292  con11k_pro_maxin_sto(sto,h)..
1293          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1294          =G= 0
1295  ;
1296   
1297  con11l_pro_maxout_sto(sto,h)..
1298          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1299          =G= 0
1300  ;
1301   
1302  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1303           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1304  ;
1305   
1306  * ------------------------------------------------------------------------
      ---- *
1307  ***** FOC conditions *****
1308  * ------------------------------------------------------------------------
      ---- *
1309   
1310  KKTG_L(tech,h)$dis(tech)..
1311   
1312      c_m(tech) - lambda_enerbal(h) +  lambda_convgen(tech,h)
1313      - lambda_convgen(tech,h+1)$(ord(h) > 1)
1314      + mu_conv_cap(tech,h)
1315      + mu_minRES*phi_min_res*phi_min_res_exog
1316      + mu_bio_cap(tech)$dis_bio(tech)
1317      - mu_minRES$dis_bio(tech)
1318      =G= 0
1319   
1320  ;
1321   
1322  KKTG_UP(dis,h)..
1323   
1324       c_up(dis) - lambda_convgen(dis,h) =G= 0
1325   
1326  ;
1327   
1328  KKTG_DO(dis,h)..
1329   
1330       c_do(dis)
1331       + lambda_convgen(dis,h)$(ord(h) > 1)
1332       =G= 0
1333   
1334  ;
1335   
1336  KKTG_RES(nondis,h)..
1337   
1338       - lambda_enerbal(h) + lambda_resgen(nondis,h)
1339       + mu_minRES*(phi_min_res*phi_min_res_exog - 1)
1340       =G= 0
1341  ;
1342   
1343  KKTCU(nondis,h)..
1344   
1345       c_cu(nondis) + lambda_resgen(nondis,h) =G= 0
1346   
1347  ;
1348   
1349  KKTSTO_IN(sto,h)..
1350   
1351      c_m_sto(sto)  + lambda_enerbal(h) -  lambda_stolev(sto,h)*(1+eta_sto(s
      to))/2
1352      + mu_stoin_cap(sto,h) =G= 0
1353  ;
1354   
1355  KKTSTO_OUT(sto,h)..
1356   
1357       c_m_sto(sto)  -  lambda_enerbal(h) +  lambda_stolev(sto,h)/(1+eta_sto
      (sto))*2
1358       +  mu_stout_cap(sto,h)
1359        =G= 0
1360  ;
1361   
1362  KKTSTO_L(sto,h)..
1363   
1364    + lambda_stolev(sto,h)
1365    +  mu_stolev_cap(sto,h)
1366    -  lambda_stolev(sto,h+1)$(ord(h) > 1 )
1367        =G= 0
1368   
1369  ;
1370   
      KKTN_TECH_NONDIS(nondis)..
       
          c_i(nondis) +  c_fix(nondis)
          - sum( h,  lambda_resgen(nondis,h)*phi_res(nondis,h)) + mu_nondis_max_
      i(nondis)
          =G= 0
      ;
       
      KKTN_TECH_DIS(dis)..
       
           c_i(dis) +  c_fix(dis) - sum( h,  lambda_convgen(dis,h)) +  mu_dis_ma
      x_i(dis)
           =G= 0
       
      ;
1386   
1387  KKTN_TECH(tech)..
1388   
1389            +  c_i(tech)
1390            +  c_fix(tech)
1391            +  mu_tech_max_i(tech)
1392   
1393            - sum( h,  lambda_convgen(tech,h))$dis(tech)
1394            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis(tech)
1395   
1396   
1397       =G= 0
1398   
1399  ;
1400   
1401   
1402   
1403  KKTN_STO_E(sto)..
1404   
1405        + c_fix_sto(sto)/2 +  c_i_sto_e(sto)
1406        - sum( h,   mu_stolev_cap(sto,h)) +  mu_stoe_max_i(sto)
1407        -  phi_sto_ini(sto)*lambda_stolev(sto,'h1')
1408        =G= 0
1409  ;
1410   
1411  KKTN_STO_P(sto)..
1412   
1413   
1414       c_fix_sto(sto)/2 + c_i_sto_p(sto)
1415       - sum( h,   + mu_stoin_cap(sto,h) + mu_stout_cap(sto,h))
1416       + mu_stop_max_i(sto)
1417       =G= 0
1418   
1419  ;
1420   
1421   
1422  **************************************************************************
      ******
1423  ***** MODEL *****
1424  **************************************************************************
      ******
1425   
1426  model DIETER /
1427  obj
1428   
1429  con1a_bal
1430   
1431  *con2a_loadlevel
1432  *con2b_loadlevelstart
1433  con2_loadlevel
1434   
1435  con3a_maxprod_dispatchable
1436   
1437  con3e_maxprod_res
1438   
1439  *con4a_stolev_start
1440  *con4b_stolev
1441  con4_stolev
1442  con4c_stolev_max
1443  con4d_maxin_sto
1444  con4e_maxout_sto
1445  *con4k_PHS_EtoP
1446  con4j_ending
1447   
1448  con5a_minRES
1449  con5b_max_energy
1450   
1451  con8a_max_I_power
1452  con8b_max_I_sto_e
1453  con8c_max_I_sto_p
1454   
1455   
1456   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1472   
1473  /;
1474   
1475  model DIETER_MCP /
1476   
1477   
1478  con1a_bal.lambda_enerbal
1479  con2_loadlevel.lambda_convgen
1480  *con2b_loadlevelstart
1481  con3a_maxprod_dispatchable.mu_conv_cap
1482  con3e_maxprod_res.lambda_resgen
1483  *con4a_stolev_start
1484  con4_stolev.lambda_stolev
1485  con4c_stolev_max.mu_stolev_cap
1486  con4d_maxin_sto.mu_stoin_cap
1487  con4e_maxout_sto.mu_stout_cap
1488  *con4j_ending
1489  con5a_minRES.mu_minRES
1490  con5b_max_energy.mu_bio_cap
1491  con8a_max_I_power.mu_tech_max_i
1492  con8b_max_I_sto_e.mu_stoe_max_i
1493  con8c_max_I_sto_p.mu_stop_max_i
1494   
1495  KKTG_L.G_L
1496  KKTG_UP.G_UP
1497  KKTG_DO.G_DO
1498  KKTG_RES.G_RES
1499  KKTCU.CU
1500  KKTSTO_IN.STO_IN
1501  KKTSTO_OUT.STO_OUT
1502  KKTSTO_L.STO_L
1503  KKTN_TECH.N_TECH
1504  KKTN_STO_E.N_STO_E
1505  KKTN_STO_P.N_STO_P
1506   
1507  /
1508  ;
1509   
1510   
1511  **************************************************************************
      ******
1512  ***** Options, fixings, report preparation *****
1513  **************************************************************************
      ******
1514   
1515  * Solver options
1521   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1532   
1533  dieter.OptFile = 1;
1534  dieter.holdFixed = 1 ;
1535   
1536   
1537  **************************************************************************
      ******
1538  ***** Solve *****
1539  **************************************************************************
      ******
1540   
1541  * Preparation of GUSS tool for scenario analysis
1542  phi_min_res = eps ;
1543  phi_pro_self = eps ;
1544   
1546   
1547  Set
1548  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1549  superscen        Scenarios                               /scen1*scen1000/
1550  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1551  ;
1552   
1553  set
1554  scen(superscen);
1555  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1556   
1557  Parameters
1558  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1559  modstats(superscen, modelstats)
1560  min_res
1561  pro_selfcon
1562  ;
1563   
1564  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_res_share.val/100 ) ;
1565  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1566   
1567  Parameters
1568  * Equations
1569  marginal_con5a(superscen)
1570  marginal_con1a(superscen,*)
1571  marginal_con9a(superscen,*,*,*)
1572  marginal_con9b(superscen,*,*,*)
1573   
1574  * Basic
1575  lev_Z(superscen)
1576  lev_G_L(superscen,tech,h)
1577  lev_G_UP(superscen,tech,h)
1578  lev_G_DO(superscen,tech,h)
1579  lev_G_RES(superscen,tech,h)
1580  lev_CU(superscen,tech,h)
1581  lev_STO_IN(superscen,sto,h)
1582  lev_STO_OUT(superscen,sto,h)
1583  lev_STO_L(superscen,sto,h)
1584  lev_N_TECH(superscen,tech)
1585  lev_N_STO_E(superscen,sto)
1586  lev_N_STO_P(superscen,sto)
1587   
1588   
1589  * Prosumage
1590  lev_CU_PRO(superscen,tech,h)
1591  lev_G_MARKET_PRO2M(superscen,tech,h)
1592  lev_G_MARKET_M2PRO(superscen,h)
1593  lev_G_RES_PRO(superscen,tech,h)
1594  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1595  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1596  lev_STO_IN_M2PRO(superscen,sto,h)
1597  lev_STO_IN_M2M(superscen,sto,h)
1598  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1599  lev_STO_OUT_PRO2M(superscen,sto,h)
1600  lev_STO_OUT_M2PRO(superscen,sto,h)
1601  lev_STO_OUT_M2M(superscen,sto,h)
1602  lev_STO_L_PRO2PRO(superscen,sto,h)
1603  lev_STO_L_PRO2M(superscen,sto,h)
1604  lev_STO_L_M2PRO(superscen,sto,h)
1605  lev_STO_L_M2M(superscen,sto,h)
1606  lev_N_STO_E_PRO(superscen,sto)
1607  lev_N_STO_P_PRO(superscen,sto)
1608  lev_STO_L_PRO(superscen,sto,h)
1609  lev_N_RES_PRO(superscen,tech)
1610  ;
1611   
1612   
1613  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\fix.gms
1615   
1616  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1626  **************************************************************************
      ******
1627   
1628   
1629   
1630  **************************************************************************
      ******
1631  **** Run of river  *******************************************************
      ******
1632  **************************************************************************
      ******
1633   
1634  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1635   
1636  *$ontext
1637  N_TECH.fx('ror') = 5857.47 ;
1638  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1641   
1642  * Fix everything to zero in case no ROR option is selected:
1643  *N_TECH.fx('ror') = 0 ;
1644  *G_RES.fx('ror',h) = 0 ;
1645  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1646   
1647   
1648  **************************************************************************
      ******
1649  **** No storage and DSM in first period  *********************************
      ******
1650  **************************************************************************
      ******
1651   
1652  ** No storage inflow in first period **
1653  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1654   
1655   
1656   
1657  **************************************************************************
      ******
1658  **** No primary reserves by heating devices  *****************************
      ******
1659  **************************************************************************
      ******
1660   
1661   
1662  **************************************************************************
      ******
1663  **** Fixing to reduce model size  ****************************************
      ******
1664  **************************************************************************
      ******
1665   
1666  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1667  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1668   
1669  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1670  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1671  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1672  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1673  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1674  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1675   
1676  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1677  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1678  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1679  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1680  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1681   
1682   
1683  Variables
1684  STO_IN_PRO2M(tech,sto,h)
1685  STO_IN_M2PRO(sto,h)
1686  STO_IN_M2M(sto,h)
1687  STO_OUT_PRO2M(sto,h)
1688  STO_OUT_M2PRO(sto,h)
1689  STO_OUT_M2M(sto,h)
1690  STO_L_PRO(sto,h)
1691  STO_L_PRO2M(sto,h)
1692  STO_L_M2PRO(sto,h)
1693  STO_L_M2M(sto,h)
1694  ;
1695   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1719   
1720  * Deactivated market storage links
1721   
1722  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1723  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1724  STO_IN_M2M.fx(sto,h)       = 0 ;
1725  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1726  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1727  STO_OUT_M2M.fx(sto,h)      = 0 ;
1728  STO_L_PRO.fx(sto,h)        = 0 ;
1729  STO_L_PRO2M.fx(sto,h)      = 0 ;
1730  STO_L_M2PRO.fx(sto,h)      = 0 ;
1731  STO_L_M2M.fx(sto,h)        = 0 ;
1732   
1733  **************************************************************************
      ******
1734  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1735  **************************************************************************
      ******
1736   
1737  * Default level zero for report parameters
1738  lev_Z(scen) = 0 ;
1739  lev_G_L(scen,tech,h) = 0 ;
1740  lev_G_UP(scen,tech,h) = 0 ;
1741  lev_G_DO(scen,tech,h) = 0 ;
1742  lev_G_RES(scen,tech,h) = 0 ;
1743  lev_CU(scen,tech,h) = 0 ;
1744  lev_STO_IN(scen,sto,h) = 0 ;
1745  lev_STO_OUT(scen,sto,h) = 0 ;
1746  lev_STO_L(scen,sto,h) = 0 ;
1747  lev_N_TECH(scen,tech) = 0 ;
1748  lev_N_STO_E(scen,sto) = 0 ;
1749  lev_N_STO_P(scen,sto) = 0 ;
1750  marginal_con1a(scen,h) = 0 ;
1751  marginal_con5a(superscen) = 0 ;
1752   
1753  * Prosumage
1754  lev_CU_PRO(scen,tech,h) = 0 ;
1755  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1756  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1757  lev_G_RES_PRO(scen,tech,h) = 0  ;
1758  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1759  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1760  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1761  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1762  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1763  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1764  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1765  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1766  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1767  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1768  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1769  lev_STO_L_M2M(scen,sto,h) = 0  ;
1770  lev_N_STO_E_PRO(scen,sto) = 0  ;
1771  lev_N_STO_P_PRO(scen,sto) = 0  ;
1772  lev_STO_L_PRO(scen,sto,h) = 0  ;
1773  lev_N_RES_PRO(scen,tech) = 0  ;
1774   
1775   
1776  * Fixing of report parameters for run-of-river
1777  *$ontext
1778  lev_N_TECH(scen,'ror') = 5857.47 ;
1779  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1789   
1790   
1791   
1792   
1793   
1794   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\scenario.gms
1796   
1797  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1807  **************************************************************************
      ******
1808   
1809   
1810   
1811   
1812  *****************************************
1813  **** Scenario file                   ****
1814  ****                                 ****
1815  *****************************************
1816   
1817  Parameter
1818  m_exog_p(tech)
1819  m_exog_sto_e(sto)
1820  m_exog_sto_p(sto)
1821  *m_exog_rsvr_p(rsvr)
1822  *m_exog_ntc(l)
1823  ;
1824   
1825  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1826  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1827  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1828  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1829  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1830   
1831   
1832  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1849   
1850  *** Investment model
1851  *$ontext
1852  N_TECH.lo(tech) = 0 ;
1853  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1854  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1855  N_TECH.lo('pv') = m_exog_p('pv') ;
1856  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1857  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1858  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1859  *NTC.lo(l) = m_exog_ntc(l) ;
1860   
1861  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1862  N_TECH.up('wind_on') = inf ;
1863  N_TECH.up('wind_off') = inf ;
1864  N_TECH.up('pv') = inf ;
1865  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1866  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1867  N_STO_P.up('sto1') = inf ;
1868  N_STO_P.up('sto5') = inf ;
1869  N_STO_P.up('sto7') = inf ;
1870  N_STO_E.up('sto1') = inf ;
1871  N_STO_E.up('sto5') = inf ;
1872  N_STO_E.up('sto7') = inf ;
1873  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1874  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1875  *$offtext
1876   
1877   
1878  *** Reservoir assumption - not used here
1879  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1880  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1881  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1882  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1883   
1884   
1885  *** Germany only, no infeasibility
1886  *NTC.fx(l) = 0 ;
1887  *F.fx(l,h) = 0 ;
1888  *G_INFES.fx(h) = 0 ;
1889   
1890   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1921   
1922   
1923  * Definition of dictionary set for GUSS tool
1924   
1925  Set dict(*,*,*) /
1926  scen             .scenario       .''
1927  gussoptions      .opt            .modstats
1928   
1929  phi_min_res      .param          .min_res
1930   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1935   
1936   
1937  con5a_minRES     .marginal       .marginal_con5a
1938  con1a_bal        .marginal       .marginal_con1a
1939   
1940   
1941  *$ontext
1942  Z                .level          .lev_Z
1945  G_L              .level          .lev_G_L
1946  G_UP             .level          .lev_G_UP
1947  G_DO             .level          .lev_G_DO
1948  G_RES            .level          .lev_G_RES
1949  CU               .level          .lev_CU
1950  STO_IN           .level          .lev_STO_IN
1951  STO_OUT          .level          .lev_STO_OUT
1952  STO_L            .level          .lev_STO_L
1953  N_TECH           .level          .lev_N_TECH
1954  N_STO_E          .level          .lev_N_STO_E
1955  N_STO_P          .level          .lev_N_STO_P
1956   
1957   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1971  /
1972  ;
1973   
1974   
1975   
1976  *$ontext
1977  solve  DIETER using lp min Z scenario dict;
1980   
      solve   DIETER_MCP using mcp scenario dict;
      $ontext
1985   
1986   
1987  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\report.gms
1989   
1990  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
2000  **************************************************************************
      ******
2001   
2003   
2004   
2005   
2006   
2007  **************************************************************************
      ******
2008  **** Parameters for report file  *****************************************
      ******
2009  **************************************************************************
      ******
2010   
2011  Parameter
2012  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
2013  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
2014  corr_fac_sto             Balancing correction factor - storage technologie
      s
2015  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
2016  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
2017  corr_fac_ev              Balancing correction factor - electric vehicles
2018  corr_fac_rsvr            Balancing correction factor - reservoir
2019  corr_fac_sets            Balancing correction factor - SETS
2020  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2021  corr_fac_hp              Balancing correction factor - heat pumps
2022  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
2023   
2024  corr_fac_ev_sep
2025   
2026  gross_energy_demand                      Gross energy demand
2027  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
2028  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2029  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
2030  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
2031   
2032  reserves_activated
2033   
2034  calc_maxprice
2035  calc_minprice
2036   
2037  report
2038  report_tech
2039  report_tech_hours
2040  report_hours
2041  report_node
2042  report_line
2043  report_cost
2044   
2045  report_reserves
2046  report_reserves_hours
2047  report_reserves_tech
2048  report_reserves_tech_hours
2049   
2050  report_prosumage
2051  report_prosumage_tech
2052  report_prosumage_tech_hours
2053  report_market
2054  report_market_tech
2055  report_market_tech_hours
2056   
2057  report_heat_tech_hours
2058  report_heat_tech
2059  ;
2060   
2061   
2062   
2063   
2064  **************************************************************************
      ******
2065  **** Initialize reporting paremetrs  *************************************
      ******
2066  **************************************************************************
      ******
2067   
2068  * Set reporting sensitivity. All results below will be reported as zero
2069  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
2070  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
2071  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
2072   
2073   
2074  * ------------------------------------------------------------------------
      ----
2075   
2076  * Min and max for prices
2077  calc_maxprice = 0 ;
2078  calc_minprice = 1000 ;
2079   
2080   
2081  * ------------------------------------------------------------------------
      ----
2082   
2083  * Default values for correction factors
2084  corr_fac_dis(scen,dis,h) = 0 ;
2085  corr_fac_nondis(scen,nondis,h) = 0 ;
2086  corr_fac_sto(scen,sto,h) = 0 ;
2087  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2088  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2089  *corr_fac_ev(scen,h) = 0 ;
2090  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2091  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2092  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2093  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2094  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2095   
2096  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2097   
2098   
2099  * ------------------------------------------------------------------------
      ----
2100   
2101  * Parameter for hourly nodal reserves activated
2102  reserves_activated(scen,h) = 0 ;
2103   
2104   
2105   
2106   
2107   
2108  * ------------------------------------------------------------------------
      ----
2109   
2110  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2117   
2118   
2119  * ------------------------------------------------------------------------
      ----
2120   
2121  *Determine balancing correction factors
2122   
2123   
2124   
2125   
2126  * ------------------------------------------------------------------------
      ----
2127   
2128  * Define gross energy demand for reporting
2129  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2134   
2135   
2136  )
2137  ;
2138   
2139   
2140  **************************************************************************
      ******
2141  **** Report  *************************************************************
      ******
2142  **************************************************************************
      ******
2143   
2144  * RPEORT model statistics
2145          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2146          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2147          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2148   
2149   
2150  * ------------------------------------------------------------------------
      ----
2151   
2152  * REPORT HOURS
2153          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
2154          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
2155  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2156  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2157  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2158  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2159  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2160  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
2161  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
2162          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2163   
2164                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
2165                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
2166  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2167  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2168                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2169                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2170  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
2171   
2172   
2173  * ------------------------------------------------------------------------
      ----
2174   
2175  * REPORT TECH HOURS
2176          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2177  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
2178          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2179  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
2180  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2181  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
2182          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2183          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2184          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
2185          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2186  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
2187   
2188                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2189                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2190  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2191                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2192                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2193                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
2194                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
2195  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
2196  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
2197  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2198  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2199   
2200   
2201  * ------------------------------------------------------------------------
      ----
2202   
2203  * RPEORT LINE
2204   
2205  * ------------------------------------------------------------------------
      ----
2206   
2207  * REPORT NODE
2208          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2209   
2210  ;
2211          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
2212          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
2213  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2214           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2215          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
2216  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2217           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2218  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2219  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2220  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2221  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2222  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2223  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2224  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2225  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2226  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2227  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2228          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2229  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2230   
2231  ;
2232          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2233          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2234          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2235          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2236          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2237          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2238          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2239   
2240                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2241                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2242                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2243                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2244                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2245                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2246  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2247  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2248  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_
      abs*card(h)) = 0 ;
2249                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2250                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2251                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2252  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2253  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2254                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2255  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2256  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2257   
2258   
2259  * ------------------------------------------------------------------------
      ----
2260   
2261  * REPORT COST
2262          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2263   
2264  ));
2265           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2266  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2267   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2272  );
2273   
2274  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2275  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2276  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2277           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2278  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2279  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2280  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      )
2281   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2293   
2294  * ------------------------------------------------------------------------
      ----
2295   
2296  * REPORT TECH
2297          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2298          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2299  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2300  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2301          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2302          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2303   
2304          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2305          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2306  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2307          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2308          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2309   
2310          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2311  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2312          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2313          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2314  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2315          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2316   
2317          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2318          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2319   
2320          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2321          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2322   
2323          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2324          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2325  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2326          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2327   
2328   
2329                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2330                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2331                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2332                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2333  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2334  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2335                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2336  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2337                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2338                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2339  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2340                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2341                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2342                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2343                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2344                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2345  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2346                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2347                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2348                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2349  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2350                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2351                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2352                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2353   
2354   
2355  * ------------------------------------------------------------------------
      ----
2356   
2357  * REPORT NODE
2358          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2359  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr))
2360           ;
2361          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2362  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2363          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2364  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr))
2365           ;
2366          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2367   
2368                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2369                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2370                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2371                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2372   
2373   
2374   
2375  * ------------------------------------------------------------------------
      ----
2376   
2377  * REPORT TECH
2378          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2379          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2380  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2381          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2382   
2383          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2384          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2385  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2386          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2387          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2388          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(s
      cen,sto) ) * 1 ;
2389   
2390                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2391                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2392  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2393                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2394   
2395                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2396                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2397  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2398                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2399                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2400                   report_tech('Storage cycles',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
2401   
2402   
2403  * ------------------------------------------------------------------------
      ----
2404   
2405  * RPEORT
2406          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2407          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2408          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2409          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2410          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2411          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2412          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2413          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2414          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2415  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2416          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2417  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2418           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2419          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2420          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2421   
2422                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2423                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2424                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2425                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2426                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2427                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2428                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2429                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2430                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2431   
2432   
2433  * ------------------------------------------------------------------------
      ----
2434   
2435  * DSM
2436   
2437   
2438  * ------------------------------------------------------------------------
      ----
2439   
2440  * EV
2441   
2442   
2443   
2444  * ------------------------------------------------------------------------
      ----
2445   
2446  * Reserves
2447   
2448   
2449   
2450   
2451  * ------------------------------------------------------------------------
      ----
2452   
2453  * Reserves and DSM
2454   
2455   
2456  * ------------------------------------------------------------------------
      ----
2457   
2458  * ------------------------------------------------------------------------
      ----
2459   
2460  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 
      - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )
        ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage load
      ing prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage
       generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage ge
      neration prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers P
      RO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage
       out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pro
      sumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosum
      age,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res
      _share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawa
      l prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(s
      cen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) )
      ;
              report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loo
      p_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour%
       ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_re
      p_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E
      _PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_shar
      e,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_sha
      re,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( sum
      (h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,r
      es,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac
      _dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec
      _hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) *
       %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( s
      cen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosum
      ers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(sce
      n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (r
      es,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
              report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
              report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
              report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (
      sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )
      ) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr
      ,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fa
      c_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,
      h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_pr
      osumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share
      ,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1
      e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* %
      sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation
      ',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated
       gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_
      rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_sh
      are,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',l
      oop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
                       report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
                       report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
      *                 report_market_tech('capacities reservoir MW market',loop
      _res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir 
      MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
      *                 report_market_tech('capacities reservoir MWh market',loo
      p_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir
       MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
                       report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
                       report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
                       report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
                       report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_shar
      e,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy 
      share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr
      )< eps_rep_rel) = 0 ;
      $ontext
2732   
2733   
2734  * ------------------------------------------------------------------------
      ----
2735   
2736  * PROSUMAGE & DSM
2737   
2738   
2739   
2740  * ------------------------------------------------------------------------
      ----
2741   
2742   
2743   
2744  * ------------------------------------------------------------------------
      ----
2745   
2746  * HEAT
2747   
2748  * ------------------------------------------------------------------------
      ----
2749   
2750  * Reserves and heat
2751   
2752   
2753  * ------------------------------------------------------------------------
      ---- *
2754  * ------------------------------------------------------------------------
      ---- *
2755  * ------------------------------------------------------------------------
      ---- *
2756   
2757   
2758  execute_unload "results", report, report_tech, report_node,
2759  *report_line,
2760  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
      $ontext
2765  ;
2766   
2767   
      $include report_to_excel.gms
      $ontext
2772   
2773   
2774   
2775  * ------------------------------------------------------------------------
      ---- *
2776  * ------------------------------------------------------------------------
      ---- *
2777  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/23/18 09:28:04 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          Modified_MCP\DIETER.gms
     2      127 INCLUDE        1     127  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\dataload.gms
     3      534 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      536 GDXIN          2     409  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\Data_input.gdx
     5      588 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      589 GDXIN          2     462  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\time_series.gdx
     7      929 INCLUDE        1     162  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\model.gms
     8     1614 INCLUDE        1     267  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\fix.gms
     9     1795 INCLUDE        1     268  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\scenario.gms
    10     1988 INCLUDE        1     336  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\Modified_MCP\report.gms


COMPILATION TIME     =       27.906 SECONDS      6 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/23/18 09:28:04 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1977


MODEL STATISTICS

BLOCKS OF EQUATIONS          15     SINGLE EQUATIONS      385,486
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      324,145  5 projected
NON ZERO ELEMENTS     1,362,738     NON LINEAR N-Z         87,601
DERIVATIVE POOL              20     CONSTANT POOL              17
CODE LENGTH             122,646


GENERATION TIME      =       74.609 SECONDS    208 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =       74.875 SECONDS    208 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/23/18 09:28:04 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1977


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1977

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT        146.984  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.53 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 40.25sec (det. 17575.27 ticks)
Optimal solution found.
Objective : 33544542852.728615

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544542852.7286
---   Resource Usage   40875
---   Total Time (ms)  41000

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.53 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 53.56sec (det. 17598.40 ticks)
Optimal solution found.
Objective : 33544542852.728615

--- Scenario scen2:     Records read:    1
--- Solution statistics for scenario scen2
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544542852.7286
---   Resource Usage   54156
---   Total Time (ms)  54282

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosu
                                  mage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage
                                      _Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 21.53 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 51.55sec (det. 31190.19 ticks)
Optimal solution found.
Objective : 40093174100.503754

--- Scenario scen3:     Records read:    1
--- Solution statistics for scenario scen3
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  40093174100.5038
---   Resource Usage   52156
---   Total Time (ms)  52281

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 11/23/18 09:28:04 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        3.531 SECONDS    139 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\Modified_MCP\DIETER.lst
