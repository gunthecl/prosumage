GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:28:06 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  ********************************************************************************
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20  ***** Set star to activate options
  21   
  22  * Set star to skip Excel upload and load data from gdx
  24   
  25   
  26  * Choose base year
  28   
  29  * Germany only - also adjust Excel inputs!
  31   
  32  * Dispatch only - used fixed capacities (also deactivates bio energy restriction)
  34   
  35  * Select if you want to use load change costs
  37   
  39   
  40  * Set star to select run-of-river options either as exogenous parameter or as endogenous variable including reserve provision:
  41  * if nothing is selected, ROR capacity will be set to zero
  42  * if parameter option is selected, set appropriate values in fix.gmx
  43  * if variable option is selected, set appropriate bound in data_input excel
  45   
  46  * Set star for no crossover to speed up calculation time by skipping crossover in LP solver
  48   
  49  * Set star for reporting to Excel
  51   
  52   
  53  * ----------------- Select if to use MCP or LP format --------------------------
  54   
  55  * Set to "*" to select linear program, leave blank to select MCP
  57   
  58   
  59  ********************************************************************************
  60   
  61  * Definition of strings for report parameters and sanity checks
  62  * (Do not change settings below)
  64   
  65  * Sanity checks
  67   
  68  * Do not change these  lines
  71   
  74   
  75   
  76  ********************************************************************************
  77   
  78   
  79  **************************
  80  ***** SOLVER OPTIONS *****
  81  **************************
  82   
  83  options
  84  optcr = 0.00
  85  reslim = 10000000
  86  lp = cplex
  87  mip = cplex
  88  nlp = conopt
  89  limrow = 0
  90  limcol = 0
  91  ;
  92   
  93  options
  94  dispwidth = 15
  95  limrow = 0
  96  limcol = 0
  97  solprint = off
  98  sysout = off
  99  ;
 100   
 101   
 102   
 103   
 104  ********************************************************************************
 105   
 106  **************************
 107  ***** Dataload *****
 108  **************************
 109   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\dataload.gms
 111   
 112  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 122  ********************************************************************************
 123   
 124   
 125   
 126   
 127  ***************  SETS  *********************************************************
 128   
 129  ***** Sets used in the model *****
 130  Sets
 131  tech                     Generation technologies
 132   dis(tech)               Dispatchable generation technologies
 133   nondis(tech)            Nondispatchable generation technologies
 134   con(tech)               Conventional generation technologies
 135   res(tech)               Renewable generation technologies
 136  sto                      Storage technologies
 137  rsvr                     Reservoir technologies
 138  dsm                      DSM technologies
 139   dsm_shift(dsm)          DSM load shifting technologies
 140   dsm_curt(dsm)           DSM load curtailment technologies
 141  year                     Base year for temporal data
 142  h                        Hours
 143  n                        Nodes
 144  l                        Lines
 145  ev                       EV types
 146  reserves                         Reserve qualities
 147   reserves_up(reserves)           Positive reserves
 148   reserves_do(reserves)           Negative reserves
 149   reserves_spin(reserves)         Spinning reserves
 150   reserves_nonspin(reserves)      Nonspinning reserves
 151   reserves_prim(reserves)         Primary reserves
 152   reserves_nonprim(reserves)      Nonprimary reserves
 153   reserves_prim_up(reserves)      Primary positive reserves
 154   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 155   reserves_prim_do(reserves)      Primary negative reserves
 156   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 157  bu                       Building archtypes
 158  ch                       Heating combination type
 159   hst(ch)                 Heating technology that feeds to storage
 160   hp(ch)                  Heat pump technologies
 161   hel(ch)                 Hybrid electric heating technologies - electric part
 162   hfo(ch)                 Hybrid electric heating technologies - fossil part
 163   
 164   
 165  ***** Sets used for data upload *****
 166  headers_tech                     Generation technologies - upload headers
 167   tech_dispatch                   Generation technologies - dispatchable or nondispatchable
 168   tech_res_con                    Generation technologies - renewable or "conventional"
 169  headers_sto                      Storage technologies - upload headers
 170  headers_reservoir                Reservoir technologies - upload headers
 171  headers_dsm                      DSM technologies - upload headers
 172   dsm_type                        DSM technologies - shifting or curtailment
 173  headers_time                     Temporal data - upload headers
 174  headers_topology                 Spatial data - upload headers
 175  headers_ev                       EV data - upload headers
 176  headers_time_ev                  EV temporal data - upload headers
 177  headers_prosumage_generation     Prosumage generation data - upload headers
 178  headers_prosumage_storage        Prosumage storage data - upload headers
 179  headers_reserves                 Reserve data - upload headers
 180   reserves_up_down                Reserve data - positive and neagtive reserves
 181   reserves_spin_nonspin           Reserve data - spinning and nonspinning reserves
 182   reserves_prim_nonprim           Reserve data - primary and nonprimary reserves
 183  headers_heat                     Heat data - upload headers
 184   heat_storage                    Heat data - storage technologies
 185   heat_hp                         Heat data - heat pump technologies
 186   heat_elec                       Heat data - hybrid heating technologies - electric part
 187   heat_fossil                     Heat data - hybrid heating technologies - fossil part
 188  headers_time_heat                Heat data - upload headers time data
 189  headers_time_dhw                 Heat data - upload headers time data on DHW
 190  ;
 191   
 192   
 193   
 194   
 195  ***************  PARAMETERS  ***************************************************
 196   
 197  Parameters
 198   
 199  ***** Generation technologies *****
 200  *--- Variable and fixed costs ---*
 201  eta              Efficiency of conventional technologies [0 1]
 202  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 203  c_up             Load change costs UP [EUR per MWh]
 204  c_do             Load change costs DOWN [EUR per MWh]
 205  c_fix            Annual fixed costs [EUR per MW per year]
 206  c_vom            Variable O&M costs [EUR per MWh]
 207  CO2price         CO2 price in [EUR per ton]
 208   
 209  *--- Investment ---*
 210  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 211  lifetime         Investment costs: technical lifetime [a]
 212  recovery         Investment costs: Recovery period according to depreciation tables [a]
 213  interest_rate    Investment costs: Interest rate [%]
 214  m_p              Investment: maximum installable capacity per technology [MW]
 215  m_e              Investment: maximum installable energy [TWh per a]
 216   
 217  *--- Flexibility ---*
 218  grad_per_min     Maximum load change relative to installed capacity [% of installed capacity per minute]
 219   
 220   
 221  ***** Fuel and CO2 costs *****
 222  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 223   
 224   
 225  ***** Renewables *****
 226  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 227  phi_min_res      Minimum renewables share [0 1]
 228   
 229   
 230  ***** Storage *****
 231  *--- Variable and fixed costs ---*
 232  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 233  eta_sto          Storage efficiency [0 1]
 234  phi_sto_ini      Initial storage level [0 1]
 235  etop_max         Maximum E to P ratio of storage types [#]
 236  c_fix_sto        Annual fixed costs [EUR per MW]
 237   
 238  *--- Investment ---*
 239  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight [EUR per MWh]
 240  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnight [EUR per MW]
 241  m_sto_e                     Investment into storage: maximum installable energy [MWh]
 242  m_sto_p                     Investment into storage: maximum installable power [MW]
 243   
 244   
 245  ***** Reservoir*****
 246  *--- Variable and fixed costs ---*
 247  c_m_rsvr                 Marginal costs of generating energy from reservoir [EUR per MWh]
 248  eta_rsvr                 Generation efficiency [0 1]
 249  phi_rsvr_ini             Initial reservoir level [0 1]
 250  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 251  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of annual energy [0 1]
 252  phi_rsvr_lev_min         Minimum filling level [0 1]
 253   
 254  *--- Investment ---*
 255  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight [EUR per MWh]
 256  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnight [EUR per MW]
 257  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetime [a]
 258  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 259  m_rsvr_e                 Investment into reservoir: maximum installable energy [MWh]
 260  m_rsvr_p                 Investment into reservoir: maximum installable capacity [MW]
 261   
 262   
 263  ***** DSM *****
 264  *--- Variable and fixed costs ---*
 265  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 266  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 267  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW per a]
 268  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per a]
 269   
 270  *--- Flexibility, efficiency, recovery ---*
 271  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 272  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment instances [h]
 273   
 274  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 275  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upshift instances [h]
 276  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 277   
 278  *--- Investment ---*
 279  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment: Overnight [EUR per MW]
 280  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: Overnight [EUR per MW]
 281  inv_recovery_dsm_cu              Investment costs for DSM load curtailment: Recovery period [a]
 282  inv_recovery_dsm_shift           Investment costs for DSM load shifting: Recovery period [a]
 283  inv_interest_dsm_cu              Investment costs for DSM load curtailment: Interest rate [%]
 284  inv_interest_dsm_shift           Investment costs for DSM load shifting: Interest rate [%]
 285  m_dsm_cu                         DSM: Maximum installable capacity load curtailment [MW]
 286  m_dsm_shift                      DSM: Maximum installable capacity load shifting [MW]
 287   
 288   
 289  ***** Time Data *****
 290  d_y                      Demand hour h for different years [MWh]
 291  d                        Demand hour h [MWh]
 292  phi_res_y                Renewables availability technology res in hour h for different years [0 1]
 293  phi_res                  Renewables availability technology res in hour h [0 1]
 294  phi_ror_y                Run-of-river availability technology ror in hour h for different years [0 1]
 295  phi_ror                  Run-of-river availability technology ror in hour h [0 1]
 296  rsvr_in_y                Reservoir inflow in hour h for different years [0 1]
 297  rsvr_in                  Reservoir inflow in hour h [0 1]
 298  n_ev_p_upload            Power rating of the charging connection in hour h [MW - 0 when car is in use or parked without grid connection]
 299  ev_ed_upload             Electricity demand for mobility vehicle profile ev in hour h [MW]
 300  ev_ged_exog_upload       Electricity demand for mobility in case of uncontrolled charging vehicle profile ev in hour h [MW]
 301  phi_reserves_call_y      Hourly share of reserve provision that is actually activated for different years [0 1]
 302  phi_reserves_call        Hourly share of reserve provision that is actually activated [0 1]
 303  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 304  reserves_exogenous       Hourly reserve provision [MW]
 305   
 306  ***** Transmission *****
 307  *--- Investment ---*
 308  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 309  c_fix_ntc                 Fixed costs [EUR per MW per a]
 310  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 311  inv_recovery_ntc          Investment costs: Recovery period in [a]
 312  inv_interest_ntc          Investment costs: Interest rate [%]
 313  m_ntc                     Investment into NTC: maximum installable capacity [MW]
 314   
 315  *--- Topology and distance ---*
 316  inc              Incidence index of link l on node n
 317  dist             Distance covered by link l [km]
 318   
 319   
 320  ***** Electric vehicles *****
 321  *--- Costs and attributes ---*
 322  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 323  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh]
 324  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 325  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 326  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 327   
 328  n_ev_e           Electric vehicle battery capacity [MWh]
 329  ev_quant         Overall number of electirc vehicles [#]
 330  phi_ev           Share of electric vehicles per load profile in actual scenario [0 1]
 331  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if yes 0 otherwise]
 332   
 333  *--- Temporal data ---*
 334  n_ev_p           Electric vehicle power rating [MWh]
 335  ev_ed            Electric vehicle electricity demand [MWh]
 336  ev_ged_exog      Electric vehicle grid electricity demand for exogenous charging pattern [MWh]
 337   
 338   
 339  ***** Prosumage *****
 340  phi_pro_load             Share of prosumagers among total load [0 1]
 341  phi_pro_self             Minimum self-generation shares for prosumagers [0 1]
 342  m_res_pro                Maximum installable: renewables capacity [MW]
 343  m_sto_pro_e              Maximum installable: storage energy [MWh]
 344  m_sto_pro_p              Maximum installable: storage capacity [MW]
 345  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 346   
 347   
 348  ***** Reserves *****
 349  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 350  reserves_intercept       Intercept of regression line determining reserves demand
 351  reserves_slope           Slope of regression line determining reserves demand
 352  reserves_reaction        Activation reaction time for reserves qualities [min]
 353  phi_reserves_pr_up       Positive primary reserves fraction of total nonprimary reserves demand [0 1]
 354  phi_reserves_pr_do       Negative primary reserves fraction of total nonprimary reserves demand [0 1]
 355  *reserves_exog
 356   
 357   
 358  ***** Heat *****
 359  *--- Time data ---*
 360  dh_upload                Hourly heat demand per year for upload [MWh per m2]
 361  dh_y                     Hourly heat demand per year [MWh per m2]
 362  dh                       Hourly heat demand [MWh per m2]
 363  temp_source              Heat pumps - source temperature [°Celsius]
 364  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2]
 365  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 366  d_dhw                    Hourly DHW demand [MWh per m2]
 367  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-time storage heaters [MWh per m2]
 368   
 369  *--- Technololgy attributes ---*
 370  phi_heat_type            Share of heating type ch per building archetype bu [0 1]
 371  eta_heat_stat            Static efficiency for heating technologies [0 1]
 372  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 373  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies [0 1]
 374  n_heat_p_in              Maximum power inflow into heating technologies [MW]
 375  n_heat_p_out             Maximum power outflow from heating technologies [MW]
 376  n_heat_e                 Maximum energy level of heating storage technologies [MWh]
 377  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 378  n_sets_p_out             SETS - Power rating - heat output [MW]
 379  n_sets_e                 SETS - Energy storage capacity [MWh]
 380  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electricity intake [MW]
 381  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW output [MW]
 382  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capacity [MWh]
 383  phi_heat_ini             Inititial storage level of heating technologies [0 1]
 384  temp_sink                Heat pumps - sink temperature [°Celsius]
 385  pen_heat_fuel            Penalty term for non-electric fuel usage for hybrid heating technologies [EUR per MWh]
 386  area_floor               Floor area subject to specific heating technology in specific building type [m2]
 387  theta_night              Indicator for night hours {0 1}
 388   
 389   
 390   
 391  ***************  DERIVED PARAMETERS  *******************************************
 392   
 393  c_m              Marginal production costs for conventional plants including variable O and M costs [EUR per MWh]
 394  c_i              Annualized investment costs by conventioanl plant [EUR per MW]
 395   
 396  c_i_res          Annualized investment costs by renewable plant [EUR per MW]
 397  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per a]
 398   
 399  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 400  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 401   
 402  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 403  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 404   
 405  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR per MW]
 406  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per MW]
 407   
 408  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 409   
 410  phi_mean_reserves_call_y         Hourly mean of share reserves called per year [0 1]
 411  phi_mean_reserves_call           Hourly mean of share reserves called [0 1]
 412   
 413  theta_dir        Dummy equal to 1 if building type bu has direct heating type ch [0 1]
 414  theta_sets       Dummy equal to 1 if building type bu has SETS heating type ch [0 1]
 415  theta_hp         Dummy equal to 1 if building type bu has heat pump heating type ch [0 1]
 416  theta_elec       Dummy equal to 1 if building type bu has hybrif electric heating - electric part [0 1]
 417  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric heating - fossil part [0 1]
 418  theta_storage    Dummy equal to 1 if building type ch has storage heating type ch [0 1]
 419   
 420   
 421   
 422   
 423  ***************  PARAMETERS FOR DATA UPLOAD  ***********************************
 424   
 425  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 426  technology_data(tech,headers_tech)
 427  storage_data(sto,headers_sto)
 428  reservoir_data(rsvr,headers_reservoir)
 429  time_data_upload(h,year,headers_time)
 430  dsm_data_upload(dsm,dsm_type,headers_dsm)
 431  dsm_data(dsm,headers_dsm)
 432  topology_data(l,headers_topology)
 433  ev_data(ev,headers_ev)
 434  ev_time_data_upload(h,headers_time_ev,ev)
 435  prosumage_data_generation(tech,headers_prosumage_generation)
 436  prosumage_data_storage(sto,headers_prosumage_storage)
 437  reserves_time_data_activation(h,year,reserves)
 438  reserves_time_data_provision(h,year,reserves)
 439  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)
 440  reserves_data(reserves,headers_reserves)
 441  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)
 442  heat_data(bu,ch,headers_heat)
 443  dh_upload(h,year,headers_time_heat,bu)
 444  d_dhw_upload(h,year,headers_time_heat,bu)
 445  temp_source_upload
 446  ;
 447   
 448   
 449   
 450   
 451  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  *********************
 452   
 512   
 513  *
 515   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\Data_input.gdx
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  rsvr = 8:rsvr
--- LOAD  headers_reservoir = 9:headers_reservoir
--- LOAD  reservoir_data = 31:reservoir_data
--- LOAD  dsm = 10:dsm
--- LOAD  headers_dsm = 11:headers_dsm
--- LOAD  dsm_type = 12:dsm_type
--- LOAD  technology_data_upload = 29:technology_data_upload
--- LOAD  storage_data = 30:storage_data
--- LOAD  dsm_data_upload = 32:dsm_data_upload
 520   
--- LOAD  ev = 13:ev
--- LOAD  headers_ev = 14:headers_ev
--- LOAD  ev_data = 34:ev_data
--- LOAD  headers_prosumage_generation = 15:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 16:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 35:prosumage_data_generation
--- LOAD  prosumage_data_storage = 36:prosumage_data_storage
--- LOAD  reserves = 17:reserves
--- LOAD  reserves_up_down = 19:reserves_up_down
--- LOAD  reserves_spin_nonspin = 20:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 21:reserves_prim_nonprim
--- LOAD  headers_reserves = 18:headers_reserves
--- LOAD  reserves_data_upload = 37:reserves_data_upload
--- LOAD  bu = 22:bu
--- LOAD  ch = 23:ch
--- LOAD  heat_storage = 24:heat_storage
--- LOAD  heat_hp = 25:heat_hp
--- LOAD  heat_elec = 26:heat_elec
--- LOAD  heat_fossil = 27:heat_fossil
--- LOAD  headers_heat = 28:headers_heat
--- LOAD  heat_data_upload = 38:heat_data_upload
 525  ;
 526   
      $ontext
 530   
 531   
 532  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  ***********************
 533   
 559   
 560   
 561  *
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 565  *$load headers_time_ev ev_time_data_upload
 566  *$load reserves_time_data_activation
 567  *$load reserves_time_data_provision
 568  *$load headers_time_heat dh_upload
 569  *$load theta_night
 570  *$load temp_source_upload
 571  *$load headers_time_dhw d_dhw_upload nets_profile
 572  ;
 573   
 574   
 575   
 576   
 577  ***************  ASSIGNMENTS  **************************************************
 578   
 579   
 580   
 581  ***** Aliases *****
 582  alias (h,hh) ;
 583  alias (res,resres) ;
 584  alias (reserves,reservesreserves) ;
 585  alias (nondis,nondisnondis) ;
 586   
 587   
 588   
 589  ***** Derived sets *****
 590  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'dis',headers_tech)) = yes;
 591  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'nondis',headers_tech)) = yes;
 592   
 593  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'con',tech_dispatch,headers_tech)) = yes;
 594  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'res',tech_dispatch,headers_tech)) = yes;
 595   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = yes;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 617   
 618   
 619   
 620  ***** Parameters *****
 621   
 622  *--- Generation technologies ---*
 623  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 624  eta(tech) = technology_data(tech,'eta_con') ;
 625  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 626  c_up(dis) =technology_data(dis,'load change costs up') ;
 627  c_do(dis) = technology_data(dis,'load change costs down') ;
 628  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 629  c_vom(tech) = technology_data(tech,'variable_om') ;
 630  CO2price(tech) = technology_data(tech,'CO2_price') ;
 631   
 632  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 633  lifetime(tech) = technology_data(tech,'lifetime') ;
 634  recovery(tech) = technology_data(tech,'recovery_period') ;
 635  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 636  m_p(tech) = technology_data(tech,'max_installable') ;
 637  m_e(tech) = technology_data(tech,'max_energy') ;
 638  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 639  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 640   
 641  c_cu(res) = technology_data(res,'curtailment_costs') ;
 642   
 643   
 644  *--- Storage technologies ---*
 645  c_m_sto(sto) = storage_data(sto,'mc');
 646  eta_sto(sto) = storage_data(sto,'efficiency');
 647  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 648  phi_sto_ini(sto) = storage_data(sto,'level_start');
 649  etop_max(sto) = storage_data(sto,'etop_max') ;
 650   
 651  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 652  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 653  lifetime(sto) = storage_data(sto,'lifetime');
 654  interest_rate(sto) = storage_data(sto,'interest_rate');
 655  m_sto_e(sto) = storage_data(sto,'max_energy');
 656  m_sto_p(sto) = storage_data(sto,'max_power');
 657   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',headers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',headers_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,headers_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate')   ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 699   
 700  *--- Temporal data ---*
 701  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 702  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_data_upload(h,year,headers_time));
 703   
 704  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), time_data_upload(h,year,headers_time));
 705  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,year,reserves) ;
 706  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,year,reserves) ;
 707   
 708   
 709  *--- Spatial data ---*
 710  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 711  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 712  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 713  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 714  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 715  *m_ntc(l) = topology_data(l,'max_installable') ;
 716  *dist(l) = topology_data(l,'distance') ;
 717   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 734   
 735  *--- Prosumage ---*
 736  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 737  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 738  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 739  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 740   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_off') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_fossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw') ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_source') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_source') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply') ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 786   
 787   
 788  ***************  CALCULATE DERIVED PARAMETERS  *********************************
 789   
 790  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2price(tech) + c_vom(tech)   ;
 791   
 792  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate(tech))**(lifetime(tech)) )
 793                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       ;
 794   
 795  c_i_res(res) = c_i(res) ;
 796  c_fix_res(res) = c_fix(res) ;
 797   
 798  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 799                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 800   
 801  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 802                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_interest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_interest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 ) ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AND phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AND phi_heat_type(bu,ch)) = 1;
 831   
 832   
 833  ***************  Adjust costs to model's hourly basis **************************
 834   
 835  c_i(tech) = c_i(tech)*card(h)/8760 ;
 836  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 837  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 838  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 839  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 840  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 841  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 842  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 843   
 844  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 845  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 846  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 847  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 848  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 849   
 850  m_e('bio') = m_e('bio')*card(h)/8760 ;
 851   
 852  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 853   
 854  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 855  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 856  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(dsm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 857  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 858   
 859   
 860   
 861  ********************************************************************************
 862   
 863   
 864   
 865   
 866   
 867   
 868   
 869   
 870   
 871  ********************************************************************************
 872   
 873  ***************************
 874  ***** Initialize data *****
 875  ***************************
 876   
 877  * Parameters for default base year
 878  d(h) = d_y('2030',h) ;
 879  phi_res(res,h) = phi_res_y('2030',res,h) ;
 880  phi_min_res  = 0 ;
 881  phi_pro_self = 0 ;
 882  phi_pro_load = 0 ;
 883   
      phi_pro_load = 0.2 ;
      $ontext
 888   
 889   
 890  Parameter
 891  phi_min_res_exog     ;
 892  phi_min_res_exog = 1 ;
 893   
 894   
 895  ********************************************************************************
 896  ***** Model *****
 897  ********************************************************************************
 898   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\model.gms
 900   
 901  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 911  ********************************************************************************
 912   
 913   
 914  Variables
 915  Z                  Value objective function [Euro]
 916  lambda_enerbal     Dual variable on energy balance (1a)
 917  lambda_resgen      Dual variable on renewable generation (3e)
 918  lambda_convgen     Dual variable on conventional generation level (2a)
 919  lambda_stolev      Dual variable on storage level  (4b)
 920  ;
 921   
 922  Positive Variables
 923  G_L(tech,h)            Generation level in hour h [MWh]
 924  G_UP(tech,h)           Generation upshift in hour h [MWh]
 925  G_DO(tech,h)           Generation downshift in hour h [MWh]
 926  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 927  CU(tech,h)             Renewables curtailment technology res in hour h [MWh]
 928   
 929  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 930  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 931  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 932   
 933  N_TECH(tech)           Technology tech built [MW]
 934  N_STO_E(sto)           Storage technology built - Energy [MWh]
 935  N_STO_P(sto)           Storage loading and discharging capacity built - Capacity [MW]
 936   
 937  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generation in hour h [MWh]
 938  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h [MWh]
 939  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market in hour h [MWh]
 940  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in hour h [MWh]
 941  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation for discharging to consumption in hour h [MWh]
 942  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumption from generation in hour h [MWh]
 943  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to consumption in hour h [MWh]
 944  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 945  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 946  N_RES_PRO(tech)                Prosumage: installed renewables capacities [MW]
 947   
 948   
 949  mu_stoin_cap          Dual variable on storage loading capacity constraint (4d)
 950  mu_stout_cap          Dual variable on storage discharging capacity constraint (4e)
 951  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 952  mu_conv_cap           Dual variable on conventional generation capacity constraint (3a)
 953  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 954  mu_dis_max_i          Dual variable on dispatchable installation constraint (8a)
 955  mu_nondis_max_i       Dual variable on nondispatchable installation constraint (8a)
 956  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 957  mu_stop_max_i         Dual variable on storage power installation constraint  (8c)
 958  mu_stoe_max_i         Dual variable on storage energy installation constraint  (8b)
 959  mu_minRES             Dual variable on minimum renewable share constraint (5a)
 960   
 961  ;
 962   
 963  Set
 964  dis_bio(tech)          Subset of dispatchable technology: Bio mass        /bio/
 965  ;
 966   
 967   
 968  ********************************************************************************
 969   
 970  Equations
 971  * Objective
 972  obj                      Objective cost minimization
 973   
 974  * Energy balance
 975  con1a_bal                Energy Balance
 976   
 977  * Load change costs
 978  con2a_loadlevel          Load change costs: Level
 979  con2b_loadlevelstart     Load change costs: Level for first period
 980  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
 981  * Capacity contraints and flexibility constraints
 982  con3a_maxprod_dispatchable       Capacity Constraint conventionals
 983  con3e_maxprod_res                Capacity constraints renewables
 984   
 985  * Storage constraints
 986  con4a_stolev_start        Storage Level Dynamics Initial Condition
 987  con4b_stolev              Storage Level Dynamics
 988  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
 989  con4c_stolev_max          Storage Power Capacity
 990  con4d_maxin_sto           Storage maximum inflow
 991  con4e_maxout_sto          Storage maximum outflow
 992  con4j_ending              End level equal to initial level
 993  con4k_PHS_EtoP            Maximum E-P ratio
 994   
 995  * Minimum restrictions for renewables and biomass
 996  con5a_minRES             Minimum yearly renewables requirement
 997  con5b_max_energy         Maximum yearly biomass energy
 998   
 999  * Maximum installation conditions
1000  con8a_max_I_power                Maximum installable capacity: Conventionals
1001  con8b_max_I_sto_e                Maximum installable energy: Storage energy in MWh
1002  con8c_max_I_sto_p                Maximum installable capacity: Storage inflow-outflow in MW
1003   
1004  con8f_max_pro_res                Maximum installable capacity: prosumage renewables
1005  con8g_max_pro_sto_e              Maximum installable capacity: prosumage storage energy
1006  con8h_max_sto_pro_p              Maximum installable capacity: prosumage storage power
1007   
1008  * Prosumage
1009  con11a_pro_distrib                       Prosumage: distribution of generated energy
1010  con11b_pro_balance                       Prosumage: energy balance
1011  con11c_pro_selfcon                       Prosumage: minimum self-generation requirement
1012  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumager-to-prosumagers
1013  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial conditions
1014  con11j_pro_stolev_max                    Prosumage: maximum overall storage level
1015  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1016  con11l_pro_maxout_sto                    Prosumage: maximum storage outflow
1017  con11o_pro_ending                        Prosumage: storage ending condition
1018   
1019  * Dummy equation for using guss tool
1020  guss
1021   
1022  * KKT optimality conditions
1023  KKTG_L                   KKT w.r.t. G_L
1024  KKTG_UP                  KKT w.r.t. G_UP
1025  KKTG_DO                  KKT w.r.t. G_DO
1026  KKTG_RES                 KKT w.r.t. G_RES
1027  KKTCU                    KKT w.r.t. CU
1028  KKTSTO_IN                KKT w.r.t. STO_IN
1029  KKTSTO_OUT               KKT w.r.t. STO_OUT
1030  KKTSTO_L                 KKT w.r.t. STO_L
1031  KKTN_TECH_NONDIS         KKT w.r.t. N_TECH(nondis)
1032  KKTN_TECH_DIS            KKT w.r.t. N_TECH(dis)
1033  KKTN_TECH                KKT w.r.t. N_TECH
1034  KKTN_STO_E               KKT w.r.t. N_STO_E
1035  KKTN_STO_P               KKT w.r.t. N_STO_P
1036  ;
1037   
1038   
1039   
1040  ********************************************************************************
1041   
1042  * ---------------------------------------------------------------------------- *
1043  ***** Objective function *****
1044  * ---------------------------------------------------------------------------- *
1045   
1046  obj..
1047           Z =E=
1048                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1049                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1050                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1051                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1052                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN(sto,h) ) )
1053                   + sum( tech , c_i(tech)*N_TECH(tech) )
1054                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1055                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1056                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)) )
1057                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E_PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1067  ;
1068   
1069  * ---------------------------------------------------------------------------- *
1070  ***** Energy balance and load levels *****
1071  * ---------------------------------------------------------------------------- *
1072   
1073  * Energy balance
1074  con1a_bal(h)..
1075   
1076             sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h)) + sum( sto , STO_OUT(sto,h) )
               + sum( res , G_MARKET_PRO2M(res,h) )
      $ontext
1081           -  ( 1 - phi_pro_load )* d(h)
1082           -   sum( sto , STO_IN(sto,h) )
1083   
               - G_MARKET_M2PRO(h)
      $ontext
1088   
1089         =E= 0
1090  ;
1091   
1092  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1093           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1094  ;
1095   
1096  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1097          G_UP(dis,h) - G_L(dis,h) =E= 0
1098  ;
1099   
1100  con2_loadlevel(dis,h)..
1101             G_UP(dis,h)  - G_L(dis,h)
1102          +  (G_L(dis,h-1) - G_DO(dis,h))$(ord(h) > 1)
1103          =E= 0
1104  ;
1105   
1106   
1107   
1108  * ---------------------------------------------------------------------------- *
1109  ***** Hourly maximum generation caps *****
1110  * ---------------------------------------------------------------------------- *
1111   
1112  con3a_maxprod_dispatchable(dis,h)..
1113   
1114           N_TECH(dis) -  G_L(dis,h)  =G= 0
1115   
1116  ;
1117   
1118  con3e_maxprod_res(nondis,h)..
1119   
1120   
1121         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =E= 0
1122  ;
1123   
1124  * ---------------------------------------------------------------------------- *
1125  ***** Storage constraints *****
1126  * ---------------------------------------------------------------------------- *
1127   
1128  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1129          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1130  ;
1131   
1132  con4b_stolev(sto,h)$(ord(h)>1)..
1133          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1134  ;
1135   
1136  con4_stolev(sto,h)..
1137   
1138         + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h)
1139         + (STO_L(sto,h-1))$(ord(h)>1)
1140         =E= 0
1141  ;
1142   
1143   
1144  con4c_stolev_max(sto,h)..
1145         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1146  ;
1147   
1148  con4d_maxin_sto(sto,h)..
1149   
1150          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1151  ;
1152   
1153  con4e_maxout_sto(sto,h)..
1154   
1155          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1156  ;
1157   
1158  con4j_ending(sto,h)$(ord(h) = card(h))..
1159   
1160          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1161  ;
1162   
1163   
1164  con4k_PHS_EtoP(sto)..
1165           etop_max(sto) * N_STO_P(sto) - N_STO_E(sto) =G= 0
1166  ;
1167   
1168  * ---------------------------------------------------------------------------- *
1169  ***** Quotas for renewables and biomass *****
1170  * ---------------------------------------------------------------------------- *
1171   
1172  con5a_minRES..
1173  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1174   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + sum( (res) , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1179  )
1180          - phi_min_res * phi_min_res_exog * sum( h ,
1181           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1182   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1187           )  =G= 0
1188  ;
1189   
1190  con5b_max_energy(tech)$dis_bio(tech)..
1191           m_e(tech) -  sum( h , G_L(tech,h) ) =G= 0
1192  ;
1193   
1194   
1195  * ---------------------------------------------------------------------------- *
1196  ***** Maximum installation constraints *****
1197  * ---------------------------------------------------------------------------- *
1198   
1199  con8a_max_I_power(tech)..
1200         m_p(tech) - N_TECH(tech)     =G= 0
1201  ;
1202   
1203  con8b_max_I_sto_e(sto)..
1204         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1205  ;
1206   
1207  con8c_max_I_sto_p(sto)..
1208         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1209  ;
1210   
1211   
1212   
1213  con8f_max_pro_res(res)..
1214         m_res_pro(res) -  N_RES_PRO(res)     =G= 0
1215  ;
1216   
1217  con8g_max_pro_sto_e(sto)..
1218         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1219  ;
1220   
1221  con8h_max_sto_pro_p(sto)..
1222          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1223  ;
1224   
1225  * ---------------------------------------------------------------------------- *
1226  ***** Prosumage constraints *****
1227  * ---------------------------------------------------------------------------- *
1228   
1229  con11a_pro_distrib(res,h)..
1230           phi_res(res,h) * N_RES_PRO(res)
1231           =E=
1232           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( sto , STO_IN_PRO2PRO(res,sto,h) )
1233  ;
1234   
1235  con11b_pro_balance(h)..
1236           phi_pro_load * d(h)
1237           =E=
1238           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1239  ;
1240   
1241  con11c_pro_selfcon..
1242           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PRO(sto,h) )
1243           =G=
1244           phi_pro_self * sum( h , phi_pro_load * d(h))
1245  ;
1246   
1247  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1248           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1249  ;
1250   
1251   
1252  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1253          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1254  ;
1255   
1256   
1257  con11j_pro_stolev_max(sto,h)..
1258         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1259  ;
1260   
1261  con11k_pro_maxin_sto(sto,h)..
1262          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1263          =G= 0
1264  ;
1265   
1266  con11l_pro_maxout_sto(sto,h)..
1267          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1268          =G= 0
1269  ;
1270   
1271  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1272           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1273  ;
1274   
1275  * ---------------------------------------------------------------------------- *
1276  ***** FOC conditions *****
1277  * ---------------------------------------------------------------------------- *
1278   
1279  KKTG_L(tech,h)$dis(tech)..
1280   
1281      + c_m(tech)
1282      - lambda_enerbal(h)
1283  *$ontext
1284      + lambda_convgen(tech,h)
1287      + mu_conv_cap(tech,h)
          + mu_bio_cap(tech)$dis_bio(tech)
      $ontext
1292  *$ontext
1293     - (lambda_convgen(tech,h+1))$(ord(h) > 1)
1296      =G= 0
1297   
1298  ;
1299   
1300  KKTG_UP(dis,h)..
1301   
1302       - lambda_convgen(dis,h)
1303       + (c_up(dis))$(ord(h)> 1)
1304     =G= 0
1305   
1306  ;
1307   
1308  KKTG_DO(dis,h)..
1309   
1310       + c_do(dis)
1311       + (lambda_convgen(dis,h))$(ord(h) > 1)
1312       =G= 0
1313   
1314  ;
1315   
1316  KKTG_RES(nondis,h)..
1317   
1318       - lambda_enerbal(h) + lambda_resgen(nondis,h)
1319       =G= 0
1320  ;
1321   
1322  KKTCU(nondis,h)..
1323   
1324       c_cu(nondis) + lambda_resgen(nondis,h) =G= 0
1325   
1326  ;
1327   
1328  KKTSTO_IN(sto,h)..
1329   
1330      c_m_sto(sto)  + lambda_enerbal(h) -  lambda_stolev(sto,h)*(1+eta_sto(sto))/2
1331      + mu_stoin_cap(sto,h) =G= 0
1332  ;
1333   
1334  KKTSTO_OUT(sto,h)..
1335   
1336       c_m_sto(sto)  -  lambda_enerbal(h) +  lambda_stolev(sto,h)/(1+eta_sto(sto))*2
1337       +  mu_stout_cap(sto,h)
1338        =G= 0
1339  ;
1340   
1341  KKTSTO_L(sto,h)..
1342   
1343    + lambda_stolev(sto,h)
1344    +  mu_stolev_cap(sto,h)
1345    -  (lambda_stolev(sto,h+1))$(ord(h) > 1 )
1346   
1347    =G= 0
1348   
1349  ;
1350   
      KKTN_TECH_NONDIS(nondis)..
       
          c_i(nondis) +  c_fix(nondis)
          - sum( h,  lambda_resgen(nondis,h)*phi_res(nondis,h)) + mu_nondis_max_i(nondis)
          =G= 0
      ;
       
      KKTN_TECH_DIS(dis)..
       
           c_i(dis) +  c_fix(dis) - sum( h,  lambda_convgen(dis,h)) +  mu_dis_max_i(dis)
           =G= 0
       
      ;
1366   
1367  KKTN_TECH(tech)..
1368   
1369            +  c_i(tech)
1370            +  c_fix(tech)
                +  mu_tech_max_i(tech)       
      $ontext
1375            - sum( h,   mu_conv_cap(tech,h))$dis(tech)
1376            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis(tech)
1377       =G= 0
1378   
1379  ;
1380   
1381   
1382   
1383  KKTN_STO_E(sto)..
1384   
1385        +  c_fix_sto(sto)/2 +  c_i_sto_e(sto)
1386        -  sum( h,   mu_stolev_cap(sto,h))
            +  mu_stoe_max_i(sto)
      $ontext
1391        =G= 0
1392  ;
1393   
1394  KKTN_STO_P(sto)..
1395   
1396   
1397       c_fix_sto(sto)/2 + c_i_sto_p(sto)
1398       - sum( h, (mu_stoin_cap(sto,h) + mu_stout_cap(sto,h)))
           + mu_stop_max_i(sto)
      $ontext
1403       =G= 0
1404   
1405  ;
1406   
1407   
1408  ********************************************************************************
1409  ***** Fix unmatched variables of first period *****
1410  ********************************************************************************
1411   
1412  G_DO.fx(dis,'h1') = 0;
1413   
1414  * Default for reporting
1415  G_DO.l(dis,h)   = 0;
1416  G_L.l(dis,h)    = 0;
1417  G_UP.l(dis,h)   = 0;
1418  G_RES.l(tech,h) = 0;
1419  CU.l(tech,h)    = 0;
1420   
1421  STO_IN.l(sto,h)  = 0;
1422  STO_OUT.l(sto,h) = 0;
1423  STO_L.l(sto,h)   = 0;
1424   
1425  N_TECH.l(tech)   = 0;
1426  N_STO_E.l(sto)   = 0;
1427  N_STO_P.l(sto)   = 0;
1428   
1429   
1430  ********************************************************************************
1431  ***** MODEL *****
1432  ********************************************************************************
1433   
1434  model DIETER /
1435  obj
1436   
1437  con1a_bal
1438   
1439  *$ontext
1440  con2_loadlevel
1443   
1444  con3a_maxprod_dispatchable
1445  con3e_maxprod_res
1446   
1447  con4_stolev
1448  con4c_stolev_max
1449  con4d_maxin_sto
1450  con4e_maxout_sto
1451   
1452  con5a_minRES
      con5b_max_energy
      $ontext
1457   
      con8a_max_I_power
      con8b_max_I_sto_e
      con8c_max_I_sto_p
      $ontext
1464   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1480   
1481  /;
1482   
1483  model DIETER_MCP /
1484   
1485  con1a_bal.lambda_enerbal
1486   
1487  *$ontext
1488  con2_loadlevel.lambda_convgen
1491   
1492  con3a_maxprod_dispatchable.mu_conv_cap
1493  con3e_maxprod_res.lambda_resgen
1494   
1495  con4_stolev.lambda_stolev
1496  con4c_stolev_max.mu_stolev_cap
1497  con4d_maxin_sto.mu_stoin_cap
1498  con4e_maxout_sto.mu_stout_cap
1499   
      con5b_max_energy.mu_bio_cap
      $ontext
1504   
      con8a_max_I_power.mu_tech_max_i
      con8b_max_I_sto_e.mu_stoe_max_i
      con8c_max_I_sto_p.mu_stop_max_i
      $ontext
1511   
1512  KKTG_L.G_L
1513   
1514  *$ontext
1515  KKTG_UP.G_UP
1516  KKTG_DO.G_DO
1519   
1520  KKTG_RES.G_RES
1521  KKTCU.CU
1522  KKTSTO_IN.STO_IN
1523  KKTSTO_OUT.STO_OUT
1524  KKTSTO_L.STO_L
1525   
      KKTN_TECH.N_TECH
      KKTN_STO_E.N_STO_E
      KKTN_STO_P.N_STO_P
      $ontext
1532   
1533  / ;
1534   
1535  ********************************************************************************
1536  ***** Options, fixings, report preparation *****
1537  ********************************************************************************
1538   
1539  * Solver options
1545   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1556   
1557  dieter.OptFile = 1;
1558  dieter.holdFixed = 1 ;
1559   
1560   
1561  ********************************************************************************
1562  ***** Solve *****
1563  ********************************************************************************
1564   
1565  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\fix.gms
1567   
1568  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1578  ********************************************************************************
1579   
1580   
1581   
1582  ********************************************************************************
1583  **** Run of river  *************************************************************
1584  ********************************************************************************
1585   
1586  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('ror') (but no reserve provision):
1587   
1588  *$ontext
1589  N_TECH.fx('ror') = 5857.47 ;
1590  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1593   
1594  * Fix everything to zero in case no ROR option is selected:
1595  *%ror_variable%N_TECH.fx('ror') = 0 ;
1596  *%ror_variable%G_RES.fx('ror',h) = 0 ;
1597  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1598   
1599   
1600  ********************************************************************************
1601  **** No storage and DSM in first period  ***************************************
1602  ********************************************************************************
1603   
1604  ** No storage inflow in first period **
1605  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1606   
1607   
1608   
1609  ********************************************************************************
1610  **** No primary reserves by heating devices  ***********************************
1611  ********************************************************************************
1612   
1613   
1614  ********************************************************************************
1615  **** Fixing to reduce model size  **********************************************
1616  ********************************************************************************
1617   
1618  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1619  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1620  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1621  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1622  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1623  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1624   
1625  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1626  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1627  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1628  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1629  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1630   
1631   
1632  Variables
1633  STO_IN_PRO2M(tech,sto,h)
1634  STO_IN_M2PRO(sto,h)
1635  STO_IN_M2M(sto,h)
1636  STO_OUT_PRO2M(sto,h)
1637  STO_OUT_M2PRO(sto,h)
1638  STO_OUT_M2M(sto,h)
1639  STO_L_PRO(sto,h)
1640  STO_L_PRO2M(sto,h)
1641  STO_L_M2PRO(sto,h)
1642  STO_L_M2M(sto,h)
1643  ;
1644   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1668   
1669  * Deactivated market storage links
1670   
1671  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1672  STO_IN_M2PRO.fx(sto,h)      = 0 ;
1673  STO_IN_M2M.fx(sto,h)        = 0 ;
1674  STO_OUT_PRO2M.fx(sto,h)     = 0 ;
1675  STO_OUT_M2PRO.fx(sto,h)     = 0 ;
1676  STO_OUT_M2M.fx(sto,h)       = 0 ;
1677  STO_L_PRO.fx(sto,h)         = 0 ;
1678  STO_L_PRO2M.fx(sto,h)       = 0 ;
1679  STO_L_M2PRO.fx(sto,h)       = 0 ;
1680  STO_L_M2M.fx(sto,h)         = 0 ;
1681   
1682  ********************************************************************************
1683  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *************************************
1684  ********************************************************************************
1685   
1686  * Reporting level
1687  Set
1688  loop_res_share  /0/
1689  loop_prosumage  /0/ ;
1690   
1692   
1693  Set
1694  modstats       model stats collection                  /modelstat, solvestat, resusd/
1695  superscen        Scenarios                               /scen1*scen1000/
1696  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_share.#loop_prosumage)/
1697  ;
1698   
1699  set
1700  scen(superscen);
1701  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(superscen,loop_res_share,loop_prosumage)) ) ;
1702   
1703   
1704  Parameters
1705  * Equations
1706  marginal_con5a(superscen)
1707  marginal_con1a(superscen,h)
1708  *marginal_con9a(superscen,*,*,*)
1709  *marginal_con9b(superscen,*,*,*)
1710   
1711  * Basic
1712  modelstat
1713  solvestat
1714  resusd
1715  lev_Z(superscen)
1716  lev_G_L(superscen,tech,h)
1717  lev_G_UP(superscen,tech,h)
1718  lev_G_DO(superscen,tech,h)
1719  lev_G_RES(superscen,tech,h)
1720  lev_CU(superscen,tech,h)
1721  lev_STO_IN(superscen,sto,h)
1722  lev_STO_OUT(superscen,sto,h)
1723  lev_STO_L(superscen,sto,h)
1724  lev_N_TECH(superscen,tech)
1725  lev_N_STO_E(superscen,sto)
1726  lev_N_STO_P(superscen,sto)
1727   
1728   
1729  * Prosumage
1730  lev_CU_PRO(superscen,tech,h)
1731  lev_G_MARKET_PRO2M(superscen,tech,h)
1732  lev_G_MARKET_M2PRO(superscen,h)
1733  lev_G_RES_PRO(superscen,tech,h)
1734  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1735  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1736  lev_STO_IN_M2PRO(superscen,sto,h)
1737  lev_STO_IN_M2M(superscen,sto,h)
1738  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1739  lev_STO_OUT_PRO2M(superscen,sto,h)
1740  lev_STO_OUT_M2PRO(superscen,sto,h)
1741  lev_STO_OUT_M2M(superscen,sto,h)
1742  lev_STO_L_PRO2PRO(superscen,sto,h)
1743  lev_STO_L_PRO2M(superscen,sto,h)
1744  lev_STO_L_M2PRO(superscen,sto,h)
1745  lev_STO_L_M2M(superscen,sto,h)
1746  lev_N_STO_E_PRO(superscen,sto)
1747  lev_N_STO_P_PRO(superscen,sto)
1748  lev_STO_L_PRO(superscen,sto,h)
1749  lev_N_RES_PRO(superscen,tech)
1750  ;
1751   
1752  * Default level zero for report parameters
1753  lev_Z(scen) = 0 ;
1754  lev_G_L(scen,tech,h) = 0 ;
1755  lev_G_UP(scen,tech,h) = 0 ;
1756  lev_G_DO(scen,tech,h) = 0 ;
1757  lev_G_RES(scen,tech,h) = 0 ;
1758  lev_CU(scen,tech,h) = 0 ;
1759  lev_STO_IN(scen,sto,h) = 0 ;
1760  lev_STO_OUT(scen,sto,h) = 0 ;
1761  lev_STO_L(scen,sto,h) = 0 ;
1762  lev_N_TECH(scen,tech) = 0 ;
1763  lev_N_STO_E(scen,sto) = 0 ;
1764  lev_N_STO_P(scen,sto) = 0 ;
1765  marginal_con1a(scen,h) = 0 ;
1766  marginal_con5a(superscen) = 0 ;
1767   
1768  * Prosumage
1769  lev_CU_PRO(scen,tech,h) = 0 ;
1770  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1771  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1772  lev_G_RES_PRO(scen,tech,h) = 0  ;
1773  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1774  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1775  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1776  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1777  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1778  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1779  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1780  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1781  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1782  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1783  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1784  lev_STO_L_M2M(scen,sto,h) = 0  ;
1785  lev_N_STO_E_PRO(scen,sto) = 0  ;
1786  lev_N_STO_P_PRO(scen,sto) = 0  ;
1787  lev_STO_L_PRO(scen,sto,h) = 0  ;
1788  lev_N_RES_PRO(scen,tech) = 0  ;
1789   
1790   
1791  * Fixing of report parameters for run-of-river
1792  *$ontext
1793  lev_N_TECH(scen,'ror') = 5857.47 ;
1794  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
1797   
1798   
1799   
1800   
1801   
1802   
1803   
1804   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\scenario.gms
1806   
1807  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1817  ********************************************************************************
1818   
1819   
1820   
1821   
1822  *****************************************
1823  **** Scenario file                   ****
1824  ****                                 ****
1825  *****************************************
1826   
1827  Parameter
1828  m_exog_p(tech)
1829  m_exog_sto_e(sto)
1830  m_exog_sto_p(sto)
1831   
1832  ;
1833   
1834  m_exog_p(tech)    = technology_data(tech,'fixed_capacities') ;
1835  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1836  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1837   
1838   
1839  *** Dispatch model
1840  *$ontext
1841  N_TECH.fx(tech)  = m_exog_p(tech) + 0.1 ;
1842  N_STO_P.fx(sto)  = m_exog_sto_p(sto) ;
1843  N_STO_E.fx(sto)  = m_exog_sto_e(sto) ;
1844   
1845  N_TECH.fx('nuc')     = no  ;
1846  N_STO_E.fx('sto1')   = no ;
1847  N_STO_E.fx('sto2')   = no ;
1848  N_STO_E.fx('sto3')   = no ;
1849  N_STO_E.fx('sto4')   = no ;
1850  N_STO_E.fx('sto6')   = no ;
1851  N_STO_E.fx('sto7')   = no ;
1852  N_STO_P.fx('sto1')   = no ;
1853  N_STO_P.fx('sto2')   = no ;
1854  N_STO_P.fx('sto3')   = no ;
1855  N_STO_P.fx('sto4')   = no ;
1856  N_STO_P.fx('sto6')   = no ;
1857  N_STO_P.fx('sto7')   = no ;
1858   
1861   
1862  *** Investment model
      N_TECH.lo(tech)        = 0 ;
      N_TECH.lo('wind_on')   = m_exog_p('wind_on') ;
      N_TECH.lo('wind_off')  = m_exog_p('wind_off') ;
      N_TECH.lo('pv')        = m_exog_p('pv') ;
      N_STO_P.lo(sto)        = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto)        = m_exog_sto_e(sto) ;
      N_TECH.up(tech)        = m_exog_p(tech) + 0.1 ;
      N_TECH.up('wind_on')   = inf ;
      N_TECH.up('wind_off')  = inf ;
      N_TECH.up('pv')        = inf ;
      N_STO_P.up(sto)        = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto)        = m_exog_sto_e(sto) + 0.1 ;
      N_STO_P.up('sto1')     = inf ;
      N_STO_P.up('sto5')     = inf ;
      N_STO_P.up('sto7')     = inf ;
      N_STO_E.up('sto1')     = inf ;
      N_STO_E.up('sto5')     = inf ;
      N_STO_E.up('sto7')     = inf ;
      $ontext
1884   
1885   
1886   
1887   
1888   
1889  *$ontext
1890  solve  DIETER using lp min Z ;
1893   
       
      solve   DIETER_MCP using mcp;
      $ontext
1899   
1900   
1901  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\report.gms
1903   
1904  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1914  ********************************************************************************
1915   
1917   
1918   
1919   
1920   
1921  ********************************************************************************
1922  **** Parameters for report file  ***********************************************
1923  ********************************************************************************
1924   
1925  Parameter
1926  corr_fac_dis             Balancing correction factor - dispatchable technologies
1927  corr_fac_nondis          Balancing correction factor - nondispatchable technologies
1928  corr_fac_sto             Balancing correction factor - storage technologies
1929  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment technologies
1930  corr_fac_dsm_shift       Balancing correction factor - DSM shifting technologies
1931  corr_fac_ev              Balancing correction factor - electric vehicles
1932  corr_fac_rsvr            Balancing correction factor - reservoir
1933  corr_fac_sets            Balancing correction factor - SETS
1934  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1935  corr_fac_hp              Balancing correction factor - heat pumps
1936  corr_fac_h_elec          Balancing correction factor - hybrid electric storage heating
1937   
1938  corr_fac_ev_sep
1939   
1940  gross_energy_demand                      Gross energy demand
1941  gross_energy_demand_market               Gross energy demand - market (non-prosumage segment)
1942  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1943  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers self-generated
1944  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers from market
1945   
1946  reserves_activated
1947   
1948  calc_maxprice
1949  calc_minprice
1950   
1951  report
1952  report_tech
1953  report_tech_hours
1954  report_hours
1955  report_node
1956  report_line
1957  report_cost
1958   
1959  report_reserves
1960  report_reserves_hours
1961  report_reserves_tech
1962  report_reserves_tech_hours
1963   
1964  report_prosumage
1965  report_prosumage_tech
1966  report_prosumage_tech_hours
1967  report_market
1968  report_market_tech
1969  report_market_tech_hours
1970   
1971  report_heat_tech_hours
1972  report_heat_tech
1973   
1974  Z_MCP
1975  Z_FIX
1976  Z_VAR
1977  ;
1978   
1979   
1980   
1981  * Declare reporting parameters
1982   
1983  marginal_con1a(scen,h)  = con1a_bal.m(h)   ;
1984  *$ontext
1985  modelstat               = DIETER.modelstat ;
1986  solvestat               = DIETER.solveStat ;
1987  resusd                  = DIETER.resusd    ;
1988  lev_Z(scen)             = Z.l              ;
1989  marginal_con5a(scen)    = con5a_minRES.m   ;
1992  lev_G_L(scen,tech,h)    = G_L.l(tech,h)    ;
1993  lev_G_UP(scen,tech,h)   = G_UP.l(tech,h)   ;
1994  lev_G_DO(scen,tech,h)   = G_DO.l(tech,h)   ;
1995  lev_G_RES(scen,tech,h)  = G_RES.l(tech,h)  ;
1996  lev_CU(scen,tech,h)     = CU.l(tech,h)     ;
1997  lev_STO_IN(scen,sto,h)  = STO_IN.l(sto,h)  ;
1998  lev_STO_OUT(scen,sto,h) = STO_OUT.l(sto,h) ;
1999  lev_STO_L(scen,sto,h)   = STO_L.l(sto,h)   ;
2000  lev_N_TECH(scen,tech)   = N_TECH.l(tech)   ;
2001  lev_N_STO_E(scen,sto)   = N_STO_E.l(sto)   ;
2002  lev_N_STO_P(scen,sto)   = N_STO_P.l(sto)   ;
2003   
2004   
      modelstat               = DIETER_MCP.modelstat ;
      solvestat               = DIETER_MCP.solveStat ;
      resusd                  = DIETER_MCP.resusd    ;
      Z_VAR =
       
       
            sum( (h,dis) , c_m(dis)*G_L.l(dis,h) )
                       + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP.l(dis,h) )
                       + sum( (h,dis) , c_do(dis)*G_DO.l(dis,h) )
                       + sum( (h,nondis) , c_cu(nondis)*CU.l(nondis,h) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT.l(sto,h) + STO_IN.l(sto,h) ) )
       
      ;
       
      Z_FIX =                 
                       + sum( tech , c_i(tech)*N_TECH.l(tech) )
                       + sum( tech , c_fix(tech)*N_TECH.l(tech) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E.l(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P.l(sto)+ N_STO_E.l(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P.l(sto) )
      ;
       
      Z_MCP = Z_VAR + Z_FIX            ;
      lev_Z(scen)    = Z_MCP           ;
      $ontext
2032   
2033   
2034  ********************************************************************************
2035  **** Initialize reporting paremetrs  *******************************************
2036  ********************************************************************************
2037   
2038  * Set reporting sensitivity. All results below will be reported as zero
2039  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        / 1e-4 / ;
2040  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         / 1e-2 / ;
2041  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   / 1 /    ;
2042   
2043   
2044  * ----------------------------------------------------------------------------
2045   
2046  * Min and max for prices
2047  calc_maxprice = 0 ;
2048  calc_minprice = 1000 ;
2049   
2050   
2051  * ----------------------------------------------------------------------------
2052   
2053  * Default values for correction factors
2054  corr_fac_dis(scen,dis,h) = 0 ;
2055  corr_fac_nondis(scen,nondis,h) = 0 ;
2056  corr_fac_sto(scen,sto,h) = 0 ;
2057   
2058   
2059  * ----------------------------------------------------------------------------
2060   
2061  * Parameter for hourly nodal reserves activated
2062  reserves_activated(scen,h) = 0 ;
2063   
2064   
2065   
2066   
2067   
2068  * ----------------------------------------------------------------------------
2069   
2070  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(scen,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2077   
2078   
2079  * ----------------------------------------------------------------------------
2080   
2081  * Define gross energy demand for reporting
2082  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(scen,sto,h) - lev_STO_OUT_M2PR
      O(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2087   
2088   
2089  )
2090  ;
2091   
2092   
2093  ********************************************************************************
2094  **** Report  *******************************************************************
2095  ********************************************************************************
2096   
2097  * REPORT model statistics
2098          report('model status',loop_res_share,loop_prosumage)  = modelstat ;
2099          report('solver status',loop_res_share,loop_prosumage) = solvestat ;
2100          report('solve time',loop_res_share,loop_prosumage)    = resusd ;
2101          report('obj value',loop_res_share,loop_prosumage)     = sum(scen, lev_Z(scen)* 1) ;
2102   
2103   
2104  * ----------------------------------------------------------------------------
2105   
2106  * REPORT HOURS
2107          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= d(h) ;
2108          report_hours('energy generated',loop_res_share,loop_prosumage,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h)) + sum( sto , l
      ev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2109          + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_S
      TO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) ) ;
2110  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2111  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) )) ;
2112  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2113          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2114   
2115                   report_hours('energy generated',loop_res_share,loop_prosumage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2116                   report_hours('energy demanded',loop_res_share,loop_prosumage,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2117  *                 report_hours('gross exports',loop_res_share,loop_prosumage,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2118  *                 report_hours('gross imports',loop_res_share,loop_prosumage,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2119                   report_hours('demand consumers',loop_res_share,loop_prosumage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2120                   report_hours('price',loop_res_share,loop_prosumage,h)$(report_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND report_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2121  *                 report_hours('infeasibility',loop_res_share,loop_prosumage,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2122   
2123   
2124  * ----------------------------------------------------------------------------
2125   
2126  * REPORT TECH HOURS
2127          report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2128  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h) ) ;
2129          report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2130  *        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) ) ;
2131  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rsvr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2132  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(scen,rsvr,h) ) ;
2133          report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2134          report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(
      scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2135          report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_
      STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) ) ;
2136          report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2137  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc(l)* lev_F(scen,l,h)) ) ;
2138   
2139                   report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2140                   report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2141  *  star added        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2142                   report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2143                   report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2144                   report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2145                   report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2146  *                 report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)) < eps_rep_abs ) = 0 ;
2147  *                 report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)< eps_rep_abs ) = 0 ;
2148  *                 report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2149  *                 report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2150   
2151   
2152  * ----------------------------------------------------------------------------
2153   
2154  * RPEORT LINE
2155   
2156  * ----------------------------------------------------------------------------
2157   
2158  * REPORT NODE
2159          report_node('energy demand total',loop_res_share,loop_prosumage)= (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2
      M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1;
2160          report_node('energy demand gross',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2161          report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2162  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2163           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) )) ;
2164          report_node('energy generated gross',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2165  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
2166           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2167  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2168  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )) ;
2169  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F(scen,l,h)) ) ;
2170  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) ) ) ;
2171  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2172  *        report_node('net import share in gross demand',loop_res_share,loop_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2173  *        report_node('net export share in net generation',loop_res_share,loop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2174  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev_NTC(scen,l))) ) ;
2175  *        report_node('gross import share',loop_res_share,loop_prosumage)= sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2176  *        report_node('gross export share in net generation',loop_res_share,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loop_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,loop_prosumage,h)) ;
2177          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)))
       + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2178  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)))
2179   
2180  ;
2181          report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2182          report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (
      lev_N_TECH(scen,nondis))))) ;
2183          report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2184          report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2185          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,  marginal_con1a(scen,h))) ) ;
2186          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,  marginal_con1a(scen,h))) ) ;
2187          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)) = sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)))/card(h) ;
2188   
2189                   report_node('energy demand total',loop_res_share,loop_prosumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2190                   report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2191                   report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2192                   report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2193                   report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2194                   report_node('min price',loop_res_share,loop_prosumage)$(report_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND report_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2195  *                 report_node('gross exports',loop_res_share,loop_prosumage)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2196  *                 report_node('gross imports',loop_res_share,loop_prosumage)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2197  *                 report_node('net exports',loop_res_share,loop_prosumage)$(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_abs*card(h)) = 0 ;
2198                   report_node('energy generated net',loop_res_share,loop_prosumage)$(report_node('energy generated net',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2199                   report_node('energy generated gross',loop_res_share,loop_prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2200                   report_node('energy demand gross',loop_res_share,loop_prosumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2201  *                 report_node('net import share in gross demand',loop_res_share,loop_prosumage)$(report_node('net import share in gross demand',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2202  *                 report_node('net export share in net generation',loop_res_share,loop_prosumage)$(report_node('net export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2203                   report_node('Capacity total',loop_res_share,loop_prosumage)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2204  *                 report_node('gross import share',loop_res_share,loop_prosumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2205  *                 report_node('gross export share in net generation',loop_res_share,loop_prosumage)$(report_node('gross export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2206   
2207   
2208  * ----------------------------------------------------------------------------
2209   
2210  * REPORT COST
2211          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) + c_do(dis)*lev_G_DO(scen,di
      s,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO_IN(scen,sto,h) ) )
2212   
2213  ));
2214           report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech , c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + sum( sto , c_i_sto_e(sto)*le
      v_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,sto) )
2215  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr_p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rsvr))
2216   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res)*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(scen,sto)) + c_i_sto_p(sto)*l
      ev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2221  );
2222   
2223  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_infes * lev_G_INFES(scen,h)) ) ;
2224  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen_phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2225  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2226           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2227  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2228  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2229  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)
2230   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l)$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_ins) = 0 ;
2242   
2243  * ----------------------------------------------------------------------------
2244   
2245  * REPORT TECH
2246          report_tech('capacities conventional',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2247          report_tech('capacities renewable',loop_res_share,loop_prosumage,res)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) ;
2248  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr));
2249  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr));
2250          report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2251          report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2252   
2253          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2254          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2255  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2256          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2257          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2258   
2259          report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_
      STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2260  *        report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , gross_energy_demand(scen)) ;
2261          report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand
      (scen)) ;
2262          report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',lo
      op_res_share,loop_prosumage)) ;
2263  *        report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2264          report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2265   
2266          report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2267          report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_P
      RO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ))) ) ;
2268   
2269          report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2270          report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2271   
2272          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2273          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKE
      T_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
2274  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2275          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)) / sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2276   
2277   
2278                   report_tech('capacities conventional',loop_res_share,loop_prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2279                   report_tech('capacities renewable',loop_res_share,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2280                   report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2281                   report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2282  *                 report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2283  *                 report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2284                   report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2285  *                 report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2286                   report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2287                   report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2288  *                 report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2289                   report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2290                   report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2291                   report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2292                   report_tech('Capacity share',loop_res_share,loop_prosumage,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2293                   report_tech('Capacity share',loop_res_share,loop_prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2294  *                 report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2295                   report_tech('Capacity share',loop_res_share,loop_prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2296                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(report_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2297                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(report_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2298  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(report_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2299                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2300                   report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2301                   report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2302   
2303   
2304  * ----------------------------------------------------------------------------
2305   
2306  * REPORT NODE
2307          report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res))
2308  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr))
2309           ;
2310          report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)) ;
2311  *        report_node('net import share in nodal gross demand',loop_res_share,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosumage)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2312          report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res))
2313  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr))
2314           ;
2315          report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)) ;
2316   
2317                   report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2318                   report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2319                   report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2320                   report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2321   
2322   
2323   
2324  * ----------------------------------------------------------------------------
2325   
2326  * REPORT TECH
2327          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) ;
2328          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2329  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2330          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(s
      cen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) ;
2331   
2332          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',loop_res_share,loop_prosuma
      ge)* 1 + 1e-9 ;
2333          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2334  *        report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2335          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,s
      to,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2336          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2337          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_
      share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2338   
2339                   report_tech('Yearly energy',loop_res_share,loop_prosumage,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps_rep_ins ) = 0 ;
2340                   report_tech('Yearly energy',loop_res_share,loop_prosumage,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps_rep_ins ) = 0 ;
2341  *                 report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins ) = 0 ;
2342                   report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps_rep_ins ) = 0 ;
2343   
2344                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2345                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2346  *                 report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2347                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2348                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2349                   report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2350   
2351   
2352  * ----------------------------------------------------------------------------
2353   
2354  * RPEORT
2355          report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)  ;
2356          report('curtailment of fluct res relative',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (
      lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) )) ;
2357          report('bio not utilized absolute',loop_res_share,loop_prosumage)$( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loop_prosumage)  ;
2358          report('bio not utilized relative',loop_res_share,loop_prosumage)$( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_prosumage) /m_e('bio') ;
2359          report('Capacity total',loop_res_share,loop_prosumage) = report_node('Capacity total',loop_res_share,loop_prosumage) ;
2360          report('energy demand gross',loop_res_share,loop_prosumage) = report_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2361          report('energy demand total',loop_res_share,loop_prosumage) = report_node('energy demand total',loop_res_share,loop_prosumage)  ;
2362          report('energy generated net',loop_res_share,loop_prosumage) =  report_node('energy generated net',loop_res_share,loop_prosumage) ;
2363          report('energy generated gross',loop_res_share,loop_prosumage) =  report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2364  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2365          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_res(res,h) * lev_N_RES_PRO(sc
      en,res) - lev_CU_PRO(scen,res,h))
2366  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)))
2367           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2368          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2369          report('Energy total',loop_res_share,loop_prosumage) = report_node('Energy total',loop_res_share,loop_prosumage) ;
2370   
2371                   report('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2372                   report('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2373                   report('bio not utilized absolute',loop_res_share,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2374                   report('bio not utilized relative',loop_res_share,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2375                   report('Capacity total',loop_res_share,loop_prosumage)$(report('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2376                   report('gross trade share',loop_res_share,loop_prosumage)$(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2377                   report('renshare total',loop_res_share,loop_prosumage)$(report('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2378                   report('conshare total',loop_res_share,loop_prosumage)$(report('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2379                   report('Energy total',loop_res_share,loop_prosumage)$(report('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2380   
2381   
2382  * ----------------------------------------------------------------------------
2383   
2384  * DSM
2385   
2386   
2387  * ----------------------------------------------------------------------------
2388   
2389  * EV
2390   
2391   
2392   
2393  * ----------------------------------------------------------------------------
2394   
2395  * Reserves
2396   
2397   
2398   
2399   
2400  * ----------------------------------------------------------------------------
2401   
2402  * Reserves and DSM
2403   
2404   
2405  * ----------------------------------------------------------------------------
2406   
2407  * ----------------------------------------------------------------------------
2408   
2409  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross_energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h
       , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('
      price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price',l
      oop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours
      ('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours(
      'price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARK
      ET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_res_share,loo
      p_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_re
      s_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(
      scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserves',loop_res
      _share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserve
      s',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_
      energy_demand_prosumers_selfgen(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_p
      rosumers_market(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) / 
      report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) 
      / report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res
      ,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_
      share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen
      ,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_prosumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO
      2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market('Capacity total market',loop_res_share,loop_prosumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech) ) / report_ma
      rket('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,con,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumage,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)$(report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)$(report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share,loop_prosumage)$(report_market('gross energy demand market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)$(report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0
       ;
                       report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop_prosumage)$(report_market('Capacity total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share,loop_prosumage)$(report_market('Energy demand total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_share,loop_prosumage)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
      $ontext
2679   
2680   
2681  execute_unload "results", report, report_tech, report_node,
2682  *report_line,
2683  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, report_market, report_market_tech, report_market_tech_hours
      $ontext
2688  ;
2689   
2690   
      $include report_to_excel.gms
      $ontext
2695   
2696   
2697  * ---------------------------------------------------------------------------- *
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:28:06 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\DIETER.gms
     2      110 INCLUDE        1     110  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\dataload.gms
     3      514 CALL           2     404  .gdxxrw data_input.xlsx @temp.tmp o=Data_input maxdupeerrors=100
     4      516 GDXIN          2     406  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\Data_input.gdx
     5      562 CALL           2     452  .gdxxrw time_series.xlsx @temp2.tmp o=time_series
     6      563 GDXIN          2     453  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\time_series.gdx
     7      899 INCLUDE        1     141  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\model.gms
     8     1566 INCLUDE        1     174  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\fix.gms
     9     1805 INCLUDE        1     175  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\scenario.gms
    10     1902 INCLUDE        1     190  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\report.gms


COMPILATION TIME     =        5.179 SECONDS      3 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:28:06 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1890


MODEL STATISTICS

BLOCKS OF EQUATIONS          10     SINGLE EQUATIONS        3,068
BLOCKS OF VARIABLES           9     SINGLE VARIABLES        3,654
NON ZERO ELEMENTS        10,848


GENERATION TIME      =        0.016 SECONDS      6 MB  25.1.2 r67455 WEX-WEI


EXECUTION TIME       =        0.016 SECONDS      6 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:28:06 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1890


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1890

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      1 Optimal                   
**** OBJECTIVE VALUE        330748758.0990

 RESOURCE USAGE, LIMIT          0.046  10000000.000
 ITERATION COUNT, LIMIT        15    2000000000

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 0.18 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 0.03sec (det. 14.21 ticks)
Optimal solution found.
Objective :   330748758.098957



**** REPORT SUMMARY :        0     NONOPT
                             0 INFEASIBLE
                             0  UNBOUNDED
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:28:06 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.000 SECONDS      5 MB  25.1.2 r67455 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP\DIETER.lst
