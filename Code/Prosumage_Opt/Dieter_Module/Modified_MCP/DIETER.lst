GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 13:30:24 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  31   
  34   
  36   
  37  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  38  * if nothing is selected, ROR capacity will be set to zero
  39  * if parameter option is selected, set appropriate values in fix.gmx
  40  * if variable option is selected, set appropriate bound in data_input exce
      l
  43   
  44  * Set star to determine loops, otherwise default 100% renewables
  46   
  47  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  49   
  50  * Set star for reporting to Excel
  52   
  53   
  54  **************************************************************************
      ******
  55   
  56  * Definition of strings for report parameters and sanity checks
  57  * (Do not change settings below)
  59   
  60  * Sanity checks
  62   
  63  **************************************************************************
      ******
  64   
  65  ****************************
  66  ***** INITIALIZE LOOPS *****
  67  ****************************
  68   
  69  sets
  70  *$ontext
  71  loop_res_share   Solution loop for different shares of renewables       /5
      0/
  74   
  75  *$ontext
  76  loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /50/
  79   
  80  *      loop_res_share                          /50/
  81  *                      loop_prosumage                          /0/
  82  ;
  83   
  84   
  85   
  86   
  87  **************************************************************************
      ******
  88   
  89  **************************
  90  ***** SOLVER OPTIONS *****
  91  **************************
  92   
  93  options
  94  optcr = 0.00
  95  reslim = 10000000
  96  lp = cplex
  97  mip = cplex
  98  nlp = conopt
  99  limrow = 0
 100  limcol = 0
 101  ;
 102   
 103  options
 104  dispwidth = 15
 105  limrow = 0
 106  limcol = 0
 107  solprint = off
 108  sysout = off
 109  ;
 110   
 111   
 112   
 113   
 114  **************************************************************************
      ******
 115   
 116  **************************
 117  ***** Dataload *****
 118  **************************
 119   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\dataload.gms
 121   
 122  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 132  **************************************************************************
      ******
 133   
 134   
 135   
 136   
 137  ***************  SETS  ***************************************************
      ******
 138   
 139  ***** Sets used in the model *****
 140  Sets
 141  tech                     Generation technologies
 142   dis(tech)               Dispatchable generation technologies
 143   nondis(tech)            Nondispatchable generation technologies
 144   con(tech)               Conventional generation technologies
 145   res(tech)               Renewable generation technologies
 146  sto                      Storage technologies
 147  rsvr                     Reservoir technologies
 148  dsm                      DSM technologies
 149   dsm_shift(dsm)          DSM load shifting technologies
 150   dsm_curt(dsm)           DSM load curtailment technologies
 151  year                     Base year for temporal data
 152  h                        Hours
 153  n                        Nodes
 154  l                        Lines
 155  ev                       EV types
 156  reserves                         Reserve qualities
 157   reserves_up(reserves)           Positive reserves
 158   reserves_do(reserves)           Negative reserves
 159   reserves_spin(reserves)         Spinning reserves
 160   reserves_nonspin(reserves)      Nonspinning reserves
 161   reserves_prim(reserves)         Primary reserves
 162   reserves_nonprim(reserves)      Nonprimary reserves
 163   reserves_prim_up(reserves)      Primary positive reserves
 164   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 165   reserves_prim_do(reserves)      Primary negative reserves
 166   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 167  bu                       Building archtypes
 168  ch                       Heating combination type
 169   hst(ch)                 Heating technology that feeds to storage
 170   hp(ch)                  Heat pump technologies
 171   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 172   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 173   
 174   
 175  ***** Sets used for data upload *****
 176  headers_tech                     Generation technologies - upload headers
 177   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 178   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 179  headers_sto                      Storage technologies - upload headers
 180  headers_reservoir                Reservoir technologies - upload headers
 181  headers_dsm                      DSM technologies - upload headers
 182   dsm_type                        DSM technologies - shifting or curtailmen
      t
 183  headers_time                     Temporal data - upload headers
 184  headers_topology                 Spatial data - upload headers
 185  headers_ev                       EV data - upload headers
 186  headers_time_ev                  EV temporal data - upload headers
 187  headers_prosumage_generation     Prosumage generation data - upload header
      s
 188  headers_prosumage_storage        Prosumage storage data - upload headers
 189  headers_reserves                 Reserve data - upload headers
 190   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 191   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 192   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 193  headers_heat                     Heat data - upload headers
 194   heat_storage                    Heat data - storage technologies
 195   heat_hp                         Heat data - heat pump technologies
 196   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 197   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 198  headers_time_heat                Heat data - upload headers time data
 199  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 200  ;
 201   
 202   
 203   
 204   
 205  ***************  PARAMETERS  *********************************************
      ******
 206   
 207  Parameters
 208   
 209  ***** Generation technologies *****
 210  *--- Variable and fixed costs ---*
 211  eta              Efficiency of conventional technologies [0 1]
 212  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 213  c_up             Load change costs UP [EUR per MWh]
 214  c_do             Load change costs DOWN [EUR per MWh]
 215  c_fix            Annual fixed costs [EUR per MW per year]
 216  c_vom            Variable O&M costs [EUR per MWh]
 217  CO2price         CO2 price in [EUR per ton]
 218   
 219  *--- Investment ---*
 220  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 221  lifetime         Investment costs: technical lifetime [a]
 222  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 223  interest_rate    Investment costs: Interest rate [%]
 224  m_p              Investment: maximum installable capacity per technology [
      MW]
 225  m_e              Investment: maximum installable energy [TWh per a]
 226   
 227  *--- Flexibility ---*
 228  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 229   
 230   
 231  ***** Fuel and CO2 costs *****
 232  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 233   
 234   
 235  ***** Renewables *****
 236  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 237  phi_min_res      Minimum renewables share [0 1]
 238   
 239   
 240  ***** Storage *****
 241  *--- Variable and fixed costs ---*
 242  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 243  eta_sto          Storage efficiency [0 1]
 244  phi_sto_ini      Initial storage level [0 1]
 245  etop_max         Maximum E to P ratio of storage types [#]
 246  c_fix_sto        Annual fixed costs [EUR per MW]
 247   
 248  *--- Investment ---*
 249  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 250  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 251  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 252  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 253   
 254   
 255  ***** Reservoir*****
 256  *--- Variable and fixed costs ---*
 257  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 258  eta_rsvr                 Generation efficiency [0 1]
 259  phi_rsvr_ini             Initial reservoir level [0 1]
 260  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 261  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 262  phi_rsvr_lev_min         Minimum filling level [0 1]
 263   
 264  *--- Investment ---*
 265  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 266  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 267  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 268  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 269  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 270  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 271   
 272   
 273  ***** DSM *****
 274  *--- Variable and fixed costs ---*
 275  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 276  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 277  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 278  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 279   
 280  *--- Flexibility, efficiency, recovery ---*
 281  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 282  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 283   
 284  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 285  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 286  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 287   
 288  *--- Investment ---*
 289  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 290  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 291  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 292  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 293  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 294  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 295  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 296  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 297   
 298   
 299  ***** Time Data *****
 300  d_y                      Demand hour h for different years [MWh]
 301  d                        Demand hour h [MWh]
 302  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 303  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 304  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 305  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 306  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 307  rsvr_in                  Reservoir inflow in hour h [0 1]
 308  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 309  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 310  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 311  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 312  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 313  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 314  reserves_exogenous       Hourly reserve provision [MW]
 315   
 316  ***** Transmission *****
 317  *--- Investment ---*
 318  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 319  c_fix_ntc                 Fixed costs [EUR per MW per a]
 320  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 321  inv_recovery_ntc          Investment costs: Recovery period in [a]
 322  inv_interest_ntc          Investment costs: Interest rate [%]
 323  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 324   
 325  *--- Topology and distance ---*
 326  inc              Incidence index of link l on node n
 327  dist             Distance covered by link l [km]
 328   
 329   
 330  ***** Electric vehicles *****
 331  *--- Costs and attributes ---*
 332  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 333  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 334  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 335  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 336  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 337   
 338  n_ev_e           Electric vehicle battery capacity [MWh]
 339  ev_quant         Overall number of electirc vehicles [#]
 340  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 341  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 342   
 343  *--- Temporal data ---*
 344  n_ev_p           Electric vehicle power rating [MWh]
 345  ev_ed            Electric vehicle electricity demand [MWh]
 346  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 347   
 348   
 349  ***** Prosumage *****
 350  phi_pro_load             Share of prosumagers among total load [0 1]
 351  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 352  m_res_pro                Maximum installable: renewables capacity [MW]
 353  m_sto_pro_e              Maximum installable: storage energy [MWh]
 354  m_sto_pro_p              Maximum installable: storage capacity [MW]
 355  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 356   
 357   
 358  ***** Reserves *****
 359  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 360  reserves_intercept       Intercept of regression line determining reserves
       demand
 361  reserves_slope           Slope of regression line determining reserves dem
      and
 362  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 363  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 364  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 365  *reserves_exog
 366   
 367   
 368  ***** Heat *****
 369  *--- Time data ---*
 370  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 371  dh_y                     Hourly heat demand per year [MWh per m2]
 372  dh                       Hourly heat demand [MWh per m2]
 373  temp_source              Heat pumps - source temperature [°Celsius]
 374  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 375  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 376  d_dhw                    Hourly DHW demand [MWh per m2]
 377  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 378   
 379  *--- Technololgy attributes ---*
 380  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 381  eta_heat_stat            Static efficiency for heating technologies [0 1]
 382  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 383  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 384  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 385  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 386  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 387  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 388  n_sets_p_out             SETS - Power rating - heat output [MW]
 389  n_sets_e                 SETS - Energy storage capacity [MWh]
 390  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 391  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 392  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 393  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 394  temp_sink                Heat pumps - sink temperature [°Celsius]
 395  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 396  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 397  theta_night              Indicator for night hours {0 1}
 398   
 399   
 400   
 401  ***************  DERIVED PARAMETERS  *************************************
      ******
 402   
 403  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 404  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 405   
 406  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 407  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 408   
 409  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 410  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 411   
 412  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 413  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 414   
 415  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 416  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 417   
 418  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 419   
 420  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 421  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 422   
 423  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 424  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 425  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 426  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 427  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 428  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 429   
 430   
 431   
 432   
 433  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 434   
 435  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 436  technology_data(tech,headers_tech)
 437  storage_data(sto,headers_sto)
 438  reservoir_data(rsvr,headers_reservoir)
 439  time_data_upload(h,year,headers_time)
 440  dsm_data_upload(dsm,dsm_type,headers_dsm)
 441  dsm_data(dsm,headers_dsm)
 442  topology_data(l,headers_topology)
 443  ev_data(ev,headers_ev)
 444  ev_time_data_upload(h,headers_time_ev,ev)
 445  prosumage_data_generation(tech,headers_prosumage_generation)
 446  prosumage_data_storage(sto,headers_prosumage_storage)
 447  reserves_time_data_activation(h,year,reserves)
 448  reserves_time_data_provision(h,year,reserves)
 449  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 450  reserves_data(reserves,headers_reserves)
 451  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 452  heat_data(bu,ch,headers_heat)
 453  dh_upload(h,year,headers_time_heat,bu)
 454  d_dhw_upload(h,year,headers_time_heat,bu)
 455  temp_source_upload
 456  ;
 457   
 458   
 459   
 460   
 461  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 462   
 525   
 526  *%skip_Excel%
 528   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
        Module\Modified_MCP\Data_input.gdx
--- LOAD  tech = 1:tech
--- LOAD  headers_tech = 2:headers_tech
--- LOAD  tech_dispatch = 3:tech_dispatch
--- LOAD  tech_res_con = 4:tech_res_con
--- LOAD  sto = 5:sto
--- LOAD  headers_sto = 6:headers_sto
--- LOAD  rsvr = 7:rsvr
--- LOAD  headers_reservoir = 8:headers_reservoir
--- LOAD  reservoir_data = 32:reservoir_data
--- LOAD  dsm = 9:dsm
--- LOAD  headers_dsm = 10:headers_dsm
--- LOAD  dsm_type = 11:dsm_type
--- LOAD  technology_data_upload = 30:technology_data_upload
--- LOAD  storage_data = 31:storage_data
--- LOAD  dsm_data_upload = 33:dsm_data_upload
 533  *$load l headers_topology topology_data
 534  *$ontext
 535  *$load l headers_topology topology_data
--- LOAD  ev = 14:ev
--- LOAD  headers_ev = 15:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 16:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 17:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 18:reserves
--- LOAD  reserves_up_down = 20:reserves_up_down
--- LOAD  reserves_spin_nonspin = 21:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 22:reserves_prim_nonprim
--- LOAD  headers_reserves = 19:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 23:bu
--- LOAD  ch = 24:ch
--- LOAD  heat_storage = 25:heat_storage
--- LOAD  heat_hp = 26:heat_hp
--- LOAD  heat_elec = 27:heat_elec
--- LOAD  heat_fossil = 28:heat_fossil
--- LOAD  headers_heat = 29:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 542  ;
 543   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 549   
 550   
 551  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 552   
 578   
 579   
 580  *
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
        Module\Modified_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 584  *$load headers_time_ev ev_time_data_upload
 585  *$load reserves_time_data_activation
 586  *$load reserves_time_data_provision
 587  *$load headers_time_heat dh_upload
 588  *$load theta_night
 589  *$load temp_source_upload
 590  *$load headers_time_dhw d_dhw_upload nets_profile
 591  ;
 592   
 593   
 594   
 595   
 596  ***************  ASSIGNMENTS  ********************************************
      ******
 597   
 598   
 599   
 600  ***** Aliases *****
 601  alias (h,hh) ;
 602  alias (res,resres) ;
 603  alias (reserves,reservesreserves) ;
 604  alias (nondis,nondisnondis) ;
 605   
 606   
 607   
 608  ***** Derived sets *****
 609  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 610  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 611   
 612  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 613  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 614   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserv
      es_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',
      reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,heade
      rs_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin
      _nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,he
      aders_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_s
      pin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), 
      reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_re
      serves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves
      ), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',head
      ers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_up
      load(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_dat
      a_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = y
      es;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data
      _upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_u
      pload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 636   
 637   
 638   
 639  ***** Parameters *****
 640   
 641  *--- Generation technologies ---*
 642  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 643  eta(tech) = technology_data(tech,'eta_con') ;
 644  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 645  c_up(dis) =technology_data(dis,'load change costs up') ;
 646  c_do(dis) = technology_data(dis,'load change costs down') ;
 647  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 648  c_vom(tech) = technology_data(tech,'variable_om') ;
 649  CO2price(tech) = technology_data(tech,'CO2_price') ;
 650   
 651  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 652  lifetime(tech) = technology_data(tech,'lifetime') ;
 653  recovery(tech) = technology_data(tech,'recovery_period') ;
 654  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 655  m_p(tech) = technology_data(tech,'max_installable') ;
 656  m_e(tech) = technology_data(tech,'max_energy') ;
 657  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 658  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 659   
 660  c_cu(res) = technology_data(res,'curtailment_costs') ;
 661   
 662   
 663  *--- Storage technologies ---*
 664  c_m_sto(sto) = storage_data(sto,'mc');
 665  eta_sto(sto) = storage_data(sto,'efficiency');
 666  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 667  phi_sto_ini(sto) = storage_data(sto,'level_start');
 668  etop_max(sto) = storage_data(sto,'etop_max') ;
 669   
 670  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 671  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 672  lifetime(sto) = storage_data(sto,'lifetime');
 673  interest_rate(sto) = storage_data(sto,'interest_rate');
 674  m_sto_e(sto) = storage_data(sto,'max_energy');
 675  m_sto_p(sto) = storage_data(sto,'max_power');
 676   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',head
      ers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',he
      aders_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,hea
      ders_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate') 
        ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 718   
 719  *--- Temporal data ---*
 720  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 721  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 722   
 723  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), ti
      me_data_upload(h,year,headers_time));
 724  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,ye
      ar,reserves) ;
 725  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,ye
      ar,reserves) ;
 726   
 727   
 728  *--- Spatial data ---*
 729  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 730  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 731  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 732  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 733  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 734  *m_ntc(l) = topology_data(l,'max_installable') ;
 735  *dist(l) = topology_data(l,'distance') ;
 736   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 753   
 754  *--- Prosumage ---*
 755  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 756  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 757  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 758  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 759   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_
      spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserve
      s_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on
      ') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_o
      ff') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_f
      ossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) 
      ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand
      ',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw'
      ) ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_sour
      ce') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_so
      urce') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply')
       ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 805   
 806   
 807  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 808   
 809  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 810   
 811  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 812                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 813   
 814  c_i_res(res) = c_i(res) ;
 815  c_fix_res(res) = c_fix(res) ;
 816   
 817  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 818                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 819   
 820  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 821                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) 
      * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)
      )-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_
      cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm
      _curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_inte
      rest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 )
       ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,
      headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec
      ,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,head
      ers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_
      fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AN
      D phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat
      ) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) 
      AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), he
      at_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AN
      D phi_heat_type(bu,ch)) = 1;
 850   
 851   
 852  ***************  Adjust costs to model's hourly basis ********************
      ******
 853   
 854  c_i(tech) = c_i(tech)*card(h)/8760 ;
 855  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 856  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 857  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 858  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 859  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 860  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 861  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 862   
 863  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 864  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 865  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 866  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 867  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 868   
 869  m_e('bio') = m_e('bio')*card(h)/8760 ;
 870   
 871  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 872   
 873  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 874  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 875  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(d
      sm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 876  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 877   
 878   
 879   
 880  ***************  Check for parameter sanity ******************************
      ******
 881   
 882  *Parameter
 883  *check_heat
 884  *check_heat_agg ;
 885  *check_heat(bu) = sum( ch , phi_heat_type(bu,ch)) ;
 886  *check_heat_agg = smax( (bu) , check_heat(bu) ) ;
 887  *abort$(check_heat_agg > 1) "DATA: heating technologies for a building typ
      e do not add up to 100 percent" ;
 888   
 889   
 890   
 891   
 892   
 893   
 894   
 895   
 896   
 897   
 898   
 899   
 900   
 901  **************************************************************************
      ******
 902   
 903  *************************************
 904  ***** Features for single nodes *****
 905  *************************************
 906   
 907   
 908  *Set
 909  *features /dsm, ev, reserves, prosumage, rsvr_outflow, heat/
 910  *;
 911   
 912   
 913  *Table
 914  *feat_node(features,n)
 915  *                 DE
 916   
 917  *%prosumage%$ontext
 918  *prosumage        1
 919  *$ontext
 920  *$offtext
 921  *rsvr_outflow     0
 922   
 923  *;
 924   
 925   
 926   
 927  *%prosumage%$ontext
 928  *m_res_pro(res)$(feat_node('prosumage',n) = 0) = 0 ;
 929  *m_sto_pro_e(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 930  *m_sto_pro_p(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
 931  *$ontext
 932  *$offtext
 933   
 934  *phi_rsvr_min(n) = 0
 935  *feat_node('rsvr_outflow',n)
 936  *;
 937   
 938   
 939   
 940   
 941  Set
 942  map_n_tech(tech)
 943  map_n_sto(sto)
 944  *map_n_rsvr(n,rsvr)
 945  *map_n_dsm(n,dsm)
 946  *map_n_ev(n,ev)
 947  *map_l(l)
 948  map_n_sto_pro(sto)
 949  map_n_res_pro(tech)
 950  ;
 951   
 952  map_n_tech(tech) = yes$m_p(tech) ;
 953  map_n_sto(sto) = yes$m_sto_p(sto) ;
 954  *map_n_rsvr(n,rsvr) = yes$m_rsvr_p(n,rsvr) ;
 955  *map_n_dsm(n,dsm_curt) = yes$m_dsm_cu(n,dsm_curt) ;
 956  *map_n_dsm(n,dsm_shift) = yes$m_dsm_shift(n,dsm_shift) ;
 957  *map_n_ev(n,ev) = yes$ev_data(n,ev,'share_ev') ;
 958  *map_l(l) = yes$m_ntc(l) ;
 959  map_n_sto_pro(sto) = yes$(yes$m_sto_pro_p(sto)) ;
 960  map_n_res_pro(res) = yes$(yes$m_res_pro(res)) ;
 961  ;
 962   
 963   
 964   
 965   
 966  **************************************************************************
      ******
 967   
 968  ***************************
 969  ***** Initialize data *****
 970  ***************************
 971   
 972  * Parameters for default base year
 973  d(h) = d_y('2030',h) ;
 974  phi_res(res,h) = phi_res_y('2030',res,h) ;
 975  *rsvr_in(n,rsvr,h) = rsvr_in_y(n,%base_year%,rsvr,h) ;
 976  *phi_reserves_call(n,reserves,h) = phi_reserves_call_y(n,%base_year%,reser
      ves,h) ;
 977  *phi_mean_reserves_call(n,reserves) = phi_mean_reserves_call_y(n,%base_yea
      r%,reserves) ;
 978  *reserves_exogenous(n,reserves,h) = reserves_exogenous_y(n,%base_year%,res
      erves,h) ;
 979  *dh(n,bu,ch,h) = dh_y(n,%base_year%,bu,ch,h) ;
 980  *d_dhw(n,bu,ch,h) = d_dhw_y(n,%base_year%,bu,ch,h) ;
 981   
 982  *dh(n,bu,ch,h) = area_floor(n,bu,ch) * dh(n,bu,ch,h) ;
 983  *d_dhw(n,bu,ch,h) = area_floor(n,bu,ch) * d_dhw(n,bu,ch,h) ;
 984   
 985   
 986  * No interconnections between non-adjacent or nonuploaded nodes
 987  *m_ntc(l)$( smax(n,inc(l,n)) = 0 OR smin(n,inc(l,n)) = 0 ) = 0 ;
 988   
 989   
 990  * Set loop parameters to default zero
 991  phi_min_res = 0 ;
 992  ev_quant = 0 ;
 993  phi_pro_self = 0 ;
 994  phi_pro_load = 0 ;
 995   
 996  *$ontext
 997  phi_pro_load = 0.2 ;
1000   
1001   
1002  Parameter
1003  phi_min_res_exog
1004  *min_flh(n,rsvr)
1005  ;
1006   
1007  phi_min_res_exog = 1 ;
1008  *min_flh(n,rsvr) = 0 ;
1009   
1010   
1011   
1012  **************************************************************************
      ******
1013  ***** Model *****
1014  **************************************************************************
      ******
1015   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\model.gms
1017   
1018  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1028  **************************************************************************
      ******
1029   
1030   
1031  Variables
1032  Z                Value objective function [Euro]
1033  F(l,h)           Energy flow over link l in hour h [MWh]
1034  ;
1035   
1036  Positive Variables
1037  G_L(tech,h)            Generation level in hour h [MWh]
1038  G_UP(tech,h)           Generation upshift in hour h [MWh]
1039  G_DO(tech,h)           Generation downshift in hour h [MWh]
1040   
1041  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
1042  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
1043   
1044  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
1045  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
1046  STO_L(sto,h)           Storage level technology sto hour h [MWh]
1047   
1048  N_TECH(tech)           Technology tech built [MW]
1049  N_STO_E(sto)           Storage technology built - Energy [MWh]
1050  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
1051   
1052  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generat
      ion in hour h [MWh]
1053  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h 
      [MWh]
1054  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market
       in hour h [MWh]
1055  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in 
      hour h [MWh]
1056  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation 
      for discharging to consumption in hour h [MWh]
1057  STO_IN_PRO2M(tech,sto,h)       Prosumage: storage loading from generation 
      for discharging to market in hour h [MWh]
1058  STO_IN_M2PRO(sto,h)            Prosumage: storage loading from market for 
      discharging to consumption in hour h [MWh]
1059  STO_IN_M2M(sto,h)              Prosumage: storage loading from market for 
      discharging to market in hour h [MWh]
1060  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumpti
      on from generation in hour h [MWh]
1061  STO_OUT_PRO2M(sto,h)           Prosumage: storage discharging to market fr
      om generation in hour h [MWh]
1062  STO_OUT_M2PRO(sto,h)           Prosumage: storage discharging to consumpti
      on from market in hour h [MWh]
1063  STO_OUT_M2M(sto,h)             Prosumage: storage discharging to market fr
      om market in hour h [MWh]
1064  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to cons
      umption in hour h [MWh]
1065  STO_L_PRO2M(sto,h)             Prosumage: storage level generation to mark
      et in hour h [MWh]
1066  STO_L_M2PRO(sto,h)             Prosumage: storage level market to consumot
      ion in hour h [MWh]
1067  STO_L_M2M(sto,h)               Prosumage: storage level market to market i
      n hour h [MWh]
1068  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
1069  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
1070  STO_L_PRO(sto,h)               Prosumage: overall storage level in hour h 
      [MWh]
1071  N_RES_PRO(tech)                Prosumage: installed renewables capacities 
      [MW]
1072   
1073  ;
1074   
1075   
1076   
1077   
1078  **************************************************************************
      ******
1079   
1080  Equations
1081  * Objective
1082  obj                      Objective cost minimization
1083   
1084  * Energy balance
1085  con1a_bal                Energy Balance
1086   
1087  * Load change costs
1088  con2a_loadlevel          Load change costs: Level
1089  con2b_loadlevelstart     Load change costs: Level for first period
1090   
1091  * Capacity contraints and flexibility constraints
1092  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1093  con3e_maxprod_res                Capacity constraints renewables
1094   
1095  * Storage constraints
1096  con4a_stolev_start        Storage Level Dynamics Initial Condition
1097  con4b_stolev              Storage Level Dynamics
1098  con4c_stolev_max          Storage Power Capacity
1099  con4d_maxin_sto           Storage maximum inflow
1100  con4e_maxout_sto          Storage maximum outflow
1101  con4j_ending              End level equal to initial level
1102  con4k_PHS_EtoP            Maximum E to P ratio for PHS
1103   
1104  * Minimum restrictions for renewables and biomass
1105  con5a_minRES             Minimum yearly renewables requirement
1106  con5b_max_energy         Maximum yearly biomass energy
1107   
1108  * Maximum installation conditions
1109  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
1110  con8b_max_I_sto_e                Maximum installable energy: Storage in MW
      h
1111  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
1112   
1113  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
1114  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
1115  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
1116   
1117  * Prosumage
1118  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
1119  con11b_pro_balance                       Prosumage: energy balance
1120  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
1121  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
1122  con11e_pro_stolev_PRO2M                  Prosumage: storage level prosumag
      ers-to-market
1123  con11f_pro_stolev_M2PRO                  Prosumage: storage level market-t
      o-prosumagers
1124  con11g_pro_stolev_M2M                    Prosumage: storage level market-t
      o-market
1125  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
1126  con11h_2_pro_stolev_start_PRO2M          Prosumage: storage level initial 
      conditions
1127  con11h_3_pro_stolev_start_M2PRO          Prosumage: storage level initial 
      conditions
1128  con11h_4_pro_stolev_start_M2M            Prosumage: storage level initial 
      conditions
1129  con11i_pro_stolev                        Prosumage: storage level total
1130  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
1131  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1132  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
1133  con11m_pro_maxout_lev                    Prosumage: maximum storage outflo
      w linked to level
1134  con11n_pro_maxin_lev                     Prosumage: maximum storage inflow
       linked to level
1135  con11o_pro_ending                        Prosumage: storage ending conditi
      on
1136  ;
1137   
1138   
1139   
1140   
1141  **************************************************************************
      ******
1142   
1143  * ------------------------------------------------------------------------
      ---- *
1144  ***** Objective function *****
1145  * ------------------------------------------------------------------------
      ---- *
1146   
1147  obj..
1148           Z =E=
1149                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1150                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1151                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1152                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1153                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
1154                   + sum( tech , c_i(tech)*N_TECH(tech) )
1155                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1156                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1157                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)
      ) )
1158                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
1159  *$ontext
1160                   + sum( res , c_i(res)*N_RES_PRO(res) )
1161                   + sum( res , c_fix(res)*N_RES_PRO(res) )
1162   
1163                   + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
1164                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E
      _PRO(sto)) )
1165                   + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
1166                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2M(sto,h) + sum( 
      res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h)) + STO_OUT_PRO2M
      (sto,h) + STO_OUT_M2M(sto,h) ) )
1169  ;
1170   
1171  * ------------------------------------------------------------------------
      ---- *
1172  ***** Energy balance and load levels *****
1173  * ------------------------------------------------------------------------
      ---- *
1174   
1175  * Energy balance
1176  con1a_bal(hh)..
1177           ( 1 - phi_pro_load )* d(hh) + sum( sto , STO_IN(sto,hh) )
1178  *$ontext
1179           + G_MARKET_M2PRO(hh)
1180           + sum( sto , STO_IN_M2PRO(sto,hh))
1181           + sum( sto , STO_IN_M2M(sto,hh))
1184   
1185           =E=
1186           sum( dis , G_L(dis,hh)) + sum( nondis , G_RES(nondis,hh)) + sum( 
      sto , STO_OUT(sto,hh) )
1187   
1188  *$ontext
1189           + sum( res , G_MARKET_PRO2M(res,hh) )
1190           + sum( sto , STO_OUT_PRO2M(sto,hh))
1191           + sum( sto , STO_OUT_M2M(sto,hh))
1194   
1195  ;
1196   
1197  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1198          G_L(dis,h) =E= G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)
1199  ;
1200   
1201  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1202           G_L(dis,h) =E= G_UP(dis,h)
1203  ;
1204   
1205  * ------------------------------------------------------------------------
      ---- *
1206  ***** Hourly maximum generation caps and constraints related to reserves  
       *****
1207  * ------------------------------------------------------------------------
      ---- *
1208   
1209  con3a_maxprod_dispatchable(dis,h)..
1210          G_L(dis,h)
1211   
1212          =L= N_TECH(dis)
1213  ;
1214   
1215  con3e_maxprod_res(nondis,h)..
1216          G_RES(nondis,h) + CU(nondis,h)
1217   
1218          =E= phi_res(nondis,h) * N_TECH(nondis)
1219  ;
1220   
1221  * ------------------------------------------------------------------------
      ---- *
1222  ***** Storage constraints *****
1223  * ------------------------------------------------------------------------
      ---- *
1224   
1225  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1226          STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(
      1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1227  ;
1228   
1229  con4b_stolev(sto,h)$((ord(h)>1))..
1230           STO_L(sto,h) =E= STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/
      2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
1231   
1232  ;
1233   
1234  con4c_stolev_max(sto,h)..
1235          STO_L(sto,h) =L= N_STO_E(sto)
1236  ;
1237   
1238  con4d_maxin_sto(sto,h)..
1239          STO_IN(sto,h)
1240   
1241          =L= N_STO_P(sto)
1242  ;
1243   
1244  con4e_maxout_sto(sto,h)..
1245          STO_OUT(sto,h)
1246   
1247          =L= N_STO_P(sto)
1248  ;
1249   
1250  con4j_ending(sto,h)$(ord(h) = card(h))..
1251           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
1252  ;
1253   
1254  con4k_PHS_EtoP(sto)..
1255          N_STO_E(sto) =L= etop_max(sto) * N_STO_P(sto)
1256  ;
1257   
1258  * ------------------------------------------------------------------------
      ---- *
1259  ***** Quotas for renewables and biomass *****
1260  * ------------------------------------------------------------------------
      ---- *
1261   
1262  con5a_minRES..
1263  sum( h , G_L('bio',h) + sum( nondis , G_RES(nondis,h))
1264   
1265  *$ontext
1266           + sum( sto , STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h)) + sum
      ( res , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
1269  )
1270          =G= phi_min_res * phi_min_res_exog * sum( h ,
1271           sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h))
1272   
1273  *$ontext
1274           + sum( res , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
1277           )
1278  ;
1279   
1280  con5b_max_energy(dis)$(m_e(dis))..
1281           sum( h , G_L(dis,h) ) =L= m_e(dis)
1282  ;
1283   
1284   
1285  * ------------------------------------------------------------------------
      ---- *
1286  ***** Maximum installation constraints *****
1287  * ------------------------------------------------------------------------
      ---- *
1288   
1289  con8a_max_I_power(tech)..
1290           N_TECH(tech) =L= m_p(tech)
1291  ;
1292   
1293  con8b_max_I_sto_e(sto)..
1294           N_STO_E(sto) =L= m_sto_e(sto)
1295  ;
1296   
1297  con8c_max_I_sto_p(sto)..
1298           N_STO_P(sto) =L= m_sto_p(sto)
1299  ;
1300   
1301   
1302   
1303  con8f_max_pro_res(res)..
1304           N_RES_PRO(res) =L= m_res_pro(res)
1305  ;
1306   
1307  con8g_max_pro_sto_e(sto)..
1308           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1309  ;
1310   
1311  con8h_max_sto_pro_p(sto)..
1312           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1313  ;
1314   
1315   
1316   
1317  * ------------------------------------------------------------------------
      ---- *
1318  ***** Prosumage constraints *****
1319  * ------------------------------------------------------------------------
      ---- *
1320   
1321  con11a_pro_distrib(res,h)..
1322           phi_res(res,h) * N_RES_PRO(res)
1323           =E=
1324           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
1325  ;
1326   
1327  con11b_pro_balance(h)..
1328           phi_pro_load * d(h)
1329           =E=
1330           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1331  ;
1332   
1333  con11c_pro_selfcon..
1334           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1335           =G=
1336           phi_pro_self * sum( h , phi_pro_load * d(h))
1337  ;
1338   
1339  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1340           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1341  ;
1342   
1343  con11e_pro_stolev_PRO2M(sto,h)$(ord(h) > 1)..
1344           STO_L_PRO2M(sto,h) =E= STO_L_PRO2M(sto,h-1) + sum( res , STO_IN_P
      RO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2M(sto,h)/(1+eta_sto(sto)
      )*2
1345  ;
1346   
1347  con11f_pro_stolev_M2PRO(sto,h)$(ord(h) > 1)..
1348           STO_L_M2PRO(sto,h) =E= STO_L_M2PRO(sto,h-1) + STO_IN_M2PRO(sto,h)
      *(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta_sto(sto))*2
1349  ;
1350   
1351  con11g_pro_stolev_M2M(sto,h)$(ord(h) > 1)..
1352           STO_L_M2M(sto,h) =E= STO_L_M2M(sto,h-1) + STO_IN_M2M(sto,h)*(1+et
      a_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(sto))*2
1353  ;
1354   
1355  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1356          STO_L_PRO2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO
      (sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT
      _PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1357  ;
1358   
1359  con11h_2_pro_stolev_start_PRO2M(sto,h)$(ord(h) = 1)..
1360          STO_L_PRO2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + sum( res , STO_IN_PRO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO
      2M(sto,h)/(1+eta_sto(sto))*2
1361  ;
1362   
1363  con11h_3_pro_stolev_start_M2PRO(sto,h)$( ord(h) = 1)..
1364          STO_L_M2PRO(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(s
      to) + STO_IN_M2PRO(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta
      _sto(sto))*2
1365  ;
1366   
1367  con11h_4_pro_stolev_start_M2M(sto,h)$(ord(h) = 1)..
1368          STO_L_M2M(sto,h) =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E_PRO(sto
      ) + STO_IN_M2M(sto,h)*(1+eta_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(s
      to))*2
1369  ;
1370   
1371  con11i_pro_stolev(sto,h)$(ord(h)>1)..
1372           STO_L_PRO(sto,h) =E=   STO_L_PRO2PRO(sto,h) +  STO_L_PRO2M(sto,h)
       + STO_L_M2PRO(sto,h) + STO_L_M2M(sto,h)
1373  ;
1374   
1375  con11j_pro_stolev_max(sto,h)..
1376          STO_L_PRO(sto,h) =L= N_STO_E_PRO(sto)
1377  ;
1378   
1379  con11k_pro_maxin_sto(sto,h)..
1380          sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) ) +
       STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h)
1381          =L= N_STO_P_PRO(sto)
1382  ;
1383   
1384  con11l_pro_maxout_sto(sto,h)..
1385          STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2PRO(sto,
      h) + STO_OUT_M2M(sto,h)
1386          =L= N_STO_P_PRO(sto)
1387  ;
1388   
1389  con11m_pro_maxout_lev(sto,h)..
1390          ( STO_OUT_PRO2PRO(sto,h) + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(st
      o,h) + STO_OUT_M2M(sto,h) ) / (1+eta_sto(sto))*2
1391          =L= STO_L_PRO(sto,h-1)
1392  ;
1393   
1394  con11n_pro_maxin_lev(sto,h)..
1395          ( sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
       + STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h) ) * (1+eta_sto(sto))/2
1396          =L= N_STO_E_PRO(sto) - STO_L_PRO(sto,h-1)
1397  ;
1398   
1399  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1400           STO_L_PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1401  ;
1402   
1403   
1404  **************************************************************************
      ******
1405  ***** MODEL *****
1406  **************************************************************************
      ******
1407   
1408  model DIETER /
1409  obj
1410   
1411  con1a_bal
1412   
1413  con2a_loadlevel
1414  con2b_loadlevelstart
1415   
1416  con3a_maxprod_dispatchable
1417   
1418  con3e_maxprod_res
1419   
1420  con4a_stolev_start
1421  con4b_stolev
1422  con4c_stolev_max
1423  con4d_maxin_sto
1424  con4e_maxout_sto
1425   
1426  con4j_ending
1427  con4k_PHS_EtoP
1428   
1429  con5a_minRES
1430  con5b_max_energy
1431   
1432  con8a_max_I_power
1433  con8b_max_I_sto_e
1434  con8c_max_I_sto_p
1435   
1436  *$ontext
1437  con8f_max_pro_res
1438  con8g_max_pro_sto_e
1439  con8h_max_sto_pro_p
1440  con11a_pro_distrib
1441  con11b_pro_balance
1442  con11c_pro_selfcon
1443  con11d_pro_stolev_PRO2PRO
1444  con11e_pro_stolev_PRO2M
1445  con11f_pro_stolev_M2PRO
1446  con11g_pro_stolev_M2M
1447  con11h_1_pro_stolev_start_PRO2PRO
1448  con11h_2_pro_stolev_start_PRO2M
1449  con11h_3_pro_stolev_start_M2PRO
1450  con11h_4_pro_stolev_start_M2M
1451  con11i_pro_stolev
1452  con11j_pro_stolev_max
1453  con11k_pro_maxin_sto
1454  con11l_pro_maxout_sto
1455  con11m_pro_maxout_lev
1456  con11n_pro_maxin_lev
1457  con11o_pro_ending
1460   
1461  /;
1462   
1463   
1464   
1465   
1466  **************************************************************************
      ******
1467  ***** Options, fixings, report preparation *****
1468  **************************************************************************
      ******
1469   
1470  * Solver options
1476   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1487   
1488  dieter.OptFile = 1;
1489  dieter.holdFixed = 1 ;
1490   
1491   
1492   
1493   
1494  **************************************************************************
      ******
1495  ***** Solve *****
1496  **************************************************************************
      ******
1497   
1498  * Preparation of GUSS tool for scenario analysis
1499  phi_min_res = eps ;
1500  ev_quant = eps ;
1501  phi_pro_self = eps ;
1502   
1504   
1505  Set
1506  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1507  superscen        Scenarios                               /scen1*scen1000/
1508  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1509  ;
1510   
1511  set
1512  scen(superscen);
1513  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) )    ;
1514   
1515  Parameters
1516  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1517  modstats(superscen, modelstats)
1518  min_res
1519  *number_ev
1520  pro_selfcon
1521  ;
1522   
1523  min_res(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_sha
      re,loop_prosumage) , loop_res_share.val/100 ) ;
1524  *number_ev(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_
      share,loop_prosumage) , loop_ev.val ) ;
1525  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res
      _share,loop_prosumage) , loop_prosumage.val/100 ) ;
1526   
1527  Parameters
1528  * Equations
1529  marginal_con5a(superscen)
1530  marginal_con1a(superscen,*)
1531  marginal_con9a(superscen,*,*,*)
1532  marginal_con9b(superscen,*,*,*)
1533   
1534  * Basic
1535  lev_Z(superscen)
1536  lev_G_L(superscen,tech,h)
1537  lev_G_UP(superscen,tech,h)
1538  lev_G_DO(superscen,tech,h)
1539  lev_G_RES(superscen,tech,h)
1540  lev_CU(superscen,tech,h)
1541  lev_STO_IN(superscen,sto,h)
1542  lev_STO_OUT(superscen,sto,h)
1543  lev_STO_L(superscen,sto,h)
1544  lev_N_TECH(superscen,tech)
1545  lev_N_STO_E(superscen,sto)
1546  lev_N_STO_P(superscen,sto)
1547   
1548   
1549  * Prosumage
1550  lev_CU_PRO(superscen,tech,h)
1551  lev_G_MARKET_PRO2M(superscen,tech,h)
1552  lev_G_MARKET_M2PRO(superscen,h)
1553  lev_G_RES_PRO(superscen,tech,h)
1554  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1555  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1556  lev_STO_IN_M2PRO(superscen,sto,h)
1557  lev_STO_IN_M2M(superscen,sto,h)
1558  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1559  lev_STO_OUT_PRO2M(superscen,sto,h)
1560  lev_STO_OUT_M2PRO(superscen,sto,h)
1561  lev_STO_OUT_M2M(superscen,sto,h)
1562  lev_STO_L_PRO2PRO(superscen,sto,h)
1563  lev_STO_L_PRO2M(superscen,sto,h)
1564  lev_STO_L_M2PRO(superscen,sto,h)
1565  lev_STO_L_M2M(superscen,sto,h)
1566  lev_N_STO_E_PRO(superscen,sto)
1567  lev_N_STO_P_PRO(superscen,sto)
1568  lev_STO_L_PRO(superscen,sto,h)
1569  lev_N_RES_PRO(superscen,tech)
1570  ;
1571   
1572   
1573  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\fix.gms
1575   
1576  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1586  **************************************************************************
      ******
1587   
1588   
1589   
1590  **************************************************************************
      ******
1591  **** Run of river  *******************************************************
      ******
1592  **************************************************************************
      ******
1593   
1594  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1595   
1596  *$ontext
1597  N_TECH.fx('ror') = 5857.47 ;
1598  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1601   
1602  * Fix everything to zero in case no ROR option is selected:
1603  *N_TECH.fx('ror') = 0 ;
1604  *G_RES.fx('ror',h) = 0 ;
1605  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1606   
1607   
1608   
1609  **************************************************************************
      ******
1610  **** Exogenous EV  *******************************************************
      ******
1611  **************************************************************************
      ******
1612   
1613   
1614   
1615  **************************************************************************
      ******
1616  **** No storage and DSM in first period  *********************************
      ******
1617  **************************************************************************
      ******
1618   
1619  ** No storage inflow in first period **
1620  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1621   
1622   
1623   
1624  **************************************************************************
      ******
1625  **** No primary reserves by heating devices  *****************************
      ******
1626  **************************************************************************
      ******
1627   
1628   
1629  **************************************************************************
      ******
1630  **** Fixing to reduce model size  ****************************************
      ******
1631  **************************************************************************
      ******
1632   
1633  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1634  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1635   
1636  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1637  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1638  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1639  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1640  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1641  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1642   
1643  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1644  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1645  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1646  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1647  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1648   
1649   
1650  *$ontext
1651  CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
1652  G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1653  *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
1654  G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
1655  STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1656  STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1657  STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1658  STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1659  STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1660  STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1661  STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1662  STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1663  STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1664  STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1665  STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1666  STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1667  N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1668  N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
1669  STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
1670  N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
1673   
1674   
1675   
1676  **************************************************************************
      ******
1677  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1678  **************************************************************************
      ******
1679   
1680  * Default level zero for report parameters
1681  lev_Z(scen) = 0 ;
1682  lev_G_L(scen,tech,h) = 0 ;
1683  lev_G_UP(scen,tech,h) = 0 ;
1684  lev_G_DO(scen,tech,h) = 0 ;
1685  lev_G_RES(scen,tech,h) = 0 ;
1686  lev_CU(scen,tech,h) = 0 ;
1687  lev_STO_IN(scen,sto,h) = 0 ;
1688  lev_STO_OUT(scen,sto,h) = 0 ;
1689  lev_STO_L(scen,sto,h) = 0 ;
1690  lev_N_TECH(scen,tech) = 0 ;
1691  lev_N_STO_E(scen,sto) = 0 ;
1692  lev_N_STO_P(scen,sto) = 0 ;
1693  marginal_con1a(scen,h) = 0 ;
1694  marginal_con5a(superscen) = 0 ;
1695  *lev_NTC(superscen,l) = 0 ;
1696  *lev_F(superscen,l,h) = 0 ;
1697  *lev_RSVR_OUT(superscen,rsvr,h) = 0 ;
1698  *lev_RSVR_L(superscen,rsvr,h) = 0 ;
1699  *lev_N_RSVR_E(superscen,rsvr) = 0 ;
1700  *lev_N_RSVR_P(superscen,rsvr) = 0 ;
1701  *lev_G_INFES(superscen,h) = 0 ;
1702   
1703   
1704  * Prosumage
1705  lev_CU_PRO(scen,tech,h) = 0 ;
1706  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1707  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1708  lev_G_RES_PRO(scen,tech,h) = 0  ;
1709  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1710  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1711  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1712  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1713  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1714  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1715  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1716  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1717  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1718  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1719  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1720  lev_STO_L_M2M(scen,sto,h) = 0  ;
1721  lev_N_STO_E_PRO(scen,sto) = 0  ;
1722  lev_N_STO_P_PRO(scen,sto) = 0  ;
1723  lev_STO_L_PRO(scen,sto,h) = 0  ;
1724  lev_N_RES_PRO(scen,tech) = 0  ;
1725   
1726   
1727  * Fixing of report parameters for run-of-river
1728  *$ontext
1729  lev_N_TECH(scen,'ror') = 5857.47 ;
1730  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1740   
1741   
1742   
1743   
1744   
1745   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\scenario.gms
1747   
1748  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1758  **************************************************************************
      ******
1759   
1760   
1761   
1762   
1763  *****************************************
1764  **** Scenario file                   ****
1765  ****                                 ****
1766  *****************************************
1767   
1768  Parameter
1769  m_exog_p(tech)
1770  m_exog_sto_e(sto)
1771  m_exog_sto_p(sto)
1772  *m_exog_rsvr_p(rsvr)
1773  *m_exog_ntc(l)
1774  ;
1775   
1776  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1777  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1778  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1779  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1780  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1781   
1782   
1783  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1800   
1801  *** Investment model
1802  *$ontext
1803  N_TECH.lo(tech) = 0 ;
1804  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1805  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1806  N_TECH.lo('pv') = m_exog_p('pv') ;
1807  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1808  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1809  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1810  *NTC.lo(l) = m_exog_ntc(l) ;
1811   
1812  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1813  N_TECH.up('wind_on') = inf ;
1814  N_TECH.up('wind_off') = inf ;
1815  N_TECH.up('pv') = inf ;
1816  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1817  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1818  N_STO_P.up('sto1') = inf ;
1819  N_STO_P.up('sto5') = inf ;
1820  N_STO_P.up('sto7') = inf ;
1821  N_STO_E.up('sto1') = inf ;
1822  N_STO_E.up('sto5') = inf ;
1823  N_STO_E.up('sto7') = inf ;
1824  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1825  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1826  *$offtext
1827   
1828   
1829  *** Reservoir assumption - not used here
1830  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1831  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1832  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1833  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1834   
1835   
1836  *** Germany only, no infeasibility
1837  *NTC.fx(l) = 0 ;
1838  *F.fx(l,h) = 0 ;
1839  *G_INFES.fx(h) = 0 ;
1840   
1841   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) +
       d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp
      _gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp
      _as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) )
       ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,
      ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1872   
1873   
1874  * Definition of dictionary set for GUSS tool
1875   
1876  Set dict(*,*,*) /
1877  scen             .scenario       .''
1878  gussoptions      .opt            .modstats
1879   
1880  phi_min_res      .param          .min_res
1881   
1882  *$ontext
1883  phi_pro_self     .param          .pro_selfcon
1886   
1887   
1888  con5a_minRES     .marginal       .marginal_con5a
1889  con1a_bal        .marginal       .marginal_con1a
1890   
1891  Z                .level          .lev_Z
1892  G_L              .level          .lev_G_L
1893  G_UP             .level          .lev_G_UP
1894  G_DO             .level          .lev_G_DO
1895  G_RES            .level          .lev_G_RES
1896  CU               .level          .lev_CU
1897  STO_IN           .level          .lev_STO_IN
1898  STO_OUT          .level          .lev_STO_OUT
1899  STO_L            .level          .lev_STO_L
1900  N_TECH           .level          .lev_N_TECH
1901  N_STO_E          .level          .lev_N_STO_E
1902  N_STO_P          .level          .lev_N_STO_P
1903   
1904   
1905  *$ontext
1906  CU_PRO           .level          .lev_CU_PRO
1907  G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
1908  G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
1909  G_RES_PRO        .level          .lev_G_RES_PRO
1910  STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
1911  STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
1912  STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
1913  STO_IN_M2M       .level          .lev_STO_IN_M2M
1914  STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
1915  STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
1916  STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
1917  STO_OUT_M2M      .level          .lev_STO_OUT_M2M
1918  STO_L_PRO        .level          .lev_STO_L_PRO
1919  STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
1920  STO_L_PRO2M      .level          .lev_STO_L_PRO2M
1921  STO_L_M2PRO      .level          .lev_STO_L_M2PRO
1922  STO_L_M2M        .level          .lev_STO_L_M2M
1923  N_STO_E_PRO      .level          .lev_N_STO_E_PRO
1924  N_STO_P_PRO      .level          .lev_N_STO_P_PRO
1925  N_RES_PRO        .level          .lev_N_RES_PRO
1928  /
1929  ;
1930   
1931  solve DIETER using lp min Z scenario dict;
1932   
1933   
1934  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\report.gms
1936   
1937  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1947  **************************************************************************
      ******
1948   
1950   
1951   
1952   
1953   
1954  **************************************************************************
      ******
1955  **** Parameters for report file  *****************************************
      ******
1956  **************************************************************************
      ******
1957   
1958  Parameter
1959  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1960  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1961  corr_fac_sto             Balancing correction factor - storage technologie
      s
1962  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1963  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1964  corr_fac_ev              Balancing correction factor - electric vehicles
1965  corr_fac_rsvr            Balancing correction factor - reservoir
1966  corr_fac_sets            Balancing correction factor - SETS
1967  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1968  corr_fac_hp              Balancing correction factor - heat pumps
1969  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
1970   
1971  corr_fac_ev_sep
1972   
1973  gross_energy_demand                      Gross energy demand
1974  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
1975  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1976  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
1977  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
1978   
1979  reserves_activated
1980   
1981  calc_maxprice
1982  calc_minprice
1983   
1984  report
1985  report_tech
1986  report_tech_hours
1987  report_hours
1988  report_node
1989  report_line
1990  report_cost
1991   
1992  report_reserves
1993  report_reserves_hours
1994  report_reserves_tech
1995  report_reserves_tech_hours
1996   
1997  report_prosumage
1998  report_prosumage_tech
1999  report_prosumage_tech_hours
2000  report_market
2001  report_market_tech
2002  report_market_tech_hours
2003   
2004  report_heat_tech_hours
2005  report_heat_tech
2006  ;
2007   
2008   
2009   
2010   
2011  **************************************************************************
      ******
2012  **** Initialize reporting paremetrs  *************************************
      ******
2013  **************************************************************************
      ******
2014   
2015  * Set reporting sensitivity. All results below will be reported as zero
2016  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
2017  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
2018  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
2019   
2020   
2021  * ------------------------------------------------------------------------
      ----
2022   
2023  * Min and max for prices
2024  calc_maxprice = 0 ;
2025  calc_minprice = 1000 ;
2026   
2027   
2028  * ------------------------------------------------------------------------
      ----
2029   
2030  * Default values for correction factors
2031  corr_fac_dis(scen,dis,h) = 0 ;
2032  corr_fac_nondis(scen,nondis,h) = 0 ;
2033  corr_fac_sto(scen,sto,h) = 0 ;
2034  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2035  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2036  *corr_fac_ev(scen,h) = 0 ;
2037  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2038  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2039  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2040  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2041  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2042   
2043  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2044   
2045   
2046  * ------------------------------------------------------------------------
      ----
2047   
2048  * Parameter for hourly nodal reserves activated
2049  reserves_activated(scen,h) = 0 ;
2050   
2051   
2052   
2053   
2054   
2055  * ------------------------------------------------------------------------
      ----
2056   
2057  * Prepare prosumage reporting parameters
2058  *$ontext
2059  gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
2060  gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(
      scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
2061  gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(sc
      en,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
2064   
2065   
2066  * ------------------------------------------------------------------------
      ----
2067   
2068  *Determine balancing correction factors
2069   
2070   
2071   
2072   
2073  * ------------------------------------------------------------------------
      ----
2074   
2075  * Define gross energy demand for reporting
2076  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
2077  *$ontext
2078           + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
2081   
2082   
2083  )
2084  ;
2085   
2086   
2087  **************************************************************************
      ******
2088  **** Report  *************************************************************
      ******
2089  **************************************************************************
      ******
2090   
2091  * RPEORT model statistics
2092          report('model status',loop_res_share,loop_prosumage) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2093          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2094          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2095   
2096   
2097  * ------------------------------------------------------------------------
      ----
2098   
2099  * REPORT HOURS
2100          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
2101          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
      sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(sc
      en,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sce
      n,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,
      h))
2102  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2103  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2104  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsv
      r , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2105  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + 
      sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,
      sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2106  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2107  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* l
      ev_F(scen,l,h),0) )) ;
2108  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= su
      m( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* le
      v_F(scen,l,h),0) ) ) ;
2109          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2110   
2111                   report_hours('energy generated',loop_res_share,loop_prosu
      mage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)<
       eps_rep_abs ) = 0 ;
2112                   report_hours('energy demanded',loop_res_share,loop_prosum
      age,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< e
      ps_rep_abs ) = 0 ;
2113  *                 report_hours('gross exports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2114  *                 report_hours('gross imports',loop_res_share,loop_prosuma
      ge,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_
      rep_abs ) = 0 ;
2115                   report_hours('demand consumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2116                   report_hours('price',loop_res_share,loop_prosumage,h)$(re
      port_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND repor
      t_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2117  *                 report_hours('infeasibility',loop_res_share,loop_prosuma
      ge,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_
      rep_abs) = 0 ;
2118   
2119   
2120  * ------------------------------------------------------------------------
      ----
2121   
2122  * REPORT TECH HOURS
2123          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2124  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(sc
      en,h) ) ;
2125          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2126  *        report_tech_hours('generation renewable',loop_res_share,loop_pros
      umage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RS
      VR_OUT(scen,rsvr,h) ) ;
2127  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumag
      e,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rs
      vr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2128  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage
      ,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(
      scen,rsvr,h) ) ;
2129          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2130          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2131          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
2132          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2133  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'
      ',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc
      (l)* lev_F(scen,l,h)) ) ;
2134   
2135                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_
      res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2136                   report_tech_hours('generation renewable',loop_res_share,l
      oop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_sh
      are,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2137  *  star added        report_tech_hours('generation renewable',loop_res_sha
      re,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_r
      es_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2138                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2139                   report_tech_hours('generation storage',loop_res_share,loo
      p_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,
      loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2140                   report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_p
      rosumage,sto,h)< eps_rep_abs) = 0 ;
2141                   report_tech_hours('storage level',loop_res_share,loop_pro
      sumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosu
      mage,sto,h)< eps_rep_abs) = 0 ;
2142  *                 report_tech_hours('netto exports',loop_res_share,loop_pr
      osumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_p
      rosumage,'',h)) < eps_rep_abs ) = 0 ;
2143  *                 report_tech_hours('infeasibility',loop_res_share,loop_pr
      osumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosu
      mage,'',h)< eps_rep_abs ) = 0 ;
2144  *                 report_tech_hours('reservoir inflow',loop_res_share,loop
      _prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,lo
      op_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2145  *                 report_tech_hours('reservoir level',loop_res_share,loop_
      prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop
      _prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2146   
2147   
2148  * ------------------------------------------------------------------------
      ----
2149   
2150  * RPEORT LINE
2151   
2152  * ------------------------------------------------------------------------
      ----
2153   
2154  * REPORT NODE
2155          report_node('energy demand total',loop_res_share,loop_prosumage)= 
      (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,
      h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2156   
2157  ;
2158          report_node('energy demand gross',loop_res_share,loop_prosumage)= 
      sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(
      scen)) ;
2159          report_node('energy generated net',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_n
      ondis(scen,nondis,h))
2160  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr
      ,h))
2161           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PR
      O(scen,res,h)) )) ;
2162          report_node('energy generated gross',loop_res_share,loop_prosumage
      )= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis 
      , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac
      _nondis(scen,nondis,h))
2163  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,
      h))
2164           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2165  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shi
      ft(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum
      ( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2166  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(sc
      en,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )
      ) ;
2167  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l
      ,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F
      (scen,l,h)) ) ;
2168  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* 
      lev_F(scen,l,h),0) ) ) ;
2169  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( 
      (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* l
      ev_F(scen,l,h),0) ) ) ;
2170  *        report_node('net import share in gross demand',loop_res_share,loo
      p_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage
      ),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2171  *        report_node('net export share in net generation',loop_res_share,l
      oop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumag
      e),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2172  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum(
       scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev
      _NTC(scen,l))) ) ;
2173  *        report_node('gross import share',loop_res_share,loop_prosumage)= 
      sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ s
      um( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2174  *        report_node('gross export share in net generation',loop_res_share
      ,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loo
      p_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,lo
      op_prosumage,h)) ;
2175          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2176  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RSVR_P(scen,rsvr)))
2177   
2178  ;
2179          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2180          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) +
       sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis
      ,h) * (lev_N_TECH(scen,nondis))))) ;
2181          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2182          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2183          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2184          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , - marginal_con1a(scen,h))) ) ;
2185          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_
      con1a(scen,h)))/card(h) ;
2186   
2187                   report_node('energy demand total',loop_res_share,loop_pro
      sumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)<
       eps_rep_abs) = 0 ;
2188                   report_node('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loo
      p_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2189                   report_node('curtailment of fluct res relative',loop_res_
      share,loop_prosumage)$(report_node('curtailment of fluct res relative',loo
      p_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2190                   report_node('bio not utilized absolute',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop
      _prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2191                   report_node('bio not utilized relative',loop_res_share,lo
      op_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop
      _prosumage)< eps_rep_rel) = 0 ;
2192                   report_node('min price',loop_res_share,loop_prosumage)$(r
      eport_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND rep
      ort_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2193  *                 report_node('gross exports',loop_res_share,loop_prosumag
      e)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2194  *                 report_node('gross imports',loop_res_share,loop_prosumag
      e)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_ab
      s*card(h)) = 0 ;
2195  *                 report_node('net exports',loop_res_share,loop_prosumage)
      $(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_
      abs*card(h)) = 0 ;
2196                   report_node('energy generated net',loop_res_share,loop_pr
      osumage)$(report_node('energy generated net',loop_res_share,loop_prosumage
      )< eps_rep_abs*card(h)) = 0 ;
2197                   report_node('energy generated gross',loop_res_share,loop_
      prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosu
      mage)< eps_rep_abs) = 0 ;
2198                   report_node('energy demand gross',loop_res_share,loop_pro
      sumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)<
       eps_rep_abs*card(h)) = 0 ;
2199  *                 report_node('net import share in gross demand',loop_res_
      share,loop_prosumage)$(report_node('net import share in gross demand',loop
      _res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2200  *                 report_node('net export share in net generation',loop_re
      s_share,loop_prosumage)$(report_node('net export share in net generation',
      loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2201                   report_node('Capacity total',loop_res_share,loop_prosumag
      e)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_i
      ns) = 0 ;
2202  *                 report_node('gross import share',loop_res_share,loop_pro
      sumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< 
      eps_rep_rel ) = 0 ;
2203  *                 report_node('gross export share in net generation',loop_
      res_share,loop_prosumage)$(report_node('gross export share in net generati
      on',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2204   
2205   
2206  * ------------------------------------------------------------------------
      ----
2207   
2208  * REPORT COST
2209          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,
      nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO
      _IN(scen,sto,h) ) )
2210   
2211  ));
2212           report_cost('Nodal cost: investment & fix',loop_res_share,loop_pr
      osumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech ,
       c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + s
      um( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_S
      TO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,st
      o) )
2213  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr
      _p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rs
      vr))
2214   
2215  *$ontext
2216                   + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
2219  );
2220   
2221  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_pros
      umage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_in
      fes * lev_G_INFES(scen,h)) ) ;
2222  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumag
      e)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen
      _phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2223  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst
      ,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2224           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2225  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2226  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2227  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage
      )
2228   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen
      ,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_pr
      osumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage
      )< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share
      ,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_shar
      e,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,lo
      op_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop
      _prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_p
      rosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosuma
      ge)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,l
      oop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,lo
      op_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosu
      mage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps
      _rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l
      )$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_in
      s) = 0 ;
2240   
2241  * ------------------------------------------------------------------------
      ----
2242   
2243  * REPORT TECH
2244          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2245          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2246  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosuma
      ge,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSV
      R_P(scen,rsvr));
2247  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosum
      age,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RS
      VR_E(scen,rsvr));
2248          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2249          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2250   
2251          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2252          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2253  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)=
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rs
      vr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2254          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2255          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2256   
2257          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2258  *        report_tech('renshares in nodal gross demand',loop_res_share,loop
      _prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2259          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2260          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2261  *        report_tech('renshares in nodal net generation',loop_res_share,lo
      op_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_
      prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',
      loop_res_share,loop_prosumage)) ;
2262          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2263   
2264          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2265          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_r
      ep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) 
      + lev_N_RES_PRO(scen,res) ))) ) ;
2266   
2267          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 1 ;
2268          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 1 ;
2269   
2270          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_TECH(scen,con)) ;
2271          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO
      2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) 
      - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_TECH(scen,res)) ;
2272  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_
      rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2273          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2274   
2275   
2276                   report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop
      _prosumage,con)< eps_rep_ins) = 0 ;
2277                   report_tech('capacities renewable',loop_res_share,loop_pr
      osumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosu
      mage,res)< eps_rep_ins) = 0 ;
2278                   report_tech('capacities storage MW',loop_res_share,loop_p
      rosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_pro
      sumage,sto)< eps_rep_ins) = 0 ;
2279                   report_tech('capacities storage MWh',loop_res_share,loop_
      prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_p
      rosumage,sto)< eps_rep_ins) = 0 ;
2280  *                 report_tech('capacities reservoir MW',loop_res_share,loo
      p_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,lo
      op_prosumage,rsvr)< eps_rep_ins) = 0 ;
2281  *                 report_tech('capacities reservoir MWh',loop_res_share,lo
      op_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,
      loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2282                   report_tech('renshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loo
      p_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2283  *                 report_tech('renshares in nodal gross demand',loop_res_s
      hare,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',l
      oop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2284                   report_tech('conshares in nodal gross demand',loop_res_sh
      are,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loo
      p_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2285                   report_tech('renshares in nodal net generation',loop_res_
      share,loop_prosumage,res)$(report_tech('renshares in nodal net generation'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2286  *                 report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generatio
      n',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2287                   report_tech('conshares in nodal net generation',loop_res_
      share,loop_prosumage,con)$(report_tech('conshares in nodal net generation'
      ,loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2288                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute'
      ,loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2289                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative'
      ,loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2290                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< e
      ps_rep_rel) = 0 ;
2291                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< e
      ps_rep_rel) = 0 ;
2292  *                 report_tech('Capacity share',loop_res_share,loop_prosuma
      ge,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)
      < eps_rep_rel) = 0 ;
2293                   report_tech('Capacity share',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< e
      ps_rep_rel) = 0 ;
2294                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2295                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2296  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(r
      eport_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2297                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2298                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2299                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_re
      s_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2300   
2301   
2302  * ------------------------------------------------------------------------
      ----
2303   
2304  * REPORT NODE
2305          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))
2306  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_
      res_share,loop_prosumage,rsvr))
2307           ;
2308          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2309  *        report_node('net import share in nodal gross demand',loop_res_sha
      re,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosum
      age)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_d
      emand(scen)) ;
2310          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res))
2311  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_sh
      are,loop_prosumage,rsvr))
2312           ;
2313          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2314   
2315                   report_node('renshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2316                   report_node('conshare in nodal gross demand',loop_res_sha
      re,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_
      share,loop_prosumage)< eps_rep_rel ) = 0 ;
2317                   report_node('renshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('renshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2318                   report_node('conshare in nodal net generation',loop_res_s
      hare,loop_prosumage)$(report_node('conshare in nodal net generation',loop_
      res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2319   
2320   
2321   
2322  * ------------------------------------------------------------------------
      ----
2323   
2324  * REPORT TECH
2325          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2326          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2327  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= 
      sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT
      (scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2328          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2329   
2330          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2331          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 1 + 1e-9 ;
2332  *        report_tech('Energy share in nodal gross generation',loop_res_sha
      re,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / 
      report_node('energy generated gross',loop_res_share,loop_prosumage)* %sec_
      hour% + 1e-9 ;
2333          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2334          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2335          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,l
      oop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(s
      cen,sto) ) * 1 ;
2336   
2337                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps
      _rep_ins ) = 0 ;
2338                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps
      _rep_ins ) = 0 ;
2339  *                 report_tech('Yearly energy',loop_res_share,loop_prosumag
      e,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< 
      eps_rep_ins ) = 0 ;
2340                   report_tech('Yearly energy',loop_res_share,loop_prosumage
      ,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps
      _rep_ins ) = 0 ;
2341   
2342                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2343                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2344  *                 report_tech('Energy share in nodal gross generation',loo
      p_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross
       generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2345                   report_tech('Energy share in nodal gross generation',loop
      _res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross g
      eneration',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2346                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2347                   report_tech('Storage cycles',loop_res_share,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< e
      ps_rep_abs) = 0 ;
2348   
2349   
2350  * ------------------------------------------------------------------------
      ----
2351   
2352  * RPEORT
2353          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2354          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2355          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2356          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2357          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2358          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2359          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2360          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2361          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2362  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( 
      (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( 
      (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2363          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))
2364  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,
      h)))
2365           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_e
      nergy_demand(scen) ) ;
2366          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2367          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2368   
2369                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_shar
      e,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2370                   report('curtailment of fluct res relative',loop_res_share
      ,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_shar
      e,loop_prosumage) < eps_rep_rel) = 0 ;
2371                   report('bio not utilized absolute',loop_res_share,loop_pr
      osumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage
      ) < eps_rep_abs*card(h)) = 0 ;
2372                   report('bio not utilized relative',loop_res_share,loop_pr
      osumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage
      ) < eps_rep_rel) = 0 ;
2373                   report('Capacity total',loop_res_share,loop_prosumage)$(r
      eport('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2374                   report('gross trade share',loop_res_share,loop_prosumage)
      $(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel 
      ) = 0 ;
2375                   report('renshare total',loop_res_share,loop_prosumage)$(r
      eport('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2376                   report('conshare total',loop_res_share,loop_prosumage)$(r
      eport('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 
      ;
2377                   report('Energy total',loop_res_share,loop_prosumage)$(rep
      ort('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2378   
2379   
2380  * ------------------------------------------------------------------------
      ----
2381   
2382  * DSM
2383   
2384   
2385  * ------------------------------------------------------------------------
      ----
2386   
2387  * EV
2388   
2389   
2390   
2391  * ------------------------------------------------------------------------
      ----
2392   
2393  * Reserves
2394   
2395   
2396   
2397   
2398  * ------------------------------------------------------------------------
      ----
2399   
2400  * Reserves and DSM
2401   
2402   
2403  * ------------------------------------------------------------------------
      ----
2404   
2405  * ------------------------------------------------------------------------
      ----
2406   
2407  * PROSUMAGE
2408  *$ontext
2409          report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      phi_pro_load * d(h) ;
2410          report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 
      - phi_pro_load) * d(h) ;
2411          gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
2412   
2413          report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
2414          report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
2415          report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
2416          report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
2417          report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
2418          report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
2419          report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
2420          report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
2421          report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
2422          report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
2423          report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
2424          report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
2425          report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
2426          report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_STO_L_PRO(scen,sto,h)) ;
2427          report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
2428          report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
2429          report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
2430          report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
2431   
2432          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2433          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
2434  *        report_market_tech_hours('generation market',loop_res_share,loop_
      prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
2435          report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)) ;
2436          report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
2437          report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
2438          report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
2439          report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
2440          report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
2441          report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
2442          report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2443          report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
2444          report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )
        ;
2445   
2446          report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
2447          report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2448   
2449          report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
2450          report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
2451          report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2452          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2453          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage 
      loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
2454          report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
2455          report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage lo
      ading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
2456          report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage load
      ing prosumers M2M',loop_res_share,loop_prosumage,sto,h));
2457          report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage
       generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2458          report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
2459          report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
2460          report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage ge
      neration prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
2461          report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers P
      RO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage
       out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pro
      sumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosum
      age,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res
      _share,loop_prosumage,sto);
2462          report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
2463          report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawa
      l prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
2464          report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
2465          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(s
      cen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
2466          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , phi_pro_load * d(h) ) );
2467          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) )
      ;
2468          report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * 1 ;
2469          report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2470          report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
2471          report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
2472          report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
2473          report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
2474          report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
2475          report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
2476          report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
2477          report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
2478          report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sce
      n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loo
      p_res_share,loop_prosumage,'');
2479          report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
2480          report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
2481          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
2482          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
2483          report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;
2484          report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * 1 > eps_rep_ins ) =
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen
      ,sto) ) * 1 / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P_PRO(scen,sto) ) ;
2485   
2486          report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
2487  *        report_market_tech('capacities reservoir MW market',loop_res_shar
      e,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_RSVR_P(scen,rsvr) );
2488  *        report_market_tech('capacities reservoir MWh market',loop_res_sha
      re,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RSVR_E(scen,rsvr) );
2489          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
2490          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * 1 ;
2491          report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h) )) * 1 ;
2492          report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) ))/( sum
      (h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,r
      es,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
2493          report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
2494          report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2495          report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2496          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac
      _dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_TECH(scen,res)) ;
2497          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2498          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2499          report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * 1 ;
2500          report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * 1 > eps_rep_ins ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * 1 / sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
2501   
2502          report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
2503          report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
2504          report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2505          report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( s
      cen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosum
      ers(scen)) ;
2506          report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
2507          report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * 1 ;
2508          report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2509          report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2510          report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2511          report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(sce
      n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (r
      es,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2512          report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2513          report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2514          report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
2515   
2516          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
2517          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
2518   
2519          report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
2520          report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) * 1 ;
2521          report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
2522          report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
2523          report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2524          report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
2525          report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2526          report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
2527          report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
2528  * line below changed
2529          report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
2530          report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (
      sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )
      ) * 1
2531  *$ontext
2532  *$ontext
2533  *$ontext
2534  *$ontext
2535  ;
2536          report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res , lev_G_MARKET_PRO2M(scen,res,h) - corr_fac_nondis(scen,res,h))
2537  *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr
      ,h))
2538           + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))
2539  *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fa
      c_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,
      h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2540            )) ;
2541   
2542          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2543  *        report_market_tech('Capacity share market',loop_res_share,loop_pr
      osumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share
      ,loop_prosumage)+ 1e-9 ;
2544          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2545          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2546          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* 1
       + 1e-9 ;
2547  *        report_market_tech('Energy share in gross nodal market generation
      ',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated
       gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_
      rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_
      res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2548          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2549   
2550                   report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2551                   report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
2552   
2553                   report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2554                   report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
2555                   report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
2556                   report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
2557                   report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
2558                   report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
2559                   report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2560                   report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2561                   report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2562                   report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
2563                   report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2564                   report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2565                   report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
2566                   report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage le
      vel prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2567                   report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2568                   report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2569                   report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2570                   report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
2571   
2572                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2573                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2574  *                 report_market_tech_hours('generation market',loop_res_sh
      are,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',l
      oop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2575                   report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
2576                   report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
2577                   report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2578                   report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2579                   report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2580                   report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2581                   report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2582                   report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2583                   report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2584                   report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2585   
2586                   report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
2587                   report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2588                   report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2589                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2590                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2591                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
2592                   report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
2593                   report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
2594                   report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2595                   report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2596                   report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2597                   report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
2598                   report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
2599                   report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2600                   report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2601                   report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
2602                   report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
2603                   report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2604                   report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2605                   report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
2606                   report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
2607                   report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2608                   report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2609                   report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
2610                   report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2611                   report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2612                   report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2613                   report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
2614                   report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2615                   report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2616                   report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
2617                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2618                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2619                   report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
2620                   report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2621                   report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2622                   report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2623   
2624                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
2625  *                 report_market_tech('capacities reservoir MW market',loop
      _res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir 
      MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2626  *                 report_market_tech('capacities reservoir MWh market',loo
      p_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir
       MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2627                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2628                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2629                   report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
2630                   report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
2631                   report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2632                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2633                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2634                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2635                   report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2636                   report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2637                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2638                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2639                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2640                   report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2641                   report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2642   
2643                   report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2644                   report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2645                   report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
2646                   report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2647                   report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
2648                   report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
2649                   report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
2650                   report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2651                   report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2652                   report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2653                   report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2654                   report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2655                   report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
2656   
2657                   report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2658                   report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2659                   report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2660                   report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2661                   report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2662                   report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2663                   report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2664                   report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
2665                   report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2666                   report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
2667                   report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2668                   report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
2669   
2670                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
2671                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2672  *                 report_market_tech('Capacity share market',loop_res_shar
      e,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_re
      s_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2673                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
2674                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
2675                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
2676                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy 
      share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr
      )< eps_rep_rel) = 0 ;
2679   
2680   
2681  * ------------------------------------------------------------------------
      ----
2682   
2683  * PROSUMAGE & DSM
2684   
2685   
2686   
2687  * ------------------------------------------------------------------------
      ----
2688   
2689   
2690   
2691  * ------------------------------------------------------------------------
      ----
2692   
2693  * HEAT
2694   
2695  * ------------------------------------------------------------------------
      ----
2696   
2697  * Reserves and heat
2698   
2699   
2700  * ------------------------------------------------------------------------
      ---- *
2701  * ------------------------------------------------------------------------
      ---- *
2702  * ------------------------------------------------------------------------
      ---- *
2703   
2704   
2705  execute_unload "results", report, report_tech, report_node,
2706  *report_line,
2707  report_tech_hours, report_hours, report_cost
2708  *$ontext
2709  , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours
2712  ;
2713   
2714   
      $include report_to_excel.gms
      $ontext
2719   
2720   
2721   
2722  * ------------------------------------------------------------------------
      ---- *
2723  * ------------------------------------------------------------------------
      ---- *
2724  * ------------------------------------------------------------------------
      ---- *
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 13:30:24 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\pr
                                          osumage\Code\Prosumage_Opt\Dieter_Modu
                                          le\Modified_MCP\DIETER.gms
     2      120 INCLUDE        1     120  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\dataload.gms
     3      527 CALL           2     407  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      529 GDXIN          2     409  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\Data_input.gdx
     5      581 CALL           2     461  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      582 GDXIN          2     462  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\time_series.gdx
     7     1016 INCLUDE        1     240  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\model.gms
     8     1574 INCLUDE        1     353  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\fix.gms
     9     1746 INCLUDE        1     354  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\scenario.gms
    10     1935 INCLUDE        1     418  .C:\Users\cguenther\Documents\GitHub\p
                                           rosumage\Code\Prosumage_Opt\Dieter_Mo
                                           dule\Modified_MCP\report.gms


COMPILATION TIME     =       16.661 SECONDS      6 MB  24.2.3 r46072 WEX-WEI
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 13:30:24 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1931


MODEL STATISTICS

BLOCKS OF EQUATIONS          39     SINGLE EQUATIONS      525,657
BLOCKS OF VARIABLES          34     SINGLE VARIABLES      543,149  5 projected
NON ZERO ELEMENTS     2,348,779     NON LINEAR N-Z         96,362
DERIVATIVE POOL              10     CONSTANT POOL              18
CODE LENGTH             131,408


GENERATION TIME      =      138.607 SECONDS    269 MB  24.2.3 r46072 WEX-WEI


EXECUTION TIME       =      138.794 SECONDS    269 MB  24.2.3 r46072 WEX-WEI
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 13:30:24 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1931


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1931

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         24.913  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.2.3 r46072 Released May 22, 2014 WEI x86_64/MS Windows    
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res
--- Scenario Variable with potential updates identified: phi_pro_self

IBM ILOG CPLEX   24.2.3 r46072 Released May 22, 2014 WEI x86_64/MS Windows    
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Pr
                               osumage_Opt\Dieter_Module\Modified_MCP\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosum
                                   age_Opt\Dieter_Module\Modified_MCP\cplex.opt"
Space for names approximately 34.30 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 24.31sec (det. 21917.22 ticks)
Optimal solution found.
Objective : 36332323331.361542

--- Scenario scen1:     Records read:    2
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  36332323331.3615
---   Resource Usage   24945
---   Total Time (ms)  25117

No solution returned
GAMS 24.2.3  r46072 Released May 22, 2014 WEX-WEI x86_64/MS Windows 10/26/18 13:30:24 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.702 SECONDS    129 MB  24.2.3 r46072 WEX-WEI


USER: Medium MUD - 10 User License                   S170316:1123AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Diet
           er_Module\Modified_MCP\DIETER.lst
