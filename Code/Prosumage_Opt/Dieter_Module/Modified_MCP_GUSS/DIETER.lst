GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  ********************************************************************************
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24   
  25  * Choose base year
  27   
  28  ***** Set star to activate options
  29   
  30  * Germany only - also adjust Excel inputs!
  32   
  33  * Dispatch only - used fixed capacities (also deactivates bio energy restriction)
  35   
  37   
  39   
  40  * Set to "*" to select linear program, leave blank to select MCP
  42   
  43  * Set star to select run-of-river options either as exogenous parameter or as endogenous variable including reserve provision:
  44  * if nothing is selected, ROR capacity will be set to zero
  45  * if parameter option is selected, set appropriate values in fix.gmx
  46  * if variable option is selected, set appropriate bound in data_input excel
  49   
  50  * Set star to determine loops, otherwise default 100% renewables
  52   
  53  * Set star for no crossover to speed up calculation time by skipping crossover in LP solver
  55   
  56  * Set star for reporting to Excel
  58   
  59   
  60  * --------------------- Do not change these lines ------------------------------
  61   
  62   
  63  ******************************Do not change these lines ************************
  64   
  65  * Definition of strings for report parameters and sanity checks
  67   
  68  * Sanity checks
  70   
  71  * LP or MCP
  74   
  75  * Dispatch or investment
  78   
  79  ********************************************************************************
  80   
  81  ****************************
  82  ***** INITIALIZE LOOPS *****
  83  ****************************
  84   
  85  sets
  86  *$ontext
  87  loop_res_share   Solution loop for different shares of renewables       /50/
  90   
      loop_prosumage   Solution loop for different prosumer self-consumption levels    /50/
      $ontext
  95   
  96  *      loop_res_share                          /50/
  97                        loop_prosumage                          /0/
  98  ;
  99   
 100   
 101   
 102   
 103  ********************************************************************************
 104   
 105  **************************
 106  ***** SOLVER OPTIONS *****
 107  **************************
 108   
 109  options
 110  optcr = 0.00
 111  reslim = 10000000
 112  lp = cplex
 113  mip = cplex
 114  nlp = conopt
 115  limrow = 0
 116  limcol = 0
 117  ;
 118   
 119  options
 120  dispwidth = 15
 121  limrow = 0
 122  limcol = 0
 123  solprint = off
 124  sysout = off
 125  ;
 126   
 127   
 128   
 129   
 130  ********************************************************************************
 131   
 132  **************************
 133  ***** Dataload *****
 134  **************************
 135   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\dataload.gms
 137   
 138  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 148  ********************************************************************************
 149   
 150   
 151   
 152   
 153  ***************  SETS  *********************************************************
 154   
 155  ***** Sets used in the model *****
 156  Sets
 157  tech                     Generation technologies
 158   dis(tech)               Dispatchable generation technologies
 159   nondis(tech)            Nondispatchable generation technologies
 160   con(tech)               Conventional generation technologies
 161   res(tech)               Renewable generation technologies
 162  sto                      Storage technologies
 163  rsvr                     Reservoir technologies
 164  dsm                      DSM technologies
 165   dsm_shift(dsm)          DSM load shifting technologies
 166   dsm_curt(dsm)           DSM load curtailment technologies
 167  year                     Base year for temporal data
 168  h                        Hours
 169  n                        Nodes
 170  l                        Lines
 171  ev                       EV types
 172  reserves                         Reserve qualities
 173   reserves_up(reserves)           Positive reserves
 174   reserves_do(reserves)           Negative reserves
 175   reserves_spin(reserves)         Spinning reserves
 176   reserves_nonspin(reserves)      Nonspinning reserves
 177   reserves_prim(reserves)         Primary reserves
 178   reserves_nonprim(reserves)      Nonprimary reserves
 179   reserves_prim_up(reserves)      Primary positive reserves
 180   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 181   reserves_prim_do(reserves)      Primary negative reserves
 182   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 183  bu                       Building archtypes
 184  ch                       Heating combination type
 185   hst(ch)                 Heating technology that feeds to storage
 186   hp(ch)                  Heat pump technologies
 187   hel(ch)                 Hybrid electric heating technologies - electric part
 188   hfo(ch)                 Hybrid electric heating technologies - fossil part
 189   
 190   
 191  ***** Sets used for data upload *****
 192  headers_tech                     Generation technologies - upload headers
 193   tech_dispatch                   Generation technologies - dispatchable or nondispatchable
 194   tech_res_con                    Generation technologies - renewable or "conventional"
 195  headers_sto                      Storage technologies - upload headers
 196  headers_reservoir                Reservoir technologies - upload headers
 197  headers_dsm                      DSM technologies - upload headers
 198   dsm_type                        DSM technologies - shifting or curtailment
 199  headers_time                     Temporal data - upload headers
 200  headers_topology                 Spatial data - upload headers
 201  headers_ev                       EV data - upload headers
 202  headers_time_ev                  EV temporal data - upload headers
 203  headers_prosumage_generation     Prosumage generation data - upload headers
 204  headers_prosumage_storage        Prosumage storage data - upload headers
 205  headers_reserves                 Reserve data - upload headers
 206   reserves_up_down                Reserve data - positive and neagtive reserves
 207   reserves_spin_nonspin           Reserve data - spinning and nonspinning reserves
 208   reserves_prim_nonprim           Reserve data - primary and nonprimary reserves
 209  headers_heat                     Heat data - upload headers
 210   heat_storage                    Heat data - storage technologies
 211   heat_hp                         Heat data - heat pump technologies
 212   heat_elec                       Heat data - hybrid heating technologies - electric part
 213   heat_fossil                     Heat data - hybrid heating technologies - fossil part
 214  headers_time_heat                Heat data - upload headers time data
 215  headers_time_dhw                 Heat data - upload headers time data on DHW
 216  ;
 217   
 218   
 219   
 220   
 221  ***************  PARAMETERS  ***************************************************
 222   
 223  Parameters
 224   
 225  ***** Generation technologies *****
 226  *--- Variable and fixed costs ---*
 227  eta              Efficiency of conventional technologies [0 1]
 228  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 229  c_up             Load change costs UP [EUR per MWh]
 230  c_do             Load change costs DOWN [EUR per MWh]
 231  c_fix            Annual fixed costs [EUR per MW per year]
 232  c_vom            Variable O&M costs [EUR per MWh]
 233  CO2price         CO2 price in [EUR per ton]
 234   
 235  *--- Investment ---*
 236  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 237  lifetime         Investment costs: technical lifetime [a]
 238  recovery         Investment costs: Recovery period according to depreciation tables [a]
 239  interest_rate    Investment costs: Interest rate [%]
 240  m_p              Investment: maximum installable capacity per technology [MW]
 241  m_e              Investment: maximum installable energy [TWh per a]
 242   
 243  *--- Flexibility ---*
 244  grad_per_min     Maximum load change relative to installed capacity [% of installed capacity per minute]
 245   
 246   
 247  ***** Fuel and CO2 costs *****
 248  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 249   
 250   
 251  ***** Renewables *****
 252  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 253  phi_min_res      Minimum renewables share [0 1]
 254   
 255   
 256  ***** Storage *****
 257  *--- Variable and fixed costs ---*
 258  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 259  eta_sto          Storage efficiency [0 1]
 260  phi_sto_ini      Initial storage level [0 1]
 261  etop_max         Maximum E to P ratio of storage types [#]
 262  c_fix_sto        Annual fixed costs [EUR per MW]
 263   
 264  *--- Investment ---*
 265  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight [EUR per MWh]
 266  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnight [EUR per MW]
 267  m_sto_e                     Investment into storage: maximum installable energy [MWh]
 268  m_sto_p                     Investment into storage: maximum installable power [MW]
 269   
 270   
 271  ***** Reservoir*****
 272  *--- Variable and fixed costs ---*
 273  c_m_rsvr                 Marginal costs of generating energy from reservoir [EUR per MWh]
 274  eta_rsvr                 Generation efficiency [0 1]
 275  phi_rsvr_ini             Initial reservoir level [0 1]
 276  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 277  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of annual energy [0 1]
 278  phi_rsvr_lev_min         Minimum filling level [0 1]
 279   
 280  *--- Investment ---*
 281  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight [EUR per MWh]
 282  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnight [EUR per MW]
 283  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetime [a]
 284  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 285  m_rsvr_e                 Investment into reservoir: maximum installable energy [MWh]
 286  m_rsvr_p                 Investment into reservoir: maximum installable capacity [MW]
 287   
 288   
 289  ***** DSM *****
 290  *--- Variable and fixed costs ---*
 291  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 292  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 293  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW per a]
 294  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per a]
 295   
 296  *--- Flexibility, efficiency, recovery ---*
 297  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 298  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment instances [h]
 299   
 300  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 301  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upshift instances [h]
 302  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 303   
 304  *--- Investment ---*
 305  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment: Overnight [EUR per MW]
 306  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: Overnight [EUR per MW]
 307  inv_recovery_dsm_cu              Investment costs for DSM load curtailment: Recovery period [a]
 308  inv_recovery_dsm_shift           Investment costs for DSM load shifting: Recovery period [a]
 309  inv_interest_dsm_cu              Investment costs for DSM load curtailment: Interest rate [%]
 310  inv_interest_dsm_shift           Investment costs for DSM load shifting: Interest rate [%]
 311  m_dsm_cu                         DSM: Maximum installable capacity load curtailment [MW]
 312  m_dsm_shift                      DSM: Maximum installable capacity load shifting [MW]
 313   
 314   
 315  ***** Time Data *****
 316  d_y                      Demand hour h for different years [MWh]
 317  d                        Demand hour h [MWh]
 318  phi_res_y                Renewables availability technology res in hour h for different years [0 1]
 319  phi_res                  Renewables availability technology res in hour h [0 1]
 320  phi_ror_y                Run-of-river availability technology ror in hour h for different years [0 1]
 321  phi_ror                  Run-of-river availability technology ror in hour h [0 1]
 322  rsvr_in_y                Reservoir inflow in hour h for different years [0 1]
 323  rsvr_in                  Reservoir inflow in hour h [0 1]
 324  n_ev_p_upload            Power rating of the charging connection in hour h [MW - 0 when car is in use or parked without grid connection]
 325  ev_ed_upload             Electricity demand for mobility vehicle profile ev in hour h [MW]
 326  ev_ged_exog_upload       Electricity demand for mobility in case of uncontrolled charging vehicle profile ev in hour h [MW]
 327  phi_reserves_call_y      Hourly share of reserve provision that is actually activated for different years [0 1]
 328  phi_reserves_call        Hourly share of reserve provision that is actually activated [0 1]
 329  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 330  reserves_exogenous       Hourly reserve provision [MW]
 331   
 332  ***** Transmission *****
 333  *--- Investment ---*
 334  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 335  c_fix_ntc                 Fixed costs [EUR per MW per a]
 336  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 337  inv_recovery_ntc          Investment costs: Recovery period in [a]
 338  inv_interest_ntc          Investment costs: Interest rate [%]
 339  m_ntc                     Investment into NTC: maximum installable capacity [MW]
 340   
 341  *--- Topology and distance ---*
 342  inc              Incidence index of link l on node n
 343  dist             Distance covered by link l [km]
 344   
 345   
 346  ***** Electric vehicles *****
 347  *--- Costs and attributes ---*
 348  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 349  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh]
 350  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 351  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 352  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 353   
 354  n_ev_e           Electric vehicle battery capacity [MWh]
 355  ev_quant         Overall number of electirc vehicles [#]
 356  phi_ev           Share of electric vehicles per load profile in actual scenario [0 1]
 357  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if yes 0 otherwise]
 358   
 359  *--- Temporal data ---*
 360  n_ev_p           Electric vehicle power rating [MWh]
 361  ev_ed            Electric vehicle electricity demand [MWh]
 362  ev_ged_exog      Electric vehicle grid electricity demand for exogenous charging pattern [MWh]
 363   
 364   
 365  ***** Prosumage *****
 366  phi_pro_load             Share of prosumagers among total load [0 1]
 367  phi_pro_self             Minimum self-generation shares for prosumagers [0 1]
 368  m_res_pro                Maximum installable: renewables capacity [MW]
 369  m_sto_pro_e              Maximum installable: storage energy [MWh]
 370  m_sto_pro_p              Maximum installable: storage capacity [MW]
 371  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 372   
 373   
 374  ***** Reserves *****
 375  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 376  reserves_intercept       Intercept of regression line determining reserves demand
 377  reserves_slope           Slope of regression line determining reserves demand
 378  reserves_reaction        Activation reaction time for reserves qualities [min]
 379  phi_reserves_pr_up       Positive primary reserves fraction of total nonprimary reserves demand [0 1]
 380  phi_reserves_pr_do       Negative primary reserves fraction of total nonprimary reserves demand [0 1]
 381  *reserves_exog
 382   
 383   
 384  ***** Heat *****
 385  *--- Time data ---*
 386  dh_upload                Hourly heat demand per year for upload [MWh per m2]
 387  dh_y                     Hourly heat demand per year [MWh per m2]
 388  dh                       Hourly heat demand [MWh per m2]
 389  temp_source              Heat pumps - source temperature [°Celsius]
 390  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2]
 391  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 392  d_dhw                    Hourly DHW demand [MWh per m2]
 393  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-time storage heaters [MWh per m2]
 394   
 395  *--- Technololgy attributes ---*
 396  phi_heat_type            Share of heating type ch per building archetype bu [0 1]
 397  eta_heat_stat            Static efficiency for heating technologies [0 1]
 398  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 399  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies [0 1]
 400  n_heat_p_in              Maximum power inflow into heating technologies [MW]
 401  n_heat_p_out             Maximum power outflow from heating technologies [MW]
 402  n_heat_e                 Maximum energy level of heating storage technologies [MWh]
 403  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 404  n_sets_p_out             SETS - Power rating - heat output [MW]
 405  n_sets_e                 SETS - Energy storage capacity [MWh]
 406  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electricity intake [MW]
 407  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW output [MW]
 408  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capacity [MWh]
 409  phi_heat_ini             Inititial storage level of heating technologies [0 1]
 410  temp_sink                Heat pumps - sink temperature [°Celsius]
 411  pen_heat_fuel            Penalty term for non-electric fuel usage for hybrid heating technologies [EUR per MWh]
 412  area_floor               Floor area subject to specific heating technology in specific building type [m2]
 413  theta_night              Indicator for night hours {0 1}
 414   
 415   
 416   
 417  ***************  DERIVED PARAMETERS  *******************************************
 418   
 419  c_m              Marginal production costs for conventional plants including variable O and M costs [EUR per MWh]
 420  c_i              Annualized investment costs by conventioanl plant [EUR per MW]
 421   
 422  c_i_res          Annualized investment costs by renewable plant [EUR per MW]
 423  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per a]
 424   
 425  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 426  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 427   
 428  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 429  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 430   
 431  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR per MW]
 432  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per MW]
 433   
 434  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 435   
 436  phi_mean_reserves_call_y         Hourly mean of share reserves called per year [0 1]
 437  phi_mean_reserves_call           Hourly mean of share reserves called [0 1]
 438   
 439  theta_dir        Dummy equal to 1 if building type bu has direct heating type ch [0 1]
 440  theta_sets       Dummy equal to 1 if building type bu has SETS heating type ch [0 1]
 441  theta_hp         Dummy equal to 1 if building type bu has heat pump heating type ch [0 1]
 442  theta_elec       Dummy equal to 1 if building type bu has hybrif electric heating - electric part [0 1]
 443  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric heating - fossil part [0 1]
 444  theta_storage    Dummy equal to 1 if building type ch has storage heating type ch [0 1]
 445   
 446   
 447   
 448   
 449  ***************  PARAMETERS FOR DATA UPLOAD  ***********************************
 450   
 451  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 452  technology_data(tech,headers_tech)
 453  storage_data(sto,headers_sto)
 454  reservoir_data(rsvr,headers_reservoir)
 455  time_data_upload(h,year,headers_time)
 456  dsm_data_upload(dsm,dsm_type,headers_dsm)
 457  dsm_data(dsm,headers_dsm)
 458  topology_data(l,headers_topology)
 459  ev_data(ev,headers_ev)
 460  ev_time_data_upload(h,headers_time_ev,ev)
 461  prosumage_data_generation(tech,headers_prosumage_generation)
 462  prosumage_data_storage(sto,headers_prosumage_storage)
 463  reserves_time_data_activation(h,year,reserves)
 464  reserves_time_data_provision(h,year,reserves)
 465  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)
 466  reserves_data(reserves,headers_reserves)
 467  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)
 468  heat_data(bu,ch,headers_heat)
 469  dh_upload(h,year,headers_time_heat,bu)
 470  d_dhw_upload(h,year,headers_time_heat,bu)
 471  temp_source_upload
 472  ;
 473   
 474   
 475   
 476   
 477  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  *********************
 478   
 538   
 539  *%skip_Excel%
 541   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\Data_input.gdx
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  rsvr = 8:rsvr
--- LOAD  headers_reservoir = 9:headers_reservoir
--- LOAD  reservoir_data = 31:reservoir_data
--- LOAD  dsm = 10:dsm
--- LOAD  headers_dsm = 11:headers_dsm
--- LOAD  dsm_type = 12:dsm_type
--- LOAD  technology_data_upload = 29:technology_data_upload
--- LOAD  storage_data = 30:storage_data
--- LOAD  dsm_data_upload = 32:dsm_data_upload
 546   
--- LOAD  ev = 13:ev
--- LOAD  headers_ev = 14:headers_ev
--- LOAD  ev_data = 34:ev_data
--- LOAD  headers_prosumage_generation = 15:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 16:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 35:prosumage_data_generation
--- LOAD  prosumage_data_storage = 36:prosumage_data_storage
--- LOAD  reserves = 17:reserves
--- LOAD  reserves_up_down = 19:reserves_up_down
--- LOAD  reserves_spin_nonspin = 20:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 21:reserves_prim_nonprim
--- LOAD  headers_reserves = 18:headers_reserves
--- LOAD  reserves_data_upload = 37:reserves_data_upload
--- LOAD  bu = 22:bu
--- LOAD  ch = 23:ch
--- LOAD  heat_storage = 24:heat_storage
--- LOAD  heat_hp = 25:heat_hp
--- LOAD  heat_elec = 26:heat_elec
--- LOAD  heat_fossil = 27:heat_fossil
--- LOAD  headers_heat = 28:headers_heat
--- LOAD  heat_data_upload = 38:heat_data_upload
 551  ;
 552   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 558   
 559   
 560  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  ***********************
 561   
 587   
 588   
 589  *
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 593  *$load headers_time_ev ev_time_data_upload
 594  *$load reserves_time_data_activation
 595  *$load reserves_time_data_provision
 596  *$load headers_time_heat dh_upload
 597  *$load theta_night
 598  *$load temp_source_upload
 599  *$load headers_time_dhw d_dhw_upload nets_profile
 600  ;
 601   
 602   
 603   
 604   
 605  ***************  ASSIGNMENTS  **************************************************
 606   
 607   
 608   
 609  ***** Aliases *****
 610  alias (h,hh) ;
 611  alias (res,resres) ;
 612  alias (reserves,reservesreserves) ;
 613  alias (nondis,nondisnondis) ;
 614   
 615   
 616   
 617  ***** Derived sets *****
 618  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'dis',headers_tech)) = yes;
 619  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'nondis',headers_tech)) = yes;
 620   
 621  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'con',tech_dispatch,headers_tech)) = yes;
 622  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'res',tech_dispatch,headers_tech)) = yes;
 623   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = yes;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 645   
 646   
 647   
 648  ***** Parameters *****
 649   
 650  *--- Generation technologies ---*
 651  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 652  eta(tech) = technology_data(tech,'eta_con') ;
 653  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 654  c_up(dis) =technology_data(dis,'load change costs up') ;
 655  c_do(dis) = technology_data(dis,'load change costs down') ;
 656  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 657  c_vom(tech) = technology_data(tech,'variable_om') ;
 658  CO2price(tech) = technology_data(tech,'CO2_price') ;
 659   
 660  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 661  lifetime(tech) = technology_data(tech,'lifetime') ;
 662  recovery(tech) = technology_data(tech,'recovery_period') ;
 663  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 664  m_p(tech) = technology_data(tech,'max_installable') ;
 665  m_e(tech) = technology_data(tech,'max_energy') ;
 666  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 667  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 668   
 669  c_cu(res) = technology_data(res,'curtailment_costs') ;
 670   
 671   
 672  *--- Storage technologies ---*
 673  c_m_sto(sto) = storage_data(sto,'mc');
 674  eta_sto(sto) = storage_data(sto,'efficiency');
 675  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 676  phi_sto_ini(sto) = storage_data(sto,'level_start');
 677  etop_max(sto) = storage_data(sto,'etop_max') ;
 678   
 679  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 680  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 681  lifetime(sto) = storage_data(sto,'lifetime');
 682  interest_rate(sto) = storage_data(sto,'interest_rate');
 683  m_sto_e(sto) = storage_data(sto,'max_energy');
 684  m_sto_p(sto) = storage_data(sto,'max_power');
 685   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',headers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',headers_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,headers_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate')   ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 727   
 728  *--- Temporal data ---*
 729  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 730  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_data_upload(h,year,headers_time));
 731   
 732  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), time_data_upload(h,year,headers_time));
 733  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,year,reserves) ;
 734  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,year,reserves) ;
 735   
 736   
 737  *--- Spatial data ---*
 738  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 739  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 740  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 741  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 742  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 743  *m_ntc(l) = topology_data(l,'max_installable') ;
 744  *dist(l) = topology_data(l,'distance') ;
 745   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 762   
 763  *--- Prosumage ---*
 764  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 765  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 766  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 767  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 768   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_off') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_fossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw') ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_source') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_source') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply') ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 814   
 815   
 816  ***************  CALCULATE DERIVED PARAMETERS  *********************************
 817   
 818  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2price(tech) + c_vom(tech)   ;
 819   
 820  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate(tech))**(lifetime(tech)) )
 821                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       ;
 822   
 823  c_i_res(res) = c_i(res) ;
 824  c_fix_res(res) = c_fix(res) ;
 825   
 826  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 827                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 828   
 829  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 830                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_interest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_interest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 ) ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AND phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AND phi_heat_type(bu,ch)) = 1;
 859   
 860   
 861  ***************  Adjust costs to model's hourly basis **************************
 862   
 863  c_i(tech) = c_i(tech)*card(h)/8760 ;
 864  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 865  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 866  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 867  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 868  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 869  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 870  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 871   
 872  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 873  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 874  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 875  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 876  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 877   
 878  m_e('bio') = m_e('bio')*card(h)/8760 ;
 879   
 880  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 881   
 882  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 883  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 884  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(dsm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 885  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 886   
 887   
 888   
 889  ********************************************************************************
 890   
 891   
 892   
 893   
 894   
 895   
 896   
 897   
 898   
 899  ********************************************************************************
 900   
 901  ***************************
 902  ***** Initialize data *****
 903  ***************************
 904   
 905  * Parameters for default base year
 906  d(h) = d_y('2030',h) ;
 907  phi_res(res,h) = phi_res_y('2030',res,h) ;
 908  phi_min_res = 0 ;
 909  phi_pro_self = 0 ;
 910  phi_pro_load = 0 ;
 911   
      phi_pro_load = 0.2 ;
      $ontext
 916   
 917   
 918  Parameter
 919  phi_min_res_exog;
 920  phi_min_res_exog = 1 ;
 921   
 922  Sets
 923  h_ini(h)                       First hour  /h1/
 924  *h_end(h)                       Last hour   /h8760/
 925  ;
 926   
 927  ********************************************************************************
 928  ***** Model *****
 929  ********************************************************************************
 930   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\model.gms
 932   
 933  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 943  ********************************************************************************
 944   
 945   
 946  Variables
 947  Z                  Value objective function [Euro]
 948  lambda_enerbal     Dual variable on energy balance (1a)
 949  lambda_resgen      Dual variable on renewable generation (3e)
 950  lambda_convgen     Dual variable on conventional generation level (2a)
 951  lambda_stolev      Dual variable on storage level  (4b)
 952  ;
 953   
 954  Positive Variables
 955  G_L(tech,h)            Generation level in hour h [MWh]
 956  G_UP(tech,h)           Generation upshift in hour h [MWh]
 957  G_DO(tech,h)           Generation downshift in hour h [MWh]
 958  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 959  CU(tech,h)             Renewables curtailment technology res in hour h [MWh]
 960   
 961  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 962  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 963  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 964   
 965  N_TECH(tech)           Technology tech built [MW]
 966  N_STO_E(sto)           Storage technology built - Energy [MWh]
 967  N_STO_P(sto)           Storage loading and discharging capacity built - Capacity [MW]
 968   
 969  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generation in hour h [MWh]
 970  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h [MWh]
 971  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market in hour h [MWh]
 972  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in hour h [MWh]
 973  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation for discharging to consumption in hour h [MWh]
 974  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumption from generation in hour h [MWh]
 975  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to consumption in hour h [MWh]
 976  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 977  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 978  N_RES_PRO(tech)                Prosumage: installed renewables capacities [MW]
 979   
 980   
 981  mu_stoin_cap          Dual variable on storage loading capacity constraint (4d)
 982  mu_stout_cap          Dual variable on storage discharging capacity constraint (4e)
 983  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 984  mu_conv_cap           Dual variable on conventional generation capacity constraint (3a)
 985  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 986  mu_dis_max_i          Dual variable on dispatchable installation constraint (8a)
 987  mu_nondis_max_i       Dual variable on nondispatchable installation constraint (8a)
 988  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 989  mu_stop_max_i         Dual variable on storage power installation constraint  (8c)
 990  mu_stoe_max_i         Dual variable on storage energy installation constraint  (8b)
 991  mu_minRES             Dual variable on minimum renewable share constraint (5a)
 992   
 993  ;
 994   
 995  Set
 996  dis_bio(tech)          Subset of dispatchable technology: Bio mass        /bio/
 997  ;
 998   
 999   
1000  ********************************************************************************
1001   
1002  Equations
1003  * Objective
1004  obj                      Objective cost minimization
1005   
1006  * Energy balance
1007  con1a_bal                Energy Balance
1008   
1009  * Load change costs
1010  con2a_loadlevel          Load change costs: Level
1011  con2b_loadlevelstart     Load change costs: Level for first period
1012  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
1013  * Capacity contraints and flexibility constraints
1014  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1015  con3e_maxprod_res                Capacity constraints renewables
1016   
1017  * Storage constraints
1018  con4a_stolev_start        Storage Level Dynamics Initial Condition
1019  con4b_stolev              Storage Level Dynamics
1020  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
1021  con4c_stolev_max          Storage Power Capacity
1022  con4d_maxin_sto           Storage maximum inflow
1023  con4e_maxout_sto          Storage maximum outflow
1024  con4j_ending              End level equal to initial level
1025  con4k_PHS_EtoP            Maximum E-P ratio
1026   
1027  * Minimum restrictions for renewables and biomass
1028  con5a_minRES             Minimum yearly renewables requirement
1029  con5b_max_energy         Maximum yearly biomass energy
1030   
1031  * Maximum installation conditions
1032  con8a_max_I_power                Maximum installable capacity: Conventionals
1033  con8b_max_I_sto_e                Maximum installable energy: Storage energy in MWh
1034  con8c_max_I_sto_p                Maximum installable capacity: Storage inflow-outflow in MW
1035   
1036  con8f_max_pro_res                Maximum installable capacity: prosumage renewables
1037  con8g_max_pro_sto_e              Maximum installable capacity: prosumage storage energy
1038  con8h_max_sto_pro_p              Maximum installable capacity: prosumage storage power
1039   
1040  * Prosumage
1041  con11a_pro_distrib                       Prosumage: distribution of generated energy
1042  con11b_pro_balance                       Prosumage: energy balance
1043  con11c_pro_selfcon                       Prosumage: minimum self-generation requirement
1044  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumager-to-prosumagers
1045  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial conditions
1046  con11j_pro_stolev_max                    Prosumage: maximum overall storage level
1047  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1048  con11l_pro_maxout_sto                    Prosumage: maximum storage outflow
1049  con11o_pro_ending                        Prosumage: storage ending condition
1050   
1051  * Dummy equation for using guss tool
1052  guss
1053   
1054  * KKT optimality conditions
1055  KKTG_L                   KKT w.r.t. G_L
1056  KKTG_UP                  KKT w.r.t. G_UP
1057  KKTG_DO                  KKT w.r.t. G_DO
1058  KKTG_RES                 KKT w.r.t. G_RES
1059  KKTCU                    KKT w.r.t. CU
1060  KKTSTO_IN                KKT w.r.t. STO_IN
1061  KKTSTO_OUT               KKT w.r.t. STO_OUT
1062  KKTSTO_L                 KKT w.r.t. STO_L
1063  KKTN_TECH_NONDIS         KKT w.r.t. N_TECH(nondis)
1064  KKTN_TECH_DIS            KKT w.r.t. N_TECH(dis)
1065  KKTN_TECH                KKT w.r.t. N_TECH
1066  KKTN_STO_E               KKT w.r.t. N_STO_E
1067  KKTN_STO_P               KKT w.r.t. N_STO_P
1068  ;
1069   
1070   
1071   
1072  ********************************************************************************
1073   
1074  * ---------------------------------------------------------------------------- *
1075  ***** Objective function *****
1076  * ---------------------------------------------------------------------------- *
1077   
1078  obj..
1079           Z =E=
1080                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1081                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1082                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1083                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1084                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN(sto,h) ) )
1085                   + sum( tech , c_i(tech)*N_TECH(tech) )
1086                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1087                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1088                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)) )
1089                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E_PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1099  ;
1100   
1101  * ---------------------------------------------------------------------------- *
1102  ***** Energy balance and load levels *****
1103  * ---------------------------------------------------------------------------- *
1104   
1105  * Energy balance
1106  con1a_bal(h)..
1107   
1108             sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h)) + sum( sto , STO_OUT(sto,h) )
               + sum( res , G_MARKET_PRO2M(res,h) )
      $ontext
1113           -  ( 1 - phi_pro_load )* d(h)
1114           -   sum( sto , STO_IN(sto,h) )
1115   
               - G_MARKET_M2PRO(h)
      $ontext
1120   
1121         =E= 0
1122  ;
1123   
1124  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1125           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1126  ;
1127   
1128  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1129          G_UP(dis,h) - G_L(dis,h) =E= 0
1130  ;
1131   
1132  con2_loadlevel(dis,h)..
1133             G_UP(dis,h)  - G_L(dis,h)
1134          +  (G_L(dis,h-1) - G_DO(dis,h))$(ord(h) > 1)
1135          =E= 0
1136  ;
1137   
1138   
1139   
1140  * ---------------------------------------------------------------------------- *
1141  ***** Hourly maximum generation caps *****
1142  * ---------------------------------------------------------------------------- *
1143   
1144  con3a_maxprod_dispatchable(dis,h)..
1145   
1146           N_TECH(dis) -  G_L(dis,h)  =G= 0
1147   
1148  ;
1149   
1150  con3e_maxprod_res(nondis,h)..
1151   
1152   
1153         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =E= 0
1154  ;
1155   
1156  * ---------------------------------------------------------------------------- *
1157  ***** Storage constraints *****
1158  * ---------------------------------------------------------------------------- *
1159   
1160  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1161          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1162  ;
1163   
1164  con4b_stolev(sto,h)$(ord(h)>1)..
1165          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1166  ;
1167   
1168  con4_stolev(sto,h)..
1169   
1170         + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h)
1171         + (STO_L(sto,h-1))$(ord(h)>1)
1172         =E= 0
1173  ;
1174   
1175   
1176  con4c_stolev_max(sto,h)..
1177         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1178  ;
1179   
1180  con4d_maxin_sto(sto,h)..
1181   
1182          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1183  ;
1184   
1185  con4e_maxout_sto(sto,h)..
1186   
1187          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1188  ;
1189   
1190  con4j_ending(sto,h)$(ord(h) = card(h))..
1191   
1192          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1193  ;
1194   
1195   
1196  con4k_PHS_EtoP(sto)..
1197           etop_max(sto) * N_STO_P(sto) - N_STO_E(sto) =G= 0
1198  ;
1199   
1200  * ---------------------------------------------------------------------------- *
1201  ***** Quotas for renewables and biomass *****
1202  * ---------------------------------------------------------------------------- *
1203   
1204  con5a_minRES..
1205  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1206   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + sum( (res) , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1211  )
1212          - phi_min_res * phi_min_res_exog * sum( h ,
1213           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1214   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1219           )  =G= 0
1220  ;
1221   
1222  con5b_max_energy(tech)$dis_bio(tech)..
1223           m_e(tech) -  sum( h , G_L(tech,h) ) =G= 0
1224  ;
1225   
1226   
1227  * ---------------------------------------------------------------------------- *
1228  ***** Maximum installation constraints *****
1229  * ---------------------------------------------------------------------------- *
1230   
1231  con8a_max_I_power(tech)..
1232         m_p(tech) - N_TECH(tech)     =G= 0
1233  ;
1234   
1235  con8b_max_I_sto_e(sto)..
1236         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1237  ;
1238   
1239  con8c_max_I_sto_p(sto)..
1240         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1241  ;
1242   
1243   
1244   
1245  con8f_max_pro_res(res)..
1246         m_res_pro(res) -  N_RES_PRO(res)     =G= 0
1247  ;
1248   
1249  con8g_max_pro_sto_e(sto)..
1250         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1251  ;
1252   
1253  con8h_max_sto_pro_p(sto)..
1254          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1255  ;
1256   
1257  * ---------------------------------------------------------------------------- *
1258  ***** Prosumage constraints *****
1259  * ---------------------------------------------------------------------------- *
1260   
1261  con11a_pro_distrib(res,h)..
1262           phi_res(res,h) * N_RES_PRO(res)
1263           =E=
1264           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( sto , STO_IN_PRO2PRO(res,sto,h) )
1265  ;
1266   
1267  con11b_pro_balance(h)..
1268           phi_pro_load * d(h)
1269           =E=
1270           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1271  ;
1272   
1273  con11c_pro_selfcon..
1274           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PRO(sto,h) )
1275           =G=
1276           phi_pro_self * sum( h , phi_pro_load * d(h))
1277  ;
1278   
1279  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1280           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1281  ;
1282   
1283   
1284  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1285          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1286  ;
1287   
1288   
1289  con11j_pro_stolev_max(sto,h)..
1290         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1291  ;
1292   
1293  con11k_pro_maxin_sto(sto,h)..
1294          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1295          =G= 0
1296  ;
1297   
1298  con11l_pro_maxout_sto(sto,h)..
1299          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1300          =G= 0
1301  ;
1302   
1303  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1304           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1305  ;
1306   
1307  * ---------------------------------------------------------------------------- *
1308  ***** FOC conditions *****
1309  * ---------------------------------------------------------------------------- *
1310   
1311  KKTG_L(tech,h)$dis(tech)..
1312   
1313      + c_m(tech)
1314      - lambda_enerbal(h)
          + lambda_convgen(tech,h)
      $ontext
1319      + mu_conv_cap(tech,h)
1320  *$ontext
1321      + mu_bio_cap(tech)$dis_bio(tech)
         - (lambda_convgen(tech,h+1))$(ord(h) > 1)
      $ontext
1328      =G= 0
1329   
1330  ;
1331   
1332  KKTG_UP(dis,h)..
1333   
1334       - lambda_convgen(dis,h)
1335       + (c_up(dis))$(ord(h)> 1)
1336     =G= 0
1337   
1338  ;
1339   
1340  KKTG_DO(dis,h)..
1341   
1342       + c_do(dis)
1343       + (lambda_convgen(dis,h))$(ord(h) > 1)
1344       =G= 0
1345   
1346  ;
1347   
1348  KKTG_RES(nondis,h)..
1349   
1350       - lambda_enerbal(h) + lambda_resgen(nondis,h)
1351       =G= 0
1352  ;
1353   
1354  KKTCU(nondis,h)..
1355   
1356       c_cu(nondis) + lambda_resgen(nondis,h) =G= 0
1357   
1358  ;
1359   
1360  KKTSTO_IN(sto,h)..
1361   
1362      c_m_sto(sto)  + lambda_enerbal(h) -  lambda_stolev(sto,h)*(1+eta_sto(sto))/2
1363      + mu_stoin_cap(sto,h) =G= 0
1364  ;
1365   
1366  KKTSTO_OUT(sto,h)..
1367   
1368       c_m_sto(sto)  -  lambda_enerbal(h) +  lambda_stolev(sto,h)/(1+eta_sto(sto))*2
1369       +  mu_stout_cap(sto,h)
1370        =G= 0
1371  ;
1372   
1373  KKTSTO_L(sto,h)..
1374   
1375    + lambda_stolev(sto,h)
1376    +  mu_stolev_cap(sto,h)
1377    -  (lambda_stolev(sto,h+1))$(ord(h) > 1 )
1378   
1379    =G= 0
1380   
1381  ;
1382   
      KKTN_TECH_NONDIS(nondis)..
       
          c_i(nondis) +  c_fix(nondis)
          - sum( h,  lambda_resgen(nondis,h)*phi_res(nondis,h)) + mu_nondis_max_i(nondis)
          =G= 0
      ;
       
      KKTN_TECH_DIS(dis)..
       
           c_i(dis) +  c_fix(dis) - sum( h,  lambda_convgen(dis,h)) +  mu_dis_max_i(dis)
           =G= 0
       
      ;
1398   
1399  KKTN_TECH(tech)..
1400   
1401            +  c_i(tech)
1402            +  c_fix(tech)
1403  *$ontext
1404            +  mu_tech_max_i(tech)
1407            - sum( h,   mu_conv_cap(tech,h))$dis(tech)
1408            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis(tech)
1409       =G= 0
1410   
1411  ;
1412   
1413   
1414   
1415  KKTN_STO_E(sto)..
1416   
1417        +  c_fix_sto(sto)/2 +  c_i_sto_e(sto)
1418        -  sum( h,   mu_stolev_cap(sto,h))
1419  *$ontext
1420        +  mu_stoe_max_i(sto)
1423        =G= 0
1424  ;
1425   
1426  KKTN_STO_P(sto)..
1427   
1428   
1429       c_fix_sto(sto)/2 + c_i_sto_p(sto)
1430       - sum( h, (mu_stoin_cap(sto,h) + mu_stout_cap(sto,h)))
1431  *$ontext
1432       + mu_stop_max_i(sto)
1435       =G= 0
1436   
1437  ;
1438   
1439   
1440  ********************************************************************************
1441  ***** Fix unmatched variables of first period *****
1442  ********************************************************************************
1443   
1444  G_DO.fx(dis,'h1') = 0;
1445   
1446  * Default for reporting
1447  G_DO.l(dis,h)   = 0;
1448  G_L.l(dis,h)    = 0;
1449  G_UP.l(dis,h)   = 0;
1450  G_RES.l(tech,h) = 0;
1451  CU.l(tech,h)    = 0;
1452   
1453  STO_IN.l(sto,h)  = 0;
1454  STO_OUT.l(sto,h) = 0;
1455  STO_L.l(sto,h)   = 0;
1456   
1457  N_TECH.l(tech)   = 0;
1458  N_STO_E.l(sto)   = 0;
1459  N_STO_P.l(sto)   = 0;
1460   
1461   
1462  ********************************************************************************
1463  ***** MODEL *****
1464  ********************************************************************************
1465   
1466  model DIETER /
1467  obj
1468   
1469  con1a_bal
1470   
      con2_loadlevel
      $ontext
1475   
1476  con3a_maxprod_dispatchable
1477  con3e_maxprod_res
1478   
1479  con4_stolev
1480  con4c_stolev_max
1481  con4d_maxin_sto
1482  con4e_maxout_sto
1483   
1484  con5a_minRES
1485  *$ontext
1486  con5b_max_energy
1489   
1490  *$ontext
1491  con8a_max_I_power
1492  con8b_max_I_sto_e
1493  con8c_max_I_sto_p
1496   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1512   
1513  /;
1514   
1515  model DIETER_MCP /
1516   
1517  con1a_bal.lambda_enerbal
1518   
      con2_loadlevel.lambda_convgen
      $ontext
1523   
1524  con3a_maxprod_dispatchable.mu_conv_cap
1525  con3e_maxprod_res.lambda_resgen
1526   
1527  con4_stolev.lambda_stolev
1528  con4c_stolev_max.mu_stolev_cap
1529  con4d_maxin_sto.mu_stoin_cap
1530  con4e_maxout_sto.mu_stout_cap
1531   
1532  *$ontext
1533  con5b_max_energy.mu_bio_cap
1536   
1537  *$ontext
1538  con8a_max_I_power.mu_tech_max_i
1539  con8b_max_I_sto_e.mu_stoe_max_i
1540  con8c_max_I_sto_p.mu_stop_max_i
1543   
1544  KKTG_L.G_L
1545   
      KKTG_UP.G_UP
      KKTG_DO.G_DO
      $ontext
1551   
1552  KKTG_RES.G_RES
1553  KKTCU.CU
1554  KKTSTO_IN.STO_IN
1555  KKTSTO_OUT.STO_OUT
1556  KKTSTO_L.STO_L
1557   
1558  *$ontext
1559  KKTN_TECH.N_TECH
1560  KKTN_STO_E.N_STO_E
1561  KKTN_STO_P.N_STO_P
1564   
1565  / ;
1566   
1567  ********************************************************************************
1568  ***** Options, fixings, report preparation *****
1569  ********************************************************************************
1570   
1571  * Solver options
1577   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1588   
1589  dieter.OptFile = 1;
1590  dieter.holdFixed = 1 ;
1591   
1592   
1593  ********************************************************************************
1594  ***** Solve *****
1595  ********************************************************************************
1596   
1597  * Preparation of GUSS tool for scenario analysis
1598  phi_min_res = eps ;
1599  phi_pro_self = eps ;
1600   
1602   
1603  Set
1604  modelstats       model stats collection                  /modelstat, solvestat, resusd/
1605  superscen        Scenarios                               /scen1*scen1000/
1606  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_share.#loop_prosumage)/
1607  ;
1608   
1609  set
1610  scen(superscen);
1611  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(superscen,loop_res_share,loop_prosumage)) )    ;
1612   
1613  Parameters
1614  gussoptions                              /Logoption 2, Optfile 1, Skipbasecase 1/
1615  modstats(superscen, modelstats)
1616  min_res
1617  pro_selfcon
1618  ;
1619   
1620  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_res_share.val/100 ) ;
1621  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_prosumage.val/100 ) ;
1622   
1623  Parameters
1624  * Equations
1625  marginal_con5a(superscen)
1626  marginal_con1a(superscen,*)
1627  marginal_con9a(superscen,*,*,*)
1628  marginal_con9b(superscen,*,*,*)
1629   
1630  * Basic
1631  lev_Z(superscen)
1632  lev_G_L(superscen,tech,h)
1633  lev_G_UP(superscen,tech,h)
1634  lev_G_DO(superscen,tech,h)
1635  lev_G_RES(superscen,tech,h)
1636  lev_CU(superscen,tech,h)
1637  lev_STO_IN(superscen,sto,h)
1638  lev_STO_OUT(superscen,sto,h)
1639  lev_STO_L(superscen,sto,h)
1640  lev_N_TECH(superscen,tech)
1641  lev_N_STO_E(superscen,sto)
1642  lev_N_STO_P(superscen,sto)
1643   
1644   
1645  * Prosumage
1646  lev_CU_PRO(superscen,tech,h)
1647  lev_G_MARKET_PRO2M(superscen,tech,h)
1648  lev_G_MARKET_M2PRO(superscen,h)
1649  lev_G_RES_PRO(superscen,tech,h)
1650  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1651  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1652  lev_STO_IN_M2PRO(superscen,sto,h)
1653  lev_STO_IN_M2M(superscen,sto,h)
1654  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1655  lev_STO_OUT_PRO2M(superscen,sto,h)
1656  lev_STO_OUT_M2PRO(superscen,sto,h)
1657  lev_STO_OUT_M2M(superscen,sto,h)
1658  lev_STO_L_PRO2PRO(superscen,sto,h)
1659  lev_STO_L_PRO2M(superscen,sto,h)
1660  lev_STO_L_M2PRO(superscen,sto,h)
1661  lev_STO_L_M2M(superscen,sto,h)
1662  lev_N_STO_E_PRO(superscen,sto)
1663  lev_N_STO_P_PRO(superscen,sto)
1664  lev_STO_L_PRO(superscen,sto,h)
1665  lev_N_RES_PRO(superscen,tech)
1666  ;
1667   
1668   
1669  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\fix.gms
1671   
1672  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1682  ********************************************************************************
1683   
1684   
1685   
1686  ********************************************************************************
1687  **** Run of river  *************************************************************
1688  ********************************************************************************
1689   
1690  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('ror') (but no reserve provision):
1691   
1692  *$ontext
1693  N_TECH.fx('ror') = 5857.47 ;
1694  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1697   
1698  * Fix everything to zero in case no ROR option is selected:
1699  *N_TECH.fx('ror') = 0 ;
1700  *G_RES.fx('ror',h) = 0 ;
1701  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1702   
1703   
1704  ********************************************************************************
1705  **** No storage and DSM in first period  ***************************************
1706  ********************************************************************************
1707   
1708  ** No storage inflow in first period **
1709  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1710   
1711   
1712   
1713  ********************************************************************************
1714  **** No primary reserves by heating devices  ***********************************
1715  ********************************************************************************
1716   
1717   
1718  ********************************************************************************
1719  **** Fixing to reduce model size  **********************************************
1720  ********************************************************************************
1721   
1722  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1723  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1724   
1725  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1726  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1727  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1728  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1729  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1730  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1731   
1732  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1733  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1734  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1735  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1736  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1737   
1738   
1739  Variables
1740  STO_IN_PRO2M(tech,sto,h)
1741  STO_IN_M2PRO(sto,h)
1742  STO_IN_M2M(sto,h)
1743  STO_OUT_PRO2M(sto,h)
1744  STO_OUT_M2PRO(sto,h)
1745  STO_OUT_M2M(sto,h)
1746  STO_L_PRO(sto,h)
1747  STO_L_PRO2M(sto,h)
1748  STO_L_M2PRO(sto,h)
1749  STO_L_M2M(sto,h)
1750  ;
1751   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1775   
1776  * Deactivated market storage links
1777   
1778  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1779  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1780  STO_IN_M2M.fx(sto,h)       = 0 ;
1781  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1782  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1783  STO_OUT_M2M.fx(sto,h)      = 0 ;
1784  STO_L_PRO.fx(sto,h)        = 0 ;
1785  STO_L_PRO2M.fx(sto,h)      = 0 ;
1786  STO_L_M2PRO.fx(sto,h)      = 0 ;
1787  STO_L_M2M.fx(sto,h)        = 0 ;
1788   
1789  ********************************************************************************
1790  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *************************************
1791  ********************************************************************************
1792   
1793  * Default level zero for report parameters
1794  lev_Z(scen) = 0 ;
1795  lev_G_L(scen,tech,h) = 0 ;
1796  lev_G_UP(scen,tech,h) = 0 ;
1797  lev_G_DO(scen,tech,h) = 0 ;
1798  lev_G_RES(scen,tech,h) = 0 ;
1799  lev_CU(scen,tech,h) = 0 ;
1800  lev_STO_IN(scen,sto,h) = 0 ;
1801  lev_STO_OUT(scen,sto,h) = 0 ;
1802  lev_STO_L(scen,sto,h) = 0 ;
1803  lev_N_TECH(scen,tech) = 0 ;
1804  lev_N_STO_E(scen,sto) = 0 ;
1805  lev_N_STO_P(scen,sto) = 0 ;
1806  marginal_con1a(scen,h) = 0 ;
1807  marginal_con5a(superscen) = 0 ;
1808   
1809  * Prosumage
1810  lev_CU_PRO(scen,tech,h) = 0 ;
1811  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1812  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1813  lev_G_RES_PRO(scen,tech,h) = 0  ;
1814  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1815  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1816  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1817  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1818  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1819  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1820  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1821  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1822  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1823  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1824  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1825  lev_STO_L_M2M(scen,sto,h) = 0  ;
1826  lev_N_STO_E_PRO(scen,sto) = 0  ;
1827  lev_N_STO_P_PRO(scen,sto) = 0  ;
1828  lev_STO_L_PRO(scen,sto,h) = 0  ;
1829  lev_N_RES_PRO(scen,tech) = 0  ;
1830   
1831   
1832  * Fixing of report parameters for run-of-river
1833  *$ontext
1834  lev_N_TECH(scen,'ror') = 5857.47 ;
1835  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1845   
1846   
1847   
1848   
1849   
1850   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\scenario.gms
1852   
1853  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1863  ********************************************************************************
1864   
1865   
1866   
1867   
1868  *****************************************
1869  **** Scenario file                   ****
1870  ****                                 ****
1871  *****************************************
1872   
1873  Parameter
1874  m_exog_p(tech)
1875  m_exog_sto_e(sto)
1876  m_exog_sto_p(sto)
1877   
1878  ;
1879   
1880  m_exog_p(tech)    = technology_data(tech,'fixed_capacities') ;
1881  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1882  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1883   
1884   
1885  *** Dispatch model
      N_TECH.fx(tech)  = m_exog_p(tech) + 0.1 ;
      N_STO_P.fx(sto)  = m_exog_sto_p(sto) ;
      N_STO_E.fx(sto)  = m_exog_sto_e(sto) ;
       
      N_TECH.fx('nuc')     = no  ;     
      N_STO_E.fx('sto1')   = no ;
      N_STO_E.fx('sto2')   = no ;
      N_STO_E.fx('sto3')   = no ;
      N_STO_E.fx('sto4')   = no ;
      N_STO_E.fx('sto6')   = no ;
      N_STO_E.fx('sto7')   = no ;
      N_STO_P.fx('sto1')   = no ;
      N_STO_P.fx('sto2')   = no ;
      N_STO_P.fx('sto3')   = no ;
      N_STO_P.fx('sto4')   = no ;
      N_STO_P.fx('sto6')   = no ;
      N_STO_P.fx('sto7')   = no ;
       
      $ontext
1907   
1908  *** Investment model
1909  *$ontext
1910  N_TECH.lo(tech)        = 0 ;
1911  N_TECH.lo('wind_on')   = m_exog_p('wind_on') ;
1912  N_TECH.lo('wind_off')  = m_exog_p('wind_off') ;
1913  N_TECH.lo('pv')        = m_exog_p('pv') ;
1914  N_STO_P.lo(sto)        = m_exog_sto_p(sto) ;
1915  N_STO_E.lo(sto)        = m_exog_sto_e(sto) ;
1916  N_TECH.up(tech)        = m_exog_p(tech) + 0.1 ;
1917  N_TECH.up('wind_on')   = inf ;
1918  N_TECH.up('wind_off')  = inf ;
1919  N_TECH.up('pv')        = inf ;
1920  N_STO_P.up(sto)        = m_exog_sto_p(sto) + 0.1 ;
1921  N_STO_E.up(sto)        = m_exog_sto_e(sto) + 0.1 ;
1922  N_STO_P.up('sto1')     = inf ;
1923  N_STO_P.up('sto5')     = inf ;
1924  N_STO_P.up('sto7')     = inf ;
1925  N_STO_E.up('sto1')     = inf ;
1926  N_STO_E.up('sto5')     = inf ;
1927  N_STO_E.up('sto7')     = inf ;
1930   
1931   
1932   
1933  * Definition of dictionary set for GUSS tool
1934   
1935  Set dict(*,*,*) /
1936  scen             .scenario       .''
1937  gussoptions      .opt            .modstats
1938   
1939  phi_min_res      .param          .min_res
1940   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1945   
1946   
1947  con5a_minRES     .marginal       .marginal_con5a
1948  con1a_bal        .marginal       .marginal_con1a
1949   
1950   
1951  *$ontext
1952  Z                .level          .lev_Z
1955  G_L              .level          .lev_G_L
1956  G_UP             .level          .lev_G_UP
1957  G_DO             .level          .lev_G_DO
1958  G_RES            .level          .lev_G_RES
1959  CU               .level          .lev_CU
1960  STO_IN           .level          .lev_STO_IN
1961  STO_OUT          .level          .lev_STO_OUT
1962  STO_L            .level          .lev_STO_L
1963  N_TECH           .level          .lev_N_TECH
1964  N_STO_E          .level          .lev_N_STO_E
1965  N_STO_P          .level          .lev_N_STO_P
1966   
1967   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1981  /
1982  ;
1983   
1984   
1985   
1986  *$ontext
1987  solve  DIETER using lp min Z scenario dict;
1988   
1989   
1990   
1991  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\report.gms
1993   
1994  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
2004  ********************************************************************************
2005   
2007   
2008   
2009   
2010   
2011  ********************************************************************************
2012  **** Parameters for report file  ***********************************************
2013  ********************************************************************************
2014   
2015  Parameter
2016  corr_fac_dis             Balancing correction factor - dispatchable technologies
2017  corr_fac_nondis          Balancing correction factor - nondispatchable technologies
2018  corr_fac_sto             Balancing correction factor - storage technologies
2019  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment technologies
2020  corr_fac_dsm_shift       Balancing correction factor - DSM shifting technologies
2021  corr_fac_ev              Balancing correction factor - electric vehicles
2022  corr_fac_rsvr            Balancing correction factor - reservoir
2023  corr_fac_sets            Balancing correction factor - SETS
2024  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2025  corr_fac_hp              Balancing correction factor - heat pumps
2026  corr_fac_h_elec          Balancing correction factor - hybrid electric storage heating
2027   
2028  corr_fac_ev_sep
2029   
2030  gross_energy_demand                      Gross energy demand
2031  gross_energy_demand_market               Gross energy demand - market (non-prosumage segment)
2032  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2033  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers self-generated
2034  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers from market
2035   
2036  reserves_activated
2037   
2038  calc_maxprice
2039  calc_minprice
2040   
2041  report
2042  report_tech
2043  report_tech_hours
2044  report_hours
2045  report_node
2046  report_line
2047  report_cost
2048   
2049  report_reserves
2050  report_reserves_hours
2051  report_reserves_tech
2052  report_reserves_tech_hours
2053   
2054  report_prosumage
2055  report_prosumage_tech
2056  report_prosumage_tech_hours
2057  report_market
2058  report_market_tech
2059  report_market_tech_hours
2060   
2061  report_heat_tech_hours
2062  report_heat_tech
2063  ;
2064   
2065   
2066   
2067   
2068  ********************************************************************************
2069  **** Initialize reporting paremetrs  *******************************************
2070  ********************************************************************************
2071   
2072  * Set reporting sensitivity. All results below will be reported as zero
2073  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        / 1e-4 / ;
2074  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         / 1e-2 / ;
2075  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   / 1 /    ;
2076   
2077   
2078  * ----------------------------------------------------------------------------
2079   
2080  * Min and max for prices
2081  calc_maxprice = 0 ;
2082  calc_minprice = 1000 ;
2083   
2084   
2085  * ----------------------------------------------------------------------------
2086   
2087  * Default values for correction factors
2088  corr_fac_dis(scen,dis,h) = 0 ;
2089  corr_fac_nondis(scen,nondis,h) = 0 ;
2090  corr_fac_sto(scen,sto,h) = 0 ;
2091  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2092  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2093  *corr_fac_ev(scen,h) = 0 ;
2094  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2095  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2096  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2097  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2098  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2099   
2100  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2101   
2102   
2103  * ----------------------------------------------------------------------------
2104   
2105  * Parameter for hourly nodal reserves activated
2106  reserves_activated(scen,h) = 0 ;
2107   
2108   
2109   
2110   
2111   
2112  * ----------------------------------------------------------------------------
2113   
2114  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(scen,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2121   
2122   
2123  * ----------------------------------------------------------------------------
2124   
2125  *Determine balancing correction factors
2126   
2127   
2128   
2129   
2130  * ----------------------------------------------------------------------------
2131   
2132  * Define gross energy demand for reporting
2133  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(scen,sto,h) - lev_STO_OUT_M2PR
      O(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2138   
2139   
2140  )
2141  ;
2142   
2143   
2144  ********************************************************************************
2145  **** Report  *******************************************************************
2146  ********************************************************************************
2147   
2148  * REPORT model statistics
2149          report('model status',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2150          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2151          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2152   
2153   
2154  * ----------------------------------------------------------------------------
2155   
2156  * REPORT HOURS
2157          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= d(h) ;
2158          report_hours('energy generated',loop_res_share,loop_prosumage,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h)) + sum( sto , l
      ev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2159  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2160  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2161  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2162  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) ) ;
2163  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2164  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) )) ;
2165  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2166          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2167   
2168                   report_hours('energy generated',loop_res_share,loop_prosumage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2169                   report_hours('energy demanded',loop_res_share,loop_prosumage,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2170  *                 report_hours('gross exports',loop_res_share,loop_prosumage,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2171  *                 report_hours('gross imports',loop_res_share,loop_prosumage,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2172                   report_hours('demand consumers',loop_res_share,loop_prosumage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2173                   report_hours('price',loop_res_share,loop_prosumage,h)$(report_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND report_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2174  *                 report_hours('infeasibility',loop_res_share,loop_prosumage,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2175   
2176   
2177  * ----------------------------------------------------------------------------
2178   
2179  * REPORT TECH HOURS
2180          report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2181  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h) ) ;
2182          report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2183  *        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) ) ;
2184  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rsvr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2185  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(scen,rsvr,h) ) ;
2186          report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2187          report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(
      scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2188          report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_
      STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) ) ;
2189          report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2190  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc(l)* lev_F(scen,l,h)) ) ;
2191   
2192                   report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2193                   report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2194  *  star added        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2195                   report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2196                   report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2197                   report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2198                   report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2199  *                 report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)) < eps_rep_abs ) = 0 ;
2200  *                 report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)< eps_rep_abs ) = 0 ;
2201  *                 report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2202  *                 report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2203   
2204   
2205  * ----------------------------------------------------------------------------
2206   
2207  * RPEORT LINE
2208   
2209  * ----------------------------------------------------------------------------
2210   
2211  * REPORT NODE
2212          report_node('energy demand total',loop_res_share,loop_prosumage)= (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2
      M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2213   
2214  ;
2215          report_node('energy demand gross',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2216          report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2217  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2218           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) )) ;
2219          report_node('energy generated gross',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2220  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
2221           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2222  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2223  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )) ;
2224  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F(scen,l,h)) ) ;
2225  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) ) ) ;
2226  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2227  *        report_node('net import share in gross demand',loop_res_share,loop_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2228  *        report_node('net export share in net generation',loop_res_share,loop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2229  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev_NTC(scen,l))) ) ;
2230  *        report_node('gross import share',loop_res_share,loop_prosumage)= sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2231  *        report_node('gross export share in net generation',loop_res_share,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loop_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,loop_prosumage,h)) ;
2232          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)))
       + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2233  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)))
2234   
2235  ;
2236          report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2237          report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (
      lev_N_TECH(scen,nondis))))) ;
2238          report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2239          report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2240          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2241          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2242          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)))/card(h) ;
2243   
2244                   report_node('energy demand total',loop_res_share,loop_prosumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2245                   report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2246                   report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2247                   report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2248                   report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2249                   report_node('min price',loop_res_share,loop_prosumage)$(report_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND report_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2250  *                 report_node('gross exports',loop_res_share,loop_prosumage)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2251  *                 report_node('gross imports',loop_res_share,loop_prosumage)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2252  *                 report_node('net exports',loop_res_share,loop_prosumage)$(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_abs*card(h)) = 0 ;
2253                   report_node('energy generated net',loop_res_share,loop_prosumage)$(report_node('energy generated net',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2254                   report_node('energy generated gross',loop_res_share,loop_prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2255                   report_node('energy demand gross',loop_res_share,loop_prosumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2256  *                 report_node('net import share in gross demand',loop_res_share,loop_prosumage)$(report_node('net import share in gross demand',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2257  *                 report_node('net export share in net generation',loop_res_share,loop_prosumage)$(report_node('net export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2258                   report_node('Capacity total',loop_res_share,loop_prosumage)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2259  *                 report_node('gross import share',loop_res_share,loop_prosumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2260  *                 report_node('gross export share in net generation',loop_res_share,loop_prosumage)$(report_node('gross export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2261   
2262   
2263  * ----------------------------------------------------------------------------
2264   
2265  * REPORT COST
2266          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) + c_do(dis)*lev_G_DO(scen,di
      s,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO_IN(scen,sto,h) ) )
2267   
2268  ));
2269           report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech , c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + sum( sto , c_i_sto_e(sto)*le
      v_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,sto) )
2270  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr_p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rsvr))
2271   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res)*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(scen,sto)) + c_i_sto_p(sto)*l
      ev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2276  );
2277   
2278  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_infes * lev_G_INFES(scen,h)) ) ;
2279  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen_phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2280  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2281           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2282  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2283  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2284  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)
2285   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l)$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_ins) = 0 ;
2297   
2298  * ----------------------------------------------------------------------------
2299   
2300  * REPORT TECH
2301          report_tech('capacities conventional',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2302          report_tech('capacities renewable',loop_res_share,loop_prosumage,res)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) ;
2303  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr));
2304  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr));
2305          report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2306          report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2307   
2308          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2309          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2310  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2311          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2312          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2313   
2314          report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_
      STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2315  *        report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , gross_energy_demand(scen)) ;
2316          report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand
      (scen)) ;
2317          report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',lo
      op_res_share,loop_prosumage)) ;
2318  *        report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2319          report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2320   
2321          report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2322          report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_P
      RO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ))) ) ;
2323   
2324          report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2325          report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2326   
2327          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2328          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKE
      T_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
2329  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2330          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)) / sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2331   
2332   
2333                   report_tech('capacities conventional',loop_res_share,loop_prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2334                   report_tech('capacities renewable',loop_res_share,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2335                   report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2336                   report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2337  *                 report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2338  *                 report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2339                   report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2340  *                 report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2341                   report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2342                   report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2343  *                 report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2344                   report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2345                   report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2346                   report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2347                   report_tech('Capacity share',loop_res_share,loop_prosumage,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2348                   report_tech('Capacity share',loop_res_share,loop_prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2349  *                 report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2350                   report_tech('Capacity share',loop_res_share,loop_prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2351                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(report_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2352                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(report_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2353  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(report_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2354                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2355                   report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2356                   report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2357   
2358   
2359  * ----------------------------------------------------------------------------
2360   
2361  * REPORT NODE
2362          report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res))
2363  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr))
2364           ;
2365          report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)) ;
2366  *        report_node('net import share in nodal gross demand',loop_res_share,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosumage)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2367          report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res))
2368  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr))
2369           ;
2370          report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)) ;
2371   
2372                   report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2373                   report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2374                   report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2375                   report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2376   
2377   
2378   
2379  * ----------------------------------------------------------------------------
2380   
2381  * REPORT TECH
2382          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) ;
2383          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2384  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2385          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(s
      cen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) ;
2386   
2387          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',loop_res_share,loop_prosuma
      ge)* 1 + 1e-9 ;
2388          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2389  *        report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2390          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,s
      to,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2391          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2392          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_
      share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2393   
2394                   report_tech('Yearly energy',loop_res_share,loop_prosumage,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps_rep_ins ) = 0 ;
2395                   report_tech('Yearly energy',loop_res_share,loop_prosumage,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps_rep_ins ) = 0 ;
2396  *                 report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins ) = 0 ;
2397                   report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps_rep_ins ) = 0 ;
2398   
2399                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2400                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2401  *                 report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2402                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2403                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2404                   report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2405   
2406   
2407  * ----------------------------------------------------------------------------
2408   
2409  * RPEORT
2410          report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)  ;
2411          report('curtailment of fluct res relative',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (
      lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) )) ;
2412          report('bio not utilized absolute',loop_res_share,loop_prosumage)$( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loop_prosumage)  ;
2413          report('bio not utilized relative',loop_res_share,loop_prosumage)$( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_prosumage) /m_e('bio') ;
2414          report('Capacity total',loop_res_share,loop_prosumage) = report_node('Capacity total',loop_res_share,loop_prosumage) ;
2415          report('energy demand gross',loop_res_share,loop_prosumage) = report_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2416          report('energy demand total',loop_res_share,loop_prosumage) = report_node('energy demand total',loop_res_share,loop_prosumage)  ;
2417          report('energy generated net',loop_res_share,loop_prosumage) =  report_node('energy generated net',loop_res_share,loop_prosumage) ;
2418          report('energy generated gross',loop_res_share,loop_prosumage) =  report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2419  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2420          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_res(res,h) * lev_N_RES_PRO(sc
      en,res) - lev_CU_PRO(scen,res,h))
2421  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)))
2422           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2423          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2424          report('Energy total',loop_res_share,loop_prosumage) = report_node('Energy total',loop_res_share,loop_prosumage) ;
2425   
2426                   report('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2427                   report('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2428                   report('bio not utilized absolute',loop_res_share,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2429                   report('bio not utilized relative',loop_res_share,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2430                   report('Capacity total',loop_res_share,loop_prosumage)$(report('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2431                   report('gross trade share',loop_res_share,loop_prosumage)$(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2432                   report('renshare total',loop_res_share,loop_prosumage)$(report('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2433                   report('conshare total',loop_res_share,loop_prosumage)$(report('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2434                   report('Energy total',loop_res_share,loop_prosumage)$(report('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2435   
2436   
2437  * ----------------------------------------------------------------------------
2438   
2439  * DSM
2440   
2441   
2442  * ----------------------------------------------------------------------------
2443   
2444  * EV
2445   
2446   
2447   
2448  * ----------------------------------------------------------------------------
2449   
2450  * Reserves
2451   
2452   
2453   
2454   
2455  * ----------------------------------------------------------------------------
2456   
2457  * Reserves and DSM
2458   
2459   
2460  * ----------------------------------------------------------------------------
2461   
2462  * ----------------------------------------------------------------------------
2463   
2464  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross_energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h
       , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('
      price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price',l
      oop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours
      ('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours(
      'price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARK
      ET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_res_share,loo
      p_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_re
      s_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(
      scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserves',loop_res
      _share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserve
      s',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_
      energy_demand_prosumers_selfgen(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_p
      rosumers_market(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) / 
      report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) 
      / report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res
      ,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_
      share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen
      ,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_prosumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO
      2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market('Capacity total market',loop_res_share,loop_prosumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech) ) / report_ma
      rket('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,con,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumage,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
      *                 report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
      *                 report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)$(report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)$(report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share,loop_prosumage)$(report_market('gross energy demand market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)$(report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0
       ;
                       report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop_prosumage)$(report_market('Capacity total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share,loop_prosumage)$(report_market('Energy demand total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_share,loop_prosumage)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
      $ontext
2736   
2737   
2738  * ----------------------------------------------------------------------------
2739   
2740  * PROSUMAGE & DSM
2741   
2742   
2743   
2744  * ----------------------------------------------------------------------------
2745   
2746   
2747   
2748  * ----------------------------------------------------------------------------
2749   
2750  * HEAT
2751   
2752  * ----------------------------------------------------------------------------
2753   
2754  * Reserves and heat
2755   
2756   
2757  * ---------------------------------------------------------------------------- *
2758  * ---------------------------------------------------------------------------- *
2759  * ---------------------------------------------------------------------------- *
2760   
2761   
2762  execute_unload "results", report, report_tech, report_node,
2763  *report_line,
2764  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, report_market, report_market_tech, report_market_tech_hours
      $ontext
2769  ;
2770   
2771   
      $include report_to_excel.gms
      $ontext
2776   
2777   
2780   
      solve   DIETER_MCP using MCP;
       
       
      Parameters
      Z_MCP
      ;
       
      Z_MCP =            sum( (h,dis) , c_m(dis)*G_L.l(dis,h) )
                       + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP.l(dis,h) )
                       + sum( (h,dis) , c_do(dis)*G_DO.l(dis,h) )
                       + sum( (h,nondis) , c_cu(nondis)*CU.l(nondis,h) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT.l(sto,h) + STO_IN.l(sto,h) ) )
                       + sum( tech , c_i(tech)*N_TECH.l(tech) )
                       + sum( tech , c_fix(tech)*N_TECH.l(tech) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E.l(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P.l(sto)+ N_STO_E.l(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P.l(sto) )
      ;
       
       
      Display
      Z_MCP,
      N_TECH.l,
      N_STO_E.l,
      N_STO_P.l,
      G_L.l,
      G_UP.l,
      G_DO.l,
      G_RES.l,
      CU.l,
      STO_IN.l,
      STO_OUT.l,
      STO_L.l
      ;
       
      $ontext
2819   
2820  * ---------------------------------------------------------------------------- *
2821  * ---------------------------------------------------------------------------- *
2822  * ---------------------------------------------------------------------------- *
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\DIETER.gms
     2      136 INCLUDE        1     136  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\dataload.gms
     3      540 CALL           2     404  .gdxxrw data_input.xlsx @temp.tmp o=Data_input maxdupeerrors=100
     4      542 GDXIN          2     406  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\Data_input.gdx
     5      590 CALL           2     454  .gdxxrw time_series.xlsx @temp2.tmp o=time_series
     6      591 GDXIN          2     455  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\time_series.gdx
     7      931 INCLUDE        1     171  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\model.gms
     8     1670 INCLUDE        1     276  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\fix.gms
     9     1851 INCLUDE        1     277  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\scenario.gms
    10     1992 INCLUDE        1     339  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\report.gms


COMPILATION TIME     =       11.263 SECONDS      6 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Setup/Generation    SOLVE DIETER Using LP From line 1987


Warning GUSS turns holdFixed for DIETER off.
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1987


MODEL STATISTICS

BLOCKS OF EQUATIONS          13     SINGLE EQUATIONS      359,189
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      464,300  5 projected
NON ZERO ELEMENTS     1,529,182     NON LINEAR N-Z        105,121
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH             148,925


GENERATION TIME      =       59.905 SECONDS    225 MB  25.1.2 r67455 WEX-WEI


EXECUTION TIME       =       60.108 SECONDS    225 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1987


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1987

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         15.085  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             25.1.2 r67420 Released Jul 31, 2018 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\cplex.opt"
Space for names approximately 24.08 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 14.59sec (det. 6992.98 ticks)
Optimal solution found.
Objective : 33252084599.493717

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33252084599.4937
---   Resource Usage   15117
---   Total Time (ms)  15210

No solution returned
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 15:09:42 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.655 SECONDS    126 MB  25.1.2 r67455 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_GUSS\DIETER.lst
