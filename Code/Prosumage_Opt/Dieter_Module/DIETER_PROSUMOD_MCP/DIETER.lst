GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 05/13/19 10:42:49 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20  ***** Set star to activate options
  21   
  22  * Set star to skip Excel upload and load data from gdx
  24   
  25  * Choose base year
  27   
  28  * Germany only - also adjust Excel inputs!
  30   
  31  * Dispatch only - use fixed capacities (also deactivates bio energy restri
      ction)
  33   
  34  * Select if you want to use load change costs
  36   
  38   
  39  * Select system-friendly prosumage or selfish prosumage
  41   
  42  * Set star to select run-of-river options either as exogenous parameter or
       as endogenous variable including reserve provision:
  43  * if nothing is selected, ROR capacity will be set to zero
  44  * if parameter option is selected, set appropriate values in fix.gmx
  46   
  47  * Set star for reporting to Excel
  49   
  50  * Set star if only second hour is used
  51   
  53   
  54  * ----------------- Select if to use MCP or LP format --------------------
      ------
  55   
  56  * Set to "*" to select linear program, leave blank to select MCP
  58   
  59   
  60  **************************************************************************
      ******
  61   
  62  * Definition of strings for report parameters and sanity checks
  63  * (Do not change settings below)
  64   
  65  * Sanity checks
  67   
  68  * Do not change these  lines
  72   
  75   
  76   
  79   
  82  **************************************************************************
      ******
  83   
  84   
  85  **************************
  86  ***** SOLVER OPTIONS *****
  87  **************************
  88   
  89  options
  90  optcr = 0.00
  91  reslim = 10000000
  92  lp = cplex
  93  mip = cplex
  94  nlp = conopt
  95  limrow = 0
  96  limcol = 0
  97  ;
  98   
  99  options
 100  dispwidth = 15
 101  limrow = 0
 102  limcol = 0
 103  solprint = off
 104  sysout = off
 105  ;
 106   
 107   
 108  **************************************************************************
      ******
 109   
 110  **************************
 111  ***** Dataload *****
 112  **************************
 113   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\dataload.gms
 115   
 116  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 126  **************************************************************************
      ******
 127   
 128   
 129   
 130   
 131  ***************  SETS  ***************************************************
      ******
 132   
 133  ***** Sets used in the model *****
 134  Sets
 135  tech                     Generation technologies
 136   dis(tech)               Dispatchable generation technologies
 137   nondis(tech)            Nondispatchable generation technologies
 138   con(tech)               Conventional generation technologies
 139   res(tech)               Renewable generation technologies
 140   sto                     Storage technologies
 141  rsvr                     Reservoir technologies
 142  dsm                      DSM technologies
 143   dsm_shift(dsm)          DSM load shifting technologies
 144   dsm_curt(dsm)           DSM load curtailment technologies
 145  year                     Base year for temporal data
 146  h                        Hours
 147  n                        Nodes
 148  l                        Lines
 149  ev                       EV types
 150  reserves                         Reserve qualities
 151   reserves_up(reserves)           Positive reserves
 152   reserves_do(reserves)           Negative reserves
 153   reserves_spin(reserves)         Spinning reserves
 154   reserves_nonspin(reserves)      Nonspinning reserves
 155   reserves_prim(reserves)         Primary reserves
 156   reserves_nonprim(reserves)      Nonprimary reserves
 157   reserves_prim_up(reserves)      Primary positive reserves
 158   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 159   reserves_prim_do(reserves)      Primary negative reserves
 160   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 161  bu                       Building archtypes
 162  ch                       Heating combination type
 163   hst(ch)                 Heating technology that feeds to storage
 164   hp(ch)                  Heat pump technologies
 165   hel(ch)                 Hybrid electric heating technologies - electric p
      art
 166   hfo(ch)                 Hybrid electric heating technologies - fossil par
      t
 167   
 168   
 169  ***** Sets used for data upload *****
 170  headers_tech                     Generation technologies - upload headers
 171   tech_dispatch                   Generation technologies - dispatchable or
       nondispatchable
 172   tech_res_con                    Generation technologies - renewable or "c
      onventional"
 173  headers_sto                      Storage technologies - upload headers
 174  headers_reservoir                Reservoir technologies - upload headers
 175  headers_dsm                      DSM technologies - upload headers
 176   dsm_type                        DSM technologies - shifting or curtailmen
      t
 177  headers_time                     Temporal data - upload headers
 178  headers_topology                 Spatial data - upload headers
 179  headers_ev                       EV data - upload headers
 180  headers_time_ev                  EV temporal data - upload headers
 181  headers_prosumage_generation     Prosumage generation data - upload header
      s
 182  headers_prosumage_storage        Prosumage storage data - upload headers
 183  headers_reserves                 Reserve data - upload headers
 184   reserves_up_down                Reserve data - positive and neagtive rese
      rves
 185   reserves_spin_nonspin           Reserve data - spinning and nonspinning r
      eserves
 186   reserves_prim_nonprim           Reserve data - primary and nonprimary res
      erves
 187  headers_heat                     Heat data - upload headers
 188   heat_storage                    Heat data - storage technologies
 189   heat_hp                         Heat data - heat pump technologies
 190   heat_elec                       Heat data - hybrid heating technologies -
       electric part
 191   heat_fossil                     Heat data - hybrid heating technologies -
       fossil part
 192  headers_time_heat                Heat data - upload headers time data
 193  headers_time_dhw                 Heat data - upload headers time data on D
      HW
 194  headers_pro                      Prosumage data - upload headers
 195  ;
 196   
 197   
 198   
 199   
 200  ***************  PARAMETERS  *********************************************
      ******
 201   
 202  Parameters
 203   
 204  ***** Generation technologies *****
 205  *--- Variable and fixed costs ---*
 206  eta              Efficiency of conventional technologies [0 1]
 207  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 208  c_up             Load change costs UP [EUR per MWh]
 209  c_do             Load change costs DOWN [EUR per MWh]
 210  c_fix            Annual fixed costs [EUR per MW per year]
 211  c_vom            Variable O&M costs [EUR per MWh]
 212  CO2price         CO2 price in [EUR per ton]
 213   
 214  *--- Investment ---*
 215  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 216  lifetime         Investment costs: technical lifetime [a]
 217  recovery         Investment costs: Recovery period according to depreciati
      on tables [a]
 218  interest_rate    Investment costs: Interest rate [%]
 219  m_p              Investment: maximum installable capacity per technology [
      MW]
 220  m_e              Investment: maximum installable energy [TWh per a]
 221   
 222  *--- Flexibility ---*
 223  grad_per_min     Maximum load change relative to installed capacity [% of 
      installed capacity per minute]
 224   
 225   
 226  ***** Fuel and CO2 costs *****
 227  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 228   
 229   
 230  ***** Renewables *****
 231  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 232  phi_min_res      Minimum renewables share [0 1]
 233   
 234   
 235  ***** Storage *****
 236  *--- Variable and fixed costs ---*
 237  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 238  eta_sto          Storage efficiency [0 1]
 239  phi_sto_ini      Initial storage level [0 1]
 240  etop_max         Maximum E to P ratio of storage types [#]
 241  c_fix_sto        Annual fixed costs [EUR per MW]
 242   
 243  *--- Investment ---*
 244  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight
       [EUR per MWh]
 245  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnig
      ht [EUR per MW]
 246  m_sto_e                     Investment into storage: maximum installable e
      nergy [MWh]
 247  m_sto_p                     Investment into storage: maximum installable p
      ower [MW]
 248   
 249   
 250  ***** Reservoir*****
 251  *--- Variable and fixed costs ---*
 252  c_m_rsvr                 Marginal costs of generating energy from reservoi
      r [EUR per MWh]
 253  eta_rsvr                 Generation efficiency [0 1]
 254  phi_rsvr_ini             Initial reservoir level [0 1]
 255  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 256  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of a
      nnual energy [0 1]
 257  phi_rsvr_lev_min         Minimum filling level [0 1]
 258   
 259  *--- Investment ---*
 260  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight 
      [EUR per MWh]
 261  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnigh
      t [EUR per MW]
 262  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetim
      e [a]
 263  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 264  m_rsvr_e                 Investment into reservoir: maximum installable en
      ergy [MWh]
 265  m_rsvr_p                 Investment into reservoir: maximum installable ca
      pacity [MW]
 266   
 267   
 268  ***** DSM *****
 269  *--- Variable and fixed costs ---*
 270  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 271  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 272  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW 
      per a]
 273  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per
       a]
 274   
 275  *--- Flexibility, efficiency, recovery ---*
 276  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 277  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment i
      nstances [h]
 278   
 279  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 280  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upsh
      ift instances [h]
 281  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 282   
 283  *--- Investment ---*
 284  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment
      : Overnight [EUR per MW]
 285  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: O
      vernight [EUR per MW]
 286  inv_recovery_dsm_cu              Investment costs for DSM load curtailment
      : Recovery period [a]
 287  inv_recovery_dsm_shift           Investment costs for DSM load shifting: R
      ecovery period [a]
 288  inv_interest_dsm_cu              Investment costs for DSM load curtailment
      : Interest rate [%]
 289  inv_interest_dsm_shift           Investment costs for DSM load shifting: I
      nterest rate [%]
 290  m_dsm_cu                         DSM: Maximum installable capacity load cu
      rtailment [MW]
 291  m_dsm_shift                      DSM: Maximum installable capacity load sh
      ifting [MW]
 292   
 293   
 294  ***** Time Data *****
 295  d_y                      Demand hour h for different years [MWh]
 296  d                        Demand hour h [MWh]
 297  d_pro                    Prosumage demand hour h [MWh] for 1000 households
 298  phi_res_y                Renewables availability technology res in hour h 
      for different years [0 1]
 299  phi_res                  Renewables availability technology res in hour h 
      [0 1]
 300  phi_ror_y                Run-of-river availability technology ror in hour 
      h for different years [0 1]
 301  phi_ror                  Run-of-river availability technology ror in hour 
      h [0 1]
 302  rsvr_in_y                Reservoir inflow in hour h for different years [0
       1]
 303  rsvr_in                  Reservoir inflow in hour h [0 1]
 304  n_ev_p_upload            Power rating of the charging connection in hour h
       [MW - 0 when car is in use or parked without grid connection]
 305  ev_ed_upload             Electricity demand for mobility vehicle profile e
      v in hour h [MW]
 306  ev_ged_exog_upload       Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h [MW]
 307  phi_reserves_call_y      Hourly share of reserve provision that is actuall
      y activated for different years [0 1]
 308  phi_reserves_call        Hourly share of reserve provision that is actuall
      y activated [0 1]
 309  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 310  reserves_exogenous       Hourly reserve provision [MW]
 311   
 312  ***** Transmission *****
 313  *--- Investment ---*
 314  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 315  c_fix_ntc                 Fixed costs [EUR per MW per a]
 316  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 317  inv_recovery_ntc          Investment costs: Recovery period in [a]
 318  inv_interest_ntc          Investment costs: Interest rate [%]
 319  m_ntc                     Investment into NTC: maximum installable capacit
      y [MW]
 320   
 321  *--- Topology and distance ---*
 322  inc              Incidence index of link l on node n
 323  dist             Distance covered by link l [km]
 324   
 325   
 326  ***** Electric vehicles *****
 327  *--- Costs and attributes ---*
 328  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 329  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh
      ]
 330  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 331  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 332  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 333   
 334  n_ev_e           Electric vehicle battery capacity [MWh]
 335  ev_quant         Overall number of electirc vehicles [#]
 336  phi_ev           Share of electric vehicles per load profile in actual sce
      nario [0 1]
 337  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if 
      yes 0 otherwise]
 338   
 339  *--- Temporal data ---*
 340  n_ev_p           Electric vehicle power rating [MWh]
 341  ev_ed            Electric vehicle electricity demand [MWh]
 342  ev_ged_exog      Electric vehicle grid electricity demand for exogenous ch
      arging pattern [MWh]
 343   
 344   
 345  ***** Prosumage *****
 346  phi_pro_load             Share of prosumagers among total load [0 1]
 347  numb_pro_load            Number of prosumagers in thousands
 348  phi_pro_self             Minimum self-generation shares for prosumagers [0
       1]
 349  m_res_pro                Maximum installable: renewables capacity [MW]
 350  m_sto_pro_e              Maximum installable: storage energy [MWh]
 351  m_sto_pro_p              Maximum installable: storage capacity [MW]
 352  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 353   
 354   
 355  ***** Reserves *****
 356  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 357  reserves_intercept       Intercept of regression line determining reserves
       demand
 358  reserves_slope           Slope of regression line determining reserves dem
      and
 359  reserves_reaction        Activation reaction time for reserves qualities [
      min]
 360  phi_reserves_pr_up       Positive primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 361  phi_reserves_pr_do       Negative primary reserves fraction of total nonpr
      imary reserves demand [0 1]
 362  *reserves_exog
 363   
 364   
 365  ***** Heat *****
 366  *--- Time data ---*
 367  dh_upload                Hourly heat demand per year for upload [MWh per m
      2]
 368  dh_y                     Hourly heat demand per year [MWh per m2]
 369  dh                       Hourly heat demand [MWh per m2]
 370  temp_source              Heat pumps - source temperature [°Celsius]
 371  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2
      ]
 372  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 373  d_dhw                    Hourly DHW demand [MWh per m2]
 374  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-ti
      me storage heaters [MWh per m2]
 375   
 376  *--- Technololgy attributes ---*
 377  phi_heat_type            Share of heating type ch per building archetype b
      u [0 1]
 378  eta_heat_stat            Static efficiency for heating technologies [0 1]
 379  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 380  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies 
      [0 1]
 381  n_heat_p_in              Maximum power inflow into heating technologies [M
      W]
 382  n_heat_p_out             Maximum power outflow from heating technologies [
      MW]
 383  n_heat_e                 Maximum energy level of heating storage technolog
      ies [MWh]
 384  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 385  n_sets_p_out             SETS - Power rating - heat output [MW]
 386  n_sets_e                 SETS - Energy storage capacity [MWh]
 387  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electr
      icity intake [MW]
 388  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW ou
      tput [MW]
 389  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capaci
      ty [MWh]
 390  phi_heat_ini             Inititial storage level of heating technologies [
      0 1]
 391  temp_sink                Heat pumps - sink temperature [°Celsius]
 392  pen_heat_fuel            Penalty term for non-electric fuel usage for hybr
      id heating technologies [EUR per MWh]
 393  area_floor               Floor area subject to specific heating technology
       in specific building type [m2]
 394  theta_night              Indicator for night hours {0 1}
 395   
 396   
 397   
 398  ***************  DERIVED PARAMETERS  *************************************
      ******
 399   
 400  c_m              Marginal production costs for conventional plants includi
      ng variable O and M costs [EUR per MWh]
 401  c_i              Annualized investment costs by conventioanl plant [EUR pe
      r MW]
 402   
 403  c_i_res          Annualized investment costs by renewable plant [EUR per M
      W]
 404  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per
       a]
 405   
 406  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 407  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 408   
 409  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 410  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 411   
 412  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR pe
      r MW]
 413  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per M
      W]
 414   
 415  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 416   
 417  phi_mean_reserves_call_y         Hourly mean of share reserves called per 
      year [0 1]
 418  phi_mean_reserves_call           Hourly mean of share reserves called [0 1
      ]
 419   
 420  theta_dir        Dummy equal to 1 if building type bu has direct heating t
      ype ch [0 1]
 421  theta_sets       Dummy equal to 1 if building type bu has SETS heating typ
      e ch [0 1]
 422  theta_hp         Dummy equal to 1 if building type bu has heat pump heatin
      g type ch [0 1]
 423  theta_elec       Dummy equal to 1 if building type bu has hybrif electric 
      heating - electric part [0 1]
 424  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric 
      heating - fossil part [0 1]
 425  theta_storage    Dummy equal to 1 if building type ch has storage heating 
      type ch [0 1]
 426   
 427   
 428   
 429   
 430  ***************  PARAMETERS FOR DATA UPLOAD  *****************************
      ******
 431   
 432  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 433  technology_data(tech,headers_tech)
 434  storage_data(sto,headers_sto)
 435  reservoir_data(rsvr,headers_reservoir)
 436  time_data_upload(h,year,headers_time)
 437  dsm_data_upload(dsm,dsm_type,headers_dsm)
 438  dsm_data(dsm,headers_dsm)
 439  topology_data(l,headers_topology)
 440  ev_data(ev,headers_ev)
 441  ev_time_data_upload(h,headers_time_ev,ev)
 442  prosumage_data_generation(tech,headers_prosumage_generation)
 443  prosumage_data_storage(sto,headers_prosumage_storage)
 444  reserves_time_data_activation(h,year,reserves)
 445  reserves_time_data_provision(h,year,reserves)
 446  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reser
      ves_prim_nonprim,headers_reserves)
 447  reserves_data(reserves,headers_reserves)
 448  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_
      heat)
 449  heat_data(bu,ch,headers_heat)
 450  dh_upload(h,year,headers_time_heat,bu)
 451  d_dhw_upload(h,year,headers_time_heat,bu)
 452  temp_source_upload
 453  d_pro_upload(h,year,headers_pro)
 454  ;
 455   
 456   
 457   
 458   
 459  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  ***************
      ******
 460   
 487   
 488   
 490   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\DIETER_PROSUMOD_MCP\Data_input.gdx
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  technology_data_upload = 10:technology_data_upload
--- LOAD  storage_data = 11:storage_data
 495   
--- LOAD  headers_prosumage_generation = 8:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 9:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 13:prosumage_data_generation
--- LOAD  prosumage_data_storage = 14:prosumage_data_storage
 497  ;
 498   
      $ontext
 502   
 503   
 504  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  *****************
      ******
 505   
 517   
 518   
 519   
GDXIN   C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Mod
        ule\DIETER_PROSUMOD_MCP\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
--- LOAD  headers_pro = 5:headers_pro
--- LOAD  d_pro_upload = 6:d_pro_upload
 524  ;
 525   
 526   
 527   
 528   
 529  ***************  ASSIGNMENTS  ********************************************
      ******
 530   
 531   
 532   
 533  ***** Aliases *****
 534  alias (h,hh) ;
 535  alias (nondis,nondisnondis) ;
 536   
 537   
 538   
 539  ***** Derived sets *****
 540  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,te
      ch_res_con,'dis',headers_tech)) = yes;
 541  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech
      ,tech_res_con,'nondis',headers_tech)) = yes;
 542   
 543  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      con',tech_dispatch,headers_tech)) = yes;
 544  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'
      res',tech_dispatch,headers_tech)) = yes;
 545   
 546   
 547  ***** Parameters *****
 548   
 549  *--- Generation technologies ---*
 550  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), tec
      hnology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 551  eta(tech) = technology_data(tech,'eta_con') ;
 552  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 553  c_up(dis) =technology_data(dis,'load change costs up') ;
 554  c_do(dis) = technology_data(dis,'load change costs down') ;
 555  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 556  c_vom(tech) = technology_data(tech,'variable_om') ;
 557  CO2price(tech) = technology_data(tech,'CO2_price') ;
 558   
 559  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 560  lifetime(tech) = technology_data(tech,'lifetime') ;
 561  recovery(tech) = technology_data(tech,'recovery_period') ;
 562  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 563  m_p(tech) = technology_data(tech,'max_installable') ;
 564  m_e(tech) = technology_data(tech,'max_energy') ;
 565  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 566  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 567   
 568  c_cu(res) = technology_data(res,'curtailment_costs') ;
 569   
 570   
 571  *--- Storage technologies ---*
 572  c_m_sto(sto) = storage_data(sto,'mc');
 573  eta_sto(sto) = storage_data(sto,'efficiency');
 574  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 575  phi_sto_ini(sto) = storage_data(sto,'level_start');
 576  etop_max(sto) = storage_data(sto,'etop_max') ;
 577   
 578  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 579  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 580  lifetime(sto) = storage_data(sto,'lifetime');
 581  interest_rate(sto) = storage_data(sto,'interest_rate');
 582  m_sto_e(sto) = storage_data(sto,'max_energy');
 583  m_sto_p(sto) = storage_data(sto,'max_power');
 584   
 585   
 586  *--- Temporal data ---*
 587  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 588  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_
      data_upload(h,year,headers_time));
 589  d_pro(h)   = d_pro_upload(h,'2030','demand_pro');
 590  *--- Prosumage ---*
 591  m_res_pro(res)       = prosumage_data_generation(res,'max_power') ;
 592  m_sto_pro_e(sto)     = prosumage_data_storage(sto,'max_energy') ;
 593  m_sto_pro_p(sto)     = prosumage_data_storage(sto,'max_power') ;
 594  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 595   
 596   
 597   
 598  ***************  CALCULATE DERIVED PARAMETERS  ***************************
      ******
 599   
 600  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2
      price(tech) + c_vom(tech)   ;
 601   
 602  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate
      (tech))**(lifetime(tech)) )
 603                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       
      ;
 604   
 605  c_i_res(res) = c_i(res) ;
 606  c_fix_res(res) = c_fix(res) ;
 607   
 608  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 609                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 610   
 611  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+inte
      rest_rate(sto))**(lifetime(sto)) )
 612                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 613   
 614  ***************  Adjust costs to model's hourly basis ********************
      ******
 615   
 616  c_i(tech) = c_i(tech)*card(h)/8760 ;
 617  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 618  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 619   
 620  *c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 621   
 622  *$ontext
 623   
 624  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760*2;
 625   
 628   
 629   
 630  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 631  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 632   
 633  m_e('bio') = m_e('bio')*card(h)/8760 ;
 634   
 635   
 636   
 637  **************************************************************************
      ******
 638   
 639  * Define set of fixed generation technologies
 640  *$ontext
 641   
 642  Set
 643  fx(tech) /ror/
 644  ;
 645   
 646   
 649   
 650  **************************************************************************
      ******
 651   
 652   
 653   
 654   
 655  **************************************************************************
      ******
 656   
 657  ***************************
 658  ***** Initialize data *****
 659  ***************************
 660   
 661  * Parameters for default base year
 662  phi_min_res    = 0   ;
 663  phi_pro_self   = 0.5 ;
 664  numb_pro_load  = 0   ;
 665   
 666   
 667  *$ontext
 668  * Number of prosumage households in thousands
 669  numb_pro_load = 1000 ;
 672   
      $setglobal minimum_SC "*"
       
      $ontext
 678   
 679  *$ontext
 681   
 684   
 685  * Load demand
 686  d(h)           = d_y('2030',h) - numb_pro_load*d_pro(h) ;
 687  phi_res(res,h) = phi_res_y('2030',res,h)  ;
 688   
 689   
 690  Parameters
 691  phi_min_res_exog
 692  price_consumption_pro(h)
 693  price_production_pro(h)
 694  retail_price
 695  FIT
 696  SC_tax
 697  alpha_max
 698  max_solar_avail
 699  flat_network_fee
 700  energy_component
 701  non_energy_component;
 702  phi_min_res_exog = 1;
 703   
 704   
 705  **************************************************************************
      ******
 706  ***** Tariff design scenario 2030 *****
 707  **************************************************************************
      ******
 708   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\tariff_scenario.gms
 710  **************************************************************************
      ******
 711  ***** Tariff Scenario 2030 *****
 712  **************************************************************************
      ******
 713   
 714  *** Define tariffs per MWh (additive)
 715   
 716  * Time-invariant retail price
 717  energy_component      =  0  ;
 718  non_energy_component  = 250  ;
 719  retail_price          = energy_component + non_energy_component ;
 720   
 721  * Time-invariant FIT
 722  FIT          =  0 ;
 723   
 724  * Define volumetric prices for prosumage households (additivie tariffs per
       MWh)
 725   
 726  ** Consumption side
 727  price_consumption_pro(h)  =   retail_price ;
 728   
 729  * Choose that real-time pricing is added on consumption side by setting "*
      "
 731   
 732  * Self-consumption tariff  (applies to G_RES_PRO and STO_OUT_PRO2PRO)
 733  SC_tax                    =  0 ;
 734   
 735  ** Production side
 736  price_production_pro(h)   =   FIT ;
 737   
 738  * Choose that real-time pricing is added on consumption side by setting "*
      "
 740   
 741   
 742  *** Further options
 743  * Limit feed-in of prosumage feed-in to alpha_max of maximum PV energy
 744  * Note: Maximum PV energy referes to installed PV capacity multiplied by m
      aximum
 745  *       solar availability (determined by time series)
 746  alpha_max       = 0.5    ;
 747  max_solar_avail = 0.7067 ;
 748   
 749  * Remove star to select the feed-in restriction
 751   
 752  *** Allow no feed-in from prosumage households
 753  * Remove star to prevent feed-in from prosumage households (i.e. FIT = 0)
 755   
 756   
 757  *** Define annual fixed network fee
 758   
 759  flat_network_fee  = 0 ;
 760   
 761  **************************************************************************
      ******
 762   
 763  **************************************************************************
      ******
 764  ***** Model *****
 765  **************************************************************************
      ******
 766   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\model.gms
 768   
 769  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 779  **************************************************************************
      ******
 780   
 781  Set
 782  *$onempty
 783  dis_bio(tech)          Subset of dispatchable technology: Bio mass        
      /bio/
 784  res_pro(tech)          Prosumage renewable generation technologies        
      /pv/
 785  sto_pro(sto)          Storage technologies prosumager                     
      /sto1/
 786  sto_sys(sto)           Storage technologies system                        
      /sto5/
 787  dis_sys(tech)                                                             
      /lig,hc,CCGT,OCGT,oil,other,bio/
 788  nondis_sys(tech)                                                          
      /ror,wind_on,wind_off,pv/
 789  ;
 790   
 791  Variables
 792  Z                      Value objective function [Euro]
 793  lambda_resgen          Dual variable on renewable generation (3e)
 794  lambda_convgen         Dual variable on conventional generation level (2)
 795  lambda_enerbal         Dual variable on energy balance (1a)
 796  lambda_stolev          Dual variable on storage level  (4a-4b)
 797  lambda_enerbal_pro     Prosumage: Dual variable on prosumage energy balanc
      e (11b)
 798  lambda_resgen_pro      Prosumage: Dual variable on renewable generation (1
      1a)
 799  lambda_stolev_pro      Prosumage: Dual variable on storage level  (11d-11h
      )
 800  ;
 801   
 802  Positive Variables
 803  G_L(tech,h)            Generation level in hour h [MWh]
 804  G_UP(tech,h)           Generation upshift in hour h [MWh]
 805  G_DO(tech,h)           Generation downshift in hour h [MWh]
 806  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 807  CU(tech,h)             Renewables curtailment technology res in hour h [MW
      h]
 808   
 809  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 810  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 811  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 812   
 813  N_TECH(tech)           Technology tech built [MW]
 814  N_STO_E(sto)           Storage technology built - Energy [MWh]
 815  N_STO_P(sto)           Storage loading and discharging capacity built - Ca
      pacity [MW]
 816   
 817  CU_PRO(res_pro,h)                Prosumage: curtailment of renewable gener
      ation in hour h [MWh]
 818  G_MARKET_PRO2M(res_pro,h)        Prosumage. energy sent to market in hour 
      h [MWh]
 819  G_MARKET_M2PRO(h)                Prosumage: withdrawal of energy from mark
      et in hour h [MWh]
 820  G_RES_PRO(res_pro,h)             Prosumage: hourly renewables generation i
      n hour h [MWh]
 821  STO_IN_PRO2PRO(sto_pro,tech,h)   Prosumage: storage loading from generatio
      n for discharging to consumption in hour h [MWh]
 822  STO_OUT_PRO2PRO(sto_pro,h)       Prosumage: storage discharging to consump
      tion from generation in hour h [MWh]
 823  STO_L_PRO2PRO(sto_pro,h)         Prosumage: storage level generation to co
      nsumption in hour h [MWh]
 824  N_STO_E_PRO(sto_pro)             Prosumage: installed storage energy [MWh]
 825  N_STO_P_PRO(sto_pro)             Prosumage: installed storage power [MW]
 826  N_RES_PRO(res_pro)               Prosumage: installed renewables capacitie
      s [MW]
 827   
 828   
 829  mu_stoin_cap          Dual variable on storage loading capacity constraint
       (4d)
 830  mu_stout_cap          Dual variable on storage discharging capacity constr
      aint (4e)
 831  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 832  mu_conv_cap           Dual variable on conventional generation capacity co
      nstraint (3a)
 833  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 834  mu_dis_max_i          Dual variable on dispatchable installation constrain
      t (8a)
 835  mu_nondis_max_i       Dual variable on nondispatchable installation constr
      aint (8a)
 836  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 837  mu_stop_max_i         Dual variable on storage power installation constrai
      nt  (8c)
 838  mu_stoe_max_i         Dual variable on storage energy installation constra
      int  (8b)
 839  mu_minRES             Dual variable on minimum renewable share constraint 
      (5a)
 840   
 841  mu_stoin_cap_pro          Prosumage: Dual variable on storage loading capa
      city constraint (11k)
 842  mu_stout_cap_pro          Prosumage: Dual variable on storage discharging 
      capacity constraint (11l)
 843  mu_stolev_cap_pro         Prosumage: Dual variable on energy capacity cons
      traint (11j)
 844  mu_tech_max_i_pro         Prosumage: Dual variable on res installation con
      straint (8f)
 845  mu_stop_max_i_pro         Prosumage: Dual variable on storage power instal
      lation constraint  (8g)
 846  mu_stoe_max_i_pro         Prosumage: Dual variable on storage energy insta
      llation constraint  (8h)
 847  mu_self_con_pro           Prosumage: Constraint on miminum self-consumptio
      n level (8c)
 848  mu_feed_in_max_pro        Prosumage: Dual variable on feed-in capacity con
      straint (11p)
 849   
 850  G_INFES(h)                Infeasibility variable
 851  ;
 852   
 853   
 854   
 855   
 856  **************************************************************************
      ******
 857   
 858  Equations
 859  * Objective
 860  obj                      Objective cost minimization
 861   
 862  * Energy balance
 863  con1a_bal                Energy Balance
 864   
 865  * Load change costs
 866  con2a_loadlevel          Load change costs: Level
 867  con2b_loadlevelstart     Load change costs: Level for first period
 868  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
 869   
 870  * Capacity contraints and flexibility constraints
 871  con3a_maxprod_dispatchable       Capacity Constraint conventionals
 872  con3e_maxprod_res                Capacity constraints renewables
 873   
 874  * Storage constraints
 875  con4a_stolev_start        Storage Level Dynamics Initial Condition
 876  con4b_stolev              Storage Level Dynamics
 877  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
 878  con4c_stolev_max          Storage Power Capacity
 879  con4d_maxin_sto           Storage maximum inflow
 880  con4e_maxout_sto          Storage maximum outflow
 881  con4j_ending              End level equal to initial level
 882  con4k_PHS_EtoP            Maximum E-P ratio
 883   
 884  * Minimum restrictions for renewables and biomass
 885  con5a_minRES             Minimum yearly renewables requirement
 886  con5b_max_energy         Maximum yearly biomass energy
 887   
 888  * Maximum installation conditions
 889  con8a_max_I_power                Maximum installable capacity: Conventiona
      ls
 890  con8b_max_I_sto_e                Maximum installable energy: Storage energ
      y in MWh
 891  con8c_max_I_sto_p                Maximum installable capacity: Storage inf
      low-outflow in MW
 892   
 893  con8f_max_pro_res                Maximum installable capacity: prosumage r
      enewables
 894  con8g_max_pro_sto_e              Maximum installable capacity: prosumage s
      torage energy
 895  con8h_max_sto_pro_p              Maximum installable capacity: prosumage s
      torage power
 896   
 897  * Prosumage
 898  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
 899  con11b_pro_balance                       Prosumage: energy balance
 900  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
 901  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
 902  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
 903  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
 904  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
 905  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
 906  con11o_pro_ending                        Prosumage: storage ending conditi
      on
 907  con11p_pro_feedin_max                    Prosumage: maximum feed-in limite
      d
 908   
 909  * FOC optimality conditions
 910  FOCG_L                   FOC w.r.t. G_L
 911  FOCG_UP                  FOC w.r.t. G_UP
 912  FOCG_DO                  FOC w.r.t. G_DO
 913  FOCG_RES                 FOC w.r.t. G_RES
 914  FOCCU                    FOC w.r.t. CU
 915  FOCSTO_IN                FOC w.r.t. STO_IN
 916  FOCSTO_OUT               FOC w.r.t. STO_OUT
 917  FOCSTO_L                 FOC w.r.t. STO_L
 918  FOCN_TECH_NONDIS         FOC w.r.t. N_TECH(nondis)
 919  FOCN_TECH_DIS            FOC w.r.t. N_TECH(dis)
 920  FOCN_TECH                FOC w.r.t. N_TECH
 921  FOCN_STO_E               FOC w.r.t. N_STO_E
 922  FOCN_STO_P               FOC w.r.t. N_STO_P
 923   
 924  FOC_CU_PRO                  Prosumage: FOC w.r.t CU_PRO
 925  FOC_N_RES_PRO               Prosumage: FOC w.r.t N_RES_PRO
 926  FOC_N_STO_E_PRO             Prosumage: FOC w.r.t N_STO_E_PRO
 927  FOC_N_STO_P_PRO             Prosumage: FOC w.r.t N_STO_P_PRO
 928  FOC_G_MARKET_M2PRO          Prosumage: FOC w.r.t G_MARKET_M2PRO
 929  FOC_G_MARKET_PRO2M          Prosumage: FOC w.r.t G_MARKET_PRO2M
 930  FOC_G_RES_PRO               Prosumage: FOC w.r.t G_RES_PRO
 931  FOC_STO_IN_PRO2PRO          Prosumage: FOC w.r.t STO_IN_PRO2PRO
 932  FOC_STO_OUT_PRO2PRO         Prosumage: FOC w.r.t STO_OUT_PRO2PRO
 933  FOC_STO_L_PRO2PRO           Prosumage: FOC w.r.t STO_L_PRO2PRO
 934   
 935  FOC_G_INFES               Infeasibility: FOC w.r.t G_INFES
 936  ;
 937   
 938   
 939   
 940  **************************************************************************
      ******
 941   
 942  * ------------------------------------------------------------------------
      ---- *
 943  ***** Objective function *****
 944  * ------------------------------------------------------------------------
      ---- *
 945   
 946  obj..
 947           Z =E=
 948                     sum( (h,dis_sys) , c_m(dis_sys)*G_L(dis_sys,h) )
 949                   + sum( (h,dis_sys)$(ord(h)>1) , c_up(dis_sys)*G_UP(dis_sy
      s,h) )
 950                   + sum( (h,dis_sys) , c_do(dis_sys)*G_DO(dis_sys,h) )
 951                   + sum( (h,nondis_sys) , c_cu(nondis_sys)*CU(nondis_sys,h)
       )
 952                   + sum( (h,sto_sys) , c_m_sto(sto_sys)* ( STO_OUT(sto_sys,
      h) + STO_IN(sto_sys,h) ) )
 953                   + sum( tech , c_i(tech)*N_TECH(tech) )
 954                   + sum( tech , c_fix(tech)*N_TECH(tech) )
 955                   + sum( sto_sys , c_i_sto_e(sto_sys)*N_STO_E(sto_sys))
 956                   + sum( sto_sys , c_fix_sto(sto_sys)/2*(N_STO_P(sto_sys)+ 
      N_STO_E(sto_sys)) )
 957                   + sum( sto_sys , c_i_sto_p(sto_sys)*N_STO_P(sto_sys))
 958                   + sum( h, G_INFES(h))*10000
 959  *$ontext
 960                   + sum( res_pro , c_i(res_pro)*N_RES_PRO(res_pro) )
 961                   + sum( res_pro , c_fix(res_pro)*N_RES_PRO(res_pro) )
 962                   + sum( sto_pro , c_i_sto_e(sto_pro)*N_STO_E_PRO(sto_pro) 
      )
 963                   + sum( sto_pro , c_fix_sto(sto_pro)/2*(N_STO_P_PRO(sto_pr
      o) + N_STO_E_PRO(sto_pro)) )
 964                   + sum( sto_pro , c_i_sto_p(sto_pro)*N_STO_P_PRO(sto_pro) 
      )
 965                   + sum( (h,sto_pro) , c_m_sto(sto_pro) * ( STO_OUT_PRO2PRO
      (sto_pro,h) + sum( res_pro , STO_IN_PRO2PRO(sto_pro,res_pro,h)) ) )
 968  ;
 969   
 970  * ------------------------------------------------------------------------
      ---- *
 971  ***** Energy balance and load levels *****
 972  * ------------------------------------------------------------------------
      ---- *
 973   
 974  * Energy balance
 975  con1a_bal(h)..
 976   
 977             sum( dis_sys , G_L(dis_sys,h)) + sum( nondis_sys , G_RES(nondis
      _sys,h)) + sum( sto_sys , STO_OUT(sto_sys,h) )
 978              +  G_INFES(h)
 979  *$ontext
 980           + sum( res_pro , G_MARKET_PRO2M(res_pro,h) )
 983           -   d(h)
 984           -   sum( sto_sys , STO_IN(sto_sys,h) )
 985   
 986  *$ontext
 987           - G_MARKET_M2PRO(h)
 990   
 991         =E= 0
 992  ;
 993   
 994  con2a_loadlevel(dis_sys,h)$(ord(h) > 1)..
 995           G_L(dis_sys,h-1) + G_UP(dis_sys,h) - G_DO(dis_sys,h)  - G_L(dis_s
      ys,h) =E= 0
 996  ;
 997   
 998  con2b_loadlevelstart(dis_sys,h)$(ord(h) = 1)..
 999          G_UP(dis_sys,h) - G_L(dis_sys,h) =E= 0
1000  ;
1001   
1002  con2_loadlevel(dis_sys,h)..
1003             G_UP(dis_sys,h)  - G_L(dis_sys,h)
1004          +  (G_L(dis_sys,h-1) - G_DO(dis_sys,h))$(ord(h) > 1)
1005          =E= 0
1006  ;
1007   
1008   
1009   
1010  * ------------------------------------------------------------------------
      ---- *
1011  ***** Hourly maximum generation caps *****
1012  * ------------------------------------------------------------------------
      ---- *
1013   
1014  con3a_maxprod_dispatchable(dis_sys,h)..
1015   
1016           N_TECH(dis_sys) -  G_L(dis_sys,h)  =G= 0
1017   
1018  ;
1019   
1020  con3e_maxprod_res(nondis_sys,h)..
1021   
1022   
1023         phi_res(nondis_sys,h)*N_TECH(nondis_sys) - G_RES(nondis_sys,h) - CU
      (nondis_sys,h) =E= 0
1024  ;
1025   
1026  * ------------------------------------------------------------------------
      ---- *
1027  ***** Storage constraints *****
1028  * ------------------------------------------------------------------------
      ---- *
1029   
1030  con4a_stolev_start(sto_sys,h)$(ord(h) = 1)..
1031          phi_sto_ini(sto_sys)* N_STO_E(sto_sys)+ STO_IN(sto_sys,h)*(1+eta_s
      to(sto_sys))/2 - STO_OUT(sto_sys,h)/(1+eta_sto(sto_sys))*2  - STO_L(sto_sy
      s,h)  =E= 0
1032  ;
1033   
1034  con4b_stolev(sto_sys,h)$(ord(h)>1)..
1035          STO_L(sto_sys,h-1) + STO_IN(sto_sys,h)*(1+eta_sto(sto_sys))/2 - ST
      O_OUT(sto_sys,h)/(1+eta_sto(sto_sys))*2  -  STO_L(sto_sys,h) =E= 0
1036  ;
1037   
1038  con4_stolev(sto_sys,h)..
1039   
1040         + STO_IN(sto_sys,h)*(1+eta_sto(sto_sys))/2 - STO_OUT(sto_sys,h)/(1+
      eta_sto(sto_sys))*2  -  STO_L(sto_sys,h)
1041         + (STO_L(sto_sys,h-1))$(ord(h)>1)
1042         =E= 0
1043  ;
1044   
1045   
1046  con4c_stolev_max(sto_sys,h)..
1047         N_STO_E(sto_sys)-  STO_L(sto_sys,h)     =G= 0
1048  ;
1049   
1050  con4d_maxin_sto(sto_sys,h)..
1051   
1052          N_STO_P(sto_sys)-  STO_IN(sto_sys,h)   =G= 0
1053  ;
1054   
1055  con4e_maxout_sto(sto_sys,h)..
1056   
1057          N_STO_P(sto_sys)- STO_OUT(sto_sys,h)   =G= 0
1058  ;
1059   
1060  con4j_ending(sto_sys,h)$(ord(h) = card(h))..
1061   
1062          phi_sto_ini(sto_sys)* N_STO_E(sto_sys)-  STO_L(sto_sys,h) =G= 0
1063  ;
1064   
1065   
1066  con4k_PHS_EtoP(sto_sys)..
1067           etop_max(sto_sys)* N_STO_P(sto_sys)- N_STO_E(sto_sys)=G= 0
1068  ;
1069   
1070  * ------------------------------------------------------------------------
      ---- *
1071  ***** Quotas for renewables and biomass *****
1072  * ------------------------------------------------------------------------
      ---- *
1073   
1074  con5a_minRES..
1075  sum( h , G_L('bio',h) + sum(nondis_sys , G_RES(nondis_sys,h))
1076   
1077  *$ontext
1078           + sum( sto_pro , STO_OUT_PRO2PRO(sto_pro,h)) + sum( res_pro , G_M
      ARKET_PRO2M(res_pro,h) + G_RES_PRO(res_pro,h))
1081  )
1082          - phi_min_res * phi_min_res_exog * sum( h ,
1083           sum( (dis_sys) , G_L(dis_sys,h)) + sum( (nondis_sys) , G_RES(nond
      is_sys,h))
1084   
1085  *$ontext
1086           + sum( (res_pro) , phi_res(res_pro,h) * N_RES_PRO(res_pro) - CU_P
      RO(res_pro,h))
1089           )  =G= 0
1090  ;
1091   
1092  con5b_max_energy(tech)$dis_bio(tech)..
1093           m_e(tech) -  sum( h , G_L(tech,h) ) =G= 0
1094  ;
1095   
1096   
1097  * ------------------------------------------------------------------------
      ---- *
1098  ***** Maximum installation constraints *****
1099  * ------------------------------------------------------------------------
      ---- *
1100   
1101  con8a_max_I_power(tech)..
1102         m_p(tech) - N_TECH(tech)     =G= 0
1103  ;
1104   
1105  con8b_max_I_sto_e(sto_sys)..
1106         m_sto_e(sto_sys)- N_STO_E(sto_sys) =G= 0
1107  ;
1108   
1109  con8c_max_I_sto_p(sto_sys)..
1110         m_sto_p(sto_sys)-  N_STO_P(sto_sys)=G= 0
1111  ;
1112   
1113   
1114   
1115  con8f_max_pro_res(res_pro)..
1116         m_res_pro(res_pro)*numb_pro_load   -  N_RES_PRO(res_pro)   =G= 0
1117  ;
1118   
1119  con8g_max_pro_sto_e(sto_pro)..
1120         m_sto_pro_e(sto_pro)*numb_pro_load -  N_STO_E_PRO(sto_pro) =G= 0
1121  ;
1122   
1123  con8h_max_sto_pro_p(sto_pro)..
1124          m_sto_pro_p(sto_pro)*numb_pro_load -  N_STO_P_PRO(sto_pro) =G= 0
1125  ;
1126   
1127  * ------------------------------------------------------------------------
      ---- *
1128  ***** Prosumage constraints *****
1129  * ------------------------------------------------------------------------
      ---- *
1130   
1131  con11a_pro_distrib(res_pro,h)..
1132           phi_res(res_pro,h) * N_RES_PRO(res_pro)
1133           - CU_PRO(res_pro,h) - G_MARKET_PRO2M(res_pro,h) - G_RES_PRO(res_p
      ro,h) - sum( sto_pro , STO_IN_PRO2PRO(sto_pro,res_pro,h) )
1134           =E= 0
1135  ;
1136   
1137  con11b_pro_balance(h)..
1138           sum( res_pro , G_RES_PRO(res_pro,h)) + sum( sto_pro , STO_OUT_PRO
      2PRO(sto_pro,h) ) + G_MARKET_M2PRO(h)
1139           - numb_pro_load * d_pro(h)
1140           =E= 0
1141  ;
1142   
1143  *** Not used in MCP model
1144  con11c_pro_selfcon..
1145           sum( (h,res_pro) , G_RES_PRO(res_pro,h) ) + sum( (h,sto_pro) , ST
      O_OUT_PRO2PRO(sto_pro,h) )
1146           -  phi_pro_self * sum( h , numb_pro_load * d_pro(h))
1147           =G=     0
1148  ;
1149   
1150  con11d_pro_stolev_PRO2PRO(sto_pro,h)..
1151   
1152           + sum( res_pro , STO_IN_PRO2PRO(sto_pro,res_pro,h))*(1+eta_sto(st
      o_pro))/2
1153           - STO_OUT_PRO2PRO(sto_pro,h)/(1+eta_sto(sto_pro))*2
1154           - STO_L_PRO2PRO(sto_pro,h)
1155           + STO_L_PRO2PRO(sto_pro,h-1)$((ord(h)>1) )
1156           =E= 0
1157  ;
1158   
1159  *** Not used in MCP model
1160  con11h_1_pro_stolev_start_PRO2PRO(sto_pro,h)$( ord(h) = 1)..
1161          STO_L_PRO2PRO(sto_pro,h) =N=  sum( res_pro , STO_IN_PRO2PRO(sto_pr
      o,res_pro,h))*(1+eta_sto(sto_pro))/2 - STO_OUT_PRO2PRO(sto_pro,h)/(1+eta_s
      to(sto_pro))*2
1162  ;
1163   
1164   
1165  con11j_pro_stolev_max(sto_pro,h)..
1166         N_STO_E_PRO(sto_pro) - STO_L_PRO2PRO(sto_pro,h) =G= 0
1167  ;
1168   
1169  con11k_pro_maxin_sto(sto_pro,h)..
1170          N_STO_P_PRO(sto_pro) - sum( res_pro , STO_IN_PRO2PRO(sto_pro,res_p
      ro,h) )
1171          =G= 0
1172  ;
1173   
1174  con11l_pro_maxout_sto(sto_pro,h)..
1175          N_STO_P_PRO(sto_pro) - STO_OUT_PRO2PRO(sto_pro,h)
1176          =G= 0
1177  ;
1178   
1179  *** Not used in MCP model
1180  con11o_pro_ending(sto_pro,h)$( ord(h) = card(h))..
1181           STO_L_PRO2PRO(sto_pro,h) =G= phi_sto_pro_ini(sto_pro) * N_STO_E_P
      RO(sto_pro)
1182  ;
1183   
1184  con11p_pro_feedin_max(res_pro,h)..
1185   
1186           N_RES_PRO(res_pro)*alpha_max*max_solar_avail
1187           - G_MARKET_PRO2M(res_pro,h)    =G= 0
1188   
1189  ;
1190   
1191   
1192  * ------------------------------------------------------------------------
      ---- *
1193  ***** FOC conditions *****
1194  * ------------------------------------------------------------------------
      ---- *
1195   
1196   
1197  *** System FOC ***
1198  FOCG_L(tech,h)$dis_sys(tech)..
1199   
1200      + c_m(tech)
1201      - lambda_enerbal(h)
          + lambda_convgen(tech,h)
      $ontext
1206      + mu_conv_cap(tech,h)
          + mu_bio_cap(tech)$dis_bio(tech)
      $ontext
         - (lambda_convgen(tech,h+1))$(ord(h) > 1)
      $ontext
1215      =G= 0
1216   
1217  ;
1218   
1219  FOCG_UP(dis_sys,h)..
1220   
1221       - lambda_convgen(dis_sys,h)
1222       + (c_up(dis_sys))$(ord(h)> 1)
1223     =G= 0
1224   
1225  ;
1226   
1227  FOCG_DO(dis_sys,h)..
1228   
1229       + c_do(dis_sys)
1230       + (lambda_convgen(dis_sys,h))$(ord(h) > 1)
1231       =G= 0
1232   
1233  ;
1234   
1235  * Note: Fixed generation from ror is excluded since this is a parameter
1236  FOCG_RES(nondis_sys,h)$(not fx(nondis_sys))..
1237   
1238       - lambda_enerbal(h) + lambda_resgen(nondis_sys,h)
1239       =G= 0
1240  ;
1241   
1242  FOCCU(nondis_sys,h)..
1243   
1244       c_cu(nondis_sys) + lambda_resgen(nondis_sys,h) =G= 0
1245   
1246  ;
1247   
1248  FOCSTO_IN(sto_sys,h)..
1249   
1250    lambda_enerbal(h) -  lambda_stolev(sto_sys,h)*(1+eta_sto(sto_sys))/2
1251      + mu_stoin_cap(sto_sys,h) =G= 0
1252  ;
1253   
1254  FOCSTO_OUT(sto_sys,h)..
1255   
1256       -  lambda_enerbal(h) +  lambda_stolev(sto_sys,h)/(1+eta_sto(sto_sys))
      *2
1257       +  mu_stout_cap(sto_sys,h)
1258        =G= 0
1259  ;
1260   
1261  FOCSTO_L(sto_sys,h)..
1262   
1263    + lambda_stolev(sto_sys,h)
1264    +  mu_stolev_cap(sto_sys,h)
1265    -  (lambda_stolev(sto_sys,h+1))$(ord(h) > 1 )
1266   
1267    =G= 0
1268   
1269  ;
1270   
1271  FOCN_TECH(tech)..
1272   
1273            +  c_i(tech)
1274            +  c_fix(tech)
                +  mu_tech_max_i(tech)
      $ontext
1279            - sum( h,   mu_conv_cap(tech,h))$dis_sys(tech)
1280            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis_sys(tec
      h)
1281       =G= 0
1282   
1283  ;
1284   
1285   
1286   
1287  FOCN_STO_E(sto_sys)..
1288   
1289        +  c_fix_sto(sto_sys)/2 +  c_i_sto_e(sto_sys)
1290        -  sum( h,   mu_stolev_cap(sto_sys,h))
            +  mu_stoe_max_i(sto_sys)
      $ontext
1295        =G= 0
1296  ;
1297   
1298  FOCN_STO_P(sto_sys)..
1299   
1300   
1301       c_fix_sto(sto_sys)/2 + c_i_sto_p(sto_sys)
1302       - sum( h, (mu_stoin_cap(sto_sys,h) + mu_stout_cap(sto_sys,h)))
           + mu_stop_max_i(sto_sys)
      $ontext
1307       =G= 0
1308   
1309  ;
1310   
1311  *** Prosumage FOC ***
1312  * FOC w.r.t CU_PRO
1313  FOC_CU_PRO(res_pro,h)..
1314          lambda_resgen_pro(res_pro,h)
1315        =G= 0
1316  ;
1317   
1318  * FOC w.r.t N_RES_PRO
1319  FOC_N_RES_PRO(res_pro)..
1320             + c_i(res_pro) + c_fix(res_pro)
1321             - sum(h, lambda_resgen_pro(res_pro,h)*phi_res(res_pro,h)  )
1322             + mu_tech_max_i_pro(res_pro)
1323  * - sum(h, mu_feed_in_max_pro(res_pro,h)*alpha_max*max_solar_avail)
1324    =G= 0
1325   
1326  ;
1327   
1328  * FOC w.r.t N_STO_E_PRO
1329  FOC_N_STO_E_PRO(sto_pro)..
1330            + c_i_sto_e(sto_pro) + c_fix_sto(sto_pro)/2
1331            - sum(h, mu_stolev_cap_pro(sto_pro,h) )       =G=  0
1332  ;
1333   
1334  * FOC w.r.t N_STO_P_PRO
1335  FOC_N_STO_P_PRO(sto_pro)..
1336  *            c_i_sto_pro_p_PRO(sto_pro)
1337              c_i_sto_p(sto_pro) + c_fix_sto(sto_pro)/2
1338            - sum(h, mu_stoin_cap_pro(sto_pro,h))
1339            - sum(h, mu_stout_cap_pro(sto_pro,h))
1340            =G=  0
1341   
1342  ;
1343   
1344  * FOC w.r.t G_MARKET_M2PRO
1345  FOC_G_MARKET_M2PRO(h)..
1346  *$ontext
1347   
1348   + price_consumption_pro(h)
1349   
1350  *$ontext
1351             + lambda_enerbal(h)
1352   
1355   
                 + lambda_enerbal(h)
      $ontext
1360   
1361             - lambda_enerbal_pro(h) =G=  0
1362  ;
1363   
1364  * FOC w.r.t G_MARKET_PRO2M
1365  FOC_G_MARKET_PRO2M(res_pro,h)..
1366  *$ontext
1367             - price_production_pro(h)
1368   
1369  *  + mu_feed_in_max_pro(res_pro,h)
1370   
1371  *$ontext
1372             - lambda_enerbal(h)
1375   
1376   
                 - lambda_enerbal(h)
      $ontext
1381   
1382   
1383           + lambda_resgen_pro(res_pro,h)  =G= 0
1384  ;
1385   
1386  * FOC w.r.t G_RES_PRO
1387  FOC_G_RES_PRO(res_pro,h)..
1388           - lambda_enerbal_pro(h)
1389           + lambda_resgen_pro(res_pro,h)
1390           + SC_tax
1391  *$ontext
               - mu_self_con_pro
      $ontext
1396   
1397          =G= 0
1398  ;
1399   
1400  * FOC w.r.t STO_IN_PRO2PRO
1401  FOC_STO_IN_PRO2PRO(sto_pro,res_pro,h)..
1402           +  lambda_resgen_pro(res_pro,h)
1403           -  lambda_stolev_pro(sto_pro,h)*(1+eta_sto(sto_pro))/2
1404           +  mu_stoin_cap_pro(sto_pro,h)
1405          =G= 0
1406   
1407  ;
1408   
1409  * FOC w.r.t STO_OUT_PRO2PRO
1410  FOC_STO_OUT_PRO2PRO(sto_pro,h)..
1411         - lambda_enerbal_pro(h)
1412         + lambda_stolev_pro(sto_pro,h)*2/(1+eta_sto(sto_pro))
1413         + mu_stout_cap_pro(sto_pro,h)
1414         + SC_tax
1415  *$ontext
              - mu_self_con_pro
      $ontext
1420           =G= 0
1421  ;
1422   
1423  * FOC w.r.t STO_L_PRO2PRO
1424  FOC_STO_L_PRO2PRO(sto_pro,h)..
1425        + lambda_stolev_pro(sto_pro,h)
1426        + mu_stolev_cap_pro(sto_pro,h)
1427        - lambda_stolev_pro(sto_pro,h+1)$(ord(h) > 1 )
1428        =G= 0
1429  ;
1430   
1431  FOC_G_INFES(h)..
1432   
1433           10000   - lambda_enerbal(h)   =G= 0
1434   
1435  ;
1436  **************************************************************************
      ******
1437  ***** Set default values *****
1438  **************************************************************************
      ******
1439   
1440   
1441  * Default for reporting
1442  G_DO.l(dis_sys,h)   = 0;
1443  G_L.l(dis_sys,h)    = 0;
1444  G_UP.l(dis_sys,h)   = 0;
1445  G_RES.l(tech,h) = 0;
1446  CU.l(tech,h)    = 0;
1447   
1448  STO_IN.l(sto_sys,h)  = 0;
1449  STO_OUT.l(sto_sys,h) = 0;
1450  STO_L.l(sto_sys,h)   = 0;
1451   
1452  N_TECH.l(tech)   = 0;
1453  N_STO_E.l(sto_sys)  = 0;
1454  N_STO_P.l(sto_sys)  = 0;
1455   
1456  * Potentially prevent feed-in from prosumers
1457  * G_MARKET_PRO2M.fx(res_pro,h) = 0 ;
1458   
1459  **************************************************************************
      ******
1460  ***** MODEL *****
1461  **************************************************************************
      ******
1462   
1463  model DIETER /
1464  obj
1465   
1466  con1a_bal
1467   
      con2_loadlevel
      $ontext
1472   
1473  con3a_maxprod_dispatchable
1474  con3e_maxprod_res
1475   
1476  con4_stolev
1477  con4c_stolev_max
1478  con4d_maxin_sto
1479  con4e_maxout_sto
1480   
1481  con5a_minRES
      con5b_max_energy
      $ontext
1486   
      con8a_max_I_power
      con8b_max_I_sto_e
      con8c_max_I_sto_p
      $ontext
1493   
1494  *$ontext
1495  con8f_max_pro_res
1496  *con8g_max_pro_sto_e
1497  *con8h_max_sto_pro_p
1498  con11a_pro_distrib
1499  con11b_pro_balance
1500  con11c_pro_selfcon
1501  con11d_pro_stolev_PRO2PRO
1502  con11j_pro_stolev_max
1503  con11k_pro_maxin_sto
1504  con11l_pro_maxout_sto
1507   
1508  /;
1509   
1510  model DIETER_MCP /
1511   
1512  con1a_bal.lambda_enerbal
1513   
      con2_loadlevel.lambda_convgen
      $ontext
1518   
1519  con3a_maxprod_dispatchable.mu_conv_cap
1520  con3e_maxprod_res.lambda_resgen
1521   
1522  con4_stolev.lambda_stolev
1523  con4c_stolev_max.mu_stolev_cap
1524  con4d_maxin_sto.mu_stoin_cap
1525  con4e_maxout_sto.mu_stout_cap
1526   
      con5b_max_energy.mu_bio_cap
      $ontext
1531   
      con8a_max_I_power.mu_tech_max_i
      con8b_max_I_sto_e.mu_stoe_max_i
      con8c_max_I_sto_p.mu_stop_max_i
      $ontext
1538   
1539  FOCG_L.G_L
1540   
      FOCG_UP.G_UP
      FOCG_DO.G_DO
      $ontext
1546   
1547  FOCG_RES.G_RES
1548  FOCCU.CU
1549  FOCSTO_IN.STO_IN
1550  FOCSTO_OUT.STO_OUT
1551  FOCSTO_L.STO_L
1552   
      FOCN_TECH.N_TECH
      FOCN_STO_E.N_STO_E
      FOCN_STO_P.N_STO_P
      $ontext
1559   
1560  *$ontext
1561  con8f_max_pro_res.mu_tech_max_i_pro
1562  *con8g_max_pro_sto_e
1563  *con8h_max_sto_pro_p
1564  con11a_pro_distrib.lambda_resgen_pro
1565  con11b_pro_balance.lambda_enerbal_pro
1566  *con11c_pro_selfcon.mu_self_con_pro
1567  con11d_pro_stolev_PRO2PRO.lambda_stolev_pro
1568  con11j_pro_stolev_max.mu_stolev_cap_pro
1569  con11k_pro_maxin_sto.mu_stoin_cap_pro
1570  con11l_pro_maxout_sto.mu_stout_cap_pro
1571  *con11p_pro_feedin_max.mu_feed_in_max_pro
1572   
1573  FOC_CU_PRO.CU_PRO
1574  FOC_N_RES_PRO.N_RES_PRO
1575  FOC_N_STO_E_PRO.N_STO_E_PRO
1576  FOC_N_STO_P_PRO.N_STO_P_PRO
1577  FOC_G_MARKET_M2PRO.G_MARKET_M2PRO
1578  FOC_G_MARKET_PRO2M.G_MARKET_PRO2M
1579  FOC_G_RES_PRO.G_RES_PRO
1580  FOC_STO_IN_PRO2PRO.STO_IN_PRO2PRO
1581  FOC_STO_OUT_PRO2PRO.STO_OUT_PRO2PRO
1582  FOC_STO_L_PRO2PRO.STO_L_PRO2PRO
1585   
1586  FOC_G_INFES.G_INFES
1587  /
1588  ;
1589   
1590   
1591  **************************************************************************
      ******
1592  ***** Options, fixings, report preparation *****
1593   
1594  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\fix.gms
1596   
1597  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1607  **************************************************************************
      ******
1608   
1609   
1610   
1611  **************************************************************************
      ******
1612  **** Run of river  *******************************************************
      ******
1613  **************************************************************************
      ******
1614   
1615  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1616   
1617  *$ontext
1618  N_TECH.fx('ror') = 5600 ;
1619  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1620   
1623   
1624  * Fix everything to zero in case no ROR option is selected:
1625  *%ror_variable%N_TECH.fx('ror') = 0 ;
1626  *%ror_variable%G_RES.fx('ror',h) = 0 ;
1627  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1628   
1629   
1630  **************************************************************************
      ******
1631  **** No storage and DSM in first period  *********************************
      ******
1632  **************************************************************************
      ******
1633   
1634  ** No storage inflow in first period **
1635  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1636   
1637   
1638   
1639  **************************************************************************
      ******
1640  **** No primary reserves by heating devices  *****************************
      ******
1641  **************************************************************************
      ******
1642   
1643   
1644  **************************************************************************
      ******
1645  **** Fixing to reduce model size  ****************************************
      ******
1646  **************************************************************************
      ******
1647   
1648  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1649  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1650  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1651  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1652  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1653  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1654   
1655  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1656  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1657  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1658  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1659  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1660   
1661   
1662  Variables
1663  STO_IN_PRO2M(tech,sto,h)
1664  STO_IN_M2PRO(sto,h)
1665  STO_IN_M2M(sto,h)
1666  STO_OUT_PRO2M(sto,h)
1667  STO_OUT_M2PRO(sto,h)
1668  STO_OUT_M2M(sto,h)
1669  STO_L_PRO(sto,h)
1670  STO_L_PRO2M(sto,h)
1671  STO_L_M2PRO(sto,h)
1672  STO_L_M2M(sto,h)
1673  ;
1674   
1675  *$ontext
1676  CU_PRO.fx(res_pro,h)$(m_res_pro(res_pro) = 0) = 0 ;
1677  G_MARKET_PRO2M.fx(res_pro,h)$( m_res_pro(res_pro) = 0) = 0 ;
1678  *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
1679  G_RES_PRO.fx(res_pro,h)$( m_res_pro(res_pro) = 0) = 0 ;
1680  STO_IN_PRO2PRO.fx(sto_pro,res,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1681  STO_IN_PRO2M.fx(res,sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1682  STO_IN_M2PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1683  STO_IN_M2M.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1684  STO_OUT_PRO2PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1685  STO_OUT_PRO2M.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1686  STO_OUT_M2PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1687  STO_OUT_M2M.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1688  STO_L_PRO2PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1689  STO_L_PRO2M.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1690  STO_L_M2PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1691  STO_L_M2M.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1692  N_STO_E_PRO.fx(sto_pro)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1693  N_STO_P_PRO.fx(sto_pro)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1694  STO_L_PRO.fx(sto_pro,h)$( m_sto_pro_p(sto_pro) = 0) = 0 ;
1695  N_RES_PRO.fx(res_pro)$( m_res_pro(res_pro) = 0) = 0 ;
1698   
1699  * Deactivated market storage links
1700   
1701  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1702  STO_IN_M2PRO.fx(sto,h)      = 0 ;
1703  STO_IN_M2M.fx(sto,h)        = 0 ;
1704  STO_OUT_PRO2M.fx(sto,h)     = 0 ;
1705  STO_OUT_M2PRO.fx(sto,h)     = 0 ;
1706  STO_OUT_M2M.fx(sto,h)       = 0 ;
1707  STO_L_PRO.fx(sto,h)         = 0 ;
1708  STO_L_PRO2M.fx(sto,h)       = 0 ;
1709  STO_L_M2PRO.fx(sto,h)       = 0 ;
1710  STO_L_M2M.fx(sto,h)         = 0 ;
1711   
1712  **************************************************************************
      ******
1713  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *******************************
      ******
1714  **************************************************************************
      ******
1715   
1716  * Reporting level
1717  Set
1718  loop_res_share  /0/
1719  loop_prosumage  /0/ ;
1720   
1722   
1723  Set
1724  modstats       model stats collection                  /modelstat, solvest
      at, resusd/
1725  superscen        Scenarios                               /scen1*scen1000/
1726  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_sha
      re.#loop_prosumage)/
1727  ;
1728   
1729  set
1730  scen(superscen);
1731  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(supersce
      n,loop_res_share,loop_prosumage)) ) ;
1732   
1733   
1734  Parameters
1735  * Equations
1736  marginal_con5a(superscen)
1737  marginal_con1a(superscen,h)
1738  *marginal_con9a(superscen,*,*,*)
1739  *marginal_con9b(superscen,*,*,*)
1740   
1741  * Basic
1742  modelstat
1743  solvestat
1744  resusd
1745  lev_Z(superscen)
1746  lev_G_L(superscen,tech,h)
1747  lev_G_UP(superscen,tech,h)
1748  lev_G_DO(superscen,tech,h)
1749  lev_G_RES(superscen,tech,h)
1750  lev_CU(superscen,tech,h)
1751  lev_STO_IN(superscen,sto,h)
1752  lev_STO_OUT(superscen,sto,h)
1753  lev_STO_L(superscen,sto,h)
1754  lev_N_TECH(superscen,tech)
1755  lev_N_STO_E(superscen,sto)
1756  lev_N_STO_P(superscen,sto)
1757   
1758   
1759  * Prosumage
1760  lev_CU_PRO(superscen,tech,h)
1761  lev_G_MARKET_PRO2M(superscen,tech,h)
1762  lev_G_MARKET_M2PRO(superscen,h)
1763  lev_G_RES_PRO(superscen,tech,h)
1764  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1765  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1766  lev_STO_IN_M2PRO(superscen,sto,h)
1767  lev_STO_IN_M2M(superscen,sto,h)
1768  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1769  lev_STO_OUT_PRO2M(superscen,sto,h)
1770  lev_STO_OUT_M2PRO(superscen,sto,h)
1771  lev_STO_OUT_M2M(superscen,sto,h)
1772  lev_STO_L_PRO2PRO(superscen,sto,h)
1773  lev_STO_L_PRO2M(superscen,sto,h)
1774  lev_STO_L_M2PRO(superscen,sto,h)
1775  lev_STO_L_M2M(superscen,sto,h)
1776  lev_N_STO_E_PRO(superscen,sto)
1777  lev_N_STO_P_PRO(superscen,sto)
1778  lev_STO_L_PRO(superscen,sto,h)
1779  lev_N_RES_PRO(superscen,tech)
1780  ;
1781   
1782  * Default level zero for report parameters
1783  lev_Z(scen) = 0 ;
1784  lev_G_L(scen,tech,h) = 0 ;
1785  lev_G_UP(scen,tech,h) = 0 ;
1786  lev_G_DO(scen,tech,h) = 0 ;
1787  lev_G_RES(scen,tech,h) = 0 ;
1788  lev_CU(scen,tech,h) = 0 ;
1789  lev_STO_IN(scen,sto,h) = 0 ;
1790  lev_STO_OUT(scen,sto,h) = 0 ;
1791  lev_STO_L(scen,sto,h) = 0 ;
1792  lev_N_TECH(scen,tech) = 0 ;
1793  lev_N_STO_E(scen,sto) = 0 ;
1794  lev_N_STO_P(scen,sto) = 0 ;
1795  marginal_con1a(scen,h) = 0 ;
1796  marginal_con5a(superscen) = 0 ;
1797   
1798  * Prosumage
1799  lev_CU_PRO(scen,tech,h) = 0 ;
1800  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1801  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1802  lev_G_RES_PRO(scen,tech,h) = 0  ;
1803  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1804  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1805  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1806  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1807  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1808  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1809  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1810  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1811  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1812  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1813  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1814  lev_STO_L_M2M(scen,sto,h) = 0  ;
1815  lev_N_STO_E_PRO(scen,sto) = 0  ;
1816  lev_N_STO_P_PRO(scen,sto) = 0  ;
1817  lev_STO_L_PRO(scen,sto,h) = 0  ;
1818  lev_N_RES_PRO(scen,tech) = 0  ;
1819   
1820   
1821  * Fixing of report parameters for run-of-river
1822  *$ontext
1823  lev_N_TECH(scen,'ror') = 5600 ;
1824  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
1827   
1828   
1829   
1830   
1831   
1832   
1833   
1834   
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\scenario.gms
1836   
1837  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1847  **************************************************************************
      ******
1848   
1849   
1850   
1851   
1852  *****************************************
1853  **** Scenario file                   ****
1854  ****                                 ****
1855  *****************************************
1856   
1857  Parameter
1858  m_exog_p(tech)
1859  m_exog_sto_e(sto)
1860  m_exog_sto_p(sto)
1861   
1862  ;
1863   
1864  m_exog_p(tech)    = technology_data(tech,'fixed_capacities') ;
1865  *m_exog_sto_e(sto)= storage_data(sto,'fixed_capacities_energy');
1866  m_exog_sto_p(sto)= storage_data(sto,'fixed_capacities_power');
1867   
1868   
1869  *$ontext
1870  m_exog_sto_e(sto)= storage_data(sto,'fixed_capacities_energy')/2;
1871   
1874   
1875   
1876  *** Dispatch model
1877  *$ontext
1878  N_TECH.fx(tech)  = m_exog_p(tech) ;
1879  N_STO_P.fx(sto_sys) = m_exog_sto_p(sto_sys);
1880  N_STO_E.fx(sto_sys) = m_exog_sto_e(sto_sys);
1881   
1884   
1885  *** Investment model
      N_TECH.lo(tech)        = 0 ;
      N_TECH.lo('wind_on')   = m_exog_p('wind_on') ;
      N_TECH.lo('wind_off')  = m_exog_p('wind_off') ;
      N_TECH.lo('pv')        = m_exog_p('pv') ;
      N_STO_P.lo(sto_sys)    = m_exog_sto_p(sto_sys);
      N_STO_E.lo(sto_sys)    = m_exog_sto_e(sto_sys);
      N_TECH.up(tech)        = m_exog_p(tech) + 0.1 ;
      N_TECH.up('wind_on')   = inf ;
      N_TECH.up('wind_off')  = inf ;
      N_TECH.up('pv')        = inf ;
      N_STO_P.up(sto_sys)    = m_exog_sto_p(sto_sys)+ 0.1 ;
      N_STO_E.up(sto_sys)    = m_exog_sto_e(sto_sys)+ 0.1 ;
      N_STO_E.up('sto5')     = inf ;
      N_STO_P.up('sto5')     = inf ;
      N_STO_E.up('sto1')     = inf ;
      N_STO_P.up('sto1')     = inf ;
       
      $ontext
1906   
1907   
1908   
1909   
1910   
1911  **************************************************************************
      ******
1912  ***** Solve *****
1913  **************************************************************************
      ******
1914   
1915   
       
      * Solver options
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      $offecho
      dieter.OptFile = 1;
      dieter.holdFixed = 1 ;
       
      * Save and load solution points
      DIETER.savepoint=1;
      $if exist DIETER_p.gdx execute_loadpoint "DIETER_p";
      option limrow = 10, limcol = 10, solprint = on ;
       
      solve  DIETER using lp min Z ;
      $ontext
1935   
1936  *$ontext
1937   
1938  * Save and load solution points
1939  DIETER_MCP.savepoint=1;
1940  execute_loadpoint "DIETER_MCP_p";
1941  option limrow = 10, limcol = 10, solprint = on ;
1942   
1943  solve   DIETER_MCP using mcp;
1946   
1947  * Reporting
INCLUDE    C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\report.gms
1949  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1959  **************************************************************************
      ******
1960   
1962   
1963   
1964   
1965   
1966  **************************************************************************
      ******
1967  **** Parameters for report file  *****************************************
      ******
1968  **************************************************************************
      ******
1969   
1970  Parameter
1971  corr_fac_dis             Balancing correction factor - dispatchable techno
      logies
1972  corr_fac_nondis          Balancing correction factor - nondispatchable tec
      hnologies
1973  corr_fac_sto             Balancing correction factor - storage technologie
      s
1974  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment tec
      hnologies
1975  corr_fac_dsm_shift       Balancing correction factor - DSM shifting techno
      logies
1976  corr_fac_ev              Balancing correction factor - electric vehicles
1977  corr_fac_rsvr            Balancing correction factor - reservoir
1978  corr_fac_sets            Balancing correction factor - SETS
1979  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
1980  corr_fac_hp              Balancing correction factor - heat pumps
1981  corr_fac_h_elec          Balancing correction factor - hybrid electric sto
      rage heating
1982   
1983  corr_fac_ev_sep
1984   
1985  gross_energy_demand                      Gross energy demand
1986  gross_energy_demand_market               Gross energy demand - market (non
      -prosumage segment)
1987  gross_energy_demand_prosumers            Gross energy demand - prosumagers
1988  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers
       self-generated
1989  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers
       from market
1990   
1991  reserves_activated
1992   
1993  calc_maxprice
1994  calc_minprice
1995  calc_maxdemand
1996  calc_mindemand
1997   
1998  report
1999  report_tech
2000  report_tech_hours
2001  report_hours
2002  report_node
2003  report_line
2004  report_cost
2005  report_cost_prosumage
2006   
2007  report_reserves
2008  report_reserves_hours
2009  report_reserves_tech
2010  report_reserves_tech_hours
2011   
2012  report_prosumage
2013  report_prosumage_tech
2014  report_prosumage_tech_hours
2015  report_market
2016  report_market_tech
2017  report_market_tech_hours
2018   
2019  report_heat_tech_hours
2020  report_heat_tech
2021   
2022  Z_MCP
2023  Z_FIX
2024  Z_VAR
2025   
2026  lev_demand
2027  lev_gross_demand
2028  lev_residual_load
2029  lev_residual_load_pro
2030  CU_energybal
2031  lev_CU_energybal
2032  lev_electr_bill_pro
2033  lev_electr_bill_con
2034   
2035  total_bill
2036  expenses_pv
2037  expenses_storage
2038  expenses_grid_consumption_energy
2039  expenses_grid_consumption_other
2040  income_feedin
2041  expenses_sc_tax
2042   
2043  ;
2044   
2045   
2046   
2047  * Declare reporting parameters
2048   
2049  marginal_con1a(scen,h)  = con1a_bal.m(h)   ;
      modelstat               = DIETER.modelstat ;
      solvestat               = DIETER.solveStat ;
      resusd                  = DIETER.resusd    ;
      lev_Z(scen)             = Z.l*%sec_hour% ;
      marginal_con5a(scen)    = con5a_minRES.m   ;
      $ontext
2058  lev_G_L(scen,tech,h)    = G_L.l(tech,h)    ;
2059  lev_G_UP(scen,tech,h)   = G_UP.l(tech,h)   ;
2060  lev_G_DO(scen,tech,h)   = G_DO.l(tech,h)   ;
2061  lev_G_RES(scen,tech,h)  = G_RES.l(tech,h)  ;
2062  lev_CU(scen,tech,h)     = CU.l(tech,h)     ;
2063  lev_STO_IN(scen,sto,h)  = STO_IN.l(sto,h)  ;
2064  lev_STO_OUT(scen,sto,h) = STO_OUT.l(sto,h) ;
2065  lev_STO_L(scen,sto,h)   = STO_L.l(sto,h)   ;
2066  lev_N_TECH(scen,tech)   = N_TECH.l(tech)   ;
2067  lev_N_STO_E(scen,sto)   = N_STO_E.l(sto)   ;
2068  lev_N_STO_P(scen,sto)   = N_STO_P.l(sto)   ;
2069  lev_demand(scen,h)      = d(h)   ;
2070  lev_gross_demand(scen,h)= lev_demand(scen,h)  ;
2071   
2072  * Curtailment at energy balance level
2073  CU_energybal(h) =
2074             sum( dis_sys , G_L.l(dis_sys,h))
2075           + sum( nondis_sys , G_RES.l(nondis_sys,h))
2076           + sum( sto_sys , STO_OUT.l(sto_sys,h) )
2077           -   d(h)  -   sum( sto_sys , STO_IN.l(sto_sys,h) );
2078   
2079  lev_electr_bill_con(scen) = ((sum(h, d_pro(h))/1000)*retail_price)*2
2080                                + flat_network_fee ;
2081   
2082  *$ontext
2083  lev_CU_PRO(scen,res_pro,h)               = CU_PRO.l(res_pro,h)            
          ;
2084  lev_G_MARKET_PRO2M(scen,res_pro,h)       = G_MARKET_PRO2M.l(res_pro,h)    
       ;
2085  lev_G_MARKET_M2PRO(scen,h)               = G_MARKET_M2PRO.l(h)            
       ;
2086  lev_G_RES_PRO(scen,res_pro,h)            = G_RES_PRO.l(res_pro,h)       ;
2087  lev_STO_IN_PRO2PRO(scen,tech,sto_pro,h)  = STO_IN_PRO2PRO.l(sto_pro,tech,h
      )    ;
2088  lev_STO_IN_PRO2M(scen,tech,sto_pro,h)    = STO_IN_PRO2M.l(tech,sto_pro,h) 
           ;
2089  lev_STO_IN_M2PRO(scen,sto_pro,h)         = STO_IN_M2PRO.l(sto_pro,h)      
           ;
2090  lev_STO_IN_M2M(scen,sto_pro,h)           = STO_IN_M2M.l(sto_pro,h)        
           ;
2091  lev_STO_OUT_PRO2PRO(scen,sto_pro,h)      = STO_OUT_PRO2PRO.l(sto_pro,h)   
           ;
2092  lev_STO_OUT_PRO2M(scen,sto_pro,h)        = STO_OUT_PRO2M.l(sto_pro,h)     
           ;
2093  lev_STO_OUT_M2PRO(scen,sto_pro,h)        = STO_OUT_M2PRO.l(sto_pro,h)     
           ;
2094  lev_STO_OUT_M2M(scen,sto_pro,h)          = STO_OUT_M2M.l(sto_pro,h)       
           ;
2095  lev_STO_L_PRO2PRO(scen,sto_pro,h)        = STO_L_PRO2PRO.l(sto_pro,h)     
           ;
2096  lev_STO_L_PRO2M(scen,sto_pro,h)          = STO_L_PRO2M.l(sto_pro,h)       
           ;
2097  lev_STO_L_M2PRO(scen,sto_pro,h)          = STO_L_M2PRO.l(sto_pro,h)       
           ;
2098  lev_STO_L_M2M(scen,sto_pro,h)            = STO_L_M2M.l(sto_pro,h)         
           ;
2099  lev_N_STO_E_PRO(scen,sto_pro)            = N_STO_E_PRO.l(sto_pro)         
           ;
2100  lev_N_STO_P_PRO(scen,sto_pro)            = N_STO_P_PRO.l(sto_pro)         
           ;
2101  lev_STO_L_PRO(scen,sto_pro,h)            = N_STO_P_PRO.l(sto_pro)         
           ;
2102  lev_N_RES_PRO(scen,res_pro)              = N_RES_PRO.l(res_pro)           
       ;
2103  lev_gross_demand(scen,h)                 = lev_demand(scen,h)
2104                                             + lev_G_MARKET_M2PRO(scen,h)
2105                                             - sum (res_pro, lev_G_MARKET_PR
      O2M(scen,res_pro,h)) ;
2106   
2107  CU_energybal(h)                         =  sum( dis_sys , G_L.l(dis_sys,h)
      )
2108                                           + sum( nondis_sys , G_RES.l(nondi
      s_sys,h))
2109                                           + sum( sto_sys , STO_OUT.l(sto_sy
      s,h) )
2110                                           + sum( res_pro , G_MARKET_PRO2M.l
      (res_pro,h) )
2111                                           - d(h)
2112                                           - sum( sto_sys , STO_IN.l(sto_sys
      ,h) )
2113                                           - G_MARKET_M2PRO.l(h) ;
2114   
2115  lev_electr_bill_pro(scen)            = flat_network_fee +
2116                                           (( sum(h, lev_G_MARKET_M2PRO(scen
      ,h)*price_consumption_pro(h) )
2117                                         - sum( (res_pro,h), lev_G_MARKET_PR
      O2M(scen,res_pro,h )* price_production_pro(h))
2118                                         + sum( res_pro , c_i(res_pro)*lev_N
      _RES_PRO(scen,res_pro) )
2119                                         + sum( res_pro , c_fix(res_pro)*lev
      _N_RES_PRO(scen,res_pro) )
2120                                         + sum( sto_pro , c_i_sto_e(sto_pro)
      *lev_N_STO_E_PRO(scen,sto_pro) )
2121                                         + sum( sto_pro , c_fix_sto(sto_pro)
      /2*(lev_N_STO_P_PRO(scen,sto_pro) + lev_N_STO_E_PRO(scen,sto_pro)*2) )
2122                                         + sum( sto_pro , c_i_sto_p(sto_pro)
      *lev_N_STO_P_PRO(scen,sto_pro))
2123                                         ) /((1000*numb_pro_load) + 1e-9 ))*
      2 ;
2124   
2127   
2128  lev_CU_energybal(scen,h)        =   CU_energybal(h)        ;
2129   
2130   
2131  *$ontext
2132  modelstat               = DIETER_MCP.modelstat ;
2133  solvestat               = DIETER_MCP.solveStat ;
2134  resusd                  = DIETER_MCP.resusd    ;
2135  Z_VAR =
2136   
2137   
2138                     sum( (h,dis) , c_m(dis)*G_L.l(dis,h) )
2139                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP.l(dis,h) )
2140                   + sum( (h,dis) , c_do(dis)*G_DO.l(dis,h) )
2141                   + sum( (h,nondis) , c_cu(nondis)*CU.l(nondis,h) )
2142                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT.l(sto,h) + STO_
      IN.l(sto,h) ) )
2143  *$ontext
2144                   + sum( (h,sto_pro) , c_m_sto(sto_pro) * ( STO_OUT_PRO2PRO
      .l(sto_pro,h) + sum( res , STO_IN_PRO2PRO.l(sto_pro,res,h)) ))
2145   
2148   
2149   
2150   
2151  ;
2152   
2153  *$ontext
2154  Z_FIX =
2155                   + sum( tech , c_i(tech)*N_TECH.l(tech) )
2156                   + sum( tech , c_fix(tech)*N_TECH.l(tech) )
2157                   + sum( sto  , c_i_sto_e(sto)*N_STO_E.l(sto) )
2158                   + sum( sto  , c_fix_sto(sto)/2*(N_STO_P.l(sto)+ N_STO_E.l
      (sto)) )
2159                   + sum( sto  , c_i_sto_p(sto)*N_STO_P.l(sto) )
2160  *$ontext
2161                   + sum( res_pro  , c_i(res_pro)*N_RES_PRO.l(res_pro) )
2162                   + sum( res_pro  , c_fix(res_pro)*N_RES_PRO.l(res_pro) )
2163                   + sum( sto_pro  , c_i_sto_e(sto_pro)*N_STO_E_PRO.l(sto_pr
      o) )
2164                   + sum( sto_pro  , c_fix_sto(sto_pro)/2*(N_STO_P_PRO.l(sto
      _pro) + N_STO_E_PRO.l(sto_pro)) )
2165                   + sum( sto_pro  , c_i_sto_p(sto_pro)*N_STO_P_PRO.l(sto_pr
      o) )
2168   
2169   
2170  ;
2171   
2172  *$ontext
2173  Z_MCP = Z_VAR + Z_FIX                ;
2174  lev_Z(scen)    = Z_MCP*2  ;
2177   
2178   
2179   
2180   
2181   
2182  **************************************************************************
      ******
2183  **** Initialize reporting paremetrs  *************************************
      ******
2184  **************************************************************************
      ******
2185   
2186  * Set reporting sensitivity. All results below will be reported as zero
2187  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
2188  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
2189  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
2190   
2191   
2192  * ------------------------------------------------------------------------
      ----
2193   
2194  * Min and max for prices
2195  calc_maxprice = 0 ;
2196  calc_minprice = 1000 ;
2197   
2198   
2199  * Min and max for demand
2200  calc_maxdemand = 0 ;
2201  calc_mindemand = 100000 ;
2202   
2203   
2204  * ------------------------------------------------------------------------
      ----
2205   
2206  * Default values for correction factors
2207  corr_fac_dis(scen,dis,h) = 0 ;
2208  corr_fac_nondis(scen,nondis,h) = 0 ;
2209  corr_fac_sto(scen,sto,h) = 0 ;
2210   
2211   
2212  * ------------------------------------------------------------------------
      ----
2213   
2214  * Parameter for hourly nodal reserves activated
2215  reserves_activated(scen,h) = 0 ;
2216   
2217   
2218   
2219   
2220   
2221  * ------------------------------------------------------------------------
      ----
2222   
2223  * Prepare prosumage reporting parameters
2224  *$ontext
2225  gross_energy_demand_prosumers(scen)= (sum( h , numb_pro_load * d_pro(h)))*
      2;
2226  gross_energy_demand_prosumers_selfgen(scen)= (sum( (h,res) , lev_G_RES_PRO
      (scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ))*2 ;
2227  gross_energy_demand_prosumers_market(scen)= (sum( h , lev_G_MARKET_M2PRO(s
      cen,h)))*2 ;
2228   
2229  total_bill(scen)                    =  lev_electr_bill_pro(scen) ;
2230  expenses_pv(scen)                   =  sum( res_pro, lev_N_RES_PRO(scen,re
      s_pro)*(c_i(res_pro) + c_fix(res_pro)))/(numb_pro_load*1000)*2;
2231  expenses_storage(scen)              =  sum( sto_pro,  c_i_sto_e(sto_pro)*l
      ev_N_STO_E_PRO(scen,sto_pro)
2232                                                      + c_fix_sto(sto_pro)/2
      *(lev_N_STO_P_PRO(scen,sto_pro) + lev_N_STO_E_PRO(scen,sto_pro))
2233                                                      + c_i_sto_p(sto_pro)*l
      ev_N_STO_P_PRO(scen,sto_pro))/(numb_pro_load*1000)*2  ;
2234  * Note: check whether fix costs for storage must be adjusted
2235  expenses_grid_consumption_energy(scen) =  sum(h, lev_G_MARKET_M2PRO(scen,h
      )*(energy_component
2236  *$ontext
2237                                                + lambda_enerbal(h)
****                                                               $143
**** LINE    289 INCLUDE     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Pro
                             sumage_Opt\Dieter_Module\DIETER_PROSUMOD_MCP\report
                             .gms
**** LINE    223 INPUT       C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Pro
                             sumage_Opt\Dieter_Module\DIETER_PROSUMOD_MCP\DIETER
                             .gms
2240  *$ontext
2241                                                   ))/(numb_pro_load*1000)*2
      ;
2242   
2243  expenses_sc_tax(scen)                  =  sum(h,
2244                                                    sum( res_pro, lev_G_RES_
      PRO(scen,res_pro,h))
2245                                                  + sum( sto_pro, lev_STO_OU
      T_PRO2PRO(scen,sto_pro,h)))*SC_tax/(numb_pro_load*1000)*2;
2246   
2247  expenses_grid_consumption_other(scen)  = flat_network_fee + expenses_sc_ta
      x(scen) +
2248                                           sum(h, lev_G_MARKET_M2PRO(scen,h)
      *(non_energy_component
2249                                                   ))/(numb_pro_load*1000)*2
      ;
2250   
2251  income_feedin(scen)                    = sum( (res_pro,h), lev_G_MARKET_PR
      O2M(scen,res_pro,h)* price_production_pro(h)
2252  *$ontext
2253                                                + lambda_enerbal(h)
****                                                               $143
**** LINE    305 INCLUDE     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Pro
                             sumage_Opt\Dieter_Module\DIETER_PROSUMOD_MCP\report
                             .gms
**** LINE    223 INPUT       C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Pro
                             sumage_Opt\Dieter_Module\DIETER_PROSUMOD_MCP\DIETER
                             .gms
2256  *$ontext
2257                                                   )/(numb_pro_load*1000)*2;
2260   
2261  * ------------------------------------------------------------------------
      ----
2262   
2263  * Define gross energy demand for reporting
2264  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,
      h) - lev_STO_OUT(scen,sto,h) )
2265  *$ontext
2266           + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_
      STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN
      _M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(sce
      n,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
2269   
2270   
2271  )
2272  ;
2273   
2274  lev_residual_load(h) =  d(h)
2275                         - sum( nondis_sys , G_RES.l(nondis_sys,h)) - CU_ene
      rgybal(h)
2276  *$ontext
2277           - sum( res_pro , G_MARKET_PRO2M.l(res_pro,h) )
2278           + G_MARKET_M2PRO.l(h)
2281  ;
2282   
2283  *$ontext
2284  lev_residual_load_pro(h) = 0 - sum( res_pro , G_MARKET_PRO2M.l(res_pro,h) 
      )
2285                             + G_MARKET_M2PRO.l(h)
2288  ;
2289   
2290   
2291  **************************************************************************
      ******
2292  **** Report  *************************************************************
      ******
2293  **************************************************************************
      ******
2294   
2295  * REPORT model statistics
2296          report('model status',loop_res_share,loop_prosumage)  = modelstat 
      ;
2297          report('solver status',loop_res_share,loop_prosumage) = solvestat 
      ;
2298          report('solve time',loop_res_share,loop_prosumage)    = resusd ;
2299          report('obj value',loop_res_share,loop_prosumage)     = sum(scen, 
      lev_Z(scen)) ;
2300   
2301   
2302  * ------------------------------------------------------------------------
      ----
2303   
2304  * REPORT HOURS
2305          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= 
      d(h) ;
2306          report_hours('energy generated',loop_res_share,loop_prosumage,h)= 
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(s
      cen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(sc
      en,nondis,h)) + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto
      ,h))
2307                                                                           +
       sum( res_pro, lev_G_MARKET_PRO2M(scen,res_pro,h))
2308                                                                           +
       sum( res , lev_G_RES_PRO(scen,res,h)  + sum( sto , lev_STO_IN_PRO2PRO(sce
      n,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))) + sum( sto , lev_STO_OUT
      _PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(s
      cen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) ) ;
2309          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2310   
2311          report_hours('energy generated',loop_res_share,loop_prosumage,h)$(
      report_hours('energy generated',loop_res_share,loop_prosumage,h)< eps_rep_
      abs ) = 0 ;
2312          report_hours('energy demanded',loop_res_share,loop_prosumage,h)$(r
      eport_hours('energy demanded',loop_res_share,loop_prosumage,h)< eps_rep_ab
      s ) = 0 ;
2313          report_hours('demand consumers',loop_res_share,loop_prosumage,h)$(
      report_hours('demand consumers',loop_res_share,loop_prosumage,h)< eps_rep_
      abs) = 0 ;
2314          report_hours('price',loop_res_share,loop_prosumage,h)$(report_hour
      s('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND report_hours('
      price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2315          report_hours('residual load',loop_res_share,loop_prosumage,h) = le
      v_residual_load(h) ;
2316  *$ontext
2317          report_hours('residual load prosumers',loop_res_share,loop_prosuma
      ge,h) = lev_residual_load_pro(h) ;
2320   
2321  * ------------------------------------------------------------------------
      ----
2322   
2323  * REPORT TECH HOURS
2324          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2325          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(
      scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES
      _PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_
      PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2326          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _CU(scen,res,h) + lev_CU_PRO(scen,res,h)  ) ;
2327          report_tech_hours('curtailment of fluct res at energy balance',loo
      p_res_share,loop_prosumage,'market',h)=  sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) ,   lev_CU_energybal(scen,h)  ) ;
2328          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,
      sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2329          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(s
      cen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,
      sto,h) ) ;
2330          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen
      ,sto,h) + lev_STO_L_PRO2PRO(scen,sto,h) ) ;
2331   
2332          report_tech_hours('generation conventional',loop_res_share,loop_pr
      osumage,con,h)$(report_tech_hours('generation conventional',loop_res_share
      ,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2333          report_tech_hours('generation renewable',loop_res_share,loop_prosu
      mage,res,h)$(report_tech_hours('generation renewable',loop_res_share,loop_
      prosumage,res,h)< eps_rep_abs) = 0 ;
2334          report_tech_hours('curtailment of fluct res',loop_res_share,loop_p
      rosumage,res,h)$(report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2335          report_tech_hours('generation storage',loop_res_share,loop_prosuma
      ge,sto,h)$(report_tech_hours('generation storage',loop_res_share,loop_pros
      umage,sto,h)< eps_rep_abs) = 0 ;
2336          report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_prosumage,
      sto,h)< eps_rep_abs) = 0 ;
2337          report_tech_hours('storage level',loop_res_share,loop_prosumage,st
      o,h)$(report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,
      h)< eps_rep_abs) = 0 ;
2338   
2339   
2340  * ------------------------------------------------------------------------
      ----
2341   
2342  * RPEORT LINE
2343   
2344  * ------------------------------------------------------------------------
      ----
2345   
2346  * REPORT NODE
2347          report_node('energy demand total',loop_res_share,loop_prosumage)  
      = (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,st
      o,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 2;
2348          report_node('energy demand gross',loop_res_share,loop_prosumage)  
      =  (sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) )*2;
2349          report_node('energy generated net',loop_res_share,loop_prosumage) 
      =  (sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis
       , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fa
      c_nondis(scen,nondis,h))
2350                                                                            
       + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,r
      es,h)) )))*2 ;
2351          report_node('energy generated gross',loop_res_share,loop_prosumage
      )=   (sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( d
      is , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_
      fac_nondis(scen,nondis,h))
2352                                                                            
         + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2353                                                                            
         + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen
      ,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(
      scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h))
       )))*2 ;
2354          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( 
      tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(sce
      n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res))) + sum( sto , sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))*2
      ;
2355          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)= (sum( (nondis,h),  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h)   ))  + sum(
      h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,  lev_CU_energybal
      (scen,h))))*2  ;
2356          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), su
      m(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum( (res,h),  sum
      (scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)))
       + sum( (nondis,h),  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_CU(scen,nondis,h))) + sum( h,  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_CU_energybal(scen,h)  )) / (sum((res,h), sum(scen$(map(s
      cen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,
      res))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis))))) );
2357          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 2 ;
2358          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2359          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) ,  marginal_con1a(scen,h))) ) ;
2360          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h))
       = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) ,  marginal_con1a(scen,h))) ) ;
2361          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)
      ) = sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_c
      on1a(scen,h)))/card(h) ;
2362          report_node('max res demand',loop_res_share,loop_prosumage)$sum(h,
      d(h)) = max( calc_maxdemand , smax( h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) ,  lev_residual_load(h)  )) ) ;
2363          report_node('min res demand',loop_res_share,loop_prosumage)$sum(h,
      d(h)) = min( calc_mindemand , smin( h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) ,    lev_residual_load(h)       )) ) ;
2364   
2365          report_node('energy demand total',loop_res_share,loop_prosumage)$(
      report_node('energy demand total',loop_res_share,loop_prosumage)< eps_rep_
      abs) = 0 ;
2366          report_node('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage)$(report_node('curtailment of fluct res absolute',loop_res_sha
      re,loop_prosumage)< eps_rep_abs*card(h)*2) = 0 ;
2367          report_node('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage)$(report_node('curtailment of fluct res relative',loop_res_sha
      re,loop_prosumage)< eps_rep_rel) = 0 ;
2368          report_node('bio not utilized absolute',loop_res_share,loop_prosum
      age)$(report_node('bio not utilized absolute',loop_res_share,loop_prosumag
      e)< eps_rep_abs*card(h)*2) = 0 ;
2369          report_node('bio not utilized relative',loop_res_share,loop_prosum
      age)$(report_node('bio not utilized relative',loop_res_share,loop_prosumag
      e)< eps_rep_rel) = 0 ;
2370          report_node('min price',loop_res_share,loop_prosumage)$(report_nod
      e('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND report_node(
      'min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2371          report_node('energy generated net',loop_res_share,loop_prosumage)$
      (report_node('energy generated net',loop_res_share,loop_prosumage)< eps_re
      p_abs*card(h)) = 0 ;
2372          report_node('energy generated gross',loop_res_share,loop_prosumage
      )$(report_node('energy generated gross',loop_res_share,loop_prosumage)< ep
      s_rep_abs) = 0 ;
2373          report_node('energy demand gross',loop_res_share,loop_prosumage)$(
      report_node('energy demand gross',loop_res_share,loop_prosumage)< eps_rep_
      abs*card(h)) = 0 ;
2374          report_node('Capacity total',loop_res_share,loop_prosumage)$(repor
      t_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2375   
2376   
2377  * ------------------------------------------------------------------------
      ----
2378   
2379  * REPORT COST
2380          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)=
       sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , 
      c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) +
       c_do(dis)*lev_G_DO(scen,dis,h)) + sum( nondis , c_cu(nondis)*(lev_CU(scen
      ,nondis,h) + lev_CU_energybal(scen,h))) + sum( sto , c_m_sto(sto) * ( lev_
      STO_OUT(scen,sto,h) + lev_STO_IN(scen,sto,h) ) )))*2 ;
2381          report_cost('Nodal cost: investment & fix',loop_res_share,loop_pro
      sumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech , 
      c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + su
      m( sto , c_i_sto_e(sto)*lev_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_ST
      O_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,sto
      ) )
2382  *$ontext
2383                   + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res
      )*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(sc
      en,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(sc
      en,sto)) + c_i_sto_p(sto)*lev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_
      sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,
      h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( re
      s , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))
       + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
2386  )*2 ;
2387   
2388           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= r
      eport_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_c
      ost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2389   ;
2390   
2391  * ------------------------------------------------------------------------
      ----
2392   
2393  * REPORT TECH
2394          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,con)) ;
2395          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(
      scen,res) + lev_N_RES_PRO(scen,res)) ;
2396          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(s
      cen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2397          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 2 ;
2398   
2399          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con))
       / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2400          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) 
      / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2401          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) +
       lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,l
      oop_prosumage)+ 1e-9 ;
2402          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) 
      + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_shar
      e,loop_prosumage)+ 1e-9 ;
2403   
2404          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(sc
      en,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO
      2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))
      ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_dem
      and(scen)) ;
2405          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , gross_energy_demand(scen)) ;
2406          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res
      ,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,
      h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,lo
      op_prosumage)) , report_node('energy generated net',loop_res_share,loop_pr
      osumage)) ;
2407          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$report_node('energy generated net',loop_res_share,loop_pr
      osumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2408   
2409          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 2 ;
2410          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h) )) > card(h)*eps_
      rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_CU(scen,res,h) + lev_CU_PRO(scen,res,h)  ))/( sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res
      ) + lev_N_RES_PRO(scen,res) )))  + 1e-9 ) ;
2411   
2412          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_shar
      e,loop_prosumage,sto,h)) * 2 ;
2413          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,lo
      op_prosumage,sto,h)) * 2 ;
2414   
2415          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_i
      ns) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G
      _L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_TECH(scen,con)))*2  ;
2416          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_i
      ns) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G
      _L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PR
      O2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h)
       - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_N_TECH(scen,res)))*2;
2417          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_
      ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev
      _N_STO_P(scen,sto)) ;
2418   
2419          report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)$(report_tech('capacities conventional',loop_res_share,loop_prosumag
      e,con)< eps_rep_ins) = 0 ;
2420          report_tech('capacities renewable',loop_res_share,loop_prosumage,r
      es)$(report_tech('capacities renewable',loop_res_share,loop_prosumage,res)
      < eps_rep_ins) = 0 ;
2421          report_tech('capacities storage MW',loop_res_share,loop_prosumage,
      sto)$(report_tech('capacities storage MW',loop_res_share,loop_prosumage,st
      o)< eps_rep_ins) = 0 ;
2422          report_tech('capacities storage MWh',loop_res_share,loop_prosumage
      ,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_prosumage,
      sto)< eps_rep_ins) = 0 ;
2423          report_tech('renshares in nodal gross demand',loop_res_share,loop_
      prosumage,res)$(report_tech('renshares in nodal gross demand',loop_res_sha
      re,loop_prosumage,res)< eps_rep_rel) = 0 ;
2424          report_tech('conshares in nodal gross demand',loop_res_share,loop_
      prosumage,con)$(report_tech('conshares in nodal gross demand',loop_res_sha
      re,loop_prosumage,con)< eps_rep_rel) = 0 ;
2425          report_tech('renshares in nodal net generation',loop_res_share,loo
      p_prosumage,res)$(report_tech('renshares in nodal net generation',loop_res
      _share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2426          report_tech('conshares in nodal net generation',loop_res_share,loo
      p_prosumage,con)$(report_tech('conshares in nodal net generation',loop_res
      _share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2427          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res
      _share,loop_prosumage,res)< eps_rep_abs*card(h)*2) = 0 ;
2428          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_prosumage,res)$(report_tech('curtailment of fluct res relative',loop_res
      _share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2429          report_tech('Capacity share',loop_res_share,loop_prosumage,con)$(r
      eport_tech('Capacity share',loop_res_share,loop_prosumage,con)< eps_rep_re
      l) = 0 ;
2430          report_tech('Capacity share',loop_res_share,loop_prosumage,res)$(r
      eport_tech('Capacity share',loop_res_share,loop_prosumage,res)< eps_rep_re
      l) = 0 ;
2431          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)$(r
      eport_tech('Capacity share',loop_res_share,loop_prosumage,sto)< eps_rep_re
      l) = 0 ;
2432          report_tech('FLH',loop_res_share,loop_prosumage,con)$(report_tech(
      'FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2433          report_tech('FLH',loop_res_share,loop_prosumage,res)$(report_tech(
      'FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2434          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech(
      'FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2435          report_tech('Storage out total non-reserves',loop_res_share,loop_p
      rosumage,sto)$(report_tech('Storage out total non-reserves',loop_res_share
      ,loop_prosumage,sto)< eps_rep_abs*card(h)*2) = 0 ;
2436          report_tech('Storage in total non-reserves',loop_res_share,loop_pr
      osumage,sto)$(report_tech('Storage in total non-reserves',loop_res_share,l
      oop_prosumage,sto)< eps_rep_abs*card(h)*2) = 0 ;
2437   
2438   
2439  * ------------------------------------------------------------------------
      ----
2440   
2441  * REPORT NODE
2442          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res
      _share,loop_prosumage,res))       ;
2443          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res
      _share,loop_prosumage,con)) ;
2444          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(res, report_tech('renshares in nodal net generation',loop
      _res_share,loop_prosumage,res)) ;
2445          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)= sum(con, report_tech('conshares in nodal net generation',loop
      _res_share,loop_prosumage,con)) ;
2446   
2447          report_node('renshare in nodal gross demand',loop_res_share,loop_p
      rosumage)$(report_node('renshare in nodal gross demand',loop_res_share,loo
      p_prosumage)< eps_rep_rel ) = 0 ;
2448          report_node('conshare in nodal gross demand',loop_res_share,loop_p
      rosumage)$(report_node('conshare in nodal gross demand',loop_res_share,loo
      p_prosumage)< eps_rep_rel ) = 0 ;
2449          report_node('renshare in nodal net generation',loop_res_share,loop
      _prosumage)$(report_node('renshare in nodal net generation',loop_res_share
      ,loop_prosumage)< eps_rep_rel ) = 0 ;
2450          report_node('conshare in nodal net generation',loop_res_share,loop
      _prosumage)$(report_node('conshare in nodal net generation',loop_res_share
      ,loop_prosumage)< eps_rep_rel ) = 0 ;
2451   
2452   
2453   
2454  * ------------------------------------------------------------------------
      ----
2455   
2456  * REPORT TECH
2457          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,c
      on,h) ) ) ;
2458          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,r
      es,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen
      ,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h
      ) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2459          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= su
      m( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PR
      O2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen
      ,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac
      _sto(scen,sto,h)) ) ;
2460   
2461          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',
      loop_res_share,loop_prosumage)* 2 + 1e-9 ;
2462          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto 
      , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) +
       lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,
      res,h))) / report_node('energy generated gross',loop_res_share,loop_prosum
      age)* 2 + 1e-9 ;
2463          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h)
       + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_O
      UT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* 2 + 1e-9 ;
2464          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO
      _P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-res
      erves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) 
      ;
2465          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(s
      um(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) 
      + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out to
      tal non-reserves',loop_res_share,loop_prosumage,sto)/ (sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(
      scen,sto) )* 2) ;
2466   
2467          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)$(re
      port_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps_rep_ins 
      ) = 0 ;
2468          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)$(re
      port_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps_rep_ins 
      ) = 0 ;
2469          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)$(re
      port_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps_rep_ins 
      ) = 0 ;
2470   
2471          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,con)$(report_tech('Energy share in nodal gross generation
      ',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2472          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,res)$(report_tech('Energy share in nodal gross generation
      ',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2473          report_tech('Energy share in nodal gross generation',loop_res_shar
      e,loop_prosumage,sto)$(report_tech('Energy share in nodal gross generation
      ',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2474          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech(
      'FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2475          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(r
      eport_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_ab
      s) = 0 ;
2476   
2477   
2478  * ------------------------------------------------------------------------
      ----
2479   
2480  * REPORT
2481          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage)  ;
2482          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage) = report_node('curtailment of fluct res absolute',loop_res_share,l
      oop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosu
      mage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res))
       )) ;
2483          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loo
      p_prosumage)  ;
2484          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      ( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_pro
      sumage) /m_e('bio') ;
2485          report('Capacity total',loop_res_share,loop_prosumage) = report_no
      de('Capacity total',loop_res_share,loop_prosumage) ;
2486          report('energy demand gross',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2487          report('energy demand total',loop_res_share,loop_prosumage) = repo
      rt_node('energy demand total',loop_res_share,loop_prosumage)  ;
2488          report('energy generated net',loop_res_share,loop_prosumage) =  re
      port_node('energy generated net',loop_res_share,loop_prosumage) ;
2489          report('energy generated gross',loop_res_share,loop_prosumage) =  
      report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2490          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(
      scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_re
      s(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h))  ))/ sum( sce
      n$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) 
      ;
2491          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) 
      , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(
      scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gr
      oss_energy_demand(scen) ) ;
2492          report('Energy total',loop_res_share,loop_prosumage) = report_node
      ('Energy total',loop_res_share,loop_prosumage) ;
2493   
2494          report('curtailment of fluct res absolute',loop_res_share,loop_pro
      sumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_pr
      osumage) < eps_rep_abs*card(h)) = 0 ;
2495          report('curtailment of fluct res relative',loop_res_share,loop_pro
      sumage)$(report('curtailment of fluct res relative',loop_res_share,loop_pr
      osumage) < eps_rep_rel) = 0 ;
2496          report('bio not utilized absolute',loop_res_share,loop_prosumage)$
      (report('bio not utilized absolute',loop_res_share,loop_prosumage) < eps_r
      ep_abs*card(h)) = 0 ;
2497          report('bio not utilized relative',loop_res_share,loop_prosumage)$
      (report('bio not utilized relative',loop_res_share,loop_prosumage) < eps_r
      ep_rel) = 0 ;
2498          report('Capacity total',loop_res_share,loop_prosumage)$(report('Ca
      pacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2499          report('gross trade share',loop_res_share,loop_prosumage)$(report(
      'gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2500          report('renshare total',loop_res_share,loop_prosumage)$(report('re
      nshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2501          report('conshare total',loop_res_share,loop_prosumage)$(report('co
      nshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2502          report('Energy total',loop_res_share,loop_prosumage)$(report('Ener
      gy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2503   
2504   
2505  * ------------------------------------------------------------------------
      ----
2506   
2507  * PROSUMAGE
2508  *$ontext
2509          report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= 
      numb_pro_load * d_pro(h) ;
2510          report_hours('demand market',loop_res_share,loop_prosumage,h)=  d(
      h) ;
2511          gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross
      _energy_demand_prosumers_selfgen(scen);
2512   
2513          report_prosumage_tech_hours('possible total generation prosumers',
      loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
2514          report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_CU_PRO(scen,res,h)) ;
2515          report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
2516          report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_G_MARKET_PRO2M(scen,res,h));
2517          report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_G_MARKET_M2PRO(scen,h)) ;
2518          report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
2519          report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
2520          report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
2521          report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
2522          report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
2523          report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
2524          report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
2525          report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
2526          report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
2527          report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
2528          report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
2529          report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_STO_L_M2M(scen,sto,h)) ;
2530   
2531          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2532          report_market_tech_hours('generation market',loop_res_share,loop_p
      rosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_
      G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
2533          report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)  ) ;
2534          report_market_tech_hours('curtailment enerbal market',loop_res_sha
      re,loop_prosumage,'market',h)=  sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) ,   lev_CU_energybal(scen,h)    ) ;
2535   
2536          report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ;
2537          report_market_tech_hours('storage loading market',loop_res_share,l
      oop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ;
2538          report_market_tech_hours('storage level market',loop_res_share,loo
      p_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_STO_L(scen,sto,h)) ;
2539          report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,
      h)) ) ;
2540          report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) 
      ) ;
2541          report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto
      ,h)) ) ;
2542          report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))
       ) ;
2543          report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
2544          report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop
      _res_share,loop_prosumage)) , sum( res_pro , lev_G_MARKET_PRO2M(scen,res_p
      ro,h)) )  ;
2545   
2546          report_node('gross energy demand market',loop_res_share,loop_prosu
      mage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
2547          report_node('gross energy demand prosumers self generation',loop_r
      es_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2548   
2549   
2550          report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , lev_N_RES_PRO(scen,res) ) ;
2551          report_prosumage_tech('Mean capacities kW renewable prosumers',loo
      p_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_
      prosumage)) , lev_N_RES_PRO(scen,res) / (numb_pro_load*1000/1000 + 1e-9 ))
       ;
2552          report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , lev_N_STO_P_PRO(scen,sto)) ;
2553          report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosum
      age)) , lev_N_STO_E_PRO(scen,sto)) * 2 ;
2554          report_prosumage_tech('Mean capacities storage kW prosumers',loop_
      res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_pr
      osumage)) , lev_N_STO_P_PRO(scen,sto)/ (numb_pro_load*1000/1000  + 1e-9)) 
      ;
2555          report_prosumage_tech('Mean capacities storage kWh prosumers',loop
      _res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_N_STO_E_PRO(scen,sto)/ (numb_pro_load*1000/1000  + 1e-9 )
      ) * 2 ;
2556   
2557          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage
       loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)))*2  ;
2558          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage
       loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)))*2 ;
2559          report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage l
      oading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)))*2 ;
2560          report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage l
      oading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)))*2 ;
2561          report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage loa
      ding prosumers M2M',loop_res_share,loop_prosumage,sto,h)))*2 ;
2562          report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storag
      e generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)))*2  
      ;
2563          report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage 
      generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)))*2  ;
2564          report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_prosumage,sto)= (sum( h, report_prosumage_tech_hours('storage 
      generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)))*2  ;
2565          report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_prosumage,sto)=  (sum( h, report_prosumage_tech_hours('storage g
      eneration prosumers M2M',loop_res_share,loop_prosumage,sto,h)))*2  ;
2566          report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_prosumage,sto)= (report_prosumage_tech('Storage out total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storag
      e out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)+ report_pr
      osumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosu
      mage,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_re
      s_share,loop_prosumage,sto));
2567          report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_prosumage,'')=  (sum( (h,res) , report_prosumage_tech_hours('ge
      neration prosumers to market',loop_res_share,loop_prosumage,res,h)))*2  ;
2568          report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_prosumage,'')=  (sum( h , report_prosumage_tech_hours('withdraw
      al prosumers from market',loop_res_share,loop_prosumage,'',h)))*2  ;
2569          report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours
      ('generation prosumers self-consumption',loop_res_share,loop_prosumage,res
      ,h)) ;
2570          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , numb_pro_load * d_pro(h) )) ) = sum( scen$(map(scen,loop_res_sh
      are,loop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( h , numb_pro_load * d_pro(
      h) ) );
2571          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( h , numb_pro_load * d_pro(h) )) ) = sum( scen$(map(scen,loop_res_sh
      are,loop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_
      OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , sum( h , numb_pro_load * d_pro(h) ) + 1e-9 );
2572          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( h , numb_pro_load * d_pro(h) ) ) = sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( h , numb_pro_load * d_
      pro(h) + 1e-9 ) );
2573          report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * 2 ;
2574          report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment o
      f fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) 
      > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2575          report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)
      ) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(sc
      en$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2P
      RO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers 
      PRO2PRO',loop_res_share,loop_prosumage,sto);
2576          report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(sce
      n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto);
2577          report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pr
      osumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) 
      / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,
      loop_prosumage,sto);
2578          report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(
      scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / repo
      rt_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_pro
      sumage,sto);
2579          report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(
      h)) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,
      sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop
      _res_share,loop_prosumage,sto);
2580          report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sha
      re,loop_prosumage,sto);
2581          report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total 
      prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) 
      = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)
      )) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_sha
      re,loop_prosumage,sto);
2582          report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / r
      eport_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_
      prosumage,sto);
2583          report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total pro
      sumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , sum( res_pro , lev_G_MARKET_PRO2M
      (scen,res_pro,h)))) / report_prosumage_tech('Generation total prosumers PR
      O2M',loop_res_share,loop_prosumage,'');
2584          report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total pro
      sumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / re
      port_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop
      _prosumage,'');
2585          report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosume
      rs self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h
      )) = sum( h , report_hours('price',loop_res_share,loop_prosumage,h)* sum(s
      cen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(s
      cen,res,h)))) / report_prosumage_tech('generation prosumers self-consumpti
      on',loop_res_share,loop_prosumage,'');
2586          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO
      (scen,res) > eps_rep_ins)) = (sum( h , sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_P
      RO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ))*2  ;
2587          report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumag
      e,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_P
      RO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)/ (sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto))) ;
2588          report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage o
      ut total prosumers',loop_res_share,loop_prosumage,sto)/ (sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * 2) ;
2589          report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * 2 > eps_rep_ins ) =
       sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen
      ,sto) ) * 2 / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_S
      TO_P_PRO(scen,sto) ) ;
2590   
2591          report_market_tech('capacities renewable market',loop_res_share,lo
      op_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_TECH(scen,res) ) ;
2592          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       lev_N_STO_P(scen,sto)) ;
2593          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_STO_E(scen,sto)) * 2 ;
2594          report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_CU(scen,res,h)     )) * 2 ;
2595          report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct r
      es absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h)+ lev_CU_energybal(scen,h)   )) > card(h)*e
      ps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_CU(scen,res,h) + lev_CU_energybal(scen,h)    ))/( sum(h,  sum(scen$(
      map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fa
      c_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_CU(scen,res,h)  + lev_CU_energybal(scen,h)   )) ) ;
2596          report_market_tech('curtailment enerbal absolute market',loop_res_
      share,loop_prosumage,'market')=  sum(h, sum(scen$(map(scen,loop_res_share,
      loop_prosumage)),  lev_CU_energybal(scen,h)    )) * 2 ;
2597   
2598          report_market_tech('capacities conventional market',loop_res_share
      ,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage))
       , lev_N_TECH(scen,con)) ;
2599          report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation s
      torage market',loop_res_share,loop_prosumage,sto,h)) * 2 ;
2600          report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loadi
      ng market',loop_res_share,loop_prosumage,sto,h)) * 2 ;
2601          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,res)) > eps_rep_ins) = (sum( h , sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_G_RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fa
      c_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , lev_N_TECH(scen,res) ))*2  ;
2602          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      TECH(scen,con)) > eps_rep_ins) = (sum( h , sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen$(map(scen,loop_res
      _share,loop_prosumage)) , lev_N_TECH(scen,con) ))*2 ;
2603          report_market_tech('FLH market non-reserves',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total ma
      rket non-reserves',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,
      loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2604          report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage o
      ut total market non-reserves',loop_res_share,loop_prosumage,sto)/ (sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * 2);
2605          report_market_tech('Storage EP-ratio market',loop_res_share,loop_p
      rosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_
      STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_N_STO_E(scen,sto) ) * 2 > eps_rep_ins ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * 2 / sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + 1
      e-9  ) ;
2606   
2607          report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross
      _energy_demand_prosumers(scen)) ;
2608          report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosuma
      ge)) , gross_energy_demand_prosumers_market(scen)) ;
2609          report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_pro
      sumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2610          report_prosumage('self-generation share (autarky rate)',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share
      ,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( sc
      en$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosume
      rs(scen) ) ;
2611          report_prosumage('market share prosumers',loop_res_share,loop_pros
      umage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,lo
      op_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
2612          report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_shar
      e,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * 2 ;
2613          report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosum
      age)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(
      scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2614          report_prosumage('share self-generation curtailed',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h)
       )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , 
      phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2615          report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage
      )) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(sce
      n$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO
      (scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum
      ( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2616          report_prosumage('self-consumption rate',loop_res_share,loop_prosu
      mage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) ,
       phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )  + s
      um( (res,sto,h), lev_STO_IN_PRO2PRO(scen,res,sto,h)) ) / sum(scen$(map(sce
      n,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_
      RES_PRO(scen,res)) ) ;
2617          report_prosumage('share self-generation to market',loop_res_share,
      loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum(
       (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(sc
      en,loop_res_share,loop_prosumage)) , sum( (h,res_pro) , lev_G_MARKET_PRO2M
      (scen,res_pro,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2618          report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) ,
       sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(m
      ap(scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PR
      O2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumag
      e)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2619          report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , s
      um( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map
      (scen,loop_res_share,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2
      M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2620          report_prosumage('Capacity total prosumers',loop_res_share,loop_pr
      osumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
2621          report_prosumage('Annual electricity expenditure consumer',loop_re
      s_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) ,  lev_electr_bill_con(scen) )  ;
2622          report_prosumage('Annual electricity expenditure prosumer',loop_re
      s_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumag
      e)) ,  lev_electr_bill_pro(scen) )  ;
2623          report_prosumage('Annual load MWh prosumer',loop_res_share,loop_pr
      osumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,  sum(h, d
      _pro(h))/1000*2 ) ;
2624          report_prosumage('Annual load defection MWh prosumer',loop_res_sha
      re,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       eps )  ;
2625          report_prosumage('Annual load defection MWh prosumer',loop_res_sha
      re,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       ((sum(h, d_pro(h)) - sum(h, lev_G_MARKET_M2PRO(scen,h)/(numb_pro_load + 1
      e-9)))/1000*2 ))$(numb_pro_load>0)   ;
2626          report_prosumage('Annual load from grid MWh prosumer',loop_res_sha
      re,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) ,
       (sum(h, lev_G_MARKET_M2PRO(scen,h)/(numb_pro_load + 1e-9))) /1000*2 )$(nu
      mb_pro_load>0)   ;
2627          report_prosumage('Annual load to grid MWh prosumer',loop_res_share
      ,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , (
      sum( (h,res_pro), lev_G_MARKET_PRO2M(scen,res_pro,h)/(numb_pro_load + 1e-9
      )))/1000*2 )$(numb_pro_load>0)   ;
2628   
2629          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_prosumage)+ 1e-9 ;
2630          report_prosumage_tech('Capacity share prosumers',loop_res_share,lo
      op_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_sha
      re,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , l
      ev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity total prosumers',l
      oop_res_share,loop_prosumage)+ 1e-9 ;
2631   
2632          report_prosumage('average market value withdrawal M2PRO',loop_res_
      share,loop_prosumage)$(report_prosumage_tech('Withdrawal total prosumers M
      2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( scen$
      (map(scen,loop_res_share,loop_prosumage)) , (sum( h, lev_G_MARKET_M2PRO(sc
      en,h)* marginal_con1a(scen,h))/ (sum( h, lev_G_MARKET_M2PRO(scen,h)) + 1e-
      9 ))) ;
2633          report_prosumage('average market value generation PRO2PRO',loop_re
      s_share,loop_prosumage)$(report_prosumage_tech('generation prosumers self-
      consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum
      ( scen$(map(scen,loop_res_share,loop_prosumage)) , (sum( (res_pro,h), lev_
      G_MARKET_PRO2M(scen,res_pro,h)* marginal_con1a(scen,h))/ (sum( (res_pro,h)
      , lev_G_MARKET_PRO2M(scen,res_pro,h) + 1e-9 )) )) ;
2634   
2635   
2636          report_market('gross energy demand market',loop_res_share,loop_pro
      sumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energ
      y_demand_market(scen)) ;
2637          report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , lev_CU(scen,res,h))) +   sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , lev_CU_energybal(scen,h))) ;
2638          report_market('curtailment of fluct res relative market',loop_res_
      share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) 
      , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card
      (res)*card(h) ) = ( sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , lev_CU(scen,res,h) )) + sum( h,  sum(scen$(map(scen,loop_res_
      share,loop_prosumage)), lev_CU_energybal(scen,h) )) ) / sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_T
      ECH(scen,res)) ) ;
2639          report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(sc
      en,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
2640          report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / s
      um( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_m
      arket(scen)) ;
2641          report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_marke
      t(scen)) ;
2642          report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_
      share,loop_prosumage)) , sum( res_pro , lev_G_MARKET_PRO2M(scen,res_pro,h)
      )) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_
      demand_market(scen)) ;
2643          report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_
      res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) 
      / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_deman
      d_market(scen)) ;
2644          report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_re
      s_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / su
      m( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_ma
      rket(scen)) ;
2645  * line below changed
2646          report_market('Capacity total market',loop_res_share,loop_prosumag
      e)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N
      _TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) )) ;
2647          report_market('Energy demand total market',loop_res_share,loop_pro
      sumage)= (sum( h , d(h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(ma
      p(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_
      IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * 2
2648  *$ontext
2649  ;
2650          report_market('energy generated gross market',loop_res_share,loop_
      prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , 
      sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + 
      sum( res_pro , lev_G_MARKET_PRO2M(scen,res_pro,h) - corr_fac_nondis(scen,r
      es_pro,h))
2651           + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h
      ) - corr_fac_sto(scen,sto,h))  )) ;
2652   
2653          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,tech)$(report_market('Capacity total market',loop_res_share,loop_pr
      osumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TE
      CH(scen,tech) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2654          report_market_tech('Capacity share market',loop_res_share,loop_pro
      sumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loo
      p_prosumage)+ 1e-9 ;
2655          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,con)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / report_market('ene
      rgy generated gross market',loop_res_share,loop_prosumage)* 2 + 1e-9 ;
2656          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,res)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(sc
      en,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / repor
      t_market('energy generated gross market',loop_res_share,loop_prosumage)* 2
       + 1e-9 ;
2657          report_market_tech('Energy share in gross nodal market generation'
      ,loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross
       market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(s
      cen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated
       gross market',loop_res_share,loop_prosumage)* 2 + 1e-9 ;
2658   
2659                   report_hours('demand prosumers',loop_res_share,loop_prosu
      mage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)<
       eps_rep_abs) = 0 ;
2660                   report_hours('demand market',loop_res_share,loop_prosumag
      e,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_r
      ep_abs) = 0 ;
2661   
2662                   report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation pr
      osumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2663                   report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours(
      'curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)<
       eps_rep_abs) = 0 ;
2664                   report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hou
      rs('generation prosumers self-consumption',loop_res_share,loop_prosumage,r
      es,h)< eps_rep_abs) = 0 ;
2665                   report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('gen
      eration prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep
      _abs) = 0 ;
2666                   report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('wi
      thdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_r
      ep_abs) = 0 ;
2667                   report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('
      storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< e
      ps_rep_abs) = 0 ;
2668                   report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2669                   report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2670                   report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2671                   report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hour
      s('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto
      ,h)< eps_rep_abs) = 0 ;
2672                   report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2673                   report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours(
      'storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)<
       eps_rep_abs) = 0 ;
2674                   report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps
      _rep_abs) = 0 ;
2675                   report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_r
      ep_abs) = 0 ;
2676                   report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2677                   report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('stor
      age level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_a
      bs) = 0 ;
2678                   report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storag
      e level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) 
      = 0 ;
2679   
2680                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2681                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loo
      p_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2682                   report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailm
      ent of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs
      ) =  0 ;
2683                   report_market_tech_hours('generation storage market',loop
      _res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation sto
      rage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
2684                   report_market_tech_hours('storage loading market',loop_re
      s_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading m
      arket',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2685                   report_market_tech_hours('storage level market',loop_res_
      share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level marke
      t',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2686                   report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2687                   report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2688                   report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_m
      arket_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_pr
      osumage,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2689                   report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_mar
      ket_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosum
      age,'Interaction with prosumers',h)< eps_rep_abs) = 0 ;
2690                   report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2691                   report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_t
      ech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Inter
      action with prosumers',h)< eps_rep_abs) = 0 ;
2692   
2693                   report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewa
      ble prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
2694                   report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stora
      ge MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2695                   report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities stor
      age MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2696                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2697                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share pr
      osumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2698                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption sha
      re prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
2699                   report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_ins) = 0 ;
2700                   report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curt
      ailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res
      )< eps_rep_rel) = 0 ;
2701                   report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2702                   report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2703                   report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)
      ) = 0 ;
2704                   report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total 
      prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 
      0 ;
2705                   report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
2706                   report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2707                   report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out to
      tal prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2708                   report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out tota
      l prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) 
      = 0 ;
2709                   report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total pr
      osumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
2710                   report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total
       prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2711                   report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total
       prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) 
      = 0 ;
2712                   report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation 
      prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs
       * card(h)) = 0 ;
2713                   report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average 
      market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_r
      ep_abs) = 0 ;
2714                   report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2715                   report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average ma
      rket value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_a
      bs) = 0 ;
2716                   report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mark
      et value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) 
      = 0 ;
2717                   report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average
       market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2718                   report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2719                   report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average m
      arket value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep
      _abs) = 0 ;
2720                   report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average mar
      ket value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs
      ) = 0 ;
2721                   report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2722                   report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average mar
      ket value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs
      ) = 0 ;
2723                   report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average m
      arket value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep
      _abs) = 0 ;
2724                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2725                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2726                   report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _prosumage,res)< eps_rep_abs) = 0 ;
2727                   report_prosumage_tech('Storage cycles prosumers',loop_res
      _share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2728                   report_prosumage_tech('FLH',loop_res_share,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps
      _rep_abs) = 0 ;
2729                   report_prosumage_tech('Storage EP-ratio prosumers',loop_r
      es_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2730   
2731                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
2732                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2733                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
2734                   report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_a
      bs*card(h)) = 0 ;
2735                   report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment o
      f fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_r
      el) = 0 ;
2736                   report_market_tech('capacities conventional market',loop_
      res_share,loop_prosumage,con)$(report_market_tech('capacities conventional
       market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2737                   report_market_tech('capacities renewable market',loop_res
      _share,loop_prosumage,res)$(report_market_tech('capacities renewable marke
      t',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2738                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW mar
      ket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
2739                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh m
      arket',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2740                   report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out tota
      l market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*car
      d(h)) = 0 ;
2741                   report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total 
      market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(
      h)) = 0 ;
2742                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2743                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2744                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2745                   report_market_tech('Storage cycles market non-reserves',l
      oop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2746                   report_market_tech('Storage EP-ratio market',loop_res_sha
      re,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2747   
2748                   report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',l
      oop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2749                   report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand 
      prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2750                   report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_prosumage)$(report_prosumage('gross energy dem
      and prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins
      ) = 0 ;
2751                   report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_prosumage)$(report_prosumage('self-generation share pr
      osumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2752                   report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,
      loop_prosumage)< eps_rep_rel) = 0 ;
2753                   report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 
      0 ;
2754                   report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of flu
      ct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 
      0 ;
2755                   report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation curtaile
      d',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2756                   report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation
       direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2757                   report_prosumage('share self-generation to market',loop_r
      es_share,loop_prosumage)$(report_prosumage('share self-generation to marke
      t',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2758                   report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_prosumage)$(report_prosumage('share self-generation sto
      red PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2759                   report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_prosumage)$(report_prosumage('share self-generation store
      d PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2760                   report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_sh
      are,loop_prosumage)< eps_rep_abs) = 0 ;
2761   
2762                   report_market('gross energy demand market',loop_res_share
      ,loop_prosumage)$(report_market('gross energy demand market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2763                   report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res ab
      solute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2764                   report_market('curtailment of fluct res relative market',
      loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res re
      lative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2765                   report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer consumption',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2766                   report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2767                   report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market
       energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2768                   report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_prosumage)$(report_market('Share market
       energy tranferred from prosumer generation',loop_res_share,loop_prosumage
      )< eps_rep_rel) = 0 ;
2769                   report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share ma
      rket energy transferred from prosumer storage PRO2M',loop_res_share,loop_p
      rosumage)< eps_rep_rel) = 0 ;
2770                   report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share mark
      et energy transferred from prosumer storage M2M',loop_res_share,loop_prosu
      mage)< eps_rep_rel) = 0 ;
2771                   report_market('Capacity total market',loop_res_share,loop
      _prosumage)$(report_market('Capacity total market',loop_res_share,loop_pro
      sumage)< eps_rep_abs) = 0 ;
2772                   report_market('Energy demand total market',loop_res_share
      ,loop_prosumage)$(report_market('Energy demand total market',loop_res_shar
      e,loop_prosumage)< eps_rep_abs) = 0 ;
2773                   report_market('energy generated gross market',loop_res_sh
      are,loop_prosumage)$(report_market('energy generated gross market',loop_re
      s_share,loop_prosumage)< eps_rep_abs) = 0 ;
2774   
2775                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res
      _share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
2776                   report_market_tech('Capacity share market',loop_res_share
      ,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_
      share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2777                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,con)<
       eps_rep_rel) = 0 ;
2778                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,res)<
       eps_rep_rel) = 0 ;
2779                   report_market_tech('Energy share in gross nodal market ge
      neration',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy s
      hare in gross nodal market generation',loop_res_share,loop_prosumage,sto)<
       eps_rep_rel) = 0 ;
2780   
2781                   report_cost_prosumage('Annualized pv expenditure prosumer
      ',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop
      _prosumage)) , expenses_pv(scen) )           ;
2782                   report_cost_prosumage('Annualized storage expenditure pro
      sumer',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share
      ,loop_prosumage)) ,expenses_storage(scen) )  ;
2783                   report_cost_prosumage('Annual expenses grid_consumption e
      nergy prosumer',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , expenses_grid_consumption_energy(scen) )  ;
2784                   report_cost_prosumage('Annual contribution non-energy pro
      sumer',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share
      ,loop_prosumage)) , expenses_grid_consumption_other(scen) )  ;
2785                   report_cost_prosumage('Annual income feedin prosumer',loo
      p_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , income_feedin(scen)  )        ;
2786                   report_cost_prosumage('Annual electricity expenditure pro
      sumer',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share
      ,loop_prosumage)) , total_bill(scen) )  ;
2787                   report_cost_prosumage('Annual expenditure SC tax prosumer
      ',loop_res_share,loop_prosumage)=  sum( scen$(map(scen,loop_res_share,loop
      _prosumage)) , expenses_SC_tax(scen) )  ;
2788   
2791   
2792   
2793   
2794   
2803   
2804  *$ontext
2805   
2814   
2817   
2818   
2819   
2820   
2821   
2822  execute_unload "results", report, report_tech, report_node,
2823  report_tech_hours, report_hours, report_cost
2824   
2825  *$ontext
2826  , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, re
      port_market, report_market_tech, report_market_tech_hours,
2827    report_cost_prosumage
2830  ;
2831   
2832  *$ontext
2833  execute "gdxxrw i=results.gdx o=results.xlsx @results.tmp squeeze=N";
2836   
2837  * ------------------------------------------------------------------------
      ---- *
2838   
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 05/13/19 10:42:49 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Error Messages


143  A suffix is missing

**** 2 ERROR(S)   0 WARNING(S)
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 05/13/19 10:42:49 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          DIETER_PROSUMOD_MCP\DIETER.gms
     2      114 INCLUDE        1     114  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\dataload.gms
     3      489 CALL           2     375  .gdxxrw data_input.xlsx @temp.tmp o=Da
                                           ta_input maxdupeerrors=100
     4      491 GDXIN          2     377  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\Data_input.gdx
     5      520 CALL           2     406  .gdxxrw time_series.xlsx @temp2.tmp o=
                                           time_series
     6      521 GDXIN          2     407  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\time_series.gdx
     7      709 INCLUDE        1     171  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\tariff_scenario
                                           .gms
     8      767 INCLUDE        1     177  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\model.gms
     9     1595 INCLUDE        1     183  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\fix.gms
    10     1835 INCLUDE        1     184  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\scenario.gms
    11     1940 IF EXIST       1     215  C:\Users\Lenovo\Documents\GitHub\prosu
                                          mage\Code\Prosumage_Opt\Dieter_Module\
                                          DIETER_PROSUMOD_MCP\DIETER_MCP_p.gdx
    12     1948 INCLUDE        1     223  .C:\Users\Lenovo\Documents\GitHub\pros
                                           umage\Code\Prosumage_Opt\Dieter_Modul
                                           e\DIETER_PROSUMOD_MCP\report.gms


COMPILATION TIME     =       31.953 SECONDS      5 MB  24.7.4 r58773 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\DIETER.gms
Output     C:\Users\Lenovo\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_
           Module\DIETER_PROSUMOD_MCP\DIETER.lst

**** USER ERROR(S) ENCOUNTERED
