GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  ********************************************************************************
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24   
  25  * Choose base year
  27   
  28  * Germany only - also adjust Excel inputs!
  30   
  31  * Set star to activate options
  32   
  34   
  35  * Set star to select run-of-river options either as exogenous parameter or as endogenous variable including reserve provision:
  36  * if nothing is selected, ROR capacity will be set to zero
  37  * if parameter option is selected, set appropriate values in fix.gmx
  38  * if variable option is selected, set appropriate bound in data_input excel
  41   
  42  * Set star to determine loops, otherwise default 100% renewables
  44   
  45  * Set star for no crossover to speed up calculation time by skipping crossover in LP solver
  47   
  48  * Set star for reporting to Excel
  50   
  51   
  52  * ----------------- Select if to use MCP or LP format --------------------------
  53   
  54  * Set to "*" to select linear program, leave blank to select MCP
  56   
  57  * Do not change these two lines
  60   
  61  ********************************************************************************
  62   
  63  * Definition of strings for report parameters and sanity checks
  64  * (Do not change settings below)
  66   
  67  * Sanity checks
  69   
  70  ********************************************************************************
  71   
  72  ****************************
  73  ***** INITIALIZE LOOPS *****
  74  ****************************
  75   
  76  sets
  77  *$ontext
  78  loop_res_share   Solution loop for different shares of renewables       /50,80/
  81   
      loop_prosumage   Solution loop for different prosumer self-consumption levels    /50/
      $ontext
  86   
  87  *      loop_res_share                          /50/
  88                        loop_prosumage                          /0/
  89  ;
  90   
  91   
  92   
  93   
  94  ********************************************************************************
  95   
  96  **************************
  97  ***** SOLVER OPTIONS *****
  98  **************************
  99   
 100  options
 101  optcr = 0.00
 102  reslim = 10000000
 103  lp = cplex
 104  mip = cplex
 105  nlp = conopt
 106  limrow = 0
 107  limcol = 0
 108  ;
 109   
 110  options
 111  dispwidth = 15
 112  limrow = 0
 113  limcol = 0
 114  solprint = off
 115  sysout = off
 116  ;
 117   
 118   
 119   
 120   
 121  ********************************************************************************
 122   
 123  **************************
 124  ***** Dataload *****
 125  **************************
 126   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\dataload.gms
 128   
 129  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 139  ********************************************************************************
 140   
 141   
 142   
 143   
 144  ***************  SETS  *********************************************************
 145   
 146  ***** Sets used in the model *****
 147  Sets
 148  tech                     Generation technologies
 149   dis(tech)               Dispatchable generation technologies
 150   nondis(tech)            Nondispatchable generation technologies
 151   con(tech)               Conventional generation technologies
 152   res(tech)               Renewable generation technologies
 153  sto                      Storage technologies
 154  rsvr                     Reservoir technologies
 155  dsm                      DSM technologies
 156   dsm_shift(dsm)          DSM load shifting technologies
 157   dsm_curt(dsm)           DSM load curtailment technologies
 158  year                     Base year for temporal data
 159  h                        Hours
 160  n                        Nodes
 161  l                        Lines
 162  ev                       EV types
 163  reserves                         Reserve qualities
 164   reserves_up(reserves)           Positive reserves
 165   reserves_do(reserves)           Negative reserves
 166   reserves_spin(reserves)         Spinning reserves
 167   reserves_nonspin(reserves)      Nonspinning reserves
 168   reserves_prim(reserves)         Primary reserves
 169   reserves_nonprim(reserves)      Nonprimary reserves
 170   reserves_prim_up(reserves)      Primary positive reserves
 171   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 172   reserves_prim_do(reserves)      Primary negative reserves
 173   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 174  bu                       Building archtypes
 175  ch                       Heating combination type
 176   hst(ch)                 Heating technology that feeds to storage
 177   hp(ch)                  Heat pump technologies
 178   hel(ch)                 Hybrid electric heating technologies - electric part
 179   hfo(ch)                 Hybrid electric heating technologies - fossil part
 180   
 181   
 182  ***** Sets used for data upload *****
 183  headers_tech                     Generation technologies - upload headers
 184   tech_dispatch                   Generation technologies - dispatchable or nondispatchable
 185   tech_res_con                    Generation technologies - renewable or "conventional"
 186  headers_sto                      Storage technologies - upload headers
 187  headers_reservoir                Reservoir technologies - upload headers
 188  headers_dsm                      DSM technologies - upload headers
 189   dsm_type                        DSM technologies - shifting or curtailment
 190  headers_time                     Temporal data - upload headers
 191  headers_topology                 Spatial data - upload headers
 192  headers_ev                       EV data - upload headers
 193  headers_time_ev                  EV temporal data - upload headers
 194  headers_prosumage_generation     Prosumage generation data - upload headers
 195  headers_prosumage_storage        Prosumage storage data - upload headers
 196  headers_reserves                 Reserve data - upload headers
 197   reserves_up_down                Reserve data - positive and neagtive reserves
 198   reserves_spin_nonspin           Reserve data - spinning and nonspinning reserves
 199   reserves_prim_nonprim           Reserve data - primary and nonprimary reserves
 200  headers_heat                     Heat data - upload headers
 201   heat_storage                    Heat data - storage technologies
 202   heat_hp                         Heat data - heat pump technologies
 203   heat_elec                       Heat data - hybrid heating technologies - electric part
 204   heat_fossil                     Heat data - hybrid heating technologies - fossil part
 205  headers_time_heat                Heat data - upload headers time data
 206  headers_time_dhw                 Heat data - upload headers time data on DHW
 207  ;
 208   
 209   
 210   
 211   
 212  ***************  PARAMETERS  ***************************************************
 213   
 214  Parameters
 215   
 216  ***** Generation technologies *****
 217  *--- Variable and fixed costs ---*
 218  eta              Efficiency of conventional technologies [0 1]
 219  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 220  c_up             Load change costs UP [EUR per MWh]
 221  c_do             Load change costs DOWN [EUR per MWh]
 222  c_fix            Annual fixed costs [EUR per MW per year]
 223  c_vom            Variable O&M costs [EUR per MWh]
 224  CO2price         CO2 price in [EUR per ton]
 225   
 226  *--- Investment ---*
 227  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 228  lifetime         Investment costs: technical lifetime [a]
 229  recovery         Investment costs: Recovery period according to depreciation tables [a]
 230  interest_rate    Investment costs: Interest rate [%]
 231  m_p              Investment: maximum installable capacity per technology [MW]
 232  m_e              Investment: maximum installable energy [TWh per a]
 233   
 234  *--- Flexibility ---*
 235  grad_per_min     Maximum load change relative to installed capacity [% of installed capacity per minute]
 236   
 237   
 238  ***** Fuel and CO2 costs *****
 239  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 240   
 241   
 242  ***** Renewables *****
 243  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 244  phi_min_res      Minimum renewables share [0 1]
 245   
 246   
 247  ***** Storage *****
 248  *--- Variable and fixed costs ---*
 249  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 250  eta_sto          Storage efficiency [0 1]
 251  phi_sto_ini      Initial storage level [0 1]
 252  etop_max         Maximum E to P ratio of storage types [#]
 253  c_fix_sto        Annual fixed costs [EUR per MW]
 254   
 255  *--- Investment ---*
 256  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight [EUR per MWh]
 257  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnight [EUR per MW]
 258  m_sto_e                     Investment into storage: maximum installable energy [MWh]
 259  m_sto_p                     Investment into storage: maximum installable power [MW]
 260   
 261   
 262  ***** Reservoir*****
 263  *--- Variable and fixed costs ---*
 264  c_m_rsvr                 Marginal costs of generating energy from reservoir [EUR per MWh]
 265  eta_rsvr                 Generation efficiency [0 1]
 266  phi_rsvr_ini             Initial reservoir level [0 1]
 267  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 268  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of annual energy [0 1]
 269  phi_rsvr_lev_min         Minimum filling level [0 1]
 270   
 271  *--- Investment ---*
 272  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight [EUR per MWh]
 273  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnight [EUR per MW]
 274  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetime [a]
 275  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 276  m_rsvr_e                 Investment into reservoir: maximum installable energy [MWh]
 277  m_rsvr_p                 Investment into reservoir: maximum installable capacity [MW]
 278   
 279   
 280  ***** DSM *****
 281  *--- Variable and fixed costs ---*
 282  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 283  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 284  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW per a]
 285  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per a]
 286   
 287  *--- Flexibility, efficiency, recovery ---*
 288  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 289  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment instances [h]
 290   
 291  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 292  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upshift instances [h]
 293  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 294   
 295  *--- Investment ---*
 296  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment: Overnight [EUR per MW]
 297  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: Overnight [EUR per MW]
 298  inv_recovery_dsm_cu              Investment costs for DSM load curtailment: Recovery period [a]
 299  inv_recovery_dsm_shift           Investment costs for DSM load shifting: Recovery period [a]
 300  inv_interest_dsm_cu              Investment costs for DSM load curtailment: Interest rate [%]
 301  inv_interest_dsm_shift           Investment costs for DSM load shifting: Interest rate [%]
 302  m_dsm_cu                         DSM: Maximum installable capacity load curtailment [MW]
 303  m_dsm_shift                      DSM: Maximum installable capacity load shifting [MW]
 304   
 305   
 306  ***** Time Data *****
 307  d_y                      Demand hour h for different years [MWh]
 308  d                        Demand hour h [MWh]
 309  phi_res_y                Renewables availability technology res in hour h for different years [0 1]
 310  phi_res                  Renewables availability technology res in hour h [0 1]
 311  phi_ror_y                Run-of-river availability technology ror in hour h for different years [0 1]
 312  phi_ror                  Run-of-river availability technology ror in hour h [0 1]
 313  rsvr_in_y                Reservoir inflow in hour h for different years [0 1]
 314  rsvr_in                  Reservoir inflow in hour h [0 1]
 315  n_ev_p_upload            Power rating of the charging connection in hour h [MW - 0 when car is in use or parked without grid connection]
 316  ev_ed_upload             Electricity demand for mobility vehicle profile ev in hour h [MW]
 317  ev_ged_exog_upload       Electricity demand for mobility in case of uncontrolled charging vehicle profile ev in hour h [MW]
 318  phi_reserves_call_y      Hourly share of reserve provision that is actually activated for different years [0 1]
 319  phi_reserves_call        Hourly share of reserve provision that is actually activated [0 1]
 320  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 321  reserves_exogenous       Hourly reserve provision [MW]
 322   
 323  ***** Transmission *****
 324  *--- Investment ---*
 325  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 326  c_fix_ntc                 Fixed costs [EUR per MW per a]
 327  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 328  inv_recovery_ntc          Investment costs: Recovery period in [a]
 329  inv_interest_ntc          Investment costs: Interest rate [%]
 330  m_ntc                     Investment into NTC: maximum installable capacity [MW]
 331   
 332  *--- Topology and distance ---*
 333  inc              Incidence index of link l on node n
 334  dist             Distance covered by link l [km]
 335   
 336   
 337  ***** Electric vehicles *****
 338  *--- Costs and attributes ---*
 339  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 340  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh]
 341  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 342  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 343  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 344   
 345  n_ev_e           Electric vehicle battery capacity [MWh]
 346  ev_quant         Overall number of electirc vehicles [#]
 347  phi_ev           Share of electric vehicles per load profile in actual scenario [0 1]
 348  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if yes 0 otherwise]
 349   
 350  *--- Temporal data ---*
 351  n_ev_p           Electric vehicle power rating [MWh]
 352  ev_ed            Electric vehicle electricity demand [MWh]
 353  ev_ged_exog      Electric vehicle grid electricity demand for exogenous charging pattern [MWh]
 354   
 355   
 356  ***** Prosumage *****
 357  phi_pro_load             Share of prosumagers among total load [0 1]
 358  phi_pro_self             Minimum self-generation shares for prosumagers [0 1]
 359  m_res_pro                Maximum installable: renewables capacity [MW]
 360  m_sto_pro_e              Maximum installable: storage energy [MWh]
 361  m_sto_pro_p              Maximum installable: storage capacity [MW]
 362  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 363   
 364   
 365  ***** Reserves *****
 366  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 367  reserves_intercept       Intercept of regression line determining reserves demand
 368  reserves_slope           Slope of regression line determining reserves demand
 369  reserves_reaction        Activation reaction time for reserves qualities [min]
 370  phi_reserves_pr_up       Positive primary reserves fraction of total nonprimary reserves demand [0 1]
 371  phi_reserves_pr_do       Negative primary reserves fraction of total nonprimary reserves demand [0 1]
 372  *reserves_exog
 373   
 374   
 375  ***** Heat *****
 376  *--- Time data ---*
 377  dh_upload                Hourly heat demand per year for upload [MWh per m2]
 378  dh_y                     Hourly heat demand per year [MWh per m2]
 379  dh                       Hourly heat demand [MWh per m2]
 380  temp_source              Heat pumps - source temperature [°Celsius]
 381  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2]
 382  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 383  d_dhw                    Hourly DHW demand [MWh per m2]
 384  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-time storage heaters [MWh per m2]
 385   
 386  *--- Technololgy attributes ---*
 387  phi_heat_type            Share of heating type ch per building archetype bu [0 1]
 388  eta_heat_stat            Static efficiency for heating technologies [0 1]
 389  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 390  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies [0 1]
 391  n_heat_p_in              Maximum power inflow into heating technologies [MW]
 392  n_heat_p_out             Maximum power outflow from heating technologies [MW]
 393  n_heat_e                 Maximum energy level of heating storage technologies [MWh]
 394  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 395  n_sets_p_out             SETS - Power rating - heat output [MW]
 396  n_sets_e                 SETS - Energy storage capacity [MWh]
 397  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electricity intake [MW]
 398  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW output [MW]
 399  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capacity [MWh]
 400  phi_heat_ini             Inititial storage level of heating technologies [0 1]
 401  temp_sink                Heat pumps - sink temperature [°Celsius]
 402  pen_heat_fuel            Penalty term for non-electric fuel usage for hybrid heating technologies [EUR per MWh]
 403  area_floor               Floor area subject to specific heating technology in specific building type [m2]
 404  theta_night              Indicator for night hours {0 1}
 405   
 406   
 407   
 408  ***************  DERIVED PARAMETERS  *******************************************
 409   
 410  c_m              Marginal production costs for conventional plants including variable O and M costs [EUR per MWh]
 411  c_i              Annualized investment costs by conventioanl plant [EUR per MW]
 412   
 413  c_i_res          Annualized investment costs by renewable plant [EUR per MW]
 414  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per a]
 415   
 416  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 417  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 418   
 419  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 420  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 421   
 422  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR per MW]
 423  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per MW]
 424   
 425  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 426   
 427  phi_mean_reserves_call_y         Hourly mean of share reserves called per year [0 1]
 428  phi_mean_reserves_call           Hourly mean of share reserves called [0 1]
 429   
 430  theta_dir        Dummy equal to 1 if building type bu has direct heating type ch [0 1]
 431  theta_sets       Dummy equal to 1 if building type bu has SETS heating type ch [0 1]
 432  theta_hp         Dummy equal to 1 if building type bu has heat pump heating type ch [0 1]
 433  theta_elec       Dummy equal to 1 if building type bu has hybrif electric heating - electric part [0 1]
 434  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric heating - fossil part [0 1]
 435  theta_storage    Dummy equal to 1 if building type ch has storage heating type ch [0 1]
 436   
 437   
 438   
 439   
 440  ***************  PARAMETERS FOR DATA UPLOAD  ***********************************
 441   
 442  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 443  technology_data(tech,headers_tech)
 444  storage_data(sto,headers_sto)
 445  reservoir_data(rsvr,headers_reservoir)
 446  time_data_upload(h,year,headers_time)
 447  dsm_data_upload(dsm,dsm_type,headers_dsm)
 448  dsm_data(dsm,headers_dsm)
 449  topology_data(l,headers_topology)
 450  ev_data(ev,headers_ev)
 451  ev_time_data_upload(h,headers_time_ev,ev)
 452  prosumage_data_generation(tech,headers_prosumage_generation)
 453  prosumage_data_storage(sto,headers_prosumage_storage)
 454  reserves_time_data_activation(h,year,reserves)
 455  reserves_time_data_provision(h,year,reserves)
 456  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)
 457  reserves_data(reserves,headers_reserves)
 458  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)
 459  heat_data(bu,ch,headers_heat)
 460  dh_upload(h,year,headers_time_heat,bu)
 461  d_dhw_upload(h,year,headers_time_heat,bu)
 462  temp_source_upload
 463  ;
 464   
 465   
 466   
 467   
 468  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  *********************
 469   
 529   
 530  *%skip_Excel%
 532   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\Data_input.gdx
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  rsvr = 8:rsvr
--- LOAD  headers_reservoir = 9:headers_reservoir
--- LOAD  reservoir_data = 31:reservoir_data
--- LOAD  dsm = 10:dsm
--- LOAD  headers_dsm = 11:headers_dsm
--- LOAD  dsm_type = 12:dsm_type
--- LOAD  technology_data_upload = 29:technology_data_upload
--- LOAD  storage_data = 30:storage_data
--- LOAD  dsm_data_upload = 32:dsm_data_upload
 537   
--- LOAD  ev = 13:ev
--- LOAD  headers_ev = 14:headers_ev
--- LOAD  ev_data = 34:ev_data
--- LOAD  headers_prosumage_generation = 15:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 16:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 35:prosumage_data_generation
--- LOAD  prosumage_data_storage = 36:prosumage_data_storage
--- LOAD  reserves = 17:reserves
--- LOAD  reserves_up_down = 19:reserves_up_down
--- LOAD  reserves_spin_nonspin = 20:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 21:reserves_prim_nonprim
--- LOAD  headers_reserves = 18:headers_reserves
--- LOAD  reserves_data_upload = 37:reserves_data_upload
--- LOAD  bu = 22:bu
--- LOAD  ch = 23:ch
--- LOAD  heat_storage = 24:heat_storage
--- LOAD  heat_hp = 25:heat_hp
--- LOAD  heat_elec = 26:heat_elec
--- LOAD  heat_fossil = 27:heat_fossil
--- LOAD  headers_heat = 28:headers_heat
--- LOAD  heat_data_upload = 38:heat_data_upload
 542  ;
 543   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 549   
 550   
 551  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  ***********************
 552   
 578   
 579   
 580   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 584  *$load headers_time_ev ev_time_data_upload
 585  *$load reserves_time_data_activation
 586  *$load reserves_time_data_provision
 587  *$load headers_time_heat dh_upload
 588  *$load theta_night
 589  *$load temp_source_upload
 590  *$load headers_time_dhw d_dhw_upload nets_profile
 591  ;
 592   
 593   
 594   
 595   
 596  ***************  ASSIGNMENTS  **************************************************
 597   
 598   
 599   
 600  ***** Aliases *****
 601  alias (h,hh) ;
 602  alias (res,resres) ;
 603  alias (reserves,reservesreserves) ;
 604  alias (nondis,nondisnondis) ;
 605   
 606   
 607   
 608  ***** Derived sets *****
 609  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'dis',headers_tech)) = yes;
 610  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'nondis',headers_tech)) = yes;
 611   
 612  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'con',tech_dispatch,headers_tech)) = yes;
 613  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'res',tech_dispatch,headers_tech)) = yes;
 614   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = yes;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 636   
 637   
 638   
 639  ***** Parameters *****
 640   
 641  *--- Generation technologies ---*
 642  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 643  eta(tech) = technology_data(tech,'eta_con') ;
 644  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 645  c_up(dis) =technology_data(dis,'load change costs up') ;
 646  c_do(dis) = technology_data(dis,'load change costs down') ;
 647  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 648  c_vom(tech) = technology_data(tech,'variable_om') ;
 649  CO2price(tech) = technology_data(tech,'CO2_price') ;
 650   
 651  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 652  lifetime(tech) = technology_data(tech,'lifetime') ;
 653  recovery(tech) = technology_data(tech,'recovery_period') ;
 654  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 655  m_p(tech) = technology_data(tech,'max_installable') ;
 656  m_e(tech) = technology_data(tech,'max_energy') ;
 657  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 658  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 659   
 660  c_cu(res) = technology_data(res,'curtailment_costs') ;
 661   
 662   
 663  *--- Storage technologies ---*
 664  c_m_sto(sto) = storage_data(sto,'mc');
 665  eta_sto(sto) = storage_data(sto,'efficiency');
 666  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 667  phi_sto_ini(sto) = storage_data(sto,'level_start');
 668  etop_max(sto) = storage_data(sto,'etop_max') ;
 669   
 670  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 671  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 672  lifetime(sto) = storage_data(sto,'lifetime');
 673  interest_rate(sto) = storage_data(sto,'interest_rate');
 674  m_sto_e(sto) = storage_data(sto,'max_energy');
 675  m_sto_p(sto) = storage_data(sto,'max_power');
 676   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',headers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',headers_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,headers_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate')   ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 718   
 719  *--- Temporal data ---*
 720  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 721  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_data_upload(h,year,headers_time));
 722   
 723  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), time_data_upload(h,year,headers_time));
 724  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,year,reserves) ;
 725  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,year,reserves) ;
 726   
 727   
 728  *--- Spatial data ---*
 729  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 730  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 731  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 732  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 733  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 734  *m_ntc(l) = topology_data(l,'max_installable') ;
 735  *dist(l) = topology_data(l,'distance') ;
 736   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 753   
 754  *--- Prosumage ---*
 755  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 756  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 757  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 758  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 759   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_off') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_fossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw') ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_source') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_source') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply') ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 805   
 806   
 807  ***************  CALCULATE DERIVED PARAMETERS  *********************************
 808   
 809  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2price(tech) + c_vom(tech)   ;
 810   
 811  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate(tech))**(lifetime(tech)) )
 812                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       ;
 813   
 814  c_i_res(res) = c_i(res) ;
 815  c_fix_res(res) = c_fix(res) ;
 816   
 817  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 818                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 819   
 820  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 821                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_interest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_interest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 ) ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AND phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AND phi_heat_type(bu,ch)) = 1;
 850   
 851   
 852  ***************  Adjust costs to model's hourly basis **************************
 853   
 854  c_i(tech) = c_i(tech)*card(h)/8760 ;
 855  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 856  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 857  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 858  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 859  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 860  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 861  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 862   
 863  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 864  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 865  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 866  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 867  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 868   
 869  m_e('bio') = m_e('bio')*card(h)/8760 ;
 870   
 871  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 872   
 873  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 874  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 875  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(dsm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 876  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 877   
 878   
 879   
 880  ********************************************************************************
 881   
 882   
 883   
 884   
 885   
 886   
 887   
 888   
 889   
 890  ********************************************************************************
 891   
 892  ***************************
 893  ***** Initialize data *****
 894  ***************************
 895   
 896  * Parameters for default base year
 897  d(h) = d_y('2030',h) ;
 898  phi_res(res,h) = phi_res_y('2030',res,h) ;
 899  phi_min_res = 0 ;
 900  phi_pro_self = 0 ;
 901  phi_pro_load = 0 ;
 902   
      phi_pro_load = 0.2 ;
      $ontext
 907   
 908   
 909  Parameter
 910  phi_min_res_exog;
 911  phi_min_res_exog = 1 ;
 912   
 913  Sets
 914  h_ini(h)                       First hour  /h1/
 915  *h_end(h)                       Last hour   /h8760/
 916  ;
 917   
 918  ********************************************************************************
 919  ***** Model *****
 920  ********************************************************************************
 921   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\model.gms
 923   
 924  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 934  ********************************************************************************
 935   
 936   
 937  Variables
 938  Z                  Value objective function [Euro]
 939  lambda_enerbal     Dual variable on energy balance (1a)
 940  lambda_resgen      Dual variable on renewable generation (3e)
 941  lambda_convgen     Dual variable on conventional generation level (2a)
 942  lambda_stolev      Dual variable on storage level  (4b)
 943  ;
 944   
 945  Positive Variables
 946  G_L(tech,h)            Generation level in hour h [MWh]
 947  G_UP(tech,h)           Generation upshift in hour h [MWh]
 948  G_DO(tech,h)           Generation downshift in hour h [MWh]
 949  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 950  CU(tech,h)             Renewables curtailment technology res in hour h [MWh]
 951   
 952  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 953  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 954  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 955   
 956  N_TECH(tech)           Technology tech built [MW]
 957  N_STO_E(sto)           Storage technology built - Energy [MWh]
 958  N_STO_P(sto)           Storage loading and discharging capacity built - Capacity [MW]
 959   
 960  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generation in hour h [MWh]
 961  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h [MWh]
 962  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market in hour h [MWh]
 963  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in hour h [MWh]
 964  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation for discharging to consumption in hour h [MWh]
 965  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumption from generation in hour h [MWh]
 966  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to consumption in hour h [MWh]
 967  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 968  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 969  N_RES_PRO(tech)                Prosumage: installed renewables capacities [MW]
 970   
 971   
 972  mu_stoin_cap          Dual variable on storage loading capacity constraint (4d)
 973  mu_stout_cap          Dual variable on storage discharging capacity constraint (4e)
 974  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 975  mu_conv_cap           Dual variable on conventional generation capacity constraint (3a)
 976  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 977  mu_dis_max_i          Dual variable on dispatchable installation constraint (8a)
 978  mu_nondis_max_i       Dual variable on nondispatchable installation constraint (8a)
 979  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 980  mu_stop_max_i         Dual variable on storage power installation constraint  (8c)
 981  mu_stoe_max_i         Dual variable on storage energy installation constraint  (8b)
 982  mu_minRES             Dual variable on minimum renewable share constraint (5a)
 983   
 984  ;
 985   
 986  Set
 987  dis_bio(tech)          Subset of dispatchable technology: Bio mass        /bio/
 988  ;
 989   
 990   
 991  ********************************************************************************
 992   
 993  Equations
 994  * Objective
 995  obj                      Objective cost minimization
 996   
 997  * Energy balance
 998  con1a_bal                Energy Balance
 999   
1000  * Load change costs
1001  con2a_loadlevel          Load change costs: Level
1002  con2b_loadlevelstart     Load change costs: Level for first period
1003  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
1004  * Capacity contraints and flexibility constraints
1005  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1006  con3e_maxprod_res                Capacity constraints renewables
1007   
1008  * Storage constraints
1009  con4a_stolev_start        Storage Level Dynamics Initial Condition
1010  con4b_stolev              Storage Level Dynamics
1011  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
1012  con4c_stolev_max          Storage Power Capacity
1013  con4d_maxin_sto           Storage maximum inflow
1014  con4e_maxout_sto          Storage maximum outflow
1015  con4j_ending              End level equal to initial level
1016  con4k_PHS_EtoP            Maximum E-P ratio
1017   
1018  * Minimum restrictions for renewables and biomass
1019  con5a_minRES             Minimum yearly renewables requirement
1020  con5b_max_energy         Maximum yearly biomass energy
1021   
1022  * Maximum installation conditions
1023  con8a_max_I_power                Maximum installable capacity: Conventionals
1024  con8b_max_I_sto_e                Maximum installable energy: Storage energy in MWh
1025  con8c_max_I_sto_p                Maximum installable capacity: Storage inflow-outflow in MW
1026   
1027  con8f_max_pro_res                Maximum installable capacity: prosumage renewables
1028  con8g_max_pro_sto_e              Maximum installable capacity: prosumage storage energy
1029  con8h_max_sto_pro_p              Maximum installable capacity: prosumage storage power
1030   
1031  * Prosumage
1032  con11a_pro_distrib                       Prosumage: distribution of generated energy
1033  con11b_pro_balance                       Prosumage: energy balance
1034  con11c_pro_selfcon                       Prosumage: minimum self-generation requirement
1035  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumager-to-prosumagers
1036  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial conditions
1037  con11j_pro_stolev_max                    Prosumage: maximum overall storage level
1038  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1039  con11l_pro_maxout_sto                    Prosumage: maximum storage outflow
1040  con11o_pro_ending                        Prosumage: storage ending condition
1041   
1042   
1043  * KKT optimality conditions
1044  KKTG_L                   KKT w.r.t. G_L
1045  KKTG_UP                  KKT w.r.t. G_UP
1046  KKTG_DO                  KKT w.r.t. G_DO
1047  KKTG_RES                 KKT w.r.t. G_RES
1048  KKTCU                    KKT w.r.t. CU
1049  KKTSTO_IN                KKT w.r.t. STO_IN
1050  KKTSTO_OUT               KKT w.r.t. STO_OUT
1051  KKTSTO_L                 KKT w.r.t. STO_L
1052  KKTN_TECH_NONDIS         KKT w.r.t. N_TECH(nondis)
1053  KKTN_TECH_DIS            KKT w.r.t. N_TECH(dis)
1054  KKTN_TECH                KKT w.r.t. N_TECH
1055  KKTN_STO_E               KKT w.r.t. N_STO_E
1056  KKTN_STO_P               KKT w.r.t. N_STO_P
1057  ;
1058   
1059   
1060  ********************************************************************************
1061   
1062  * ---------------------------------------------------------------------------- *
1063  ***** Objective function *****
1064  * ---------------------------------------------------------------------------- *
1065   
1066  obj..
1067           Z =E=
1068                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1069                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1070                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1071                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1072                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN(sto,h) ) )
1073                   + sum( tech , c_i(tech)*N_TECH(tech) )
1074                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1075                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1076                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)) )
1077                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E_PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1087  ;
1088   
1089  * ---------------------------------------------------------------------------- *
1090  ***** Energy balance and load levels *****
1091  * ---------------------------------------------------------------------------- *
1092   
1093  * Energy balance
1094  con1a_bal(h)..
1095   
1096             sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h)) + sum( sto , STO_OUT(sto,h) )
               + sum( res , G_MARKET_PRO2M(res,h) )
      $ontext
1101           -  ( 1 - phi_pro_load )* d(h)
1102           -   sum( sto , STO_IN(sto,h) )
1103   
               - G_MARKET_M2PRO(h)
      $ontext
1108   
1109         =E= 0
1110  ;
1111   
1112  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1113           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1114  ;
1115   
1116  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1117          G_UP(dis,h) - G_L(dis,h) =E= 0
1118  ;
1119   
1120  con2_loadlevel(dis,h)..
1121             G_UP(dis,h)  - G_L(dis,h)
1122          +  (G_L(dis,h-1) - G_DO(dis,h))$(ord(h) > 1)
1123          =E= 0
1124  ;
1125   
1126   
1127   
1128  * ---------------------------------------------------------------------------- *
1129  ***** Hourly maximum generation caps *****
1130  * ---------------------------------------------------------------------------- *
1131   
1132  con3a_maxprod_dispatchable(dis,h)..
1133   
1134           N_TECH(dis) -  G_L(dis,h)  =G= 0
1135   
1136  ;
1137   
1138  con3e_maxprod_res(nondis,h)..
1139   
1140   
1141         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =E= 0
1142  ;
1143   
1144  * ---------------------------------------------------------------------------- *
1145  ***** Storage constraints *****
1146  * ---------------------------------------------------------------------------- *
1147   
1148  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1149          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1150  ;
1151   
1152  con4b_stolev(sto,h)$(ord(h)>1)..
1153          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1154  ;
1155   
1156  con4_stolev(sto,h)..
1157   
1158         + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h)
1159         + (STO_L(sto,h-1))$(ord(h)>1)
1160         =E= 0
1161  ;
1162   
1163   
1164  con4c_stolev_max(sto,h)..
1165         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1166  ;
1167   
1168  con4d_maxin_sto(sto,h)..
1169   
1170          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1171  ;
1172   
1173  con4e_maxout_sto(sto,h)..
1174   
1175          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1176  ;
1177   
1178  con4j_ending(sto,h)$(ord(h) = card(h))..
1179   
1180          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1181  ;
1182   
1183   
1184  con4k_PHS_EtoP(sto)..
1185           etop_max(sto) * N_STO_P(sto) - N_STO_E(sto) =G= 0
1186  ;
1187   
1188  * ---------------------------------------------------------------------------- *
1189  ***** Quotas for renewables and biomass *****
1190  * ---------------------------------------------------------------------------- *
1191   
1192  con5a_minRES..
1193  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1194   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + sum( (res) , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1199  )
1200          - phi_min_res * phi_min_res_exog * sum( h ,
1201           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1202   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1207           )  =G= 0
1208  ;
1209   
1210  con5b_max_energy(tech)$dis_bio(tech)..
1211           m_e(tech) -  sum( h , G_L(tech,h) ) =G= 0
1212  ;
1213   
1214   
1215  * ---------------------------------------------------------------------------- *
1216  ***** Maximum installation constraints *****
1217  * ---------------------------------------------------------------------------- *
1218   
1219  con8a_max_I_power(tech)..
1220         m_p(tech) - N_TECH(tech)     =G= 0
1221  ;
1222   
1223  con8b_max_I_sto_e(sto)..
1224         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1225  ;
1226   
1227  con8c_max_I_sto_p(sto)..
1228         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1229  ;
1230   
1231   
1232   
1233  con8f_max_pro_res(res)..
1234         m_res_pro(res) -  N_RES_PRO(res)     =G= 0
1235  ;
1236   
1237  con8g_max_pro_sto_e(sto)..
1238         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1239  ;
1240   
1241  con8h_max_sto_pro_p(sto)..
1242          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1243  ;
1244   
1245  * ---------------------------------------------------------------------------- *
1246  ***** Prosumage constraints *****
1247  * ---------------------------------------------------------------------------- *
1248   
1249  con11a_pro_distrib(res,h)..
1250           phi_res(res,h) * N_RES_PRO(res)
1251           =E=
1252           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( sto , STO_IN_PRO2PRO(res,sto,h) )
1253  ;
1254   
1255  con11b_pro_balance(h)..
1256           phi_pro_load * d(h)
1257           =E=
1258           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1259  ;
1260   
1261  con11c_pro_selfcon..
1262           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PRO(sto,h) )
1263           =G=
1264           phi_pro_self * sum( h , phi_pro_load * d(h))
1265  ;
1266   
1267  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1268           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1269  ;
1270   
1271   
1272  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1273          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1274  ;
1275   
1276   
1277  con11j_pro_stolev_max(sto,h)..
1278         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1279  ;
1280   
1281  con11k_pro_maxin_sto(sto,h)..
1282          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1283          =G= 0
1284  ;
1285   
1286  con11l_pro_maxout_sto(sto,h)..
1287          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1288          =G= 0
1289  ;
1290   
1291  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1292           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1293  ;
1294   
1295  * ---------------------------------------------------------------------------- *
1296  ***** FOC conditions *****
1297  * ---------------------------------------------------------------------------- *
1298   
1299  KKTG_L(tech,h)$dis(tech)..
1300   
1301      + c_m(tech)
1302      - lambda_enerbal(h)
1303      +  lambda_convgen(tech,h)
1304      + mu_conv_cap(tech,h)
1305      + mu_bio_cap(tech)$dis_bio(tech)
1306     - (lambda_convgen(tech,h+1))$(ord(h) > 1)
1307      =G= 0
1308   
1309  ;
1310   
1311  KKTG_UP(dis,h)..
1312   
1313       - lambda_convgen(dis,h)
1314       + (c_up(dis))$(ord(h)> 1)
1315     =G= 0
1316   
1317  ;
1318   
1319  KKTG_DO(dis,h)..
1320   
1321       + c_do(dis)
1322       + (lambda_convgen(dis,h))$(ord(h) > 1)
1323       =G= 0
1324   
1325  ;
1326   
1327  KKTG_RES(nondis,h)..
1328   
1329       - lambda_enerbal(h) + lambda_resgen(nondis,h)
1330       =G= 0
1331  ;
1332   
1333  KKTCU(nondis,h)..
1334   
1335       c_cu(nondis) + lambda_resgen(nondis,h) =G= 0
1336   
1337  ;
1338   
1339  KKTSTO_IN(sto,h)..
1340   
1341      c_m_sto(sto)  + lambda_enerbal(h) -  lambda_stolev(sto,h)*(1+eta_sto(sto))/2
1342      + mu_stoin_cap(sto,h) =G= 0
1343  ;
1344   
1345  KKTSTO_OUT(sto,h)..
1346   
1347       c_m_sto(sto)  -  lambda_enerbal(h) +  lambda_stolev(sto,h)/(1+eta_sto(sto))*2
1348       +  mu_stout_cap(sto,h)
1349        =G= 0
1350  ;
1351   
1352  KKTSTO_L(sto,h)..
1353   
1354    + lambda_stolev(sto,h)
1355    +  mu_stolev_cap(sto,h)
1356    -  (lambda_stolev(sto,h+1))$(ord(h) > 1 )
1357   
1358    =G= 0
1359   
1360  ;
1361   
      KKTN_TECH_NONDIS(nondis)..
       
          c_i(nondis) +  c_fix(nondis)
          - sum( h,  lambda_resgen(nondis,h)*phi_res(nondis,h)) + mu_nondis_max_i(nondis)
          =G= 0
      ;
       
      KKTN_TECH_DIS(dis)..
       
           c_i(dis) +  c_fix(dis) - sum( h,  lambda_convgen(dis,h)) +  mu_dis_max_i(dis)
           =G= 0
       
      ;
1377   
1378  KKTN_TECH(tech)..
1379   
1380            +  c_i(tech)
1381            +  c_fix(tech)
1382            +  mu_tech_max_i(tech)
1383            - sum( h,   mu_conv_cap(tech,h))$dis(tech)
1384            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis(tech)
1385       =G= 0
1386   
1387  ;
1388   
1389   
1390   
1391  KKTN_STO_E(sto)..
1392   
1393        +  c_fix_sto(sto)/2 +  c_i_sto_e(sto)
1394        -  sum( h,   mu_stolev_cap(sto,h))
1395        +  mu_stoe_max_i(sto)
1396        =G= 0
1397  ;
1398   
1399  KKTN_STO_P(sto)..
1400   
1401   
1402       c_fix_sto(sto)/2 + c_i_sto_p(sto)
1403       - sum( h, (mu_stoin_cap(sto,h) + mu_stout_cap(sto,h)))
1404       + mu_stop_max_i(sto)
1405       =G= 0
1406   
1407  ;
1408   
1409   
1410  ********************************************************************************
1411  ***** Fix unmatched variables of first period *****
1412  ********************************************************************************
1413   
1414  G_DO.fx(dis,'h1') = 0;
1415   
1416  * Default for reporting
1417  G_DO.l(dis,h) = 0;
1418  G_L.l(dis,h) = 0 ;
1419  G_UP.l(dis,h) = 0 ;
1420  G_RES.l(tech,h)= 0;
1421  CU.l(tech,h) = 0;
1422   
1423  STO_IN.l(sto,h)= 0;
1424  STO_OUT.l(sto,h)= 0;
1425  STO_L.l(sto,h) = 0;
1426   
1427  N_TECH.l(tech)= 0;
1428  N_STO_E.l(sto)= 0;
1429  N_STO_P.l(sto)= 0;
1430   
1431   
1432  ********************************************************************************
1433  ***** MODEL *****
1434  ********************************************************************************
1435   
1436  model DIETER /
1437  obj
1438   
1439  con1a_bal
1440   
1441  *con2a_loadlevel
1442  *con2b_loadlevelstart
1443  con2_loadlevel
1444   
1445  con3a_maxprod_dispatchable
1446  con3e_maxprod_res
1447   
1448  *con4a_stolev_start
1449  *con4b_stolev
1450  con4_stolev
1451  con4c_stolev_max
1452  con4d_maxin_sto
1453  con4e_maxout_sto
1454  *con4k_PHS_EtoP
1455  *con4j_ending
1456   
1457  con5a_minRES
1458  con5b_max_energy
1459   
1460  con8a_max_I_power
1461  con8b_max_I_sto_e
1462  con8c_max_I_sto_p
1463   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1479   
1480  /;
1481   
1482  model DIETER_MCP /
1483   
1484   
1485  con1a_bal.lambda_enerbal
1486  con2_loadlevel.lambda_convgen
1487   
1488  con3a_maxprod_dispatchable.mu_conv_cap
1489  con3e_maxprod_res.lambda_resgen
1490   
1491  con4_stolev.lambda_stolev
1492  con4c_stolev_max.mu_stolev_cap
1493  con4d_maxin_sto.mu_stoin_cap
1494  con4e_maxout_sto.mu_stout_cap
1495   
1496  con5b_max_energy.mu_bio_cap
1497  con8a_max_I_power.mu_tech_max_i
1498  con8b_max_I_sto_e.mu_stoe_max_i
1499  con8c_max_I_sto_p.mu_stop_max_i
1500   
1501  KKTG_L.G_L
1502  KKTG_UP.G_UP
1503  KKTG_DO.G_DO
1504  KKTG_RES.G_RES
1505  KKTCU.CU
1506  KKTSTO_IN.STO_IN
1507  KKTSTO_OUT.STO_OUT
1508  KKTSTO_L.STO_L
1509  KKTN_TECH.N_TECH
1510  KKTN_STO_E.N_STO_E
1511  KKTN_STO_P.N_STO_P
1512   
1513  / ;
1514   
1515  ********************************************************************************
1516  ***** Options, fixings, report preparation *****
1517  ********************************************************************************
1518   
1519  * Solver options
1525   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1536   
1537  dieter.OptFile = 1;
1538  dieter.holdFixed = 1 ;
1539   
1540   
1541  ********************************************************************************
1542  ***** Solve *****
1543  ********************************************************************************
1544   
1545  * Preparation of GUSS tool for scenario analysis
1546  phi_min_res = eps ;
1547  phi_pro_self = eps ;
1548   
1550   
1551  Set
1552  modelstats       model stats collection                  /modelstat, solvestat, resusd/
1553  superscen        Scenarios                               /scen1*scen1000/
1554  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_share.#loop_prosumage)/
1555  ;
1556   
1557  set
1558  scen(superscen);
1559  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(superscen,loop_res_share,loop_prosumage)) )    ;
1560   
1561  Parameters
1562  gussoptions                              /Logoption 2, Optfile 1, Skipbasecase 1/
1563  modstats(superscen, modelstats)
1564  min_res
1565  pro_selfcon
1566  ;
1567   
1568  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_res_share.val/100 ) ;
1569  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_prosumage.val/100 ) ;
1570   
1571  Parameters
1572  * Equations
1573  marginal_con5a(superscen)
1574  marginal_con1a(superscen,*)
1575  marginal_con9a(superscen,*,*,*)
1576  marginal_con9b(superscen,*,*,*)
1577   
1578  * Basic
1579  lev_Z(superscen)
1580  lev_G_L(superscen,tech,h)
1581  lev_G_UP(superscen,tech,h)
1582  lev_G_DO(superscen,tech,h)
1583  lev_G_RES(superscen,tech,h)
1584  lev_CU(superscen,tech,h)
1585  lev_STO_IN(superscen,sto,h)
1586  lev_STO_OUT(superscen,sto,h)
1587  lev_STO_L(superscen,sto,h)
1588  lev_N_TECH(superscen,tech)
1589  lev_N_STO_E(superscen,sto)
1590  lev_N_STO_P(superscen,sto)
1591   
1592   
1593  * Prosumage
1594  lev_CU_PRO(superscen,tech,h)
1595  lev_G_MARKET_PRO2M(superscen,tech,h)
1596  lev_G_MARKET_M2PRO(superscen,h)
1597  lev_G_RES_PRO(superscen,tech,h)
1598  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1599  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1600  lev_STO_IN_M2PRO(superscen,sto,h)
1601  lev_STO_IN_M2M(superscen,sto,h)
1602  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1603  lev_STO_OUT_PRO2M(superscen,sto,h)
1604  lev_STO_OUT_M2PRO(superscen,sto,h)
1605  lev_STO_OUT_M2M(superscen,sto,h)
1606  lev_STO_L_PRO2PRO(superscen,sto,h)
1607  lev_STO_L_PRO2M(superscen,sto,h)
1608  lev_STO_L_M2PRO(superscen,sto,h)
1609  lev_STO_L_M2M(superscen,sto,h)
1610  lev_N_STO_E_PRO(superscen,sto)
1611  lev_N_STO_P_PRO(superscen,sto)
1612  lev_STO_L_PRO(superscen,sto,h)
1613  lev_N_RES_PRO(superscen,tech)
1614  ;
1615   
1616   
1617  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\fix.gms
1619   
1620  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1630  ********************************************************************************
1631   
1632   
1633   
1634  ********************************************************************************
1635  **** Run of river  *************************************************************
1636  ********************************************************************************
1637   
1638  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('ror') (but no reserve provision):
1639   
1640  *$ontext
1641  N_TECH.fx('ror') = 5857.47 ;
1642  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1645   
1646  * Fix everything to zero in case no ROR option is selected:
1647  *N_TECH.fx('ror') = 0 ;
1648  *G_RES.fx('ror',h) = 0 ;
1649  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1650   
1651   
1652  ********************************************************************************
1653  **** No storage and DSM in first period  ***************************************
1654  ********************************************************************************
1655   
1656  ** No storage inflow in first period **
1657  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1658   
1659   
1660   
1661  ********************************************************************************
1662  **** No primary reserves by heating devices  ***********************************
1663  ********************************************************************************
1664   
1665   
1666  ********************************************************************************
1667  **** Fixing to reduce model size  **********************************************
1668  ********************************************************************************
1669   
1670  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1671  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1672   
1673  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1674  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1675  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1676  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1677  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1678  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1679   
1680  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1681  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1682  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1683  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1684  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1685   
1686   
1687  Variables
1688  STO_IN_PRO2M(tech,sto,h)
1689  STO_IN_M2PRO(sto,h)
1690  STO_IN_M2M(sto,h)
1691  STO_OUT_PRO2M(sto,h)
1692  STO_OUT_M2PRO(sto,h)
1693  STO_OUT_M2M(sto,h)
1694  STO_L_PRO(sto,h)
1695  STO_L_PRO2M(sto,h)
1696  STO_L_M2PRO(sto,h)
1697  STO_L_M2M(sto,h)
1698  ;
1699   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1723   
1724  * Deactivated market storage links
1725   
1726  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1727  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1728  STO_IN_M2M.fx(sto,h)       = 0 ;
1729  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1730  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1731  STO_OUT_M2M.fx(sto,h)      = 0 ;
1732  STO_L_PRO.fx(sto,h)        = 0 ;
1733  STO_L_PRO2M.fx(sto,h)      = 0 ;
1734  STO_L_M2PRO.fx(sto,h)      = 0 ;
1735  STO_L_M2M.fx(sto,h)        = 0 ;
1736   
1737  ********************************************************************************
1738  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *************************************
1739  ********************************************************************************
1740   
1741  * Default level zero for report parameters
1742  lev_Z(scen) = 0 ;
1743  lev_G_L(scen,tech,h) = 0 ;
1744  lev_G_UP(scen,tech,h) = 0 ;
1745  lev_G_DO(scen,tech,h) = 0 ;
1746  lev_G_RES(scen,tech,h) = 0 ;
1747  lev_CU(scen,tech,h) = 0 ;
1748  lev_STO_IN(scen,sto,h) = 0 ;
1749  lev_STO_OUT(scen,sto,h) = 0 ;
1750  lev_STO_L(scen,sto,h) = 0 ;
1751  lev_N_TECH(scen,tech) = 0 ;
1752  lev_N_STO_E(scen,sto) = 0 ;
1753  lev_N_STO_P(scen,sto) = 0 ;
1754  marginal_con1a(scen,h) = 0 ;
1755  marginal_con5a(superscen) = 0 ;
1756   
1757  * Prosumage
1758  lev_CU_PRO(scen,tech,h) = 0 ;
1759  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1760  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1761  lev_G_RES_PRO(scen,tech,h) = 0  ;
1762  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1763  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1764  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1765  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1766  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1767  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1768  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1769  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1770  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1771  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1772  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1773  lev_STO_L_M2M(scen,sto,h) = 0  ;
1774  lev_N_STO_E_PRO(scen,sto) = 0  ;
1775  lev_N_STO_P_PRO(scen,sto) = 0  ;
1776  lev_STO_L_PRO(scen,sto,h) = 0  ;
1777  lev_N_RES_PRO(scen,tech) = 0  ;
1778   
1779   
1780  * Fixing of report parameters for run-of-river
1781  *$ontext
1782  lev_N_TECH(scen,'ror') = 5857.47 ;
1783  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1793   
1794   
1795   
1796   
1797   
1798   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\scenario.gms
1800   
1801  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1811  ********************************************************************************
1812   
1813   
1814   
1815   
1816  *****************************************
1817  **** Scenario file                   ****
1818  ****                                 ****
1819  *****************************************
1820   
1821  Parameter
1822  m_exog_p(tech)
1823  m_exog_sto_e(sto)
1824  m_exog_sto_p(sto)
1825  *m_exog_rsvr_p(rsvr)
1826  *m_exog_ntc(l)
1827  ;
1828   
1829  m_exog_p(tech) = technology_data(tech,'fixed_capacities') ;
1830  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1831  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1832  *m_exog_rsvr_p(rsvr) = reservoir_data(rsvr,'fixed_capacities_power');
1833  *m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
1834   
1835   
1836  *** Dispatch model
      N_TECH.lo(tech) = m_exog_p(tech) ;
      N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
      N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
      N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
      N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo('OCGT') = m_exog_p('OCGT') ;
      *N_TECH.up('OCGT') = inf ;
1853   
1854  *** Investment model
1855  *$ontext
1856  N_TECH.lo(tech) = 0 ;
1857  N_TECH.lo('wind_on') = m_exog_p('wind_on') ;
1858  N_TECH.lo('wind_off') = m_exog_p('wind_off') ;
1859  N_TECH.lo('pv') = m_exog_p('pv') ;
1860  N_STO_P.lo(sto) = m_exog_sto_p(sto) ;
1861  N_STO_E.lo(sto) = m_exog_sto_e(sto) ;
1862  *N_RSVR_P.lo(rsvr) =  m_exog_rsvr_p(rsvr) ;
1863  *NTC.lo(l) = m_exog_ntc(l) ;
1864   
1865  N_TECH.up(tech) = m_exog_p(tech) + 0.1 ;
1866  N_TECH.up('wind_on') = inf ;
1867  N_TECH.up('wind_off') = inf ;
1868  N_TECH.up('pv') = inf ;
1869  N_STO_P.up(sto) = m_exog_sto_p(sto) + 0.1 ;
1870  N_STO_E.up(sto) = m_exog_sto_e(sto) + 0.1 ;
1871  N_STO_P.up('sto1') = inf ;
1872  N_STO_P.up('sto5') = inf ;
1873  N_STO_P.up('sto7') = inf ;
1874  N_STO_E.up('sto1') = inf ;
1875  N_STO_E.up('sto5') = inf ;
1876  N_STO_E.up('sto7') = inf ;
1877  *N_RSVR_P.up(rsvr) =  m_exog_rsvr_p(rsvr) + 0.1 ;
1878  *NTC.up(l) = m_exog_ntc(l) + 0.1 ;
1879  *$offtext
1880   
1881   
1882  *** Reservoir assumption - not used here
1883  *phi_rsvr_lev_min(rsvr) = 0.0 ;
1884  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
1885  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
1886  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
1887   
1888   
1889  *** Germany only, no infeasibility
1890  *NTC.fx(l) = 0 ;
1891  *F.fx(l,h) = 0 ;
1892  *G_INFES.fx(h) = 0 ;
1893   
1894   
      *** Heating
      Parameter
      security_margin_n_heat_out /1.0/
      ;
       
      * Parameterization of water-based heat storage
      n_heat_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) + d_dhw(bu,ch,h) ) ;
      n_heat_e(bu,ch) = 3 * n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,ch) = n_heat_p_out(bu,ch) ;
      n_heat_p_in(bu,'hp_gs') = n_heat_p_out(bu,'hp_gs') / ( eta_heat_dyn(bu,'hp_gs') * (temp_sink(bu,'hp_gs')+273.15) / (temp_sink(bu,'hp_gs') - 10) ) ;
      * at least -5°C; applied to 98% of hoursn; minimum: -13.4
      n_heat_p_in(bu,'hp_as') = n_heat_p_out(bu,'hp_as') / ( eta_heat_dyn(bu,'hp_as') * (temp_sink(bu,'hp_as')+273.15) / (temp_sink(bu,'hp_as') + 5) ) ;
       
      * Parameterization of SETS
      n_sets_p_out(bu,ch) = security_margin_n_heat_out * smax( h , dh(bu,ch,h) ) ;
      n_sets_p_in(bu,ch) = 2 * n_sets_p_out(bu,ch) ;
      n_sets_e(bu,ch) = 16 * n_sets_p_out(bu,ch) ;
       
      * Parameterization of DHW SETS
      n_sets_dhw_p_out(bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(bu,ch,h) ) ;
      n_sets_dhw_p_in(bu,ch) = n_sets_dhw_p_out(bu,ch) ;
      n_sets_dhw_e(bu,ch) = 2.2 * n_sets_dhw_p_out(bu,ch) ;
       
      *RP_SETS_AUX.fx(reserves,bu,ch,h) = 0 ;
      *RP_SETS.fx(reserves,bu,ch,h) = 0 ;
      *RP_HP.fx(reserves,bu,ch,h) = 0 ;
      *RP_H_ELEC.fx(reserves,bu,ch,h) = 0 ;
       
1925   
1926   
1927  * Definition of dictionary set for GUSS tool
1928   
1929  Set dict(*,*,*) /
1930  scen             .scenario       .''
1931  gussoptions      .opt            .modstats
1932   
1933  phi_min_res      .param          .min_res
1934   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1939   
1940   
1941  con5a_minRES     .marginal       .marginal_con5a
1942  con1a_bal        .marginal       .marginal_con1a
1943   
1944   
1945  *$ontext
1946  Z                .level          .lev_Z
1949  G_L              .level          .lev_G_L
1950  G_UP             .level          .lev_G_UP
1951  G_DO             .level          .lev_G_DO
1952  G_RES            .level          .lev_G_RES
1953  CU               .level          .lev_CU
1954  STO_IN           .level          .lev_STO_IN
1955  STO_OUT          .level          .lev_STO_OUT
1956  STO_L            .level          .lev_STO_L
1957  N_TECH           .level          .lev_N_TECH
1958  N_STO_E          .level          .lev_N_STO_E
1959  N_STO_P          .level          .lev_N_STO_P
1960   
1961   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1975  /
1976  ;
1977   
1978   
1979   
1980  *$ontext
1981  solve  DIETER using lp min Z scenario dict;
1982   
1983   
1984   
1985  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\report.gms
1987   
1988  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1998  ********************************************************************************
1999   
2001   
2002   
2003   
2004   
2005  ********************************************************************************
2006  **** Parameters for report file  ***********************************************
2007  ********************************************************************************
2008   
2009  Parameter
2010  corr_fac_dis             Balancing correction factor - dispatchable technologies
2011  corr_fac_nondis          Balancing correction factor - nondispatchable technologies
2012  corr_fac_sto             Balancing correction factor - storage technologies
2013  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment technologies
2014  corr_fac_dsm_shift       Balancing correction factor - DSM shifting technologies
2015  corr_fac_ev              Balancing correction factor - electric vehicles
2016  corr_fac_rsvr            Balancing correction factor - reservoir
2017  corr_fac_sets            Balancing correction factor - SETS
2018  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2019  corr_fac_hp              Balancing correction factor - heat pumps
2020  corr_fac_h_elec          Balancing correction factor - hybrid electric storage heating
2021   
2022  corr_fac_ev_sep
2023   
2024  gross_energy_demand                      Gross energy demand
2025  gross_energy_demand_market               Gross energy demand - market (non-prosumage segment)
2026  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2027  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers self-generated
2028  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers from market
2029   
2030  reserves_activated
2031   
2032  calc_maxprice
2033  calc_minprice
2034   
2035  report
2036  report_tech
2037  report_tech_hours
2038  report_hours
2039  report_node
2040  report_line
2041  report_cost
2042   
2043  report_reserves
2044  report_reserves_hours
2045  report_reserves_tech
2046  report_reserves_tech_hours
2047   
2048  report_prosumage
2049  report_prosumage_tech
2050  report_prosumage_tech_hours
2051  report_market
2052  report_market_tech
2053  report_market_tech_hours
2054   
2055  report_heat_tech_hours
2056  report_heat_tech
2057  ;
2058   
2059   
2060   
2061   
2062  ********************************************************************************
2063  **** Initialize reporting paremetrs  *******************************************
2064  ********************************************************************************
2065   
2066  * Set reporting sensitivity. All results below will be reported as zero
2067  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        / 1e-4 / ;
2068  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         / 1e-2 / ;
2069  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   / 1 /    ;
2070   
2071   
2072  * ----------------------------------------------------------------------------
2073   
2074  * Min and max for prices
2075  calc_maxprice = 0 ;
2076  calc_minprice = 1000 ;
2077   
2078   
2079  * ----------------------------------------------------------------------------
2080   
2081  * Default values for correction factors
2082  corr_fac_dis(scen,dis,h) = 0 ;
2083  corr_fac_nondis(scen,nondis,h) = 0 ;
2084  corr_fac_sto(scen,sto,h) = 0 ;
2085  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2086  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2087  *corr_fac_ev(scen,h) = 0 ;
2088  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2089  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2090  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2091  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2092  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2093   
2094  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2095   
2096   
2097  * ----------------------------------------------------------------------------
2098   
2099  * Parameter for hourly nodal reserves activated
2100  reserves_activated(scen,h) = 0 ;
2101   
2102   
2103   
2104   
2105   
2106  * ----------------------------------------------------------------------------
2107   
2108  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(scen,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2115   
2116   
2117  * ----------------------------------------------------------------------------
2118   
2119  *Determine balancing correction factors
2120   
2121   
2122   
2123   
2124  * ----------------------------------------------------------------------------
2125   
2126  * Define gross energy demand for reporting
2127  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(scen,sto,h) - lev_STO_OUT_M2PR
      O(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2132   
2133   
2134  )
2135  ;
2136   
2137   
2138  ********************************************************************************
2139  **** Report  *******************************************************************
2140  ********************************************************************************
2141   
2142  * RPEORT model statistics
2143          report('model status',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2144          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2145          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2146   
2147   
2148  * ----------------------------------------------------------------------------
2149   
2150  * REPORT HOURS
2151          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= d(h) ;
2152          report_hours('energy generated',loop_res_share,loop_prosumage,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h)) + sum( sto , l
      ev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2153  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2154  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2155  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2156  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) ) ;
2157  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2158  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) )) ;
2159  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2160          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2161   
2162                   report_hours('energy generated',loop_res_share,loop_prosumage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2163                   report_hours('energy demanded',loop_res_share,loop_prosumage,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2164  *                 report_hours('gross exports',loop_res_share,loop_prosumage,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2165  *                 report_hours('gross imports',loop_res_share,loop_prosumage,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2166                   report_hours('demand consumers',loop_res_share,loop_prosumage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2167                   report_hours('price',loop_res_share,loop_prosumage,h)$(report_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND report_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2168  *                 report_hours('infeasibility',loop_res_share,loop_prosumage,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2169   
2170   
2171  * ----------------------------------------------------------------------------
2172   
2173  * REPORT TECH HOURS
2174          report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2175  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h) ) ;
2176          report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2177  *        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) ) ;
2178  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rsvr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2179  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(scen,rsvr,h) ) ;
2180          report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2181          report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(
      scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2182          report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_
      STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) ) ;
2183          report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2184  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc(l)* lev_F(scen,l,h)) ) ;
2185   
2186                   report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2187                   report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2188  *  star added        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2189                   report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2190                   report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2191                   report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2192                   report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2193  *                 report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)) < eps_rep_abs ) = 0 ;
2194  *                 report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)< eps_rep_abs ) = 0 ;
2195  *                 report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2196  *                 report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2197   
2198   
2199  * ----------------------------------------------------------------------------
2200   
2201  * RPEORT LINE
2202   
2203  * ----------------------------------------------------------------------------
2204   
2205  * REPORT NODE
2206          report_node('energy demand total',loop_res_share,loop_prosumage)= (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2
      M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2207   
2208  ;
2209          report_node('energy demand gross',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2210          report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2211  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2212           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) )) ;
2213          report_node('energy generated gross',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2214  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
2215           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2216  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2217  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )) ;
2218  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F(scen,l,h)) ) ;
2219  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) ) ) ;
2220  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2221  *        report_node('net import share in gross demand',loop_res_share,loop_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2222  *        report_node('net export share in net generation',loop_res_share,loop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2223  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev_NTC(scen,l))) ) ;
2224  *        report_node('gross import share',loop_res_share,loop_prosumage)= sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2225  *        report_node('gross export share in net generation',loop_res_share,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loop_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,loop_prosumage,h)) ;
2226          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)))
       + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2227  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)))
2228   
2229  ;
2230          report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2231          report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (
      lev_N_TECH(scen,nondis))))) ;
2232          report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2233          report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2234          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2235          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2236          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)))/card(h) ;
2237   
2238                   report_node('energy demand total',loop_res_share,loop_prosumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2239                   report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2240                   report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2241                   report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2242                   report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2243                   report_node('min price',loop_res_share,loop_prosumage)$(report_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND report_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2244  *                 report_node('gross exports',loop_res_share,loop_prosumage)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2245  *                 report_node('gross imports',loop_res_share,loop_prosumage)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2246  *                 report_node('net exports',loop_res_share,loop_prosumage)$(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_abs*card(h)) = 0 ;
2247                   report_node('energy generated net',loop_res_share,loop_prosumage)$(report_node('energy generated net',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2248                   report_node('energy generated gross',loop_res_share,loop_prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2249                   report_node('energy demand gross',loop_res_share,loop_prosumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2250  *                 report_node('net import share in gross demand',loop_res_share,loop_prosumage)$(report_node('net import share in gross demand',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2251  *                 report_node('net export share in net generation',loop_res_share,loop_prosumage)$(report_node('net export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2252                   report_node('Capacity total',loop_res_share,loop_prosumage)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2253  *                 report_node('gross import share',loop_res_share,loop_prosumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2254  *                 report_node('gross export share in net generation',loop_res_share,loop_prosumage)$(report_node('gross export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2255   
2256   
2257  * ----------------------------------------------------------------------------
2258   
2259  * REPORT COST
2260          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) + c_do(dis)*lev_G_DO(scen,di
      s,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO_IN(scen,sto,h) ) )
2261   
2262  ));
2263           report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech , c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + sum( sto , c_i_sto_e(sto)*le
      v_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,sto) )
2264  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr_p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rsvr))
2265   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res)*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(scen,sto)) + c_i_sto_p(sto)*l
      ev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2270  );
2271   
2272  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_infes * lev_G_INFES(scen,h)) ) ;
2273  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen_phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2274  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2275           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2276  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2277  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2278  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)
2279   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l)$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_ins) = 0 ;
2291   
2292  * ----------------------------------------------------------------------------
2293   
2294  * REPORT TECH
2295          report_tech('capacities conventional',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2296          report_tech('capacities renewable',loop_res_share,loop_prosumage,res)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) ;
2297  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr));
2298  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr));
2299          report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2300          report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2301   
2302          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2303          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2304  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2305          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2306          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2307   
2308          report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_
      STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2309  *        report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , gross_energy_demand(scen)) ;
2310          report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand
      (scen)) ;
2311          report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',lo
      op_res_share,loop_prosumage)) ;
2312  *        report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2313          report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2314   
2315          report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2316          report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_P
      RO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ))) ) ;
2317   
2318          report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2319          report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2320   
2321          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2322          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKE
      T_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
2323  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2324          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)) / sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2325   
2326   
2327                   report_tech('capacities conventional',loop_res_share,loop_prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2328                   report_tech('capacities renewable',loop_res_share,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2329                   report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2330                   report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2331  *                 report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2332  *                 report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2333                   report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2334  *                 report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2335                   report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2336                   report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2337  *                 report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2338                   report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2339                   report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2340                   report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2341                   report_tech('Capacity share',loop_res_share,loop_prosumage,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2342                   report_tech('Capacity share',loop_res_share,loop_prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2343  *                 report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2344                   report_tech('Capacity share',loop_res_share,loop_prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2345                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(report_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2346                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(report_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2347  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(report_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2348                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2349                   report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2350                   report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2351   
2352   
2353  * ----------------------------------------------------------------------------
2354   
2355  * REPORT NODE
2356          report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res))
2357  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr))
2358           ;
2359          report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)) ;
2360  *        report_node('net import share in nodal gross demand',loop_res_share,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosumage)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2361          report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res))
2362  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr))
2363           ;
2364          report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)) ;
2365   
2366                   report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2367                   report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2368                   report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2369                   report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2370   
2371   
2372   
2373  * ----------------------------------------------------------------------------
2374   
2375  * REPORT TECH
2376          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) ;
2377          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2378  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2379          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(s
      cen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) ;
2380   
2381          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',loop_res_share,loop_prosuma
      ge)* 1 + 1e-9 ;
2382          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2383  *        report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2384          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,s
      to,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2385          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2386          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_
      share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2387   
2388                   report_tech('Yearly energy',loop_res_share,loop_prosumage,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps_rep_ins ) = 0 ;
2389                   report_tech('Yearly energy',loop_res_share,loop_prosumage,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps_rep_ins ) = 0 ;
2390  *                 report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins ) = 0 ;
2391                   report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps_rep_ins ) = 0 ;
2392   
2393                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2394                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2395  *                 report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2396                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2397                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2398                   report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2399   
2400   
2401  * ----------------------------------------------------------------------------
2402   
2403  * RPEORT
2404          report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)  ;
2405          report('curtailment of fluct res relative',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (
      lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) )) ;
2406          report('bio not utilized absolute',loop_res_share,loop_prosumage)$( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loop_prosumage)  ;
2407          report('bio not utilized relative',loop_res_share,loop_prosumage)$( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_prosumage) /m_e('bio') ;
2408          report('Capacity total',loop_res_share,loop_prosumage) = report_node('Capacity total',loop_res_share,loop_prosumage) ;
2409          report('energy demand gross',loop_res_share,loop_prosumage) = report_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2410          report('energy demand total',loop_res_share,loop_prosumage) = report_node('energy demand total',loop_res_share,loop_prosumage)  ;
2411          report('energy generated net',loop_res_share,loop_prosumage) =  report_node('energy generated net',loop_res_share,loop_prosumage) ;
2412          report('energy generated gross',loop_res_share,loop_prosumage) =  report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2413  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2414          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_res(res,h) * lev_N_RES_PRO(sc
      en,res) - lev_CU_PRO(scen,res,h))
2415  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)))
2416           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2417          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2418          report('Energy total',loop_res_share,loop_prosumage) = report_node('Energy total',loop_res_share,loop_prosumage) ;
2419   
2420                   report('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2421                   report('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2422                   report('bio not utilized absolute',loop_res_share,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2423                   report('bio not utilized relative',loop_res_share,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2424                   report('Capacity total',loop_res_share,loop_prosumage)$(report('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2425                   report('gross trade share',loop_res_share,loop_prosumage)$(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2426                   report('renshare total',loop_res_share,loop_prosumage)$(report('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2427                   report('conshare total',loop_res_share,loop_prosumage)$(report('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2428                   report('Energy total',loop_res_share,loop_prosumage)$(report('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2429   
2430   
2431  * ----------------------------------------------------------------------------
2432   
2433  * DSM
2434   
2435   
2436  * ----------------------------------------------------------------------------
2437   
2438  * EV
2439   
2440   
2441   
2442  * ----------------------------------------------------------------------------
2443   
2444  * Reserves
2445   
2446   
2447   
2448   
2449  * ----------------------------------------------------------------------------
2450   
2451  * Reserves and DSM
2452   
2453   
2454  * ----------------------------------------------------------------------------
2455   
2456  * ----------------------------------------------------------------------------
2457   
2458  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross_energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h
       , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('
      price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price',l
      oop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours
      ('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours(
      'price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARK
      ET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_res_share,loo
      p_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_re
      s_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(
      scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserves',loop_res
      _share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserve
      s',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_
      energy_demand_prosumers_selfgen(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_p
      rosumers_market(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) / 
      report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) 
      / report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res
      ,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_
      share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen
      ,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_prosumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO
      2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market('Capacity total market',loop_res_share,loop_prosumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech) ) / report_ma
      rket('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,con,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumage,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
      *                 report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
      *                 report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)$(report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)$(report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share,loop_prosumage)$(report_market('gross energy demand market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)$(report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0
       ;
                       report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop_prosumage)$(report_market('Capacity total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share,loop_prosumage)$(report_market('Energy demand total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_share,loop_prosumage)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
      $ontext
2730   
2731   
2732  * ----------------------------------------------------------------------------
2733   
2734  * PROSUMAGE & DSM
2735   
2736   
2737   
2738  * ----------------------------------------------------------------------------
2739   
2740   
2741   
2742  * ----------------------------------------------------------------------------
2743   
2744  * HEAT
2745   
2746  * ----------------------------------------------------------------------------
2747   
2748  * Reserves and heat
2749   
2750   
2751  * ---------------------------------------------------------------------------- *
2752  * ---------------------------------------------------------------------------- *
2753  * ---------------------------------------------------------------------------- *
2754   
2755   
2756  execute_unload "results", report, report_tech, report_node,
2757  *report_line,
2758  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, report_market, report_market_tech, report_market_tech_hours
      $ontext
2763  ;
2764   
2765   
      $include report_to_excel.gms
      $ontext
2770   
2771   
2774   
      solve   DIETER_MCP using mcp ;
      *scenario dict;
       
       
      Parameters
      Z_MCP
      ;
       
      Z_MCP =            sum( (h,dis) , c_m(dis)*G_L.l(dis,h) )
                       + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP.l(dis,h) )
                       + sum( (h,dis) , c_do(dis)*G_DO.l(dis,h) )
                       + sum( (h,nondis) , c_cu(nondis)*CU.l(nondis,h) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT.l(sto,h) + STO_IN.l(sto,h) ) )
                       + sum( tech , c_i(tech)*N_TECH.l(tech) )
                       + sum( tech , c_fix(tech)*N_TECH.l(tech) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E.l(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P.l(sto)+ N_STO_E.l(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P.l(sto) )
      ;
       
       
      Display
      Z_MCP,
      N_TECH.l,
      N_STO_E.l,
      N_STO_P.l,
      G_L.l,
      G_UP.l,
      G_DO.l,
      G_RES.l,
      CU.l,
      STO_IN.l,
      STO_OUT.l,
      STO_L.l
      lambda_enerbal.m,
      lambda_enerbal.l,
      lambda_resgen.m,
      lambda_convgen.m,
      lambda_stolev.m
      ;
       
      $ontext
2819   
2820  * ---------------------------------------------------------------------------- *
2821  * ---------------------------------------------------------------------------- *
2822  * ---------------------------------------------------------------------------- *
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.gms
     2      127 INCLUDE        1     127  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\dataload.gms
     3      531 CALL           2     404  .gdxxrw data_input.xlsx @temp.tmp o=Data_input maxdupeerrors=100
     4      533 GDXIN          2     406  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\Data_input.gdx
     5      581 CALL           2     454  .gdxxrw time_series.xlsx @temp2.tmp o=time_series
     6      582 GDXIN          2     455  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\time_series.gdx
     7      922 INCLUDE        1     162  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\model.gms
     8     1618 INCLUDE        1     267  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\fix.gms
     9     1799 INCLUDE        1     268  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\scenario.gms
    10     1986 INCLUDE        1     330  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\report.gms


COMPILATION TIME     =       10.811 SECONDS      6 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Setup/Generation    SOLVE DIETER Using LP From line 1981


Warning GUSS turns holdFixed for DIETER off.
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1981


MODEL STATISTICS

BLOCKS OF EQUATIONS          14     SINGLE EQUATIONS      429,269
BLOCKS OF VARIABLES          13     SINGLE VARIABLES      464,308  5 projected
NON ZERO ELEMENTS     1,809,486     NON LINEAR N-Z        105,121
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH             148,925


GENERATION TIME      =       53.696 SECONDS    241 MB  25.1.2 r67455 WEX-WEI


EXECUTION TIME       =       53.883 SECONDS    241 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1981


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1981

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         40.374  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             25.1.2 r67420 Released Jul 31, 2018 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
Space for names approximately 26.37 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 18.64sec (det. 20036.00 ticks)
Optimal solution found.
Objective : 33544675636.589802

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544675636.5898
---   Resource Usage   19157
---   Total Time (ms)  19282

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
Space for names approximately 26.37 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 20.78sec (det. 27053.83 ticks)
Optimal solution found.
Objective : 40093268939.343040

--- Scenario scen2:     Records read:    1
--- Solution statistics for scenario scen2
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  40093268939.343
---   Resource Usage   21279
---   Total Time (ms)  21418

No solution returned
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:33:12 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        1.825 SECONDS    132 MB  25.1.2 r67455 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.lst
