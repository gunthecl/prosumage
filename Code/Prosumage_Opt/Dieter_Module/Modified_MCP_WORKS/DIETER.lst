GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  ********************************************************************************
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24   
  25  * Choose base year
  27   
  28  ***** Set star to activate options
  29   
  30  * Germany only - also adjust Excel inputs!
  32   
  33  * Dispatch only - used fixed capacities (also deactivates bio energy restriction)
  35   
  37   
  38  * Set to "*" to select linear program, leave blank to select MCP
  40   
  41  * Set star to select run-of-river options either as exogenous parameter or as endogenous variable including reserve provision:
  42  * if nothing is selected, ROR capacity will be set to zero
  43  * if parameter option is selected, set appropriate values in fix.gmx
  44  * if variable option is selected, set appropriate bound in data_input excel
  47   
  48  * Set star to determine loops, otherwise default 100% renewables
  50   
  51  * Set star for no crossover to speed up calculation time by skipping crossover in LP solver
  53   
  54  * Set star for reporting to Excel
  56   
  57   
  58  * --------------------- Do not change these lines ------------------------------
  59   
  60   
  61  ******************************Do not change these lines ************************
  62   
  63  * Definition of strings for report parameters and sanity checks
  65   
  66  * Sanity checks
  68   
  69  * LP or MCP
  72   
  73  * Dispatch or investment
  76   
  77  ********************************************************************************
  78   
  79  ****************************
  80  ***** INITIALIZE LOOPS *****
  81  ****************************
  82   
  83  sets
  84  *$ontext
  85  loop_res_share   Solution loop for different shares of renewables       /50/
  88   
      loop_prosumage   Solution loop for different prosumer self-consumption levels    /50/
      $ontext
  93   
  94  *      loop_res_share                          /50/
  95                        loop_prosumage                          /0/
  96  ;
  97   
  98   
  99   
 100   
 101  ********************************************************************************
 102   
 103  **************************
 104  ***** SOLVER OPTIONS *****
 105  **************************
 106   
 107  options
 108  optcr = 0.00
 109  reslim = 10000000
 110  lp = cplex
 111  mip = cplex
 112  nlp = conopt
 113  limrow = 0
 114  limcol = 0
 115  ;
 116   
 117  options
 118  dispwidth = 15
 119  limrow = 0
 120  limcol = 0
 121  solprint = off
 122  sysout = off
 123  ;
 124   
 125   
 126   
 127   
 128  ********************************************************************************
 129   
 130  **************************
 131  ***** Dataload *****
 132  **************************
 133   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\dataload.gms
 135   
 136  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 146  ********************************************************************************
 147   
 148   
 149   
 150   
 151  ***************  SETS  *********************************************************
 152   
 153  ***** Sets used in the model *****
 154  Sets
 155  tech                     Generation technologies
 156   dis(tech)               Dispatchable generation technologies
 157   nondis(tech)            Nondispatchable generation technologies
 158   con(tech)               Conventional generation technologies
 159   res(tech)               Renewable generation technologies
 160  sto                      Storage technologies
 161  rsvr                     Reservoir technologies
 162  dsm                      DSM technologies
 163   dsm_shift(dsm)          DSM load shifting technologies
 164   dsm_curt(dsm)           DSM load curtailment technologies
 165  year                     Base year for temporal data
 166  h                        Hours
 167  n                        Nodes
 168  l                        Lines
 169  ev                       EV types
 170  reserves                         Reserve qualities
 171   reserves_up(reserves)           Positive reserves
 172   reserves_do(reserves)           Negative reserves
 173   reserves_spin(reserves)         Spinning reserves
 174   reserves_nonspin(reserves)      Nonspinning reserves
 175   reserves_prim(reserves)         Primary reserves
 176   reserves_nonprim(reserves)      Nonprimary reserves
 177   reserves_prim_up(reserves)      Primary positive reserves
 178   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 179   reserves_prim_do(reserves)      Primary negative reserves
 180   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 181  bu                       Building archtypes
 182  ch                       Heating combination type
 183   hst(ch)                 Heating technology that feeds to storage
 184   hp(ch)                  Heat pump technologies
 185   hel(ch)                 Hybrid electric heating technologies - electric part
 186   hfo(ch)                 Hybrid electric heating technologies - fossil part
 187   
 188   
 189  ***** Sets used for data upload *****
 190  headers_tech                     Generation technologies - upload headers
 191   tech_dispatch                   Generation technologies - dispatchable or nondispatchable
 192   tech_res_con                    Generation technologies - renewable or "conventional"
 193  headers_sto                      Storage technologies - upload headers
 194  headers_reservoir                Reservoir technologies - upload headers
 195  headers_dsm                      DSM technologies - upload headers
 196   dsm_type                        DSM technologies - shifting or curtailment
 197  headers_time                     Temporal data - upload headers
 198  headers_topology                 Spatial data - upload headers
 199  headers_ev                       EV data - upload headers
 200  headers_time_ev                  EV temporal data - upload headers
 201  headers_prosumage_generation     Prosumage generation data - upload headers
 202  headers_prosumage_storage        Prosumage storage data - upload headers
 203  headers_reserves                 Reserve data - upload headers
 204   reserves_up_down                Reserve data - positive and neagtive reserves
 205   reserves_spin_nonspin           Reserve data - spinning and nonspinning reserves
 206   reserves_prim_nonprim           Reserve data - primary and nonprimary reserves
 207  headers_heat                     Heat data - upload headers
 208   heat_storage                    Heat data - storage technologies
 209   heat_hp                         Heat data - heat pump technologies
 210   heat_elec                       Heat data - hybrid heating technologies - electric part
 211   heat_fossil                     Heat data - hybrid heating technologies - fossil part
 212  headers_time_heat                Heat data - upload headers time data
 213  headers_time_dhw                 Heat data - upload headers time data on DHW
 214  ;
 215   
 216   
 217   
 218   
 219  ***************  PARAMETERS  ***************************************************
 220   
 221  Parameters
 222   
 223  ***** Generation technologies *****
 224  *--- Variable and fixed costs ---*
 225  eta              Efficiency of conventional technologies [0 1]
 226  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 227  c_up             Load change costs UP [EUR per MWh]
 228  c_do             Load change costs DOWN [EUR per MWh]
 229  c_fix            Annual fixed costs [EUR per MW per year]
 230  c_vom            Variable O&M costs [EUR per MWh]
 231  CO2price         CO2 price in [EUR per ton]
 232   
 233  *--- Investment ---*
 234  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 235  lifetime         Investment costs: technical lifetime [a]
 236  recovery         Investment costs: Recovery period according to depreciation tables [a]
 237  interest_rate    Investment costs: Interest rate [%]
 238  m_p              Investment: maximum installable capacity per technology [MW]
 239  m_e              Investment: maximum installable energy [TWh per a]
 240   
 241  *--- Flexibility ---*
 242  grad_per_min     Maximum load change relative to installed capacity [% of installed capacity per minute]
 243   
 244   
 245  ***** Fuel and CO2 costs *****
 246  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 247   
 248   
 249  ***** Renewables *****
 250  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 251  phi_min_res      Minimum renewables share [0 1]
 252   
 253   
 254  ***** Storage *****
 255  *--- Variable and fixed costs ---*
 256  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 257  eta_sto          Storage efficiency [0 1]
 258  phi_sto_ini      Initial storage level [0 1]
 259  etop_max         Maximum E to P ratio of storage types [#]
 260  c_fix_sto        Annual fixed costs [EUR per MW]
 261   
 262  *--- Investment ---*
 263  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight [EUR per MWh]
 264  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnight [EUR per MW]
 265  m_sto_e                     Investment into storage: maximum installable energy [MWh]
 266  m_sto_p                     Investment into storage: maximum installable power [MW]
 267   
 268   
 269  ***** Reservoir*****
 270  *--- Variable and fixed costs ---*
 271  c_m_rsvr                 Marginal costs of generating energy from reservoir [EUR per MWh]
 272  eta_rsvr                 Generation efficiency [0 1]
 273  phi_rsvr_ini             Initial reservoir level [0 1]
 274  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 275  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of annual energy [0 1]
 276  phi_rsvr_lev_min         Minimum filling level [0 1]
 277   
 278  *--- Investment ---*
 279  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight [EUR per MWh]
 280  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnight [EUR per MW]
 281  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetime [a]
 282  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 283  m_rsvr_e                 Investment into reservoir: maximum installable energy [MWh]
 284  m_rsvr_p                 Investment into reservoir: maximum installable capacity [MW]
 285   
 286   
 287  ***** DSM *****
 288  *--- Variable and fixed costs ---*
 289  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 290  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 291  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW per a]
 292  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per a]
 293   
 294  *--- Flexibility, efficiency, recovery ---*
 295  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 296  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment instances [h]
 297   
 298  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 299  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upshift instances [h]
 300  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 301   
 302  *--- Investment ---*
 303  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment: Overnight [EUR per MW]
 304  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: Overnight [EUR per MW]
 305  inv_recovery_dsm_cu              Investment costs for DSM load curtailment: Recovery period [a]
 306  inv_recovery_dsm_shift           Investment costs for DSM load shifting: Recovery period [a]
 307  inv_interest_dsm_cu              Investment costs for DSM load curtailment: Interest rate [%]
 308  inv_interest_dsm_shift           Investment costs for DSM load shifting: Interest rate [%]
 309  m_dsm_cu                         DSM: Maximum installable capacity load curtailment [MW]
 310  m_dsm_shift                      DSM: Maximum installable capacity load shifting [MW]
 311   
 312   
 313  ***** Time Data *****
 314  d_y                      Demand hour h for different years [MWh]
 315  d                        Demand hour h [MWh]
 316  phi_res_y                Renewables availability technology res in hour h for different years [0 1]
 317  phi_res                  Renewables availability technology res in hour h [0 1]
 318  phi_ror_y                Run-of-river availability technology ror in hour h for different years [0 1]
 319  phi_ror                  Run-of-river availability technology ror in hour h [0 1]
 320  rsvr_in_y                Reservoir inflow in hour h for different years [0 1]
 321  rsvr_in                  Reservoir inflow in hour h [0 1]
 322  n_ev_p_upload            Power rating of the charging connection in hour h [MW - 0 when car is in use or parked without grid connection]
 323  ev_ed_upload             Electricity demand for mobility vehicle profile ev in hour h [MW]
 324  ev_ged_exog_upload       Electricity demand for mobility in case of uncontrolled charging vehicle profile ev in hour h [MW]
 325  phi_reserves_call_y      Hourly share of reserve provision that is actually activated for different years [0 1]
 326  phi_reserves_call        Hourly share of reserve provision that is actually activated [0 1]
 327  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 328  reserves_exogenous       Hourly reserve provision [MW]
 329   
 330  ***** Transmission *****
 331  *--- Investment ---*
 332  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 333  c_fix_ntc                 Fixed costs [EUR per MW per a]
 334  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 335  inv_recovery_ntc          Investment costs: Recovery period in [a]
 336  inv_interest_ntc          Investment costs: Interest rate [%]
 337  m_ntc                     Investment into NTC: maximum installable capacity [MW]
 338   
 339  *--- Topology and distance ---*
 340  inc              Incidence index of link l on node n
 341  dist             Distance covered by link l [km]
 342   
 343   
 344  ***** Electric vehicles *****
 345  *--- Costs and attributes ---*
 346  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 347  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh]
 348  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 349  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 350  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 351   
 352  n_ev_e           Electric vehicle battery capacity [MWh]
 353  ev_quant         Overall number of electirc vehicles [#]
 354  phi_ev           Share of electric vehicles per load profile in actual scenario [0 1]
 355  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if yes 0 otherwise]
 356   
 357  *--- Temporal data ---*
 358  n_ev_p           Electric vehicle power rating [MWh]
 359  ev_ed            Electric vehicle electricity demand [MWh]
 360  ev_ged_exog      Electric vehicle grid electricity demand for exogenous charging pattern [MWh]
 361   
 362   
 363  ***** Prosumage *****
 364  phi_pro_load             Share of prosumagers among total load [0 1]
 365  phi_pro_self             Minimum self-generation shares for prosumagers [0 1]
 366  m_res_pro                Maximum installable: renewables capacity [MW]
 367  m_sto_pro_e              Maximum installable: storage energy [MWh]
 368  m_sto_pro_p              Maximum installable: storage capacity [MW]
 369  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 370   
 371   
 372  ***** Reserves *****
 373  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 374  reserves_intercept       Intercept of regression line determining reserves demand
 375  reserves_slope           Slope of regression line determining reserves demand
 376  reserves_reaction        Activation reaction time for reserves qualities [min]
 377  phi_reserves_pr_up       Positive primary reserves fraction of total nonprimary reserves demand [0 1]
 378  phi_reserves_pr_do       Negative primary reserves fraction of total nonprimary reserves demand [0 1]
 379  *reserves_exog
 380   
 381   
 382  ***** Heat *****
 383  *--- Time data ---*
 384  dh_upload                Hourly heat demand per year for upload [MWh per m2]
 385  dh_y                     Hourly heat demand per year [MWh per m2]
 386  dh                       Hourly heat demand [MWh per m2]
 387  temp_source              Heat pumps - source temperature [°Celsius]
 388  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2]
 389  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 390  d_dhw                    Hourly DHW demand [MWh per m2]
 391  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-time storage heaters [MWh per m2]
 392   
 393  *--- Technololgy attributes ---*
 394  phi_heat_type            Share of heating type ch per building archetype bu [0 1]
 395  eta_heat_stat            Static efficiency for heating technologies [0 1]
 396  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 397  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies [0 1]
 398  n_heat_p_in              Maximum power inflow into heating technologies [MW]
 399  n_heat_p_out             Maximum power outflow from heating technologies [MW]
 400  n_heat_e                 Maximum energy level of heating storage technologies [MWh]
 401  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 402  n_sets_p_out             SETS - Power rating - heat output [MW]
 403  n_sets_e                 SETS - Energy storage capacity [MWh]
 404  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electricity intake [MW]
 405  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW output [MW]
 406  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capacity [MWh]
 407  phi_heat_ini             Inititial storage level of heating technologies [0 1]
 408  temp_sink                Heat pumps - sink temperature [°Celsius]
 409  pen_heat_fuel            Penalty term for non-electric fuel usage for hybrid heating technologies [EUR per MWh]
 410  area_floor               Floor area subject to specific heating technology in specific building type [m2]
 411  theta_night              Indicator for night hours {0 1}
 412   
 413   
 414   
 415  ***************  DERIVED PARAMETERS  *******************************************
 416   
 417  c_m              Marginal production costs for conventional plants including variable O and M costs [EUR per MWh]
 418  c_i              Annualized investment costs by conventioanl plant [EUR per MW]
 419   
 420  c_i_res          Annualized investment costs by renewable plant [EUR per MW]
 421  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per a]
 422   
 423  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 424  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 425   
 426  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 427  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 428   
 429  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR per MW]
 430  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per MW]
 431   
 432  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 433   
 434  phi_mean_reserves_call_y         Hourly mean of share reserves called per year [0 1]
 435  phi_mean_reserves_call           Hourly mean of share reserves called [0 1]
 436   
 437  theta_dir        Dummy equal to 1 if building type bu has direct heating type ch [0 1]
 438  theta_sets       Dummy equal to 1 if building type bu has SETS heating type ch [0 1]
 439  theta_hp         Dummy equal to 1 if building type bu has heat pump heating type ch [0 1]
 440  theta_elec       Dummy equal to 1 if building type bu has hybrif electric heating - electric part [0 1]
 441  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric heating - fossil part [0 1]
 442  theta_storage    Dummy equal to 1 if building type ch has storage heating type ch [0 1]
 443   
 444   
 445   
 446   
 447  ***************  PARAMETERS FOR DATA UPLOAD  ***********************************
 448   
 449  technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)
 450  technology_data(tech,headers_tech)
 451  storage_data(sto,headers_sto)
 452  reservoir_data(rsvr,headers_reservoir)
 453  time_data_upload(h,year,headers_time)
 454  dsm_data_upload(dsm,dsm_type,headers_dsm)
 455  dsm_data(dsm,headers_dsm)
 456  topology_data(l,headers_topology)
 457  ev_data(ev,headers_ev)
 458  ev_time_data_upload(h,headers_time_ev,ev)
 459  prosumage_data_generation(tech,headers_prosumage_generation)
 460  prosumage_data_storage(sto,headers_prosumage_storage)
 461  reserves_time_data_activation(h,year,reserves)
 462  reserves_time_data_provision(h,year,reserves)
 463  reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)
 464  reserves_data(reserves,headers_reserves)
 465  heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)
 466  heat_data(bu,ch,headers_heat)
 467  dh_upload(h,year,headers_time_heat,bu)
 468  d_dhw_upload(h,year,headers_time_heat,bu)
 469  temp_source_upload
 470  ;
 471   
 472   
 473   
 474   
 475  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  *********************
 476   
 536   
 537  *%skip_Excel%
 539   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\Data_input.gdx
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  rsvr = 8:rsvr
--- LOAD  headers_reservoir = 9:headers_reservoir
--- LOAD  reservoir_data = 31:reservoir_data
--- LOAD  dsm = 10:dsm
--- LOAD  headers_dsm = 11:headers_dsm
--- LOAD  dsm_type = 12:dsm_type
--- LOAD  technology_data_upload = 29:technology_data_upload
--- LOAD  storage_data = 30:storage_data
--- LOAD  dsm_data_upload = 32:dsm_data_upload
 544   
--- LOAD  ev = 13:ev
--- LOAD  headers_ev = 14:headers_ev
--- LOAD  ev_data = 34:ev_data
--- LOAD  headers_prosumage_generation = 15:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 16:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 35:prosumage_data_generation
--- LOAD  prosumage_data_storage = 36:prosumage_data_storage
--- LOAD  reserves = 17:reserves
--- LOAD  reserves_up_down = 19:reserves_up_down
--- LOAD  reserves_spin_nonspin = 20:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 21:reserves_prim_nonprim
--- LOAD  headers_reserves = 18:headers_reserves
--- LOAD  reserves_data_upload = 37:reserves_data_upload
--- LOAD  bu = 22:bu
--- LOAD  ch = 23:ch
--- LOAD  heat_storage = 24:heat_storage
--- LOAD  heat_hp = 25:heat_hp
--- LOAD  heat_elec = 26:heat_elec
--- LOAD  heat_fossil = 27:heat_fossil
--- LOAD  headers_heat = 28:headers_heat
--- LOAD  heat_data_upload = 38:heat_data_upload
 549  ;
 550   
      parameter inc ;
      inc(l,n) = 1 ;
      $ontext
 556   
 557   
 558  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  ***********************
 559   
 585   
 586   
 587  *
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
 591  *$load headers_time_ev ev_time_data_upload
 592  *$load reserves_time_data_activation
 593  *$load reserves_time_data_provision
 594  *$load headers_time_heat dh_upload
 595  *$load theta_night
 596  *$load temp_source_upload
 597  *$load headers_time_dhw d_dhw_upload nets_profile
 598  ;
 599   
 600   
 601   
 602   
 603  ***************  ASSIGNMENTS  **************************************************
 604   
 605   
 606   
 607  ***** Aliases *****
 608  alias (h,hh) ;
 609  alias (res,resres) ;
 610  alias (reserves,reservesreserves) ;
 611  alias (nondis,nondisnondis) ;
 612   
 613   
 614   
 615  ***** Derived sets *****
 616  dis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'dis',headers_tech)) = yes;
 617  nondis(tech)$sum( (tech_res_con,headers_tech), technology_data_upload(tech,tech_res_con,'nondis',headers_tech)) = yes;
 618   
 619  con(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'con',tech_dispatch,headers_tech)) = yes;
 620  res(tech)$sum( (tech_dispatch,headers_tech), technology_data_upload(tech,'res',tech_dispatch,headers_tech)) = yes;
 621   
      reserves_up(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_do(reserves)$sum( (reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_spin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'spin',reserves_prim_nonprim,headers_reserves)) = yes;
      reserves_nonspin(reserves)$sum( (reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(reserves,reserves_up_down,'nonspin',reserves_prim_nonprim,headers_reserves)) = yes;
       
      reserves_prim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim(reserves)$sum( (reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      reserves_prim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_prim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
      reserves_nonprim_up(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'up',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
      reserves_nonprim_do(reserves)$sum( (reserves_spin_nonspin,headers_reserves), reserves_data_upload(reserves,'do',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
       
      hst(ch)$sum( (bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
      hp(ch)$sum( (bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = yes;
       
      hel(ch)$sum( (bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
      hfo(ch)$sum( (bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 643   
 644   
 645   
 646  ***** Parameters *****
 647   
 648  *--- Generation technologies ---*
 649  technology_data(tech,headers_tech) = sum((tech_res_con,tech_dispatch), technology_data_upload(tech,tech_res_con,tech_dispatch,headers_tech)) ;
 650  eta(tech) = technology_data(tech,'eta_con') ;
 651  carbon_content(tech) = technology_data(tech,'carbon_content') ;
 652  c_up(dis) =technology_data(dis,'load change costs up') ;
 653  c_do(dis) = technology_data(dis,'load change costs down') ;
 654  c_fix(tech) = technology_data(tech,'fixed_costs') ;
 655  c_vom(tech) = technology_data(tech,'variable_om') ;
 656  CO2price(tech) = technology_data(tech,'CO2_price') ;
 657   
 658  c_inv_overnight(tech) = technology_data(tech,'oc') ;
 659  lifetime(tech) = technology_data(tech,'lifetime') ;
 660  recovery(tech) = technology_data(tech,'recovery_period') ;
 661  interest_rate(tech) = technology_data(tech,'interest_rate') ;
 662  m_p(tech) = technology_data(tech,'max_installable') ;
 663  m_e(tech) = technology_data(tech,'max_energy') ;
 664  grad_per_min(dis) = technology_data(dis,'load change flexibility') ;
 665  fuelprice(tech) = technology_data(tech,'fuel costs') ;
 666   
 667  c_cu(res) = technology_data(res,'curtailment_costs') ;
 668   
 669   
 670  *--- Storage technologies ---*
 671  c_m_sto(sto) = storage_data(sto,'mc');
 672  eta_sto(sto) = storage_data(sto,'efficiency');
 673  c_fix_sto(sto) = storage_data(sto,'fixed_costs');
 674  phi_sto_ini(sto) = storage_data(sto,'level_start');
 675  etop_max(sto) = storage_data(sto,'etop_max') ;
 676   
 677  c_inv_overnight_sto_e(sto) = storage_data(sto,'oc_energy');
 678  c_inv_overnight_sto_p(sto) = storage_data(sto,'oc_capacity');
 679  lifetime(sto) = storage_data(sto,'lifetime');
 680  interest_rate(sto) = storage_data(sto,'interest_rate');
 681  m_sto_e(sto) = storage_data(sto,'max_energy');
 682  m_sto_p(sto) = storage_data(sto,'max_power');
 683   
      *--- Reservoir technologies ---*
      c_m_rsvr(rsvr) = reservoir_data(rsvr,'mc');
      eta_rsvr(rsvr) = reservoir_data(rsvr,'efficiency');
      c_fix_rsvr(rsvr) = reservoir_data(rsvr,'fixed_costs');
      phi_rsvr_ini(rsvr) = reservoir_data(rsvr,'level_start');
      phi_rsvr_lev_min(rsvr) = reservoir_data(rsvr,'level_min');
       
      c_inv_overnight_rsvr_e(rsvr) = reservoir_data(rsvr,'oc_energy');
      c_inv_overnight_rsvr_p(rsvr) = reservoir_data(rsvr,'oc_capacity');
      inv_lifetime_rsvr(rsvr) = reservoir_data(rsvr,'lifetime');
      inv_interest_rsvr(rsvr) = reservoir_data(rsvr,'interest_rate');
      m_rsvr_e(rsvr) = reservoir_data(rsvr,'max_energy');
      m_rsvr_p(rsvr) = reservoir_data(rsvr,'max_power');
       
       
      *--- DSM technologies ---*
      dsm_curt(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'curt',headers_dsm)) = yes;
      dsm_shift(dsm)$sum( (dsm_type,headers_dsm), dsm_data_upload(dsm,'shift',headers_dsm)) = yes;
      dsm_data(dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(dsm,dsm_type,headers_dsm) ) ;
       
      c_m_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'mc')     ;
      c_m_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'mc')  ;
      c_fix_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'fc')  ;
      c_fix_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'fc') ;
       
      t_dur_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'max_duration')   ;
      t_off_dsm_cu(dsm_curt) = dsm_data(dsm_curt,'recovery_time')   ;
      t_dur_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'max_duration')   ;
      t_off_dsm_shift(dsm_shift) = dsm_data(dsm_shift,'recovery_time')   ;
      eta_dsm_shift(dsm_shift)  = dsm_data(dsm_shift,'efficiency')   ;
       
      c_inv_overnight_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'oc')   ;
      c_inv_overnight_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'oc')   ;
      inv_recovery_dsm_cu(dsm_curt)  =  dsm_data(dsm_curt,'lifetime')   ;
      inv_recovery_dsm_shift(dsm_shift)   =  dsm_data(dsm_shift,'lifetime')   ;
      inv_interest_dsm_cu(dsm_curt)   =  dsm_data(dsm_curt,'interest_rate')   ;
      inv_interest_dsm_shift(dsm_shift)  =  dsm_data(dsm_shift,'interest_rate')   ;
      m_dsm_cu(dsm_curt) =  dsm_data(dsm_curt,'max_installable')   ;
      m_dsm_shift(dsm_shift) =  dsm_data(dsm_shift,'max_installable')   ;
 725   
 726  *--- Temporal data ---*
 727  d_y(year,h) = time_data_upload(h,year,'demand')  ;
 728  phi_res_y(year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_data_upload(h,year,headers_time));
 729   
 730  *rsvr_in_y(year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), time_data_upload(h,year,headers_time));
 731  *phi_reserves_call_y(year,reserves,h) = reserves_time_data_activation(h,year,reserves) ;
 732  *reserves_exogenous_y(year,reserves,h) = reserves_time_data_provision(h,year,reserves) ;
 733   
 734   
 735  *--- Spatial data ---*
 736  *inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 737  *inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 738  *inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 739  *c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 740  *c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 741  *m_ntc(l) = topology_data(l,'max_installable') ;
 742  *dist(l) = topology_data(l,'distance') ;
 743   
      *--- Electric vehicles ---*
      c_m_ev(ev) = ev_data(ev,'mc') ;
      pen_phevfuel(ev) = ev_data(ev,'penalty_fuel') ;
      eta_ev_in(ev) = ev_data(ev,'efficiency_charge') ;
      eta_ev_out(ev) = ev_data(ev,'efficiency_discharge') ;
      phi_ev_ini(ev) = ev_data(ev,'ev_start') ;
       
      n_ev_e(ev) = ev_data(ev,'ev_capacity') ;
      phi_ev(ev) = ev_data(ev,'share_ev') ;
      ev_phev(ev) = ev_data(ev,'ev_type') ;
       
      n_ev_p(ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
      ev_ed(ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
      ev_ged_exog(ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 760   
 761  *--- Prosumage ---*
 762  m_res_pro(res) = prosumage_data_generation(res,'max_power') ;
 763  m_sto_pro_e(sto) = prosumage_data_storage(sto,'max_energy') ;
 764  m_sto_pro_p(sto) = prosumage_data_storage(sto,'max_power') ;
 765  phi_sto_pro_ini(sto) = prosumage_data_storage(sto,'level_start') ;
 766   
      *--- Reserves ---*
      reserves_data(reserves,headers_reserves) = sum((reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim), reserves_data_upload(reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
      phi_reserves_share(reserves) = reserves_data(reserves,'share_sr_mr') ;
      reserves_intercept(reserves) = reserves_data(reserves,'intercept') ;
      reserves_slope(reserves,'wind_on') = reserves_data(reserves,'slope_wind_on') ;
      reserves_slope(reserves,'wind_off') = reserves_data(reserves,'slope_wind_off') ;
      reserves_slope(reserves,'pv') = reserves_data(reserves,'slope_pv') ;
      reserves_reaction(reserves) = reserves_data(reserves,'reaction_time') ;
      phi_reserves_pr_up(n) = reserves_data('PR_up','fraction_pr') ;
      phi_reserves_pr_do(n) = reserves_data('PR_do','fraction_pr') ;
       
       
      *--- Heat ---*
      heat_data(bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_fossil), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) ;
      phi_heat_type(bu,ch) = heat_data(bu,ch,'share') ;
      dh_y(year,bu,ch,h) = phi_heat_type(bu,ch) * dh_upload(h,year,'demand',bu) ;
      d_dhw_y(year,bu,ch,h) = phi_heat_type(bu,ch) * d_dhw_upload(h,year,'demand',bu) ;
       
      eta_heat_stat(bu,ch) = heat_data(bu,ch,'static_efficiency') ;
      eta_heat_dyn(bu,ch) = heat_data(bu,ch,'dynamic_efficiency') ;
      eta_dhw_aux_stat(bu,ch) = heat_data(bu,ch,'static_efficiency_sets_aux_dhw') ;
      * currently not used
      n_heat_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_heat_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_heat_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_p_in(bu,ch) = heat_data(bu,ch,'max_power') ;
      n_sets_p_out(bu,ch) = heat_data(bu,ch,'max_outflow') ;
      n_sets_e(bu,ch) = heat_data(bu,ch,'max_level') ;
      n_sets_dhw_p_in(bu,ch) = heat_data(bu,ch,'max_power_in_sets_aux_dhw') ;
      n_sets_dhw_p_out(bu,ch) = heat_data(bu,ch,'max_power_out_sets_aux_dhw') ;
      n_sets_dhw_e(bu,ch) = heat_data(bu,ch,'max_energy_sets_aux_dhw') ;
      phi_heat_ini(bu,ch) = heat_data(bu,ch,'level_ini') ;
      temp_sink(bu,ch) = heat_data(bu,ch,'temperature_sink') ;
       
      temp_source(bu,'hp_as',h) = temp_source_upload(h,'hp_as') ;
      temp_source(bu,'hp_gs',h) = heat_data(bu,'hp_gs','temperature_source') ;
       
      temp_source(bu,'gas_hp_gs',h) = heat_data(bu,'gas_hp_gs','temperature_source') ;
      temp_source(bu,'hp_gs_elec',h) = heat_data(bu,'hp_gs_elec','temperature_source') ;
       
      pen_heat_fuel(bu,ch) = heat_data(bu,ch,'penalty_non-electric_heat_supply') ;
       
      area_floor(bu,ch) = heat_data(bu,ch,'area_floor') ;
 812   
 813   
 814  ***************  CALCULATE DERIVED PARAMETERS  *********************************
 815   
 816  c_m(tech) = fuelprice(tech)/eta(tech) + carbon_content(tech)/eta(tech)*CO2price(tech) + c_vom(tech)   ;
 817   
 818  c_i(tech) = c_inv_overnight(tech)*( interest_rate(tech) * (1+interest_rate(tech))**(lifetime(tech)) )
 819                    / ( (1+interest_rate(tech))**(lifetime(tech))-1 )       ;
 820   
 821  c_i_res(res) = c_i(res) ;
 822  c_fix_res(res) = c_fix(res) ;
 823   
 824  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 825                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
 826   
 827  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( interest_rate(sto) * (1+interest_rate(sto))**(lifetime(sto)) )
 828                   / ( (1+interest_rate(sto))**(lifetime(sto))-1 )       ;
      c_i_rsvr_e(rsvr) = c_inv_overnight_rsvr_e(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_rsvr_p(rsvr) = c_inv_overnight_rsvr_p(rsvr)*( inv_interest_rsvr(rsvr) * (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr)) )
                       / ( (1+inv_interest_rsvr(rsvr))**(inv_lifetime_rsvr(rsvr))-1 )       ;
       
      c_i_dsm_cu(dsm_curt) =c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm_cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt)) )
                       / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(dsm_curt))-1 )       ;
       
      c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_interest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift)) )
                       / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_dsm_shift(dsm_shift))-1 )       ;
       
      c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_interest_ntc(l))**(inv_lifetime_ntc(l)) )
                       / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 ) ;
       
      phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,reserves,h) ) / card(h) + eps ;
       
       
      theta_sets(bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'setsh',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'setsh')) = 1;
      theta_dir(bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(bu,'dir',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(bu,'dir')) = 1;
       
      theta_storage(bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AND phi_heat_type(bu,ch)) = 1;
      theta_hp(bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
       
      theta_elec(bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) AND phi_heat_type(bu,ch)) = 1;
      theta_fossil(bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AND phi_heat_type(bu,ch)) = 1;
 857   
 858   
 859  ***************  Adjust costs to model's hourly basis **************************
 860   
 861  c_i(tech) = c_i(tech)*card(h)/8760 ;
 862  c_i_res(tech) = c_i_res(tech)*card(h)/8760 ;
 863  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 864  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 865  *c_i_rsvr_e(rsvr) = c_i_rsvr_e(rsvr)*card(h)/8760 ;
 866  *c_i_rsvr_p(rsvr) = c_i_rsvr_p(rsvr)*card(h)/8760 ;
 867  *c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 868  *c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
 869   
 870  c_fix(tech) = c_fix(tech)*card(h)/8760 ;
 871  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 872  *c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 873  *c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 874  *c_fix_rsvr(rsvr) = c_fix_rsvr(rsvr)*card(h)/8760 ;
 875   
 876  m_e('bio') = m_e('bio')*card(h)/8760 ;
 877   
 878  *c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 879   
 880  *t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) ;
 881  *t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) ;
 882  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(dsm_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
 883  *t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 884   
 885   
 886   
 887  ********************************************************************************
 888   
 889   
 890   
 891   
 892   
 893   
 894   
 895   
 896   
 897  ********************************************************************************
 898   
 899  ***************************
 900  ***** Initialize data *****
 901  ***************************
 902   
 903  * Parameters for default base year
 904  d(h) = d_y('2030',h) ;
 905  phi_res(res,h) = phi_res_y('2030',res,h) ;
 906  phi_min_res = 0 ;
 907  phi_pro_self = 0 ;
 908  phi_pro_load = 0 ;
 909   
      phi_pro_load = 0.2 ;
      $ontext
 914   
 915   
 916  Parameter
 917  phi_min_res_exog;
 918  phi_min_res_exog = 1 ;
 919   
 920  Sets
 921  h_ini(h)                       First hour  /h1/
 922  *h_end(h)                       Last hour   /h8760/
 923  ;
 924   
 925  ********************************************************************************
 926  ***** Model *****
 927  ********************************************************************************
 928   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\model.gms
 930   
 931  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 941  ********************************************************************************
 942   
 943   
 944  Variables
 945  Z                  Value objective function [Euro]
 946  lambda_enerbal     Dual variable on energy balance (1a)
 947  lambda_resgen      Dual variable on renewable generation (3e)
 948  lambda_convgen     Dual variable on conventional generation level (2a)
 949  lambda_stolev      Dual variable on storage level  (4b)
 950  ;
 951   
 952  Positive Variables
 953  G_L(tech,h)            Generation level in hour h [MWh]
 954  G_UP(tech,h)           Generation upshift in hour h [MWh]
 955  G_DO(tech,h)           Generation downshift in hour h [MWh]
 956  G_RES(tech,h)          Generation renewables type res in hour h [MWh]
 957  CU(tech,h)             Renewables curtailment technology res in hour h [MWh]
 958   
 959  STO_IN(sto,h)          Storage inflow technology sto hour h [MWh]
 960  STO_OUT(sto,h)         Storage outflow technology sto hour h [MWh]
 961  STO_L(sto,h)           Storage level technology sto hour h [MWh]
 962   
 963  N_TECH(tech)           Technology tech built [MW]
 964  N_STO_E(sto)           Storage technology built - Energy [MWh]
 965  N_STO_P(sto)           Storage loading and discharging capacity built - Capacity [MW]
 966   
 967  CU_PRO(tech,h)                 Prosumage: curtailment of renewable generation in hour h [MWh]
 968  G_MARKET_PRO2M(tech,h)         Prosumage. energy sent to market in hour h [MWh]
 969  G_MARKET_M2PRO(h)              Prosumage: withdrawal of energy from market in hour h [MWh]
 970  G_RES_PRO(tech,h)              Prosumage: hourly renewables generation in hour h [MWh]
 971  STO_IN_PRO2PRO(tech,sto,h)     Prosumage: storage loading from generation for discharging to consumption in hour h [MWh]
 972  STO_OUT_PRO2PRO(sto,h)         Prosumage: storage discharging to consumption from generation in hour h [MWh]
 973  STO_L_PRO2PRO(sto,h)           Prosumage: storage level generation to consumption in hour h [MWh]
 974  N_STO_E_PRO(sto)               Prosumage: installed storage energy [MWh]
 975  N_STO_P_PRO(sto)               Prosumage: installed storage power [MW]
 976  N_RES_PRO(tech)                Prosumage: installed renewables capacities [MW]
 977   
 978   
 979  mu_stoin_cap          Dual variable on storage loading capacity constraint (4d)
 980  mu_stout_cap          Dual variable on storage discharging capacity constraint (4e)
 981  mu_stolev_cap         Dual variable on energy capacity constraint (4c)
 982  mu_conv_cap           Dual variable on conventional generation capacity constraint (3a)
 983  mu_bio_cap            Dual variable on storage bio energy constraint (5b)
 984  mu_dis_max_i          Dual variable on dispatchable installation constraint (8a)
 985  mu_nondis_max_i       Dual variable on nondispatchable installation constraint (8a)
 986  mu_tech_max_i         Dual variable on tech installation constraint (8a)
 987  mu_stop_max_i         Dual variable on storage power installation constraint  (8c)
 988  mu_stoe_max_i         Dual variable on storage energy installation constraint  (8b)
 989  mu_minRES             Dual variable on minimum renewable share constraint (5a)
 990   
 991  ;
 992   
 993  Set
 994  dis_bio(tech)          Subset of dispatchable technology: Bio mass        /bio/
 995  ;
 996   
 997   
 998  ********************************************************************************
 999   
1000  Equations
1001  * Objective
1002  obj                      Objective cost minimization
1003   
1004  * Energy balance
1005  con1a_bal                Energy Balance
1006   
1007  * Load change costs
1008  con2a_loadlevel          Load change costs: Level
1009  con2b_loadlevelstart     Load change costs: Level for first period
1010  con2_loadlevel           Load change costs: Level of all periods (2a+2b)
1011  * Capacity contraints and flexibility constraints
1012  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1013  con3e_maxprod_res                Capacity constraints renewables
1014   
1015  * Storage constraints
1016  con4a_stolev_start        Storage Level Dynamics Initial Condition
1017  con4b_stolev              Storage Level Dynamics
1018  con4_stolev               Storage Level Dynamics all periods(4a + 4b)
1019  con4c_stolev_max          Storage Power Capacity
1020  con4d_maxin_sto           Storage maximum inflow
1021  con4e_maxout_sto          Storage maximum outflow
1022  con4j_ending              End level equal to initial level
1023  con4k_PHS_EtoP            Maximum E-P ratio
1024   
1025  * Minimum restrictions for renewables and biomass
1026  con5a_minRES             Minimum yearly renewables requirement
1027  con5b_max_energy         Maximum yearly biomass energy
1028   
1029  * Maximum installation conditions
1030  con8a_max_I_power                Maximum installable capacity: Conventionals
1031  con8b_max_I_sto_e                Maximum installable energy: Storage energy in MWh
1032  con8c_max_I_sto_p                Maximum installable capacity: Storage inflow-outflow in MW
1033   
1034  con8f_max_pro_res                Maximum installable capacity: prosumage renewables
1035  con8g_max_pro_sto_e              Maximum installable capacity: prosumage storage energy
1036  con8h_max_sto_pro_p              Maximum installable capacity: prosumage storage power
1037   
1038  * Prosumage
1039  con11a_pro_distrib                       Prosumage: distribution of generated energy
1040  con11b_pro_balance                       Prosumage: energy balance
1041  con11c_pro_selfcon                       Prosumage: minimum self-generation requirement
1042  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumager-to-prosumagers
1043  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial conditions
1044  con11j_pro_stolev_max                    Prosumage: maximum overall storage level
1045  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1046  con11l_pro_maxout_sto                    Prosumage: maximum storage outflow
1047  con11o_pro_ending                        Prosumage: storage ending condition
1048   
1049   
1050  * KKT optimality conditions
1051  KKTG_L                   KKT w.r.t. G_L
1052  KKTG_UP                  KKT w.r.t. G_UP
1053  KKTG_DO                  KKT w.r.t. G_DO
1054  KKTG_RES                 KKT w.r.t. G_RES
1055  KKTCU                    KKT w.r.t. CU
1056  KKTSTO_IN                KKT w.r.t. STO_IN
1057  KKTSTO_OUT               KKT w.r.t. STO_OUT
1058  KKTSTO_L                 KKT w.r.t. STO_L
1059  KKTN_TECH_NONDIS         KKT w.r.t. N_TECH(nondis)
1060  KKTN_TECH_DIS            KKT w.r.t. N_TECH(dis)
1061  KKTN_TECH                KKT w.r.t. N_TECH
1062  KKTN_STO_E               KKT w.r.t. N_STO_E
1063  KKTN_STO_P               KKT w.r.t. N_STO_P
1064  ;
1065   
1066   
1067  ********************************************************************************
1068   
1069  * ---------------------------------------------------------------------------- *
1070  ***** Objective function *****
1071  * ---------------------------------------------------------------------------- *
1072   
1073  obj..
1074           Z =E=
1075                     sum( (h,dis) , c_m(dis)*G_L(dis,h) )
1076                   + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP(dis,h) )
1077                   + sum( (h,dis) , c_do(dis)*G_DO(dis,h) )
1078                   + sum( (h,nondis) , c_cu(nondis)*CU(nondis,h) )
1079                   + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN(sto,h) ) )
1080                   + sum( tech , c_i(tech)*N_TECH(tech) )
1081                   + sum( tech , c_fix(tech)*N_TECH(tech) )
1082                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
1083                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+ N_STO_E(sto)) )
1084                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( res , c_i(res)*N_RES_PRO(res) )
                       + sum( res , c_fix(res)*N_RES_PRO(res) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto) + N_STO_E_PRO(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) + sum( res , STO_IN_PRO2PRO(res,sto,h)) ) )
      $ontext
1094  ;
1095   
1096  * ---------------------------------------------------------------------------- *
1097  ***** Energy balance and load levels *****
1098  * ---------------------------------------------------------------------------- *
1099   
1100  * Energy balance
1101  con1a_bal(h)..
1102   
1103             sum( dis , G_L(dis,h)) + sum( nondis , G_RES(nondis,h)) + sum( sto , STO_OUT(sto,h) )
               + sum( res , G_MARKET_PRO2M(res,h) )
      $ontext
1108           -  ( 1 - phi_pro_load )* d(h)
1109           -   sum( sto , STO_IN(sto,h) )
1110   
               - G_MARKET_M2PRO(h)
      $ontext
1115   
1116         =E= 0
1117  ;
1118   
1119  con2a_loadlevel(dis,h)$(ord(h) > 1)..
1120           G_L(dis,h-1) + G_UP(dis,h) - G_DO(dis,h)  - G_L(dis,h) =E= 0
1121  ;
1122   
1123  con2b_loadlevelstart(dis,h)$(ord(h) = 1)..
1124          G_UP(dis,h) - G_L(dis,h) =E= 0
1125  ;
1126   
1127  con2_loadlevel(dis,h)..
1128             G_UP(dis,h)  - G_L(dis,h)
1129          +  (G_L(dis,h-1) - G_DO(dis,h))$(ord(h) > 1)
1130          =E= 0
1131  ;
1132   
1133   
1134   
1135  * ---------------------------------------------------------------------------- *
1136  ***** Hourly maximum generation caps *****
1137  * ---------------------------------------------------------------------------- *
1138   
1139  con3a_maxprod_dispatchable(dis,h)..
1140   
1141           N_TECH(dis) -  G_L(dis,h)  =G= 0
1142   
1143  ;
1144   
1145  con3e_maxprod_res(nondis,h)..
1146   
1147   
1148         phi_res(nondis,h)*N_TECH(nondis) - G_RES(nondis,h) - CU(nondis,h) =E= 0
1149  ;
1150   
1151  * ---------------------------------------------------------------------------- *
1152  ***** Storage constraints *****
1153  * ---------------------------------------------------------------------------- *
1154   
1155  con4a_stolev_start(sto,h)$(ord(h) = 1)..
1156          phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  - STO_L(sto,h)  =E= 0
1157  ;
1158   
1159  con4b_stolev(sto,h)$(ord(h)>1)..
1160          STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h) =E= 0
1161  ;
1162   
1163  con4_stolev(sto,h)..
1164   
1165         + STO_IN(sto,h)*(1+eta_sto(sto))/2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2  -  STO_L(sto,h)
1166         + (STO_L(sto,h-1))$(ord(h)>1)
1167         =E= 0
1168  ;
1169   
1170   
1171  con4c_stolev_max(sto,h)..
1172         N_STO_E(sto) -  STO_L(sto,h) =G= 0
1173  ;
1174   
1175  con4d_maxin_sto(sto,h)..
1176   
1177          N_STO_P(sto) -  STO_IN(sto,h)   =G= 0
1178  ;
1179   
1180  con4e_maxout_sto(sto,h)..
1181   
1182          N_STO_P(sto) - STO_OUT(sto,h)   =G= 0
1183  ;
1184   
1185  con4j_ending(sto,h)$(ord(h) = card(h))..
1186   
1187          phi_sto_ini(sto) * N_STO_E(sto) -  STO_L(sto,h) =E= 0
1188  ;
1189   
1190   
1191  con4k_PHS_EtoP(sto)..
1192           etop_max(sto) * N_STO_P(sto) - N_STO_E(sto) =G= 0
1193  ;
1194   
1195  * ---------------------------------------------------------------------------- *
1196  ***** Quotas for renewables and biomass *****
1197  * ---------------------------------------------------------------------------- *
1198   
1199  con5a_minRES..
1200  sum( h , G_L('bio',h) + sum(nondis , G_RES(nondis,h))
1201   
               + sum( (sto) , STO_OUT_PRO2PRO(sto,h) + sum( (res) , G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h))
      $ontext
1206  )
1207          - phi_min_res * phi_min_res_exog * sum( h ,
1208           sum( (dis) , G_L(dis,h)) + sum( (nondis) , G_RES(nondis,h))
1209   
               + sum( (res) , phi_res(res,h) * N_RES_PRO(res) - CU_PRO(res,h))
      $ontext
1214           )  =G= 0
1215  ;
1216   
1217  con5b_max_energy(tech)$dis_bio(tech)..
1218           m_e(tech) -  sum( h , G_L(tech,h) ) =G= 0
1219  ;
1220   
1221   
1222  * ---------------------------------------------------------------------------- *
1223  ***** Maximum installation constraints *****
1224  * ---------------------------------------------------------------------------- *
1225   
1226  con8a_max_I_power(tech)..
1227         m_p(tech) - N_TECH(tech)     =G= 0
1228  ;
1229   
1230  con8b_max_I_sto_e(sto)..
1231         m_sto_e(sto) - N_STO_E(sto)  =G= 0
1232  ;
1233   
1234  con8c_max_I_sto_p(sto)..
1235         m_sto_p(sto) -  N_STO_P(sto) =G= 0
1236  ;
1237   
1238   
1239   
1240  con8f_max_pro_res(res)..
1241         m_res_pro(res) -  N_RES_PRO(res)     =G= 0
1242  ;
1243   
1244  con8g_max_pro_sto_e(sto)..
1245         m_sto_pro_e(sto) -  N_STO_E_PRO(sto) =G= 0
1246  ;
1247   
1248  con8h_max_sto_pro_p(sto)..
1249          m_sto_pro_p(sto) -  N_STO_P_PRO(sto) =G= 0
1250  ;
1251   
1252  * ---------------------------------------------------------------------------- *
1253  ***** Prosumage constraints *****
1254  * ---------------------------------------------------------------------------- *
1255   
1256  con11a_pro_distrib(res,h)..
1257           phi_res(res,h) * N_RES_PRO(res)
1258           =E=
1259           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( sto , STO_IN_PRO2PRO(res,sto,h) )
1260  ;
1261   
1262  con11b_pro_balance(h)..
1263           phi_pro_load * d(h)
1264           =E=
1265           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1266  ;
1267   
1268  con11c_pro_selfcon..
1269           sum( (h,res) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PRO(sto,h) )
1270           =G=
1271           phi_pro_self * sum( h , phi_pro_load * d(h))
1272  ;
1273   
1274  con11d_pro_stolev_PRO2PRO(sto,h)$(ord(h) > 1 )..
1275           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1276  ;
1277   
1278   
1279  con11h_1_pro_stolev_start_PRO2PRO(sto,h)$( ord(h) = 1)..
1280          STO_L_PRO2PRO(sto,h) =E=   phi_sto_pro_ini(sto) * N_STO_E_PRO(sto) + sum( res , STO_IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_sto(sto))*2
1281  ;
1282   
1283   
1284  con11j_pro_stolev_max(sto,h)..
1285         N_STO_E_PRO(sto) - STO_L_PRO2PRO(sto,h) =G= 0
1286  ;
1287   
1288  con11k_pro_maxin_sto(sto,h)..
1289          N_STO_P_PRO(sto) - sum( res , STO_IN_PRO2PRO(res,sto,h) )
1290          =G= 0
1291  ;
1292   
1293  con11l_pro_maxout_sto(sto,h)..
1294          N_STO_P_PRO(sto) - STO_OUT_PRO2PRO(sto,h)
1295          =G= 0
1296  ;
1297   
1298  con11o_pro_ending(sto,h)$( ord(h) = card(h))..
1299           STO_L_PRO2PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1300  ;
1301   
1302  * ---------------------------------------------------------------------------- *
1303  ***** FOC conditions *****
1304  * ---------------------------------------------------------------------------- *
1305   
1306  KKTG_L(tech,h)$dis(tech)..
1307   
1308      + c_m(tech)
1309      - lambda_enerbal(h)
1310      + lambda_convgen(tech,h)
1311      + mu_conv_cap(tech,h)
          + mu_bio_cap(tech)$dis_bio(tech)
      $ontext
1316     - (lambda_convgen(tech,h+1))$(ord(h) > 1)
1317      =G= 0
1318   
1319  ;
1320   
1321  KKTG_UP(dis,h)..
1322   
1323       - lambda_convgen(dis,h)
1324       + (c_up(dis))$(ord(h)> 1)
1325     =G= 0
1326   
1327  ;
1328   
1329  KKTG_DO(dis,h)..
1330   
1331       + c_do(dis)
1332       + (lambda_convgen(dis,h))$(ord(h) > 1)
1333       =G= 0
1334   
1335  ;
1336   
1337  KKTG_RES(nondis,h)..
1338   
1339       - lambda_enerbal(h) + lambda_resgen(nondis,h)
1340       =G= 0
1341  ;
1342   
1343  KKTCU(nondis,h)..
1344   
1345       c_cu(nondis) + lambda_resgen(nondis,h) =G= 0
1346   
1347  ;
1348   
1349  KKTSTO_IN(sto,h)..
1350   
1351      c_m_sto(sto)  + lambda_enerbal(h) -  lambda_stolev(sto,h)*(1+eta_sto(sto))/2
1352      + mu_stoin_cap(sto,h) =G= 0
1353  ;
1354   
1355  KKTSTO_OUT(sto,h)..
1356   
1357       c_m_sto(sto)  -  lambda_enerbal(h) +  lambda_stolev(sto,h)/(1+eta_sto(sto))*2
1358       +  mu_stout_cap(sto,h)
1359        =G= 0
1360  ;
1361   
1362  KKTSTO_L(sto,h)..
1363   
1364    + lambda_stolev(sto,h)
1365    +  mu_stolev_cap(sto,h)
1366    -  (lambda_stolev(sto,h+1))$(ord(h) > 1 )
1367   
1368    =G= 0
1369   
1370  ;
1371   
      KKTN_TECH_NONDIS(nondis)..
       
          c_i(nondis) +  c_fix(nondis)
          - sum( h,  lambda_resgen(nondis,h)*phi_res(nondis,h)) + mu_nondis_max_i(nondis)
          =G= 0
      ;
       
      KKTN_TECH_DIS(dis)..
       
           c_i(dis) +  c_fix(dis) - sum( h,  lambda_convgen(dis,h)) +  mu_dis_max_i(dis)
           =G= 0
       
      ;
1387   
1388  KKTN_TECH(tech)..
1389   
1390            +  c_i(tech)
1391            +  c_fix(tech)
                +  mu_tech_max_i(tech)       
      $ontext
1396            - sum( h,   mu_conv_cap(tech,h))$dis(tech)
1397            - sum( h,  lambda_resgen(tech,h)*phi_res(tech,h))$nondis(tech)
1398       =G= 0
1399   
1400  ;
1401   
1402   
1403   
1404  KKTN_STO_E(sto)..
1405   
1406        +  c_fix_sto(sto)/2 +  c_i_sto_e(sto)
1407        -  sum( h,   mu_stolev_cap(sto,h))
            +  mu_stoe_max_i(sto)
      $ontext
1412        =G= 0
1413  ;
1414   
1415  KKTN_STO_P(sto)..
1416   
1417   
1418       c_fix_sto(sto)/2 + c_i_sto_p(sto)
1419       - sum( h, (mu_stoin_cap(sto,h) + mu_stout_cap(sto,h)))
           + mu_stop_max_i(sto)
      $ontext
1424       =G= 0
1425   
1426  ;
1427   
1428   
1429  ********************************************************************************
1430  ***** Fix unmatched variables of first period *****
1431  ********************************************************************************
1432   
1433  G_DO.fx(dis,'h1') = 0;
1434  *G_L.fx('lig','h1') = 6462.10261116911;
1435   
1436  * Default for reporting
1437  G_DO.l(dis,h) = 0;
1438  G_L.l(dis,h) = 0 ;
1439  G_UP.l(dis,h) = 0 ;
1440  G_RES.l(tech,h)= 0;
1441  CU.l(tech,h) = 0;
1442   
1443  STO_IN.l(sto,h)= 0;
1444  STO_OUT.l(sto,h)= 0;
1445  STO_L.l(sto,h) = 0;
1446   
1447  N_TECH.l(tech)= 0;
1448  N_STO_E.l(sto)= 0;
1449  N_STO_P.l(sto)= 0;
1450   
1451   
1452  ********************************************************************************
1453  ***** MODEL *****
1454  ********************************************************************************
1455   
1456  model DIETER /
1457  obj
1458   
1459  con1a_bal
1460   
1461  *con2a_loadlevel
1462  *con2b_loadlevelstart
1463  con2_loadlevel
1464   
1465  con3a_maxprod_dispatchable
1466  con3e_maxprod_res
1467   
1468  *con4a_stolev_start
1469  *con4b_stolev
1470  con4_stolev
1471  con4c_stolev_max
1472  con4d_maxin_sto
1473  con4e_maxout_sto
1474  *con4k_PHS_EtoP
1475  *con4j_ending
1476   
1477  con5a_minRES
      con5b_max_energy
      $ontext
1482   
      con8a_max_I_power
      con8b_max_I_sto_e
      con8c_max_I_sto_p
      $ontext
1489   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11h_1_pro_stolev_start_PRO2PRO
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11o_pro_ending
      $ontext
1505   
1506  /;
1507   
1508  model DIETER_MCP /
1509   
1510  con1a_bal.lambda_enerbal
1511  con2_loadlevel.lambda_convgen
1512   
1513  con3a_maxprod_dispatchable.mu_conv_cap
1514  con3e_maxprod_res.lambda_resgen
1515   
1516  con4_stolev.lambda_stolev
1517  con4c_stolev_max.mu_stolev_cap
1518  con4d_maxin_sto.mu_stoin_cap
1519  con4e_maxout_sto.mu_stout_cap
1520   
      con5b_max_energy.mu_bio_cap
      $ontext
1525   
      con8a_max_I_power.mu_tech_max_i
      con8b_max_I_sto_e.mu_stoe_max_i
      con8c_max_I_sto_p.mu_stop_max_i
      $ontext
1532   
1533  KKTG_L.G_L
1534  KKTG_UP.G_UP
1535  KKTG_DO.G_DO
1536  KKTG_RES.G_RES
1537  KKTCU.CU
1538  KKTSTO_IN.STO_IN
1539  KKTSTO_OUT.STO_OUT
1540  KKTSTO_L.STO_L
1541   
      KKTN_TECH.N_TECH
      KKTN_STO_E.N_STO_E
      KKTN_STO_P.N_STO_P
      $ontext
1548  / ;
1549   
1550  ********************************************************************************
1551  ***** Options, fixings, report preparation *****
1552  ********************************************************************************
1553   
1554  * Solver options
1560   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
1571   
1572  dieter.OptFile = 1;
1573  dieter.holdFixed = 1 ;
1574   
1575   
1576  ********************************************************************************
1577  ***** Solve *****
1578  ********************************************************************************
1579   
1580  * Preparation of GUSS tool for scenario analysis
1581  phi_min_res = eps ;
1582  phi_pro_self = eps ;
1583   
1585   
1586  Set
1587  modelstats       model stats collection                  /modelstat, solvestat, resusd/
1588  superscen        Scenarios                               /scen1*scen1000/
1589  map(superscen,loop_res_share,loop_prosumage)    /#superscen:(#loop_res_share.#loop_prosumage)/
1590  ;
1591   
1592  set
1593  scen(superscen);
1594  scen(superscen) = yes$( sum((loop_res_share,loop_prosumage) , map(superscen,loop_res_share,loop_prosumage)) )    ;
1595   
1596  Parameters
1597  gussoptions                              /Logoption 2, Optfile 1, Skipbasecase 1/
1598  modstats(superscen, modelstats)
1599  min_res
1600  pro_selfcon
1601  ;
1602   
1603  min_res(scen)     = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_res_share.val/100 ) ;
1604  pro_selfcon(scen) = sum( (loop_res_share,loop_prosumage)$map(scen,loop_res_share,loop_prosumage) , loop_prosumage.val/100 ) ;
1605   
1606  Parameters
1607  * Equations
1608  marginal_con5a(superscen)
1609  marginal_con1a(superscen,*)
1610  marginal_con9a(superscen,*,*,*)
1611  marginal_con9b(superscen,*,*,*)
1612   
1613  * Basic
1614  lev_Z(superscen)
1615  lev_G_L(superscen,tech,h)
1616  lev_G_UP(superscen,tech,h)
1617  lev_G_DO(superscen,tech,h)
1618  lev_G_RES(superscen,tech,h)
1619  lev_CU(superscen,tech,h)
1620  lev_STO_IN(superscen,sto,h)
1621  lev_STO_OUT(superscen,sto,h)
1622  lev_STO_L(superscen,sto,h)
1623  lev_N_TECH(superscen,tech)
1624  lev_N_STO_E(superscen,sto)
1625  lev_N_STO_P(superscen,sto)
1626   
1627   
1628  * Prosumage
1629  lev_CU_PRO(superscen,tech,h)
1630  lev_G_MARKET_PRO2M(superscen,tech,h)
1631  lev_G_MARKET_M2PRO(superscen,h)
1632  lev_G_RES_PRO(superscen,tech,h)
1633  lev_STO_IN_PRO2PRO(superscen,tech,sto,h)
1634  lev_STO_IN_PRO2M(superscen,tech,sto,h)
1635  lev_STO_IN_M2PRO(superscen,sto,h)
1636  lev_STO_IN_M2M(superscen,sto,h)
1637  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1638  lev_STO_OUT_PRO2M(superscen,sto,h)
1639  lev_STO_OUT_M2PRO(superscen,sto,h)
1640  lev_STO_OUT_M2M(superscen,sto,h)
1641  lev_STO_L_PRO2PRO(superscen,sto,h)
1642  lev_STO_L_PRO2M(superscen,sto,h)
1643  lev_STO_L_M2PRO(superscen,sto,h)
1644  lev_STO_L_M2M(superscen,sto,h)
1645  lev_N_STO_E_PRO(superscen,sto)
1646  lev_N_STO_P_PRO(superscen,sto)
1647  lev_STO_L_PRO(superscen,sto,h)
1648  lev_N_RES_PRO(superscen,tech)
1649  ;
1650   
1651   
1652  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\fix.gms
1654   
1655  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1665  ********************************************************************************
1666   
1667   
1668   
1669  ********************************************************************************
1670  **** Run of river  *************************************************************
1671  ********************************************************************************
1672   
1673  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('ror') (but no reserve provision):
1674   
1675  *$ontext
1676  N_TECH.fx('ror') = 5857.47 ;
1677  G_RES.fx('ror',h) = N_TECH.l('ror') * phi_res('ror',h) ;
1680   
1681  * Fix everything to zero in case no ROR option is selected:
1682  *N_TECH.fx('ror') = 0 ;
1683  *G_RES.fx('ror',h) = 0 ;
1684  *%ror_parameter%%ror_variable%RP_NONDIS.fx('ror',h) = 0 ;
1685   
1686   
1687  ********************************************************************************
1688  **** No storage and DSM in first period  ***************************************
1689  ********************************************************************************
1690   
1691  ** No storage inflow in first period **
1692  STO_IN.fx(sto,h)$(ord(h) = 1) = 0;
1693   
1694   
1695   
1696  ********************************************************************************
1697  **** No primary reserves by heating devices  ***********************************
1698  ********************************************************************************
1699   
1700   
1701  ********************************************************************************
1702  **** Fixing to reduce model size  **********************************************
1703  ********************************************************************************
1704   
1705  *F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
1706  *NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
1707   
1708  G_L.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1709  G_UP.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1710  G_DO.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1711  N_TECH.fx(tech)$(m_p(tech) = 0) = 0 ;
1712  G_RES.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1713  CU.fx(tech,h)$(m_p(tech) = 0) = 0 ;
1714   
1715  N_STO_P.fx(sto)$(m_sto_p(sto) = 0) = 0 ;
1716  N_STO_E.fx(sto)$(m_sto_e(sto) = 0) = 0 ;
1717  STO_IN.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1718  STO_OUT.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1719  STO_L.fx(sto,h)$(m_sto_p(sto) = 0) = 0 ;
1720   
1721   
1722  Variables
1723  STO_IN_PRO2M(tech,sto,h)
1724  STO_IN_M2PRO(sto,h)
1725  STO_IN_M2M(sto,h)
1726  STO_OUT_PRO2M(sto,h)
1727  STO_OUT_M2PRO(sto,h)
1728  STO_OUT_M2M(sto,h)
1729  STO_L_PRO(sto,h)
1730  STO_L_PRO2M(sto,h)
1731  STO_L_M2PRO(sto,h)
1732  STO_L_M2M(sto,h)
1733  ;
1734   
      CU_PRO.fx(res,h)$(m_res_pro(res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      *G_MARKET_M2PRO.fx(h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(res,h)$( m_res_pro(res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(res,sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_IN_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_OUT_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_M2M.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_E_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_STO_P_PRO.fx(sto)$( m_sto_pro_p(sto) = 0) = 0 ;
      STO_L_PRO.fx(sto,h)$( m_sto_pro_p(sto) = 0) = 0 ;
      N_RES_PRO.fx(res)$( m_res_pro(res) = 0) = 0 ;
      $ontext
1758   
1759  * Deactivated market storage links
1760   
1761  STO_IN_PRO2M.fx(tech,sto,h) = 0 ;
1762  STO_IN_M2PRO.fx(sto,h)     = 0 ;
1763  STO_IN_M2M.fx(sto,h)       = 0 ;
1764  STO_OUT_PRO2M.fx(sto,h)    = 0 ;
1765  STO_OUT_M2PRO.fx(sto,h)    = 0 ;
1766  STO_OUT_M2M.fx(sto,h)      = 0 ;
1767  STO_L_PRO.fx(sto,h)        = 0 ;
1768  STO_L_PRO2M.fx(sto,h)      = 0 ;
1769  STO_L_M2PRO.fx(sto,h)      = 0 ;
1770  STO_L_M2M.fx(sto,h)        = 0 ;
1771   
1772  ********************************************************************************
1773  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *************************************
1774  ********************************************************************************
1775   
1776  * Default level zero for report parameters
1777  lev_Z(scen) = 0 ;
1778  lev_G_L(scen,tech,h) = 0 ;
1779  lev_G_UP(scen,tech,h) = 0 ;
1780  lev_G_DO(scen,tech,h) = 0 ;
1781  lev_G_RES(scen,tech,h) = 0 ;
1782  lev_CU(scen,tech,h) = 0 ;
1783  lev_STO_IN(scen,sto,h) = 0 ;
1784  lev_STO_OUT(scen,sto,h) = 0 ;
1785  lev_STO_L(scen,sto,h) = 0 ;
1786  lev_N_TECH(scen,tech) = 0 ;
1787  lev_N_STO_E(scen,sto) = 0 ;
1788  lev_N_STO_P(scen,sto) = 0 ;
1789  marginal_con1a(scen,h) = 0 ;
1790  marginal_con5a(superscen) = 0 ;
1791   
1792  * Prosumage
1793  lev_CU_PRO(scen,tech,h) = 0 ;
1794  lev_G_MARKET_PRO2M(scen,tech,h) = 0  ;
1795  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1796  lev_G_RES_PRO(scen,tech,h) = 0  ;
1797  lev_STO_IN_PRO2PRO(scen,tech,sto,h) = 0  ;
1798  lev_STO_IN_PRO2M(scen,tech,sto,h) = 0  ;
1799  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1800  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1801  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1802  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1803  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1804  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1805  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1806  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1807  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1808  lev_STO_L_M2M(scen,sto,h) = 0  ;
1809  lev_N_STO_E_PRO(scen,sto) = 0  ;
1810  lev_N_STO_P_PRO(scen,sto) = 0  ;
1811  lev_STO_L_PRO(scen,sto,h) = 0  ;
1812  lev_N_RES_PRO(scen,tech) = 0  ;
1813   
1814   
1815  * Fixing of report parameters for run-of-river
1816  *$ontext
1817  lev_N_TECH(scen,'ror') = 5857.47 ;
1818  lev_G_RES(scen,'ror',h) = lev_N_TECH(scen,'ror') * phi_res('ror',h) ;
      %ror_parameter%%ror_variable%lev_N_TECH(scen'ror') = 0 ;
      %ror_parameter%%ror_variable%lev_G_RES(scen'ror',h) = 0 ;
      %reserves%$ontext
      *%ror_parameter%%ror_variable%lev_RP_CON(scenreserves,'ror',h) = 0 ;
      $ontext
1828   
1829   
1830   
1831   
1832   
1833   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\scenario.gms
1835   
1836  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1846  ********************************************************************************
1847   
1848   
1849   
1850   
1851  *****************************************
1852  **** Scenario file                   ****
1853  ****                                 ****
1854  *****************************************
1855   
1856  Parameter
1857  m_exog_p(tech)
1858  m_exog_sto_e(sto)
1859  m_exog_sto_p(sto)
1860   
1861  ;
1862   
1863  m_exog_p(tech)    = technology_data(tech,'fixed_capacities') ;
1864  m_exog_sto_e(sto) = storage_data(sto,'fixed_capacities_energy');
1865  m_exog_sto_p(sto) = storage_data(sto,'fixed_capacities_power');
1866   
1867   
1868  *** Dispatch model
1869  *$ontext
1870  N_TECH.fx(tech)  = m_exog_p(tech) + 0.1 ;
1871  N_STO_P.fx(sto)  = m_exog_sto_p(sto) ;
1872  N_STO_E.fx(sto)  = m_exog_sto_e(sto) ;
1873   
1874  N_TECH.fx('nuc')     = no  ;
1875  N_STO_E.fx('sto1')   = no ;
1876  N_STO_E.fx('sto2')   = no ;
1877  N_STO_E.fx('sto3')   = no ;
1878  N_STO_E.fx('sto4')   = no ;
1879  N_STO_E.fx('sto6')   = no ;
1880  N_STO_E.fx('sto7')   = no ;
1881  N_STO_P.fx('sto1')   = no ;
1882  N_STO_P.fx('sto2')   = no ;
1883  N_STO_P.fx('sto3')   = no ;
1884  N_STO_P.fx('sto4')   = no ;
1885  N_STO_P.fx('sto6')   = no ;
1886  N_STO_P.fx('sto7')   = no ;
1887   
1890   
1891  *** Investment model
      N_TECH.lo(tech)        = 0 ;
      N_TECH.lo('wind_on')   = m_exog_p('wind_on') ;
      N_TECH.lo('wind_off')  = m_exog_p('wind_off') ;
      N_TECH.lo('pv')        = m_exog_p('pv') ;
      N_STO_P.lo(sto)        = m_exog_sto_p(sto) ;
      N_STO_E.lo(sto)        = m_exog_sto_e(sto) ;
      N_TECH.up(tech)        = m_exog_p(tech) + 0.1 ;
      N_TECH.up('wind_on')   = inf ;
      N_TECH.up('wind_off')  = inf ;
      N_TECH.up('pv')        = inf ;
      N_STO_P.up(sto)        = m_exog_sto_p(sto) + 0.1 ;
      N_STO_E.up(sto)        = m_exog_sto_e(sto) + 0.1 ;
      N_STO_P.up('sto1')     = inf ;
      N_STO_P.up('sto5')     = inf ;
      N_STO_P.up('sto7')     = inf ;
      N_STO_E.up('sto1')     = inf ;
      N_STO_E.up('sto5')     = inf ;
      N_STO_E.up('sto7')     = inf ;
      $ontext
1913   
1914   
1915   
1916  * Definition of dictionary set for GUSS tool
1917   
1918  Set dict(*,*,*) /
1919  scen             .scenario       .''
1920  gussoptions      .opt            .modstats
1921   
1922  phi_min_res      .param          .min_res
1923   
      phi_pro_self     .param          .pro_selfcon
      $ontext
1928   
1929   
1930  con5a_minRES     .marginal       .marginal_con5a
1931  con1a_bal        .marginal       .marginal_con1a
1932   
1933   
1934  *$ontext
1935  Z                .level          .lev_Z
1938  G_L              .level          .lev_G_L
1939  G_UP             .level          .lev_G_UP
1940  G_DO             .level          .lev_G_DO
1941  G_RES            .level          .lev_G_RES
1942  CU               .level          .lev_CU
1943  STO_IN           .level          .lev_STO_IN
1944  STO_OUT          .level          .lev_STO_OUT
1945  STO_L            .level          .lev_STO_L
1946  N_TECH           .level          .lev_N_TECH
1947  N_STO_E          .level          .lev_N_STO_E
1948  N_STO_P          .level          .lev_N_STO_P
1949   
1950   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
1964  /
1965  ;
1966   
1967   
1968   
1969  *$ontext
1970  solve  DIETER using lp min Z scenario dict;
1971   
1972   
1973   
1974  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\report.gms
1976   
1977  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1987  ********************************************************************************
1988   
1990   
1991   
1992   
1993   
1994  ********************************************************************************
1995  **** Parameters for report file  ***********************************************
1996  ********************************************************************************
1997   
1998  Parameter
1999  corr_fac_dis             Balancing correction factor - dispatchable technologies
2000  corr_fac_nondis          Balancing correction factor - nondispatchable technologies
2001  corr_fac_sto             Balancing correction factor - storage technologies
2002  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment technologies
2003  corr_fac_dsm_shift       Balancing correction factor - DSM shifting technologies
2004  corr_fac_ev              Balancing correction factor - electric vehicles
2005  corr_fac_rsvr            Balancing correction factor - reservoir
2006  corr_fac_sets            Balancing correction factor - SETS
2007  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
2008  corr_fac_hp              Balancing correction factor - heat pumps
2009  corr_fac_h_elec          Balancing correction factor - hybrid electric storage heating
2010   
2011  corr_fac_ev_sep
2012   
2013  gross_energy_demand                      Gross energy demand
2014  gross_energy_demand_market               Gross energy demand - market (non-prosumage segment)
2015  gross_energy_demand_prosumers            Gross energy demand - prosumagers
2016  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers self-generated
2017  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers from market
2018   
2019  reserves_activated
2020   
2021  calc_maxprice
2022  calc_minprice
2023   
2024  report
2025  report_tech
2026  report_tech_hours
2027  report_hours
2028  report_node
2029  report_line
2030  report_cost
2031   
2032  report_reserves
2033  report_reserves_hours
2034  report_reserves_tech
2035  report_reserves_tech_hours
2036   
2037  report_prosumage
2038  report_prosumage_tech
2039  report_prosumage_tech_hours
2040  report_market
2041  report_market_tech
2042  report_market_tech_hours
2043   
2044  report_heat_tech_hours
2045  report_heat_tech
2046  ;
2047   
2048   
2049   
2050   
2051  ********************************************************************************
2052  **** Initialize reporting paremetrs  *******************************************
2053  ********************************************************************************
2054   
2055  * Set reporting sensitivity. All results below will be reported as zero
2056  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        / 1e-4 / ;
2057  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         / 1e-2 / ;
2058  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   / 1 /    ;
2059   
2060   
2061  * ----------------------------------------------------------------------------
2062   
2063  * Min and max for prices
2064  calc_maxprice = 0 ;
2065  calc_minprice = 1000 ;
2066   
2067   
2068  * ----------------------------------------------------------------------------
2069   
2070  * Default values for correction factors
2071  corr_fac_dis(scen,dis,h) = 0 ;
2072  corr_fac_nondis(scen,nondis,h) = 0 ;
2073  corr_fac_sto(scen,sto,h) = 0 ;
2074  *corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2075  *corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2076  *corr_fac_ev(scen,h) = 0 ;
2077  *corr_fac_rsvr(scen,rsvr,h) = 0 ;
2078  *corr_fac_sets(scen,bu,ch,h) = 0 ;
2079  *corr_fac_sets_aux(scen,bu,ch,h) = 0 ;
2080  *corr_fac_hp(scen,bu,ch,h) = 0 ;
2081  *corr_fac_h_elec(scen,bu,ch,h) = 0 ;
2082   
2083  *corr_fac_ev_sep(scen,ev,h) = 0 ;
2084   
2085   
2086  * ----------------------------------------------------------------------------
2087   
2088  * Parameter for hourly nodal reserves activated
2089  reserves_activated(scen,h) = 0 ;
2090   
2091   
2092   
2093   
2094   
2095  * ----------------------------------------------------------------------------
2096   
2097  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen)= sum( h , phi_pro_load * d(h));
      gross_energy_demand_prosumers_selfgen(scen)= sum( (h,res) , lev_G_RES_PRO(scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen)= sum( h , lev_G_MARKET_M2PRO(scen,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
      $ontext
2104   
2105   
2106  * ----------------------------------------------------------------------------
2107   
2108  *Determine balancing correction factors
2109   
2110   
2111   
2112   
2113  * ----------------------------------------------------------------------------
2114   
2115  * Define gross energy demand for reporting
2116  gross_energy_demand(scen)= sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto,h) - lev_STO_OUT(scen,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(scen,sto,h) - lev_STO_OUT_M2PR
      O(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
      $ontext
2121   
2122   
2123  )
2124  ;
2125   
2126   
2127  ********************************************************************************
2128  **** Report  *******************************************************************
2129  ********************************************************************************
2130   
2131  * RPEORT model statistics
2132          report('model status',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'modelstat')) ;
2133          report('solve time',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , modstats(scen,'resusd')) ;
2134          report('obj value',loop_res_share,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_Z(scen)* 1) ;
2135   
2136   
2137  * ----------------------------------------------------------------------------
2138   
2139  * REPORT HOURS
2140          report_hours('demand consumers',loop_res_share,loop_prosumage,h)= d(h) ;
2141          report_hours('energy generated',loop_res_share,loop_prosumage,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h) ) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h)) + sum( sto , l
      ev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2142  *+ sum( dsm_shift, lev_DSM_DO_DEMAND(scen,dsm_shift,h)
2143  *- corr_fac_dsm_shift(scen,dsm_shift,h))
2144  *+ sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h) + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2145  + sum( res , lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h))) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M
      2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) ) ;
2146  *        report_hours('infeasibility',loop_res_share,loop_prosumage,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h));
2147  *        report_hours('gross exports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) )) ;
2148  *        report_hours('gross imports',loop_res_share,loop_prosumage,h)= sum( l , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2149          report_hours('price',loop_res_share,loop_prosumage,h)= - sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)) ;
2150   
2151                   report_hours('energy generated',loop_res_share,loop_prosumage,h)$(report_hours('energy generated',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2152                   report_hours('energy demanded',loop_res_share,loop_prosumage,h)$(report_hours('energy demanded',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2153  *                 report_hours('gross exports',loop_res_share,loop_prosumage,h)$(report_hours('gross exports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2154  *                 report_hours('gross imports',loop_res_share,loop_prosumage,h)$(report_hours('gross imports',loop_res_share,loop_prosumage,h)< eps_rep_abs ) = 0 ;
2155                   report_hours('demand consumers',loop_res_share,loop_prosumage,h)$(report_hours('demand consumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2156                   report_hours('price',loop_res_share,loop_prosumage,h)$(report_hours('price',loop_res_share,loop_prosumage,h)< eps_rep_abs AND report_hours('price',loop_res_share,loop_prosumage,h)> -eps_rep_abs) = eps ;
2157  *                 report_hours('infeasibility',loop_res_share,loop_prosumage,h)$(report_hours('infeasibility',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
2158   
2159   
2160  * ----------------------------------------------------------------------------
2161   
2162  * REPORT TECH HOURS
2163          report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
2164  *        report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_INFES(scen,h) ) ;
2165          report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) ) ;
2166  *        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) ) ;
2167  *        report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , rsvr_in(rsvr,h)/1000 * lev_N_RSVR_E(scen,rsvr) ) ;
2168  *        report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_L(scen,rsvr,h) ) ;
2169          report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2170          report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(
      scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) ;
2171          report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_
      STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) ) ;
2172          report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2173  *        report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - sum( l , inc(l)* lev_F(scen,l,h)) ) ;
2174   
2175                   report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)$(report_tech_hours('generation conventional',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
2176                   report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2177  *  star added        report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('generation renewable',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2178                   report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct res',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
2179                   report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2180                   report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2181                   report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
2182  *                 report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)$(abs(report_tech_hours('netto exports',loop_res_share,loop_prosumage,'',h)) < eps_rep_abs ) = 0 ;
2183  *                 report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)$(report_tech_hours('infeasibility',loop_res_share,loop_prosumage,'',h)< eps_rep_abs ) = 0 ;
2184  *                 report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir inflow',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2185  *                 report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)$(report_tech_hours('reservoir level',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
2186   
2187   
2188  * ----------------------------------------------------------------------------
2189   
2190  * RPEORT LINE
2191   
2192  * ----------------------------------------------------------------------------
2193   
2194  * REPORT NODE
2195          report_node('energy demand total',loop_res_share,loop_prosumage)= (sum( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2
      M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
2196   
2197  ;
2198          report_node('energy demand gross',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2199          report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2200  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h))
2201           + sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) )) ;
2202          report_node('energy generated gross',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , lev_G_L(scen,dis,h)) + sum( nondis , lev_G_RES(scen,nondis,h) - corr_fac_nondis(scen,nondis,h))
2203  *        + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
2204           + sum( sto , lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
2205  *+ sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
2206  +  sum( res , phi_res(res,h) * lev_N_RES_PRO(scen,res) - lev_CU_PRO(scen,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h)) )) ;
2207  *        report_node('net exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - inc(l)* lev_F(scen,l,h)) ) ;
2208  *        report_node('gross exports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , -min(inc(l)* lev_F(scen,l,h),0) ) ) ;
2209  *        report_node('gross imports',loop_res_share,loop_prosumage)= sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , max(inc(l)* lev_F(scen,l,h),0) ) ) ;
2210  *        report_node('net import share in gross demand',loop_res_share,loop_prosumage)= -min(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy demand gross',loop_res_share,loop_prosumage);
2211  *        report_node('net export share in net generation',loop_res_share,loop_prosumage)= max(report_node('net exports',loop_res_share,loop_prosumage),0)/report_node('energy generated net',loop_res_share,loop_prosumage);
2212  *        report_node('trade capacity',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( l , abs(inc(l)* lev_NTC(scen,l))) ) ;
2213  *        report_node('gross import share',loop_res_share,loop_prosumage)= sum( h , report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( h , report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2214  *        report_node('gross export share in net generation',loop_res_share,loop_prosumage)= sum( h , report_hours('gross exports',loop_res_share,loop_prosumage,h))/sum( h , report_hours('energy generated',loop_res_share,loop_prosumage,h)) ;
2215          report_node('Capacity total',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)))
       + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ))
2216  *        + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)))
2217   
2218  ;
2219          report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)= sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,nondis,h) + lev_CU(scen,nondis,h))) * 1 ;
2220          report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (lev_N_TECH(scen,nondis)))) + sum((res,h), sum(scen$(map(scen,loop_res_s
      hare,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loo
      p_prosumage)) , lev_CU(scen,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) + sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(nondis,h) * (
      lev_N_TECH(scen,nondis))))) ;
2221          report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2222          report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(m_e('bio')) = (m_e('bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_e('bio') ;
2223          report_node('max price',loop_res_share,loop_prosumage)$sum(h,d(h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2224          report_node('min price',loop_res_share,loop_prosumage)$sum(h,d(h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , - marginal_con1a(scen,h))) ) ;
2225          report_node('mean price',loop_res_share,loop_prosumage)$sum(h,d(h)) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , marginal_con1a(scen,h)))/card(h) ;
2226   
2227                   report_node('energy demand total',loop_res_share,loop_prosumage)$(report_node('energy demand total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2228                   report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2229                   report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report_node('curtailment of fluct res relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2230                   report_node('bio not utilized absolute',loop_res_share,loop_prosumage)$(report_node('bio not utilized absolute',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)*1) = 0 ;
2231                   report_node('bio not utilized relative',loop_res_share,loop_prosumage)$(report_node('bio not utilized relative',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2232                   report_node('min price',loop_res_share,loop_prosumage)$(report_node('min price',loop_res_share,loop_prosumage)< eps_rep_abs AND report_node('min price',loop_res_share,loop_prosumage)> -eps_rep_abs) = eps ;
2233  *                 report_node('gross exports',loop_res_share,loop_prosumage)$(report_node('gross exports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2234  *                 report_node('gross imports',loop_res_share,loop_prosumage)$(report_node('gross imports',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2235  *                 report_node('net exports',loop_res_share,loop_prosumage)$(abs(report_node('net exports',loop_res_share,loop_prosumage)) < eps_rep_abs*card(h)) = 0 ;
2236                   report_node('energy generated net',loop_res_share,loop_prosumage)$(report_node('energy generated net',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2237                   report_node('energy generated gross',loop_res_share,loop_prosumage)$(report_node('energy generated gross',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
2238                   report_node('energy demand gross',loop_res_share,loop_prosumage)$(report_node('energy demand gross',loop_res_share,loop_prosumage)< eps_rep_abs*card(h)) = 0 ;
2239  *                 report_node('net import share in gross demand',loop_res_share,loop_prosumage)$(report_node('net import share in gross demand',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2240  *                 report_node('net export share in net generation',loop_res_share,loop_prosumage)$(report_node('net export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
2241                   report_node('Capacity total',loop_res_share,loop_prosumage)$(report_node('Capacity total',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
2242  *                 report_node('gross import share',loop_res_share,loop_prosumage)$(report_node('gross import share',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2243  *                 report_node('gross export share in net generation',loop_res_share,loop_prosumage)$(report_node('gross export share in net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2244   
2245   
2246  * ----------------------------------------------------------------------------
2247   
2248  * REPORT COST
2249          report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis , c_m(dis)*lev_G_L(scen,dis,h) + c_up(dis)*lev_G_UP(scen,dis,h)$(ord(h)>1) + c_do(dis)*lev_G_DO(scen,di
      s,h)) + sum( nondis , c_cu(nondis)*lev_CU(scen,nondis,h)) + sum( sto , c_m_sto(sto) * ( lev_STO_OUT(scen,sto,h) + lev_STO_IN(scen,sto,h) ) )
2250   
2251  ));
2252           report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( tech , c_i(tech)*lev_N_TECH(scen,tech) + c_fix(tech)*lev_N_TECH(scen,tech) ) + sum( sto , c_i_sto_e(sto)*le
      v_N_STO_E(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P(scen,sto)+lev_N_STO_E(scen,sto)) + c_i_sto_p(sto)*lev_N_STO_P(scen,sto) )
2253  *        + sum( rsvr , c_i_rsvr_e(rsvr)*lev_N_RSVR_E(scen,rsvr) + c_i_rsvr_p(rsvr)*lev_N_RSVR_P(scen,rsvr) + c_fix_rsvr(rsvr) * lev_N_RSVR_P(scen,rsvr))
2254   
                       + sum( res , c_i(res)*lev_N_RES_PRO(scen,res) + c_fix(res)*lev_N_RES_PRO(scen,res) ) + sum( sto , c_i_sto_e(sto)*lev_N_STO_E_PRO(scen,sto) + c_fix_sto(sto)/2*(lev_N_STO_P_PRO(scen,sto) + lev_N_STO_E_PRO(scen,sto)) + c_i_sto_p(sto)*l
      ev_N_STO_P_PRO(scen,sto)) + sum( (sto,h) , c_m_sto(sto) * ( lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) ) )
      $ontext
2259  );
2260   
2261  *         report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , c_infes * lev_G_INFES(scen,h)) ) ;
2262  *         report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,ev) , pen_phevfuel(ev) * lev_EV_PHEVFUEL(scen,ev,h)) ) ;
2263  *         report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (bu,hst,h) , pen_heat_fuel(bu,hst) * lev_H_STO_IN_FOSSIL(scen,bu,hst,h)) ) ;
2264           report_cost('Nodal cost: total',loop_res_share,loop_prosumage)= report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)+ report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)
2265  * + report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)
2266  * + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)
2267  * + report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)
2268   ;
               report_cost('Costs lines',loop_res_share,loop_prosumage,l) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen,l)*dist(l) ) ;
       
                       report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: investment & fix',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: fossil heating',loop_res_share,loop_prosumage)< card(h) * eps_rep_abs) = 0 ;
                       report_cost('Nodal cost: total',loop_res_share,loop_prosumage)$(report_cost('Nodal cost: total',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_cost('Costs lines',loop_res_share,loop_prosumage,l)$(report_cost('Costs lines',loop_res_share,loop_prosumage,l) < eps_rep_ins) = 0 ;
2280   
2281  * ----------------------------------------------------------------------------
2282   
2283  * REPORT TECH
2284          report_tech('capacities conventional',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2285          report_tech('capacities renewable',loop_res_share,loop_prosumage,res)= 0 + sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) ;
2286  *        report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr));
2287  *        report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr));
2288          report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2289          report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2290   
2291          report_tech('Capacity share',loop_res_share,loop_prosumage,con)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2292          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2293  *        report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2294          report_tech('Capacity share',loop_res_share,loop_prosumage,res)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2295          report_tech('Capacity share',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report_node('Capacity total',loop_res_share,loop_prosumage)+ 1e-9 ;
2296   
2297          report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_
      STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2298  *        report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,l
      oop_prosumage)) , gross_energy_demand(scen)) ;
2299          report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand
      (scen)) ;
2300          report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MA
      RKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',lo
      op_res_share,loop_prosumage)) ;
2301  *        report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2302          report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$report_node('energy generated net',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum( 
      scen$(map(scen,loop_res_share,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_prosumage)) ;
2303   
2304          report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2305          report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_P
      RO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,l
      oop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res) ))) ) ;
2306   
2307          report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('generation storage',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2308          report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_tech_hours('storage loading',loop_res_share,loop_prosumage,sto,h)) * 1 ;
2309   
2310          report_tech('FLH',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h)) ) / sum(scen
      $(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
2311          report_tech('FLH',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKE
      T_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
2312  *        report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - 
      corr_fac_rsvr(scen,rsvr,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr)) ;
2313          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)) / sum(scen$
      (map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2314   
2315   
2316                   report_tech('capacities conventional',loop_res_share,loop_prosumage,con)$(report_tech('capacities conventional',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
2317                   report_tech('capacities renewable',loop_res_share,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
2318                   report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2319                   report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
2320  *                 report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MW',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2321  *                 report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)$(report_tech('capacities reservoir MWh',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
2322                   report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2323  *                 report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2324                   report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2325                   report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2326  *                 report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2327                   report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)$(report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2328                   report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)*1) = 0 ;
2329                   report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)$(report_tech('curtailment of fluct res relative',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2330                   report_tech('Capacity share',loop_res_share,loop_prosumage,con)$(report_tech('Capacity share',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2331                   report_tech('Capacity share',loop_res_share,loop_prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2332  *                 report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)$(report_tech('Capacity share',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2333                   report_tech('Capacity share',loop_res_share,loop_prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2334                   report_tech('FLH',loop_res_share,loop_prosumage,con)$(report_tech('FLH',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
2335                   report_tech('FLH',loop_res_share,loop_prosumage,res)$(report_tech('FLH',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
2336  *                 report_tech('FLH',loop_res_share,loop_prosumage,rsvr)$(report_tech('FLH',loop_res_share,loop_prosumage,rsvr)< eps_rep_abs) = 0 ;
2337                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2338                   report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage out total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2339                   report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)$(report_tech('Storage in total non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)*1) = 0 ;
2340   
2341   
2342  * ----------------------------------------------------------------------------
2343   
2344  * REPORT NODE
2345          report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,res))
2346  *        + sum( rsvr , report_tech('renshares in nodal gross demand',loop_res_share,loop_prosumage,rsvr))
2347           ;
2348          report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal gross demand',loop_res_share,loop_prosumage,con)) ;
2349  *        report_node('net import share in nodal gross demand',loop_res_share,loop_prosumage)= - report_node('net exports',loop_res_share,loop_prosumage)/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen)) ;
2350          report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)= sum(res, report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,res))
2351  *+ sum( rsvr , report_tech('renshares in nodal net generation',loop_res_share,loop_prosumage,rsvr))
2352           ;
2353          report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)= sum(con, report_tech('conshares in nodal net generation',loop_res_share,loop_prosumage,con)) ;
2354   
2355                   report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('renshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2356                   report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)$(report_node('conshare in nodal gross demand',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2357                   report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('renshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2358                   report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)$(report_node('conshare in nodal net generation',loop_res_share,loop_prosumage)< eps_rep_rel ) = 0 ;
2359   
2360   
2361   
2362  * ----------------------------------------------------------------------------
2363   
2364  * REPORT TECH
2365          report_tech('Yearly energy',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) ;
2366          report_tech('Yearly energy',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,sto,h) + lev_STO_IN_PR
      O2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) ;
2367  *        report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) ;
2368          report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(s
      cen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) ;
2369   
2370          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) ) ) / report_node('energy generated gross',loop_res_share,loop_prosuma
      ge)* 1 + 1e-9 ;
2371          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h))) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2372  *        report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h) ) ) / report_node('energy generat
      ed gross',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
2373          report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_OUT_M2PRO(scen,s
      to,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_node('energy generated gross',loop_res_share,loop_prosumage)* 1 + 1e-9 ;
2374          report_tech('FLH',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_share,loop_
      prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2375          report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_res_
      share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2376   
2377                   report_tech('Yearly energy',loop_res_share,loop_prosumage,con)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,con)< eps_rep_ins ) = 0 ;
2378                   report_tech('Yearly energy',loop_res_share,loop_prosumage,res)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,res)< eps_rep_ins ) = 0 ;
2379  *                 report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins ) = 0 ;
2380                   report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)$(report_tech('Yearly energy',loop_res_share,loop_prosumage,sto)< eps_rep_ins ) = 0 ;
2381   
2382                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
2383                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
2384  *                 report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
2385                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
2386                   report_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2387                   report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)$(report_tech('Storage cycles',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
2388   
2389   
2390  * ----------------------------------------------------------------------------
2391   
2392  * RPEORT
2393          report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage)  ;
2394          report('curtailment of fluct res relative',loop_res_share,loop_prosumage) = report_node('curtailment of fluct res absolute',loop_res_share,loop_prosumage) / sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * (
      lev_N_TECH(scen,res) + lev_N_RES_PRO(scen,res)) )) ;
2395          report('bio not utilized absolute',loop_res_share,loop_prosumage)$( m_e('bio')) = report_node('bio not utilized absolute',loop_res_share,loop_prosumage)  ;
2396          report('bio not utilized relative',loop_res_share,loop_prosumage)$( m_e('bio')) = report('bio not utilized absolute',loop_res_share,loop_prosumage) /m_e('bio') ;
2397          report('Capacity total',loop_res_share,loop_prosumage) = report_node('Capacity total',loop_res_share,loop_prosumage) ;
2398          report('energy demand gross',loop_res_share,loop_prosumage) = report_node('energy demand gross',loop_res_share,loop_prosumage)  ;
2399          report('energy demand total',loop_res_share,loop_prosumage) = report_node('energy demand total',loop_res_share,loop_prosumage)  ;
2400          report('energy generated net',loop_res_share,loop_prosumage) =  report_node('energy generated net',loop_res_share,loop_prosumage) ;
2401          report('energy generated gross',loop_res_share,loop_prosumage) =  report_node('energy generated gross',loop_res_share,loop_prosumage) ;
2402  *        report('gross trade share',loop_res_share,loop_prosumage) = sum( (h), report_hours('gross imports',loop_res_share,loop_prosumage,h))/ sum( (h), report_hours('energy demanded',loop_res_share,loop_prosumage,h)) ;
2403          report('renshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_L(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h) + phi_res(res,h) * lev_N_RES_PRO(sc
      en,res) - lev_CU_PRO(scen,res,h))
2404  *       + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)))
2405           ))/ sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2406          report('conshare total',loop_res_share,loop_prosumage) = sum( (h) , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( con , lev_G_L(scen,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand(scen) ) ;
2407          report('Energy total',loop_res_share,loop_prosumage) = report_node('Energy total',loop_res_share,loop_prosumage) ;
2408   
2409                   report('curtailment of fluct res absolute',loop_res_share,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2410                   report('curtailment of fluct res relative',loop_res_share,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2411                   report('bio not utilized absolute',loop_res_share,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
2412                   report('bio not utilized relative',loop_res_share,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_prosumage) < eps_rep_rel) = 0 ;
2413                   report('Capacity total',loop_res_share,loop_prosumage)$(report('Capacity total',loop_res_share,loop_prosumage) < eps_rep_ins) = 0 ;
2414                   report('gross trade share',loop_res_share,loop_prosumage)$(report('gross trade share',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2415                   report('renshare total',loop_res_share,loop_prosumage)$(report('renshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2416                   report('conshare total',loop_res_share,loop_prosumage)$(report('conshare total',loop_res_share,loop_prosumage) < eps_rep_rel ) = 0 ;
2417                   report('Energy total',loop_res_share,loop_prosumage)$(report('Energy total',loop_res_share,loop_prosumage) < eps_rep_abs) = 0 ;
2418   
2419   
2420  * ----------------------------------------------------------------------------
2421   
2422  * DSM
2423   
2424   
2425  * ----------------------------------------------------------------------------
2426   
2427  * EV
2428   
2429   
2430   
2431  * ----------------------------------------------------------------------------
2432   
2433  * Reserves
2434   
2435   
2436   
2437   
2438  * ----------------------------------------------------------------------------
2439   
2440  * Reserves and DSM
2441   
2442   
2443  * ----------------------------------------------------------------------------
2444   
2445  * ----------------------------------------------------------------------------
2446   
2447  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_prosumage,h)= phi_pro_load * d(h) ;
              report_hours('demand market',loop_res_share,loop_prosumage,h)= (1 - phi_pro_load) * d(h) ;
              gross_energy_demand_market(scen)= gross_energy_demand(scen)- gross_energy_demand_prosumers_selfgen(scen);
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,con,h) + corr_fac_dis(scen,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_L(scen,res,h) + corr_fac_dis(scen,res,h) + lev_G_RES(scen,res,h)) ;
      *        report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_RSVR_OUT(scen,rsvr,h) + corr_fac_rsvr(scen,rsvr,h)) ;
              report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_L(scen,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)=  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_node('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h));
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)= sum( h, report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)=  sum( h, report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)= report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)+ report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')=  sum( (h,res) , report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')=  sum( h , report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')=  sum( (res,h) , report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) )) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , 
      lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) ) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h
       , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_pro_load * d(h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * %sec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)AND sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( h , phi_res(res,h) * lev_N_RES_PRO(sce
      n,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('
      price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pric
      e',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price',l
      oop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours
      ('price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('pr
      ice',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto);
              report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours('price'
      ,loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')> eps_rep_abs*card(h)) = sum( h , report_hours(
      'price',loop_res_share,loop_prosumage,h)* sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'');
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARK
      ET_PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_res_share,loo
      p_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
              report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Storage out total prosumers',loop_re
      s_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , le
      v_N_STO_E_PRO(scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res) ) ;
      *        report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) );
      *        report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_E(scen,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)=  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)AND sum(h, sum(scen$(map(scen,loop_res_share,lo
      op_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(
      scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)=  sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)= sum(h, report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)) * %sec_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      RES(scen,res,h) + lev_G_L(scen,res,h)- corr_fac_dis(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_
      L(scen,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,con)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserves',loop_res
      _share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market_tech('Storage out total market non-reserve
      s',loop_res_share,loop_prosumage,sto)/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(
      scen,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_market(scen)) ;
              report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
              report_prosumage('self-generation share prosumers total',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_
      energy_demand_prosumers_selfgen(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('market share prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen))) = sum(scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_p
      rosumers_market(scen)) / sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_prosumers(scen)) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * %sec_hour% ;
              report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))))  = sum(scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) )) = sum(scen$(map(scen,loop_res_share,
      loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop
      _prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res))) ) = sum(scen$(map(scen,loop_res_share,loop_p
      rosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum( res , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_ST
      O_P_PRO(scen,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) / 
      report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) 
      / report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)+ 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_prosumage)= sum( scen$(map(scen,loop_res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)= sum((res,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_TECH(scen,res)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res
      ,h), sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( (res,h) , phi_res(res,h) * lev_N_TECH(scen,res)) ) ;
              report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen$(map(scen,loop_res_share,loop_pros
      umage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(scen,sto,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_sha
      re,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,res,h))) ) / sum( scen$(map(scen,loop_res
      _share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_
      res_share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
              report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)= sum( h, sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(scen,sto,h))) ) / sum( scen$(map(scen,loop_res_
      share,loop_prosumage)) , gross_energy_demand_market(scen)) ;
      * line below changed
              report_market('Capacity total market',loop_res_share,loop_prosumage)= sum( tech , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen
      ,sto) )) ;
              report_market('Energy demand total market',loop_res_share,loop_prosumage)= (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h))) + sum( (sto,h) , sum(scen$(map(scen
      ,loop_res_share,loop_prosumage)) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PRO(scen,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      %prosumage%$ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_prosumage)= sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)) , sum( dis ,lev_G_L(scen,dis,h)) + sum( nondis ,lev_G_RES(scen,nondis,h)) + sum( res , lev_G_MARKET_PRO
      2M(scen,res,h) - corr_fac_nondis(scen,res,h))
      *         + sum( rsvr , lev_RSVR_OUT(scen,rsvr,h)- corr_fac_rsvr(scen,rsvr,h))
               + sum( sto , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h))
      *         + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,ev,h)) - corr_fac_ev(scen,h)
                )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market('Capacity total market',loop_res_share,loop_prosumage)) = sum( scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_TECH(scen,tech) ) / report_ma
      rket('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
      *        report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_RSVR_P(scen,rsvr) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)= sum(scen$(map(scen,loop_res_share,loop_prosumage)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total market',loop_res_share,loop_prosumage)+ 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,con,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_G_L(scen,res,h) + lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - corr_fac_nondis(scen,res,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
      *        report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(AND report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_pros
      umage)) , lev_RSVR_OUT(scen,rsvr,h) - corr_fac_rsvr(scen,rsvr,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_prosumage)
      ) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - corr_fac_sto(scen,sto,h)) ) / report_market('energy generated gross market',loop_res_share,loop_prosumage)* %sec_hour% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_prosumage,h)$(report_hours('demand market',loop_res_share,loop_prosumage,h)< eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)$(report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)$(report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_prosumage,'',h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)$(report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,con,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) = 0 ;
      *                 report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)$(report_market_tech_hours('generation market',loop_res_share,loop_prosumage,rsvr,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)$(report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_prosumage,res,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('generation storage market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage loading market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)$(report_market_tech_hours('storage level market',loop_res_share,loop_prosumage,sto,h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_prosumage,'Interaction with p
      rosumers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_prosumage,'Interaction with prosu
      mers',h)< eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy market to prosumer',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)$(report_market_tech_hours('energy prosumer to market',loop_res_share,loop_prosumage,'Interaction with prosumers',h)< 
      eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_prosumage,'market')< eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_prosumage,'')< eps_rep_abs * card(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')$(report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_prosumage,'')< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_abs) =  0 ;
      *                 report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MW market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
      *                 report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('capacities reservoir MWh market',loop_res_share,loop_prosumage,rsvr)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_prosumage,res)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)$(report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)$(report_market_tech('capacities conventional market',loop_res_share,loop_prosumage,con)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)$(report_market_tech('capacities renewable market',loop_res_share,loop_prosumage,res)< eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MW market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_prosumage,sto)< eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage out total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage in total market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs*card(h)) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,res)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,con)< eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_prosumage,sto)< eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)$(report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)$(report_prosumage('self-generation share prosumage total',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,loop_prosumage)$(report_prosumage('market share prosumage',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_prosumage)< eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)$(report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation curtailed',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation direct consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation to market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)$(report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)$(report_prosumage('Capacity total prosumers',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share,loop_prosumage)$(report_market('gross energy demand market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res absolute market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)$(report_market('curtailment of fluct res relative market',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)$(report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0
       ;
                       report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)$(report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_prosumage)< eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop_prosumage)$(report_market('Capacity total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share,loop_prosumage)$(report_market('Energy demand total market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_share,loop_prosumage)$(report_market('energy generated gross market',loop_res_share,loop_prosumage)< eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,tech)< eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
      *                 report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Capacity share market',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,con)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,res)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,sto)< eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_prosumage,rsvr)< eps_rep_rel) = 0 ;
      $ontext
2719   
2720   
2721  * ----------------------------------------------------------------------------
2722   
2723  * PROSUMAGE & DSM
2724   
2725   
2726   
2727  * ----------------------------------------------------------------------------
2728   
2729   
2730   
2731  * ----------------------------------------------------------------------------
2732   
2733  * HEAT
2734   
2735  * ----------------------------------------------------------------------------
2736   
2737  * Reserves and heat
2738   
2739   
2740  * ---------------------------------------------------------------------------- *
2741  * ---------------------------------------------------------------------------- *
2742  * ---------------------------------------------------------------------------- *
2743   
2744   
2745  execute_unload "results", report, report_tech, report_node,
2746  *report_line,
2747  report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, report_market, report_market_tech, report_market_tech_hours
      $ontext
2752  ;
2753   
2754   
      $include report_to_excel.gms
      $ontext
2759   
2760   
2763   
      solve   DIETER_MCP using mcp ;
      *scenario dict;
       
       
      Parameters
      Z_MCP
      ;
       
      Z_MCP =            sum( (h,dis) , c_m(dis)*G_L.l(dis,h) )
                       + sum( (h,dis)$(ord(h)>1) , c_up(dis)*G_UP.l(dis,h) )
                       + sum( (h,dis) , c_do(dis)*G_DO.l(dis,h) )
                       + sum( (h,nondis) , c_cu(nondis)*CU.l(nondis,h) )
                       + sum( (h,sto) , c_m_sto(sto) * ( STO_OUT.l(sto,h) + STO_IN.l(sto,h) ) )
                       + sum( tech , c_i(tech)*N_TECH.l(tech) )
                       + sum( tech , c_fix(tech)*N_TECH.l(tech) )
                       + sum( sto , c_i_sto_e(sto)*N_STO_E.l(sto) )
                       + sum( sto , c_fix_sto(sto)/2*(N_STO_P.l(sto)+ N_STO_E.l(sto)) )
                       + sum( sto , c_i_sto_p(sto)*N_STO_P.l(sto) )
      ;
       
       
      Display
      Z_MCP,
      N_TECH.l,
      N_STO_E.l,
      N_STO_P.l,
      G_L.l,
      G_UP.l,
      G_DO.l,
      G_RES.l,
      CU.l,
      STO_IN.l,
      STO_OUT.l,
      STO_L.l
      lambda_enerbal.m,
      lambda_enerbal.l,
      lambda_resgen.m,
      lambda_convgen.m,
      lambda_stolev.m
      ;
       
      $ontext
2808   
2809  * ---------------------------------------------------------------------------- *
2810  * ---------------------------------------------------------------------------- *
2811  * ---------------------------------------------------------------------------- *
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.gms
     2      134 INCLUDE        1     134  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\dataload.gms
     3      538 CALL           2     404  .gdxxrw data_input.xlsx @temp.tmp o=Data_input maxdupeerrors=100
     4      540 GDXIN          2     406  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\Data_input.gdx
     5      588 CALL           2     454  .gdxxrw time_series.xlsx @temp2.tmp o=time_series
     6      589 GDXIN          2     455  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\time_series.gdx
     7      929 INCLUDE        1     169  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\model.gms
     8     1653 INCLUDE        1     274  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\fix.gms
     9     1834 INCLUDE        1     275  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\scenario.gms
    10     1975 INCLUDE        1     337  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\report.gms


COMPILATION TIME     =        5.070 SECONDS      3 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Setup/Generation    SOLVE DIETER Using LP From line 1970


Warning GUSS turns holdFixed for DIETER off.
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 1970


MODEL STATISTICS

BLOCKS OF EQUATIONS          10     SINGLE EQUATIONS        4,853
BLOCKS OF VARIABLES          13     SINGLE VARIABLES        5,275
NON ZERO ELEMENTS        20,328     NON LINEAR N-Z          1,189
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH               1,689


GENERATION TIME      =        0.031 SECONDS      7 MB  25.1.2 r67455 WEX-WEI


EXECUTION TIME       =        0.031 SECONDS      7 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 1970


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  1970

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT          0.047  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             25.1.2 r67420 Released Jul 31, 2018 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\cplex.opt"
Space for names approximately 0.28 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 0.03sec (det. 18.75 ticks)
Optimal solution found.
Objective :   330748758.098957

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  330748758.098957
---   Resource Usage   47
---   Total Time (ms)  47

No solution returned
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 10:38:54 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        0.000 SECONDS      6 MB  25.1.2 r67455 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Modified_MCP_WORKS\DIETER.lst
