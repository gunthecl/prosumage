GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2018.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  ********************************************************************************
  13   
  14   
  15   
  16   
  17  **************************
  18  ***** GLOBAL OPTIONS *****
  19  **************************
  20   
  21  * Set star to skip Excel upload and load data from gdx
  23   
  24  * Choose base year
  26   
  27  * Germany only - also adjust Excel inputs!
  29   
  30  * Set star to activate options
  32   
  35   
  37   
  38  **** Activate modifications to replicate MCP results**************************
  39  * Prosumage link restrictions prohibits prosumage storage interaction with market
  41  * Deacivated storage flow constraints 4h,4i,4j,4k
  43  * Set parameter phi_sto_ini to zero (instead of 0.5)
  45   
  46  ******************************************************************************
  47   
  49   
  52  * Set star to indicate renewables constraint on electric vehicles - DEFAULT is same quota as for the rest of the electricity system
  56   
  57  * Set star to select run-of-river options either as exogenous parameter or as endogenous variable including reserve provision:
  58  * if nothing is selected, ROR capacity will be set to zero
  59  * if parameter option is selected, set appropriate values in fix.gmx
  60  * if variable option is selected, set appropriate bound in data_input excel
  63   
  64  * Set star to determine loops, otherwise default 100% renewables
  66   
  67  * Set star for no crossover to speed up calculation time by skipping crossover in LP solver
  69   
  70  * Set star for reporting to Excel
  72   
  73   
  74  ********************************************************************************
  75   
  76  * Definition of strings for report parameters and sanity checks
  77  * (Do not change settings below)
  79   
  81   
  82  * Sanity checks
  84   
  86   
  88   
  92   
  96   
  97   
  98   
  99   
 100  ********************************************************************************
 101   
 102  ****************************
 103  ***** INITIALIZE LOOPS *****
 104  ****************************
 105   
 106  sets
 107  *$ontext
 108  loop_res_share   Solution loop for different shares of renewables       /50,80/
 111   
      loop_ev          Solution loop for different fleets of EVs              /4e+6/
      $ontext
 116   
      loop_prosumage   Solution loop for different prosumer self-consumption levels    /50/
      $ontext
 121   
 122  *      loop_res_share                          /50/
 123                               loop_ev                                 /0/
 124                        loop_prosumage                          /0/
 125  ;
 126   
 127   
 128   
 129   
 130  ********************************************************************************
 131   
 132  **************************
 133  ***** SOLVER OPTIONS *****
 134  **************************
 135   
 136  options
 137  optcr = 0.00
 138  reslim = 10000000
 139  lp = cplex
 140  mip = cplex
 141  nlp = conopt
 142  limrow = 0
 143  limcol = 0
 144  ;
 145   
 146  options
 147  dispwidth = 15
 148  limrow = 0
 149  limcol = 0
 150  solprint = off
 151  sysout = off
 152  ;
 153   
 154   
 155   
 156   
 157  ********************************************************************************
 158   
 159  **************************
 160  ***** Dataload *****
 161  **************************
 162   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\dataload.gms
 164   
 165  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 175  ********************************************************************************
 176   
 177   
 178   
 179   
 180  ***************  SETS  *********************************************************
 181   
 182  ***** Sets used in the model *****
 183  Sets
 184  tech                     Generation technologies
 185   dis(tech)               Dispatchable generation technologies
 186   nondis(tech)            Nondispatchable generation technologies
 187   con(tech)               Conventional generation technologies
 188   res(tech)               Renewable generation technologies
 189  sto                      Storage technologies
 190  rsvr                     Reservoir technologies
 191  dsm                      DSM technologies
 192   dsm_shift(dsm)          DSM load shifting technologies
 193   dsm_curt(dsm)           DSM load curtailment technologies
 194  year                     Base year for temporal data
 195  h                        Hours
 196  n                        Nodes
 197  l                        Lines
 198  ev                       EV types
 199  reserves                         Reserve qualities
 200   reserves_up(reserves)           Positive reserves
 201   reserves_do(reserves)           Negative reserves
 202   reserves_spin(reserves)         Spinning reserves
 203   reserves_nonspin(reserves)      Nonspinning reserves
 204   reserves_prim(reserves)         Primary reserves
 205   reserves_nonprim(reserves)      Nonprimary reserves
 206   reserves_prim_up(reserves)      Primary positive reserves
 207   reserves_nonprim_up(reserves)   Nonprimary positive reserves
 208   reserves_prim_do(reserves)      Primary negative reserves
 209   reserves_nonprim_do(reserves)   Nonprimary negative reserves
 210  bu                       Building archtypes
 211  ch                       Heating combination type
 212   hst(ch)                 Heating technology that feeds to storage
 213   hp(ch)                  Heat pump technologies
 214   hel(ch)                 Hybrid electric heating technologies - electric part
 215   hfo(ch)                 Hybrid electric heating technologies - fossil part
 216   
 217   
 218  ***** Sets used for data upload *****
 219  headers_tech                     Generation technologies - upload headers
 220   tech_dispatch                   Generation technologies - dispatchable or nondispatchable
 221   tech_res_con                    Generation technologies - renewable or "conventional"
 222  headers_sto                      Storage technologies - upload headers
 223  headers_reservoir                Reservoir technologies - upload headers
 224  headers_dsm                      DSM technologies - upload headers
 225   dsm_type                        DSM technologies - shifting or curtailment
 226  headers_time                     Temporal data - upload headers
 227  headers_topology                 Spatial data - upload headers
 228  headers_ev                       EV data - upload headers
 229  headers_time_ev                  EV temporal data - upload headers
 230  headers_prosumage_generation     Prosumage generation data - upload headers
 231  headers_prosumage_storage        Prosumage storage data - upload headers
 232  headers_reserves                 Reserve data - upload headers
 233   reserves_up_down                Reserve data - positive and neagtive reserves
 234   reserves_spin_nonspin           Reserve data - spinning and nonspinning reserves
 235   reserves_prim_nonprim           Reserve data - primary and nonprimary reserves
 236  headers_heat                     Heat data - upload headers
 237   heat_storage                    Heat data - storage technologies
 238   heat_hp                         Heat data - heat pump technologies
 239   heat_elec                       Heat data - hybrid heating technologies - electric part
 240   heat_fossil                     Heat data - hybrid heating technologies - fossil part
 241  headers_time_heat                Heat data - upload headers time data
 242  headers_time_dhw                 Heat data - upload headers time data on DHW
 243  ;
 244   
 245   
 246   
 247   
 248  ***************  PARAMETERS  ***************************************************
 249   
 250  Parameters
 251   
 252  ***** Generation technologies *****
 253  *--- Variable and fixed costs ---*
 254  eta              Efficiency of conventional technologies [0 1]
 255  carbon_content   CO2 emissions per fuel unit used [tons per MWh thermal]
 256  c_up             Load change costs UP [EUR per MWh]
 257  c_do             Load change costs DOWN [EUR per MWh]
 258  c_fix            Annual fixed costs [EUR per MW per year]
 259  c_vom            Variable O&M costs [EUR per MWh]
 260  CO2price         CO2 price in [EUR per ton]
 261   
 262  *--- Investment ---*
 263  c_inv_overnight  Investment costs: Overnight [EUR per MW]
 264  lifetime         Investment costs: technical lifetime [a]
 265  recovery         Investment costs: Recovery period according to depreciation tables [a]
 266  interest_rate    Investment costs: Interest rate [%]
 267  m_p              Investment: maximum installable capacity per technology [MW]
 268  m_e              Investment: maximum installable energy [TWh per a]
 269   
 270  *--- Flexibility ---*
 271  grad_per_min     Maximum load change relative to installed capacity [% of installed capacity per minute]
 272   
 273   
 274  ***** Fuel and CO2 costs *****
 275  fuelprice        Fuel price conventionals [EUR per MWh thermal]
 276   
 277   
 278  ***** Renewables *****
 279  c_cu             Hourly Curtailment costs for renewables [Euro per MW]
 280  phi_min_res      Minimum renewables share [0 1]
 281   
 282   
 283  ***** Storage *****
 284  *--- Variable and fixed costs ---*
 285  c_m_sto          Marginal costs of storing in or out [EUR per MWh]
 286  eta_sto          Storage efficiency [0 1]
 287  phi_sto_ini      Initial storage level [0 1]
 288  etop_max         Maximum E to P ratio of storage types [#]
 289  c_fix_sto        Annual fixed costs [EUR per MW]
 290   
 291  *--- Investment ---*
 292  c_inv_overnight_sto_e       Investment costs for storage energy: Overnight [EUR per MWh]
 293  c_inv_overnight_sto_p       Investment costs for storage capacity: Overnight [EUR per MW]
 294  m_sto_e                     Investment into storage: maximum installable energy [MWh]
 295  m_sto_p                     Investment into storage: maximum installable power [MW]
 296   
 297   
 298  ***** Reservoir*****
 299  *--- Variable and fixed costs ---*
 300  c_m_rsvr                 Marginal costs of generating energy from reservoir [EUR per MWh]
 301  eta_rsvr                 Generation efficiency [0 1]
 302  phi_rsvr_ini             Initial reservoir level [0 1]
 303  c_fix_rsvr               Annual fixed costs [EUR per MW per a]
 304  phi_rsvr_min             Minimum hourly reservoir outflow as fraction of annual energy [0 1]
 305  phi_rsvr_lev_min         Minimum filling level [0 1]
 306   
 307  *--- Investment ---*
 308  c_inv_overnight_rsvr_e   Investment costs for reservoir energy: Overnight [EUR per MWh]
 309  c_inv_overnight_rsvr_p   Investment costs for reservoir capacity: Overnight [EUR per MW]
 310  inv_lifetime_rsvr        Investment costs for reservoir: technical lifetime [a]
 311  inv_interest_rsvr        Investment costs for reservoir: Interest rate [%]
 312  m_rsvr_e                 Investment into reservoir: maximum installable energy [MWh]
 313  m_rsvr_p                 Investment into reservoir: maximum installable capacity [MW]
 314   
 315   
 316  ***** DSM *****
 317  *--- Variable and fixed costs ---*
 318  c_m_dsm_cu       DSM: hourly costs of load curtailment [EUR per MWh]
 319  c_m_dsm_shift    DSM: costs for load shifting [EUR per MWh]
 320  c_fix_dsm_cu     Annual fixed costs load curtailment capacity [EUR per MW per a]
 321  c_fix_dsm_shift  Annual fixed costs load shifting capacity [EUR per MW per a]
 322   
 323  *--- Flexibility, efficiency, recovery ---*
 324  t_dur_dsm_cu     DSM: Maximum duration load curtailment [h]
 325  t_off_dsm_cu     DSM: Minimum recovery time between two load curtailment instances [h]
 326   
 327  t_dur_dsm_shift  DSM: Maximum duration load shifting [h]
 328  t_off_dsm_shift  DSM: Minimum recovery time between two granular load upshift instances [h]
 329  eta_dsm_shift    DSM: Efficiency of load shifting technologies [0 1]
 330   
 331  *--- Investment ---*
 332  c_inv_overnight_dsm_cu           Investment costs for DSM load curtailment: Overnight [EUR per MW]
 333  c_inv_overnight_dsm_shift        Investment costs for DSM load shifting: Overnight [EUR per MW]
 334  inv_recovery_dsm_cu              Investment costs for DSM load curtailment: Recovery period [a]
 335  inv_recovery_dsm_shift           Investment costs for DSM load shifting: Recovery period [a]
 336  inv_interest_dsm_cu              Investment costs for DSM load curtailment: Interest rate [%]
 337  inv_interest_dsm_shift           Investment costs for DSM load shifting: Interest rate [%]
 338  m_dsm_cu                         DSM: Maximum installable capacity load curtailment [MW]
 339  m_dsm_shift                      DSM: Maximum installable capacity load shifting [MW]
 340   
 341   
 342  ***** Time Data *****
 343  d_y                      Demand hour h for different years [MWh]
 344  d                        Demand hour h [MWh]
 345  phi_res_y                Renewables availability technology res in hour h for different years [0 1]
 346  phi_res                  Renewables availability technology res in hour h [0 1]
 347  phi_ror_y                Run-of-river availability technology ror in hour h for different years [0 1]
 348  phi_ror                  Run-of-river availability technology ror in hour h [0 1]
 349  rsvr_in_y                Reservoir inflow in hour h for different years [0 1]
 350  rsvr_in                  Reservoir inflow in hour h [0 1]
 351  n_ev_p_upload            Power rating of the charging connection in hour h [MW - 0 when car is in use or parked without grid connection]
 352  ev_ed_upload             Electricity demand for mobility vehicle profile ev in hour h [MW]
 353  ev_ged_exog_upload       Electricity demand for mobility in case of uncontrolled charging vehicle profile ev in hour h [MW]
 354  phi_reserves_call_y      Hourly share of reserve provision that is actually activated for different years [0 1]
 355  phi_reserves_call        Hourly share of reserve provision that is actually activated [0 1]
 356  reserves_exogenous_y     Hourly reserve provision for different years [MW]
 357  reserves_exogenous       Hourly reserve provision [MW]
 358   
 359  ***** Transmission *****
 360  *--- Investment ---*
 361  c_inv_overnight_ntc       Investment costs in: overnight [EUR per MW]
 362  c_fix_ntc                 Fixed costs [EUR per MW per a]
 363  inv_lifetime_ntc          Investment costs: technical lifetime [a]
 364  inv_recovery_ntc          Investment costs: Recovery period in [a]
 365  inv_interest_ntc          Investment costs: Interest rate [%]
 366  m_ntc                     Investment into NTC: maximum installable capacity [MW]
 367   
 368  *--- Topology and distance ---*
 369  inc              Incidence index of link l on node n
 370  dist             Distance covered by link l [km]
 371   
 372   
 373  ***** Electric vehicles *****
 374  *--- Costs and attributes ---*
 375  c_m_ev           Marginal costs of discharging V2G [EUR per MWh]
 376  pen_phevfuel     Penalty for non-electric PHEV operation mode [EUR per MWh]
 377  eta_ev_in        Electric vehicle efficiency of charging (G2V) [0 1]
 378  eta_ev_out       Electric vehicle efficiency of discharging (V2G) [0 1]
 379  phi_ev_ini       Electric vehicle charging level in initial period [0 1]
 380   
 381  n_ev_e           Electric vehicle battery capacity [MWh]
 382  ev_quant         Overall number of electirc vehicles [#]
 383  phi_ev           Share of electric vehicles per load profile in actual scenario [0 1]
 384  ev_phev          Defines whether an electric vehicle is a PHEV REEV [1 if yes 0 otherwise]
 385   
 386  *--- Temporal data ---*
 387  n_ev_p           Electric vehicle power rating [MWh]
 388  ev_ed            Electric vehicle electricity demand [MWh]
 389  ev_ged_exog      Electric vehicle grid electricity demand for exogenous charging pattern [MWh]
 390   
 391   
 392  ***** Prosumage *****
 393  phi_pro_load             Share of prosumagers among total load [0 1]
 394  phi_pro_self             Minimum self-generation shares for prosumagers [0 1]
 395  m_res_pro                Maximum installable: renewables capacity [MW]
 396  m_sto_pro_e              Maximum installable: storage energy [MWh]
 397  m_sto_pro_p              Maximum installable: storage capacity [MW]
 398  phi_sto_pro_ini          Prosumagers' initial storage loading [0 1]
 399   
 400   
 401  ***** Reserves *****
 402  phi_reserves_share       Shares of SRL and MRL up and down [0 1]
 403  reserves_intercept       Intercept of regression line determining reserves demand
 404  reserves_slope           Slope of regression line determining reserves demand
 405  reserves_reaction        Activation reaction time for reserves qualities [min]
 406  phi_reserves_pr_up       Positive primary reserves fraction of total nonprimary reserves demand [0 1]
 407  phi_reserves_pr_do       Negative primary reserves fraction of total nonprimary reserves demand [0 1]
 408  *reserves_exog
 409   
 410   
 411  ***** Heat *****
 412  *--- Time data ---*
 413  dh_upload                Hourly heat demand per year for upload [MWh per m2]
 414  dh_y                     Hourly heat demand per year [MWh per m2]
 415  dh                       Hourly heat demand [MWh per m2]
 416  temp_source              Heat pumps - source temperature [°Celsius]
 417  d_dhw_upload             Hourly DHW demand per year for upload [MWh per m2]
 418  d_dhw_y                  Hourly DHW demand per year [MWh per m2]
 419  d_dhw                    Hourly DHW demand [MWh per m2]
 420  nets_profile(h)          Hourly exogenous heat demand by nonsmart night-time storage heaters [MWh per m2]
 421   
 422  *--- Technololgy attributes ---*
 423  phi_heat_type            Share of heating type ch per building archetype bu [0 1]
 424  eta_heat_stat            Static efficiency for heating technologies [0 1]
 425  eta_heat_dyn             Static efficiency for heating technologies [0 1]
 426  eta_dhw_aux_stat         Static efficiency for auxiliary DHW technologies [0 1]
 427  n_heat_p_in              Maximum power inflow into heating technologies [MW]
 428  n_heat_p_out             Maximum power outflow from heating technologies [MW]
 429  n_heat_e                 Maximum energy level of heating storage technologies [MWh]
 430  n_sets_p_in              SETS - Power rating - electricity intake [MW]
 431  n_sets_p_out             SETS - Power rating - heat output [MW]
 432  n_sets_e                 SETS - Energy storage capacity [MWh]
 433  n_sets_dhw_p_in          SETS auxiliary DHW module - power rating - electricity intake [MW]
 434  n_sets_dhw_p_out         SETS auxiliary DHW module - power rating - DHW output [MW]
 435  n_sets_dhw_e             SETS auxiliary DHW module - energy storage capacity [MWh]
 436  phi_heat_ini             Inititial storage level of heating technologies [0 1]
 437  temp_sink                Heat pumps - sink temperature [°Celsius]
 438  pen_heat_fuel            Penalty term for non-electric fuel usage for hybrid heating technologies [EUR per MWh]
 439  area_floor               Floor area subject to specific heating technology in specific building type [m2]
 440  theta_night              Indicator for night hours {0 1}
 441   
 442   
 443   
 444  ***************  DERIVED PARAMETERS  *******************************************
 445   
 446  c_m              Marginal production costs for conventional plants including variable O and M costs [EUR per MWh]
 447  c_i              Annualized investment costs by conventioanl plant [EUR per MW]
 448   
 449  c_i_res          Annualized investment costs by renewable plant [EUR per MW]
 450  c_fix_res        Annualized fixed costs by renewable plant [EUR per MW per a]
 451   
 452  c_i_sto_e        Annualized investment costs storage energy [EUR per MWh]
 453  c_i_sto_p        Annualized investment costs storage capacity [EUR per MW]
 454   
 455  c_i_rsvr_e       Annualized investment costs storage energy [EUR per MWh]
 456  c_i_rsvr_p       Annualized investment costs storage capacity [EUR per MW]
 457   
 458  c_i_dsm_cu       DSM: Annualized investment costs load curtailment [EUR per MW]
 459  c_i_dsm_shift    DSM: Annualized investment costs load shifting [EUR per MW]
 460   
 461  c_i_ntc          Investment for net transfer capacity [EUR per MW and km]
 462   
 463  phi_mean_reserves_call_y         Hourly mean of share reserves called per year [0 1]
 464  phi_mean_reserves_call           Hourly mean of share reserves called [0 1]
 465   
 466  theta_dir        Dummy equal to 1 if building type bu has direct heating type ch [0 1]
 467  theta_sets       Dummy equal to 1 if building type bu has SETS heating type ch [0 1]
 468  theta_hp         Dummy equal to 1 if building type bu has heat pump heating type ch [0 1]
 469  theta_elec       Dummy equal to 1 if building type bu has hybrif electric heating - electric part [0 1]
 470  theta_fossil     Dummy equal to 1 if building type bu has hybrif electric heating - fossil part [0 1]
 471  theta_storage    Dummy equal to 1 if building type ch has storage heating type ch [0 1]
 472   
 473   
 474   
 475   
 476  ***************  PARAMETERS FOR DATA UPLOAD  ***********************************
 477   
 478  technology_data_upload(n,tech,tech_res_con,tech_dispatch,headers_tech)
 479  technology_data(n,tech,headers_tech)
 480  storage_data(n,sto,headers_sto)
 481  reservoir_data(n,rsvr,headers_reservoir)
 482  time_data_upload(h,n,year,headers_time)
 483  dsm_data_upload(n,dsm,dsm_type,headers_dsm)
 484  dsm_data(n,dsm,headers_dsm)
 485  topology_data(l,headers_topology)
 486  ev_data(n,ev,headers_ev)
 487  ev_time_data_upload(h,headers_time_ev,ev)
 488  prosumage_data_generation(n,tech,headers_prosumage_generation)
 489  prosumage_data_storage(n,sto,headers_prosumage_storage)
 490  reserves_time_data_activation(h,year,reserves)
 491  reserves_time_data_provision(h,year,reserves)
 492  reserves_data_upload(n,reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)
 493  reserves_data(n,reserves,headers_reserves)
 494  heat_data_upload(n,bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)
 495  heat_data(n,bu,ch,headers_heat)
 496  dh_upload(h,n,year,headers_time_heat,bu)
 497  d_dhw_upload(h,n,year,headers_time_heat,bu)
 498  temp_source_upload
 499  ;
 500   
 501   
 502   
 503   
 504  ***************  UPLOAD TIME-CONSTANT SETS AND PARAMETERS  *********************
 505   
 565   
 566  *$call "gdxxrw data_input.xlsx @temp.tmp o=Data_input maxdupeerrors=100";
 567   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\Data_input.gdx
--- LOAD  n = 1:n
--- LOAD  tech = 2:tech
--- LOAD  headers_tech = 3:headers_tech
--- LOAD  tech_dispatch = 4:tech_dispatch
--- LOAD  tech_res_con = 5:tech_res_con
--- LOAD  sto = 6:sto
--- LOAD  headers_sto = 7:headers_sto
--- LOAD  rsvr = 8:rsvr
--- LOAD  headers_reservoir = 9:headers_reservoir
--- LOAD  reservoir_data = 33:reservoir_data
--- LOAD  dsm = 10:dsm
--- LOAD  headers_dsm = 11:headers_dsm
--- LOAD  dsm_type = 12:dsm_type
--- LOAD  technology_data_upload = 31:technology_data_upload
--- LOAD  storage_data = 32:storage_data
--- LOAD  dsm_data_upload = 34:dsm_data_upload
 572  *$load l headers_topology topology_data inc
 573  *$ontext
--- LOAD  l = 13:l
--- LOAD  headers_topology = 14:headers_topology
--- LOAD  topology_data = 35:topology_data
--- LOAD  ev = 15:ev
--- LOAD  headers_ev = 16:headers_ev
--- LOAD  ev_data = 36:ev_data
--- LOAD  headers_prosumage_generation = 17:headers_prosumage_generation
--- LOAD  headers_prosumage_storage = 18:headers_prosumage_storage
--- LOAD  prosumage_data_generation = 37:prosumage_data_generation
--- LOAD  prosumage_data_storage = 38:prosumage_data_storage
--- LOAD  reserves = 19:reserves
--- LOAD  reserves_up_down = 21:reserves_up_down
--- LOAD  reserves_spin_nonspin = 22:reserves_spin_nonspin
--- LOAD  reserves_prim_nonprim = 23:reserves_prim_nonprim
--- LOAD  headers_reserves = 20:headers_reserves
--- LOAD  reserves_data_upload = 39:reserves_data_upload
--- LOAD  bu = 24:bu
--- LOAD  ch = 25:ch
--- LOAD  heat_storage = 26:heat_storage
--- LOAD  heat_hp = 27:heat_hp
--- LOAD  heat_elec = 28:heat_elec
--- LOAD  heat_fossil = 29:heat_fossil
--- LOAD  headers_heat = 30:headers_heat
--- LOAD  heat_data_upload = 40:heat_data_upload
 581  ;
 582   
 583  *$ontext
 584  parameter inc ;
 585  inc(l,n) = 1 ;
 588   
 589   
 590  ***************  UPLOAD TIME-SERIES SETS AND PARAMETERS  ***********************
 591   
 617   
 618  *$call "gdxxrw time_series.xlsx @temp2.tmp o=time_series";
 619   
GDXIN   C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\time_series.gdx
--- LOAD  h = 1:h
--- LOAD  headers_time = 2:headers_time
--- LOAD  year = 3:year
--- LOAD  time_data_upload = 4:time_data_upload
--- LOAD  headers_time_ev = 5:headers_time_ev
--- LOAD  ev_time_data_upload = 6:ev_time_data_upload
--- LOAD  reserves_time_data_activation = 7:reserves_time_data_activation
--- LOAD  reserves_time_data_provision = 8:reserves_time_data_provision
--- LOAD  headers_time_heat = 9:headers_time_heat
--- LOAD  dh_upload = 10:dh_upload
--- LOAD  theta_night = 11:theta_night
--- LOAD  temp_source_upload = 15:temp_source_upload
--- LOAD  headers_time_dhw = 12:headers_time_dhw
--- LOAD  d_dhw_upload = 13:d_dhw_upload
--- LOAD  nets_profile = 14:nets_profile
 629  ;
 630   
 631   
 632   
 633   
 634  ***************  ASSIGNMENTS  **************************************************
 635   
 636   
 637   
 638  ***** Aliases *****
 639  alias (h,hh) ;
 640  alias (res,resres) ;
 641  alias (reserves,reservesreserves) ;
 642  alias (nondis,nondisnondis) ;
 643   
 644   
 645   
 646  ***** Derived sets *****
 647  dis(tech)$sum( (n,tech_res_con,headers_tech), technology_data_upload(n,tech,tech_res_con,'dis',headers_tech)) = yes;
 648  nondis(tech)$sum( (n,tech_res_con,headers_tech), technology_data_upload(n,tech,tech_res_con,'nondis',headers_tech)) = yes;
 649   
 650  con(tech)$sum( (n,tech_dispatch,headers_tech), technology_data_upload(n,tech,'con',tech_dispatch,headers_tech)) = yes;
 651  res(tech)$sum( (n,tech_dispatch,headers_tech), technology_data_upload(n,tech,'res',tech_dispatch,headers_tech)) = yes;
 652   
 653  reserves_up(reserves)$sum( (n,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(n,reserves,'up',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
 654  reserves_do(reserves)$sum( (n,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves), reserves_data_upload(n,reserves,'do',reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) = yes;
 655   
 656  reserves_spin(reserves)$sum( (n,reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(n,reserves,reserves_up_down,'spin',reserves_prim_nonprim,headers_reserves)) = yes;
 657  reserves_nonspin(reserves)$sum( (n,reserves_up_down,reserves_prim_nonprim,headers_reserves), reserves_data_upload(n,reserves,reserves_up_down,'nonspin',reserves_prim_nonprim,headers_reserves)) = yes;
 658   
 659  reserves_prim(reserves)$sum( (n,reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,reserves_up_down,reserves_spin_nonspin,'prim',headers_reserves)) = yes;
 660  reserves_nonprim(reserves)$sum( (n,reserves_up_down,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,reserves_up_down,reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
 661   
 662  reserves_prim_up(reserves)$sum( (n,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,'up',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
 663  reserves_prim_do(reserves)$sum( (n,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,'do',reserves_spin_nonspin,'prim',headers_reserves)) = yes;
 664  reserves_nonprim_up(reserves)$sum( (n,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,'up',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
 665  reserves_nonprim_do(reserves)$sum( (n,reserves_spin_nonspin,headers_reserves), reserves_data_upload(n,reserves,'do',reserves_spin_nonspin,'nonprim',headers_reserves)) = yes;
 666   
 667  hst(ch)$sum( (n,bu,heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) = yes;
 668  hp(ch)$sum( (n,bu,heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat)) = yes;
 669   
 670  hel(ch)$sum( (n,bu,heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat)) = yes;
 671  hfo(ch)$sum( (n,bu,heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(n,bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat)) = yes;
 672   
 673   
 674   
 675   
 676  ***** Parameters *****
 677   
 678  *--- Generation technologies ---*
 679  technology_data(n,tech,headers_tech) = sum((tech_res_con,tech_dispatch), technology_data_upload(n,tech,tech_res_con,tech_dispatch,headers_tech)) ;
 680  eta(n,tech) = technology_data(n,tech,'eta_con') ;
 681  carbon_content(n,tech) = technology_data(n,tech,'carbon_content') ;
 682  c_up(n,dis) =technology_data(n,dis,'load change costs up') ;
 683  c_do(n,dis) = technology_data(n,dis,'load change costs down') ;
 684  c_fix(n,tech) = technology_data(n,tech,'fixed_costs') ;
 685  c_vom(n,tech) = technology_data(n,tech,'variable_om') ;
 686  CO2price(n,tech) = technology_data(n,tech,'CO2_price') ;
 687   
 688  c_inv_overnight(n,tech) = technology_data(n,tech,'oc') ;
 689  lifetime(n,tech) = technology_data(n,tech,'lifetime') ;
 690  recovery(n,tech) = technology_data(n,tech,'recovery_period') ;
 691  interest_rate(n,tech) = technology_data(n,tech,'interest_rate') ;
 692  m_p(n,tech) = technology_data(n,tech,'max_installable') ;
 693  m_e(n,tech) = technology_data(n,tech,'max_energy') ;
 694  grad_per_min(n,dis) = technology_data(n,dis,'load change flexibility') ;
 695  fuelprice(n,tech) = technology_data(n,tech,'fuel costs') ;
 696   
 697  c_cu(n,res) = technology_data(n,res,'curtailment_costs') ;
 698   
 699   
 700  *--- Storage technologies ---*
 701  c_m_sto(n,sto) = storage_data(n,sto,'mc');
 702  eta_sto(n,sto) = storage_data(n,sto,'efficiency');
 703  c_fix_sto(n,sto) = storage_data(n,sto,'fixed_costs');
 704  phi_sto_ini(n,sto) = storage_data(n,sto,'level_start');
 705  etop_max(n,sto) = storage_data(n,sto,'etop_max') ;
 706   
 707  c_inv_overnight_sto_e(n,sto) = storage_data(n,sto,'oc_energy');
 708  c_inv_overnight_sto_p(n,sto) = storage_data(n,sto,'oc_capacity');
 709  lifetime(n,sto) = storage_data(n,sto,'lifetime');
 710  interest_rate(n,sto) = storage_data(n,sto,'interest_rate');
 711  m_sto_e(n,sto) = storage_data(n,sto,'max_energy');
 712  m_sto_p(n,sto) = storage_data(n,sto,'max_power');
 713   
 714   
 715  *--- Reservoir technologies ---*
 716  c_m_rsvr(n,rsvr) = reservoir_data(n,rsvr,'mc');
 717  eta_rsvr(n,rsvr) = reservoir_data(n,rsvr,'efficiency');
 718  c_fix_rsvr(n,rsvr) = reservoir_data(n,rsvr,'fixed_costs');
 719  phi_rsvr_ini(n,rsvr) = reservoir_data(n,rsvr,'level_start');
 720  phi_rsvr_lev_min(n,rsvr) = reservoir_data(n,rsvr,'level_min');
 721   
 722  c_inv_overnight_rsvr_e(n,rsvr) = reservoir_data(n,rsvr,'oc_energy');
 723  c_inv_overnight_rsvr_p(n,rsvr) = reservoir_data(n,rsvr,'oc_capacity');
 724  inv_lifetime_rsvr(n,rsvr) = reservoir_data(n,rsvr,'lifetime');
 725  inv_interest_rsvr(n,rsvr) = reservoir_data(n,rsvr,'interest_rate');
 726  m_rsvr_e(n,rsvr) = reservoir_data(n,rsvr,'max_energy');
 727  m_rsvr_p(n,rsvr) = reservoir_data(n,rsvr,'max_power');
 728   
 729   
 730  *--- DSM technologies ---*
 731  dsm_curt(dsm)$sum( (n,dsm_type,headers_dsm), dsm_data_upload(n,dsm,'curt',headers_dsm)) = yes;
 732  dsm_shift(dsm)$sum( (n,dsm_type,headers_dsm), dsm_data_upload(n,dsm,'shift',headers_dsm)) = yes;
 733  dsm_data(n,dsm,headers_dsm) = sum(dsm_type, dsm_data_upload(n,dsm,dsm_type,headers_dsm) ) ;
 734   
 735  c_m_dsm_cu(n,dsm_curt) = dsm_data(n,dsm_curt,'mc')     ;
 736  c_m_dsm_shift(n,dsm_shift) = dsm_data(n,dsm_shift,'mc')  ;
 737  c_fix_dsm_cu(n,dsm_curt) = dsm_data(n,dsm_curt,'fc')  ;
 738  c_fix_dsm_shift(n,dsm_shift) = dsm_data(n,dsm_shift,'fc') ;
 739   
 740  t_dur_dsm_cu(n,dsm_curt) = dsm_data(n,dsm_curt,'max_duration')   ;
 741  t_off_dsm_cu(n,dsm_curt) = dsm_data(n,dsm_curt,'recovery_time')   ;
 742  t_dur_dsm_shift(n,dsm_shift) = dsm_data(n,dsm_shift,'max_duration')   ;
 743  t_off_dsm_shift(n,dsm_shift) = dsm_data(n,dsm_shift,'recovery_time')   ;
 744  eta_dsm_shift(n,dsm_shift)  = dsm_data(n,dsm_shift,'efficiency')   ;
 745   
 746  c_inv_overnight_dsm_cu(n,dsm_curt) =  dsm_data(n,dsm_curt,'oc')   ;
 747  c_inv_overnight_dsm_shift(n,dsm_shift)  =  dsm_data(n,dsm_shift,'oc')   ;
 748  inv_recovery_dsm_cu(n,dsm_curt)  =  dsm_data(n,dsm_curt,'lifetime')   ;
 749  inv_recovery_dsm_shift(n,dsm_shift)   =  dsm_data(n,dsm_shift,'lifetime')   ;
 750  inv_interest_dsm_cu(n,dsm_curt)   =  dsm_data(n,dsm_curt,'interest_rate')   ;
 751  inv_interest_dsm_shift(n,dsm_shift)  =  dsm_data(n,dsm_shift,'interest_rate')   ;
 752  m_dsm_cu(n,dsm_curt) =  dsm_data(n,dsm_curt,'max_installable')   ;
 753  m_dsm_shift(n,dsm_shift) =  dsm_data(n,dsm_shift,'max_installable')   ;
 754   
 755   
 756  *--- Temporal data ---*
 757  d_y(n,year,h) = time_data_upload(h,n,year,'demand')  ;
 758  phi_res_y(n,year,res,h) = sum(headers_time$(sameas(res,headers_time)), time_data_upload(h,n,year,headers_time));
 759  rsvr_in_y(n,year,rsvr,h) = sum(headers_time$(sameas(rsvr,headers_time)), time_data_upload(h,n,year,headers_time));
 760  phi_reserves_call_y(n,year,reserves,h) = reserves_time_data_activation(h,year,reserves) ;
 761  reserves_exogenous_y(n,year,reserves,h) = reserves_time_data_provision(h,year,reserves) ;
 762   
 763   
 764  *--- Spatial data ---*
 765  inv_lifetime_ntc(l) = topology_data(l,'lifetime') ;
 766  inv_recovery_ntc(l) = topology_data(l,'recovery_period') ;
 767  inv_interest_ntc(l) = topology_data(l,'interest_rate') ;
 768  c_inv_overnight_ntc(l) = topology_data(l,'overnight_costs') ;
 769  c_fix_ntc(l) = topology_data(l,'fixed_costs') ;
 770  m_ntc(l) = topology_data(l,'max_installable') ;
 771  dist(l) = topology_data(l,'distance') ;
 772   
 773   
 774  *--- Electric vehicles ---*
 775  c_m_ev(n,ev) = ev_data(n,ev,'mc') ;
 776  pen_phevfuel(n,ev) = ev_data(n,ev,'penalty_fuel') ;
 777  eta_ev_in(n,ev) = ev_data(n,ev,'efficiency_charge') ;
 778  eta_ev_out(n,ev) = ev_data(n,ev,'efficiency_discharge') ;
 779  phi_ev_ini(n,ev) = ev_data(n,ev,'ev_start') ;
 780   
 781  n_ev_e(n,ev) = ev_data(n,ev,'ev_capacity') ;
 782  phi_ev(n,ev) = ev_data(n,ev,'share_ev') ;
 783  ev_phev(n,ev) = ev_data(n,ev,'ev_type') ;
 784   
 785  n_ev_p(n,ev,h) = ev_time_data_upload(h,'n_ev_p',ev) ;
 786  ev_ed(n,ev,h) = ev_time_data_upload(h,'ev_ed',ev) ;
 787  ev_ged_exog(n,ev,h) = ev_time_data_upload(h,'ev_ged_exog',ev) ;
 788   
 789   
 790  *--- Prosumage ---*
 791  m_res_pro(n,res) = prosumage_data_generation(n,res,'max_power') ;
 792  m_sto_pro_e(n,sto) = prosumage_data_storage(n,sto,'max_energy') ;
 793  m_sto_pro_p(n,sto) = prosumage_data_storage(n,sto,'max_power') ;
 794  phi_sto_pro_ini(n,sto) = prosumage_data_storage(n,sto,'level_start') ;
 795   
 796   
 797  *--- Reserves ---*
 798  reserves_data(n,reserves,headers_reserves) = sum((reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim), reserves_data_upload(n,reserves,reserves_up_down,reserves_spin_nonspin,reserves_prim_nonprim,headers_reserves)) ;
 799  phi_reserves_share(n,reserves) = reserves_data(n,reserves,'share_sr_mr') ;
 800  reserves_intercept(n,reserves) = reserves_data(n,reserves,'intercept') ;
 801  reserves_slope(n,reserves,'wind_on') = reserves_data(n,reserves,'slope_wind_on') ;
 802  reserves_slope(n,reserves,'wind_off') = reserves_data(n,reserves,'slope_wind_off') ;
 803  reserves_slope(n,reserves,'pv') = reserves_data(n,reserves,'slope_pv') ;
 804  reserves_reaction(n,reserves) = reserves_data(n,reserves,'reaction_time') ;
 805  phi_reserves_pr_up(n) = reserves_data(n,'PR_up','fraction_pr') ;
 806  phi_reserves_pr_do(n) = reserves_data(n,'PR_do','fraction_pr') ;
 807   
 808   
 809  *--- Heat ---*
 810  heat_data(n,bu,ch,headers_heat) = sum((heat_storage,heat_hp,heat_elec,heat_fossil), heat_data_upload(n,bu,ch,heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) ;
 811  phi_heat_type(n,bu,ch) = heat_data(n,bu,ch,'share') ;
 812  dh_y(n,year,bu,ch,h) = phi_heat_type(n,bu,ch) * dh_upload(h,n,year,'demand',bu) ;
 813  d_dhw_y(n,year,bu,ch,h) = phi_heat_type(n,bu,ch) * d_dhw_upload(h,n,year,'demand',bu) ;
 814   
 815  eta_heat_stat(n,bu,ch) = heat_data(n,bu,ch,'static_efficiency') ;
 816  eta_heat_dyn(n,bu,ch) = heat_data(n,bu,ch,'dynamic_efficiency') ;
 817  eta_dhw_aux_stat(n,bu,ch) = heat_data(n,bu,ch,'static_efficiency_sets_aux_dhw') ;
 818  * currently not used
 819  n_heat_p_in(n,bu,ch) = heat_data(n,bu,ch,'max_power') ;
 820  n_heat_p_out(n,bu,ch) = heat_data(n,bu,ch,'max_outflow') ;
 821  n_heat_e(n,bu,ch) = heat_data(n,bu,ch,'max_level') ;
 822  n_sets_p_in(n,bu,ch) = heat_data(n,bu,ch,'max_power') ;
 823  n_sets_p_out(n,bu,ch) = heat_data(n,bu,ch,'max_outflow') ;
 824  n_sets_e(n,bu,ch) = heat_data(n,bu,ch,'max_level') ;
 825  n_sets_dhw_p_in(n,bu,ch) = heat_data(n,bu,ch,'max_power_in_sets_aux_dhw') ;
 826  n_sets_dhw_p_out(n,bu,ch) = heat_data(n,bu,ch,'max_power_out_sets_aux_dhw') ;
 827  n_sets_dhw_e(n,bu,ch) = heat_data(n,bu,ch,'max_energy_sets_aux_dhw') ;
 828  phi_heat_ini(n,bu,ch) = heat_data(n,bu,ch,'level_ini') ;
 829  temp_sink(n,bu,ch) = heat_data(n,bu,ch,'temperature_sink') ;
 830   
 831  temp_source(n,bu,'hp_as',h) = temp_source_upload(h,n,'hp_as') ;
 832  temp_source(n,bu,'hp_gs',h) = heat_data(n,bu,'hp_gs','temperature_source') ;
 833   
 834  temp_source(n,bu,'gas_hp_gs',h) = heat_data(n,bu,'gas_hp_gs','temperature_source') ;
 835  temp_source(n,bu,'hp_gs_elec',h) = heat_data(n,bu,'hp_gs_elec','temperature_source') ;
 836   
 837  pen_heat_fuel(n,bu,ch) = heat_data(n,bu,ch,'penalty_non-electric_heat_supply') ;
 838   
 839  area_floor(n,bu,ch) = heat_data(n,bu,ch,'area_floor') ;
 840   
 841   
 842   
 843  ***************  CALCULATE DERIVED PARAMETERS  *********************************
 844   
 845  c_m(n,tech) = fuelprice(n,tech)/eta(n,tech) + carbon_content(n,tech)/eta(n,tech)*CO2price(n,tech) + c_vom(n,tech)   ;
 846   
 847  c_i(n,tech) = c_inv_overnight(n,tech)*( interest_rate(n,tech) * (1+interest_rate(n,tech))**(lifetime(n,tech)) )
 848                    / ( (1+interest_rate(n,tech))**(lifetime(n,tech))-1 )       ;
 849   
 850  c_i_res(n,res) = c_i(n,res) ;
 851  c_fix_res(n,res) = c_fix(n,res) ;
 852   
 853  c_i_sto_e(n,sto) = c_inv_overnight_sto_e(n,sto)*( interest_rate(n,sto) * (1+interest_rate(n,sto))**(lifetime(n,sto)) )
 854                   / ( (1+interest_rate(n,sto))**(lifetime(n,sto))-1 )       ;
 855   
 856  c_i_sto_p(n,sto) = c_inv_overnight_sto_p(n,sto)*( interest_rate(n,sto) * (1+interest_rate(n,sto))**(lifetime(n,sto)) )
 857                   / ( (1+interest_rate(n,sto))**(lifetime(n,sto))-1 )       ;
 858   
 859  c_i_rsvr_e(n,rsvr) = c_inv_overnight_rsvr_e(n,rsvr)*( inv_interest_rsvr(n,rsvr) * (1+inv_interest_rsvr(n,rsvr))**(inv_lifetime_rsvr(n,rsvr)) )
 860                   / ( (1+inv_interest_rsvr(n,rsvr))**(inv_lifetime_rsvr(n,rsvr))-1 )       ;
 861   
 862  c_i_rsvr_p(n,rsvr) = c_inv_overnight_rsvr_p(n,rsvr)*( inv_interest_rsvr(n,rsvr) * (1+inv_interest_rsvr(n,rsvr))**(inv_lifetime_rsvr(n,rsvr)) )
 863                   / ( (1+inv_interest_rsvr(n,rsvr))**(inv_lifetime_rsvr(n,rsvr))-1 )       ;
 864   
 865  c_i_dsm_cu(n,dsm_curt) =c_inv_overnight_dsm_cu(n,dsm_curt)*( inv_interest_dsm_cu(n,dsm_curt) * (1+inv_interest_dsm_cu(n,dsm_curt))**(inv_recovery_dsm_cu(n,dsm_curt)) )
 866                   / ( (1+inv_interest_dsm_cu(n,dsm_curt))**(inv_recovery_dsm_cu(n,dsm_curt))-1 )       ;
 867   
 868  c_i_dsm_shift(n,dsm_shift) = c_inv_overnight_dsm_shift(n,dsm_shift)*( inv_interest_dsm_shift(n,dsm_shift) * (1+inv_interest_dsm_shift(n,dsm_shift))**(inv_recovery_dsm_shift(n,dsm_shift)) )
 869                   / ( (1+inv_interest_dsm_shift(n,dsm_shift))**(inv_recovery_dsm_shift(n,dsm_shift))-1 )       ;
 870   
 871  c_i_ntc(l) = c_inv_overnight_ntc(l) * (inv_interest_ntc(l) * (1 + inv_interest_ntc(l))**(inv_lifetime_ntc(l)) )
 872                   / ((1 + inv_interest_ntc(l)) ** (inv_lifetime_ntc(l))-1 ) ;
 873   
 874  phi_mean_reserves_call_y(n,year,reserves) = sum(h, phi_reserves_call_y(n,year,reserves,h) ) / card(h) + eps ;
 875   
 876   
 877  theta_sets(n,bu,'setsh')$(smax( (heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(n,bu,'setsh',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(n,bu,'setsh')) = 1;
 878  theta_dir(n,bu,'dir')$(smax((heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat) , heat_data_upload(n,bu,'dir',heat_storage,heat_hp,heat_elec,heat_fossil,headers_heat)) > 0 AND phi_heat_type(n,bu,'dir')) = 1;
 879   
 880  theta_storage(n,bu,ch)$(sum((heat_hp,heat_elec,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,'yes',heat_hp,heat_elec,heat_fossil,headers_heat)) AND phi_heat_type(n,bu,ch)) = 1;
 881  theta_hp(n,bu,ch)$sum( (heat_storage,heat_elec,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,heat_storage,'yes',heat_elec,heat_fossil,headers_heat) AND phi_heat_type(n,bu,ch)) = 1;
 882   
 883  theta_elec(n,bu,ch)$sum( (heat_storage,heat_hp,heat_fossil,headers_heat), heat_data_upload(n,bu,ch,heat_storage,heat_hp,'yes',heat_fossil,headers_heat) AND phi_heat_type(n,bu,ch)) = 1;
 884  theta_fossil(n,bu,ch)$sum( (heat_storage,heat_hp,heat_elec,headers_heat), heat_data_upload(n,bu,ch,heat_storage,heat_hp,heat_elec,'yes',headers_heat) AND phi_heat_type(n,bu,ch)) = 1;
 885   
 886   
 887   
 888  ***************  Adjust costs to model's hourly basis **************************
 889   
 890  c_i(n,tech) = c_i(n,tech)*card(h)/8760 ;
 891  c_i_res(n,tech) = c_i_res(n,tech)*card(h)/8760 ;
 892  c_i_sto_p(n,sto) = c_i_sto_p(n,sto)*card(h)/8760 ;
 893  c_i_sto_e(n,sto) = c_i_sto_e(n,sto)*card(h)/8760 ;
 894  c_i_rsvr_e(n,rsvr) = c_i_rsvr_e(n,rsvr)*card(h)/8760 ;
 895  c_i_rsvr_p(n,rsvr) = c_i_rsvr_p(n,rsvr)*card(h)/8760 ;
 896  c_i_dsm_cu(n,dsm_curt) = c_i_dsm_cu(n,dsm_curt)*card(h)/8760 ;
 897  c_i_dsm_shift(n,dsm_shift) = c_i_dsm_shift(n,dsm_shift)*card(h)/8760 ;
 898   
 899  c_fix(n,tech) = c_fix(n,tech)*card(h)/8760 ;
 900  c_fix_sto(n,sto) = c_fix_sto(n,sto)*card(h)/8760 ;
 901  c_fix_dsm_cu(n,dsm_curt) = c_fix_dsm_cu(n,dsm_curt)*card(h)/8760 ;
 902  c_fix_dsm_shift(n,dsm_shift) = c_fix_dsm_shift(n,dsm_shift)*card(h)/8760 ;
 903  c_fix_rsvr(n,rsvr) = c_fix_rsvr(n,rsvr)*card(h)/8760 ;
 904   
 905  m_e(n,'bio') = m_e(n,'bio')*card(h)/8760 ;
 906   
 907  c_i_ntc(l) = c_i_ntc(l) * card(h)/8760 ;
 908   
 909  *t_dur_dsm_cu(n,dsm_curt) = t_dur_dsm_cu(n,dsm_curt) ;
 910  *t_off_dsm_cu(n,dsm_curt) = t_off_dsm_cu(n,dsm_curt) ;
 911  *t_dur_dsm_shift(n,dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(dsm_shift)=5) = t_dur_dsm_shift(n,dsm_shift) / 2 ;
 912  *t_dur_dsm_shift(n,dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
 913   
 914   
 915   
 916  ***************  Check for parameter sanity ************************************
 917   
 918  Parameter
 919  check_heat
 920  check_heat_agg ;
 921  check_heat(n,bu) = sum( ch , phi_heat_type(n,bu,ch)) ;
 922  check_heat_agg = smax( (n,bu) , check_heat(n,bu) ) ;
 923  *abort$(check_heat_agg > 1) "DATA: heating technologies for a building type do not add up to 100 percent" ;
 924   
 925   
 926   
 927   
 928  ***************  Infeasibility *************************************************
 929   
 930  Positive variable
 931  G_INFES(n,h)
 932  ;
 933   
 934  Parameter
 935  c_infes  /100000/
 936  ;
 937   
 938   
 939   
 940   
 941   
 942   
 943   
 944   
 945   
 946   
 947   
 948   
 949   
 950   
 951   
 952   
 953   
 954   
 955  ********************************************************************************
 956   
 957  *************************************
 958  ***** Features for single nodes *****
 959  *************************************
 960   
 961  Set
 962  features /dsm, ev, reserves, prosumage, rsvr_outflow, heat/
 963  ;
 964   
 965   
 966  Table
 967  feat_node(features,n)
 968                   DE
      dsm              1
      $ontext
      reserves         1
      $ontext
      ev               1
      $ontext
      prosumage        1
      $ontext
 985  rsvr_outflow     0
      heat             1
      $ontext
 990  ;
 991   
 992   
      m_dsm_cu(n,dsm_curt)$(feat_node('dsm',n) = 0) = 0 ;
      m_dsm_shift(n,dsm_shift)$(feat_node('dsm',n) = 0) = 0 ;
      $ontext
 998   
      m_res_pro(n,res)$(feat_node('prosumage',n) = 0) = 0 ;
      m_sto_pro_e(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
      m_sto_pro_p(n,sto)$(feat_node('prosumage',n) = 0) = 0 ;
      $ontext
1005   
1006  phi_rsvr_min(n) = 0
1007  *feat_node('rsvr_outflow',n)
1008  ;
1009   
      dh(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      d_dhw(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      $ontext
1015   
1016   
1017  Set
1018  map_n_tech(n,tech)
1019  map_n_sto(n,sto)
1020  map_n_rsvr(n,rsvr)
1021  map_n_dsm(n,dsm)
1022  map_n_ev(n,ev)
1023  map_l(l)
1024  map_n_sto_pro(n,sto)
1025  map_n_res_pro(n,tech)
1026  ;
1027   
1028  map_n_tech(n,tech) = yes$m_p(n,tech) ;
1029  map_n_sto(n,sto) = yes$m_sto_p(n,sto) ;
1030  map_n_rsvr(n,rsvr) = yes$m_rsvr_p(n,rsvr) ;
1031  map_n_dsm(n,dsm_curt) = yes$m_dsm_cu(n,dsm_curt) ;
1032  map_n_dsm(n,dsm_shift) = yes$m_dsm_shift(n,dsm_shift) ;
1033  map_n_ev(n,ev) = yes$ev_data(n,ev,'share_ev') ;
1034  map_l(l) = yes$m_ntc(l) ;
1035  map_n_sto_pro(n,sto) = yes$(yes$m_sto_pro_p(n,sto)) ;
1036  map_n_res_pro(n,res) = yes$(yes$m_res_pro(n,res)) ;
1037  ;
1038   
1039   
1040   
1041   
1042  ********************************************************************************
1043   
1044  ***************************
1045  ***** Initialize data *****
1046  ***************************
1047   
1048  * Parameters for default base year
1049  d(n,h) = d_y(n,'2030',h) ;
1050  phi_res(n,res,h) = phi_res_y(n,'2030',res,h) ;
1051  rsvr_in(n,rsvr,h) = rsvr_in_y(n,'2030',rsvr,h) ;
1052  phi_reserves_call(n,reserves,h) = phi_reserves_call_y(n,'2030',reserves,h) ;
1053  phi_mean_reserves_call(n,reserves) = phi_mean_reserves_call_y(n,'2030',reserves) ;
1054  reserves_exogenous(n,reserves,h) = reserves_exogenous_y(n,'2030',reserves,h) ;
1055  dh(n,bu,ch,h) = dh_y(n,'2030',bu,ch,h) ;
1056  d_dhw(n,bu,ch,h) = d_dhw_y(n,'2030',bu,ch,h) ;
1057   
1058  dh(n,bu,ch,h) = area_floor(n,bu,ch) * dh(n,bu,ch,h) ;
1059  d_dhw(n,bu,ch,h) = area_floor(n,bu,ch) * d_dhw(n,bu,ch,h) ;
1060   
1061   
1062  * No interconnections between non-adjacent or nonuploaded nodes
1063  m_ntc(l)$( smax(n,inc(l,n)) = 0 OR smin(n,inc(l,n)) = 0 ) = 0 ;
1064   
1065   
1066  * Set loop parameters to default zero
1067  phi_min_res = 0 ;
1068  ev_quant = 0 ;
1069  phi_pro_self = 0 ;
1070  phi_pro_load(n) = 0 ;
1071  phi_pro_load(n)$feat_node('prosumage',n) = 0.2 ;
1072   
1073   
1074  Parameter
1075  phi_min_res_exog(n)
1076  min_flh(n,rsvr)
1077  ;
1078   
1079  phi_min_res_exog(n) = 1 ;
1080  min_flh(n,rsvr) = 0 ;
1081   
1082  *min_flh('FR',rsvr) = 1000 * card(h)/8760 ;
1083  *min_flh('AT',rsvr) = 1000 * card(h)/8760 ;
1084  *min_flh('CH',rsvr) = 1000 * card(h)/8760 ;
1085   
1086   
1087   
1088   
1089  ********************************************************************************
1090  ***** Model *****
1091  ********************************************************************************
1092   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\model.gms
1094   
1095  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1105  ********************************************************************************
1106   
1107   
1108  Variables
1109  Z                Value objective function [Euro]
1110  F(l,h)           Energy flow over link l in hour h [MWh]
1111  ;
1112   
1113  Positive Variables
1114  G_L(n,tech,h)            Generation level in hour h [MWh]
1115  G_UP(n,tech,h)           Generation upshift in hour h [MWh]
1116  G_DO(n,tech,h)           Generation downshift in hour h [MWh]
1117   
1118  G_RES(n,tech,h)          Generation renewables type res in hour h [MWh]
1119  CU(n,tech,h)             Renewables curtailment technology res in hour h [MWh]
1120   
1121  STO_IN(n,sto,h)          Storage inflow technology sto hour h [MWh]
1122  STO_OUT(n,sto,h)         Storage outflow technology sto hour h [MWh]
1123  STO_L(n,sto,h)           Storage level technology sto hour h [MWh]
1124   
1125  EV_CHARGE(n,ev,h)        Electric vehicle charging vehicle profile ev hour h [MWh]
1126  EV_DISCHARGE(n,ev,h)     Electric vehicle discharging vehicle profile ev hour h [MWh]
1127  EV_L(n,ev,h)             Electric vehicle charging level vehicle profile ev hour h [MWh]
1128  EV_PHEVFUEL(n,ev,h)      Plug in hybrid electric vehicle conventional fuel use vehicle profile ev hour h [MWh]
1129  EV_GED(n,ev,h)           Grid electricity demand for mobility vehicle profile ev hour h [MWh]
1130   
1131  N_TECH(n,tech)           Technology tech built [MW]
1132  N_STO_E(n,sto)           Storage technology built - Energy [MWh]
1133  N_STO_P(n,sto)           Storage loading and discharging capacity built - Capacity [MW]
1134   
1135  DSM_CU(n,dsm,h)          DSM: Load curtailment hour h [MWh]
1136  DSM_UP(n,dsm,h)          DSM: Load shifting up hour h technology dsm [MWh]
1137  DSM_DO(n,dsm,h,hh)       DSM: Load shifting down in hour hh to account for upshifts in hour h technology dsm [MWh]
1138   
1139  DSM_UP_DEMAND(n,dsm,h)   DSM: Load shifting up active for wholesale demand in hour h of technology dsm [MWh]
1140  DSM_DO_DEMAND(n,dsm,h)   DSM: Load shifting down active for wholesale demand in hour h of technology dsm [MWh]
1141   
1142  N_DSM_CU(n,dsm)          DSM: Load curtailment capacity [MW]
1143  N_DSM_SHIFT(n,dsm)       DSM: Load shifting capacity [MWh]
1144   
1145  RP_DIS(n,reserves,tech,h)        Reserve provision by conventionals in hour h [MW]
1146  RP_NONDIS(n,reserves,tech,h)     Reserve provision by renewables in hour h [MW]
1147  RP_STO_IN(n,reserves,sto,h)      Reserve provision by storage in in hour h [MW]
1148  RP_STO_OUT(n,reserves,sto,h)     Reserve provision by storage out in hour h [MW]
1149  RP_EV_V2G(n,reserves,ev,h)       Reserve provision by electric vehicles V2G hour h [MW]
1150  RP_EV_G2V(n,reserves,ev,h)       Reserve provision by electric vehicles G2V hour h [MW]
1151  RP_DSM_CU(n,reserves,dsm,h)      Reserve provision by DSM load curtailment in hour h [MW]
1152  RP_DSM_SHIFT(n,reserves,dsm,h)   Reserve provision by DSM load shifting in hour h [MW]
1153  RP_RSVR(n,reserves,rsvr,h)       Reserve provision by reservoirs h [MW]
1154  RP_SETS(n,reserves,bu,ch,h)      Reserve provision by SETS [MW]
1155  RP_SETS_AUX(n,reserves,bu,ch,h)  Reserve provision by SETS auxiliary DHW modules [MW]
1156  RP_HP(n,reserves,bu,ch,h)        Reserve provision by heat pumps [MW]
1157  RP_H_ELEC(n,reserves,bu,ch,h)    Reserve provision by hybrid electric heaters [MW]
1158   
1159  CU_PRO(n,tech,h)                 Prosumage: curtailment of renewable generation in hour h [MWh]
1160  G_MARKET_PRO2M(n,tech,h)         Prosumage. energy sent to market in hour h [MWh]
1161  G_MARKET_M2PRO(n,h)              Prosumage: withdrawal of energy from market in hour h [MWh]
1162  G_RES_PRO(n,tech,h)              Prosumage: hourly renewables generation in hour h [MWh]
1163  STO_IN_PRO2PRO(n,tech,sto,h)     Prosumage: storage loading from generation for discharging to consumption in hour h [MWh]
1164  STO_IN_PRO2M(n,tech,sto,h)       Prosumage: storage loading from generation for discharging to market in hour h [MWh]
1165  STO_IN_M2PRO(n,sto,h)            Prosumage: storage loading from market for discharging to consumption in hour h [MWh]
1166  STO_IN_M2M(n,sto,h)              Prosumage: storage loading from market for discharging to market in hour h [MWh]
1167  STO_OUT_PRO2PRO(n,sto,h)         Prosumage: storage discharging to consumption from generation in hour h [MWh]
1168  STO_OUT_PRO2M(n,sto,h)           Prosumage: storage discharging to market from generation in hour h [MWh]
1169  STO_OUT_M2PRO(n,sto,h)           Prosumage: storage discharging to consumption from market in hour h [MWh]
1170  STO_OUT_M2M(n,sto,h)             Prosumage: storage discharging to market from market in hour h [MWh]
1171  STO_L_PRO2PRO(n,sto,h)           Prosumage: storage level generation to consumption in hour h [MWh]
1172  STO_L_PRO2M(n,sto,h)             Prosumage: storage level generation to market in hour h [MWh]
1173  STO_L_M2PRO(n,sto,h)             Prosumage: storage level market to consumotion in hour h [MWh]
1174  STO_L_M2M(n,sto,h)               Prosumage: storage level market to market in hour h [MWh]
1175  N_STO_E_PRO(n,sto)               Prosumage: installed storage energy [MWh]
1176  N_STO_P_PRO(n,sto)               Prosumage: installed storage power [MW]
1177  STO_L_PRO(n,sto,h)               Prosumage: overall storage level in hour h [MWh]
1178  N_RES_PRO(n,tech)                Prosumage: installed renewables capacities [MW]
1179   
1180  NTC(l)                           Trade: installed NTC on line l [MW]
1181   
1182  RSVR_OUT(n,rsvr,h)               Reservoirs: outflow in hour h [MWh]
1183  RSVR_L(n,rsvr,h)                 Reservoirs: level in hour h [MWh]
1184  N_RSVR_E(n,rsvr)                 Reservoirs: installed energy capacity [MWh]
1185  N_RSVR_P(n,rsvr)                 Reservoirs: installed power capacity [MW]
1186   
1187  H_DIR(n,bu,ch,h)                 Heating: direct heating in hour h for building type bu with haeting technology ch [MWh]
1188  H_SETS_LEV(n,bu,ch,h)            Heating: storage level SETS technologies [MWh]
1189  H_SETS_IN(n,bu,ch,h)             Heating: storage inflow SETS technologies [MWh]
1190  H_SETS_OUT(n,bu,ch,h)            Heating: storage outflow SETS technologies [MWh]
1191  H_HP_IN(n,bu,ch,hh)              Heating: electricity demand heat pump technologies [MWh]
1192  H_STO_LEV(n,bu,ch,h)             Heating: storage level storage technologies [MWh]
1193  H_STO_IN_HP(n,bu,ch,h)           Heating: storage inflow from heat pumps to storage technologies [MWh]
1194  H_STO_IN_ELECTRIC(n,bu,ch,h)     Heating: storage inflow from electric heating to storage technologies [MWh]
1195  H_ELECTRIC_IN(n,bu,ch,h)         Heating: hybrid electric heaters electricity demand [MWh]
1196  H_STO_IN_FOSSIL(n,bu,ch,h)       Heating: storage inflow from nonelectric heating to storage technologies [MWh]
1197  H_STO_OUT(n,bu,ch,h)             Heating: storage outflow from storage technologies [MWh]
1198   
1199  H_DHW_DIR(n,bu,ch,h)             Heating - domestic hot water: provision in case of direct electric heating [MWh]
1200  H_DHW_STO_OUT(n,bu,ch,h)         Heating - domestic hot water: DHW storage outflow [MWh]
1201   
1202  H_DHW_AUX_ELEC_IN(n,bu,ch,h)     Heating - domestic hot water: electrical energy input of auxiliary hot water tank for SETS [MWh]
1203  H_DHW_AUX_LEV(n,bu,ch,h)         Heating - domestic hot water: level of auxiliary hot water tank for SETS [MWh]
1204  H_DHW_AUX_OUT(n,bu,ch,h)         Heating - domestic hot water: auxiliary DHW provision for SETS [MWh]
1205  ;
1206   
1207   
1208   
1209   
1210  ********************************************************************************
1211   
1212  Equations
1213  * Objective
1214  obj                      Objective cost minimization
1215   
1216  * Energy balance
1217  con1a_bal                Energy Balance
1218   
1219  * Load change costs
1220  con2a_loadlevel          Load change costs: Level
1221  con2b_loadlevelstart     Load change costs: Level for first period
1222   
1223  * Capacity contraints and flexibility constraints
1224  con3a_maxprod_dispatchable       Capacity Constraint conventionals
1225  con3b_minprod_dispatchable       Minimum production conventionals if reserves contracted
1226  con3c_flex_reserves_spin         Flexibility of conventionals for reserves provision
1227  con3d_flex_reserves_nonspin      Flexibility of conventionals for reserves provision
1228  con3e_maxprod_res                Capacity constraints renewables
1229  con3f_minprod_res                Minimum production RES if reserves contracted
1230   
1231  * Storage constraints
1232  con4a_stolev_start        Storage Level Dynamics Initial Condition
1233  con4b_stolev              Storage Level Dynamics
1234  con4c_stolev_max          Storage Power Capacity
1235  con4d_maxin_sto           Storage maximum inflow
1236  con4e_maxout_sto          Storage maximum outflow
1237  con4f_resrv_sto           Constraint on reserves (up)
1238  con4g_resrv_sto           Constraint on reserves (down)
1239  con4h_maxout_lev          Maximum storage outflow - no more than level of last period
1240  con4i_maxin_lev           Maximum storage inflow - no more than ebergy capacity minus level of last period
1241  con4j_ending              End level equal to initial level
1242  con4k_PHS_EtoP            Maximum E to P ratio for PHS
1243   
1244  * Minimum restrictions for renewables and biomass
1245  con5a_minRES             Minimum yearly renewables requirement
1246  con5b_max_energy         Maximum yearly biomass energy
1247   
1248  * DSM conditions: Load curtailment
1249  con6a_DSMcurt_duration_max       Maximum curtailment energy budget per time
1250  con6b_DSMcurt_max                Maximum curtailment per period
1251   
1252  * DSM conditions: Load shifting
1253  con7a_DSMshift_upanddown         Equalization of upshifts and downshifts in due time
1254  con7b_DSMshift_granular_max      Maximum shifting in either direction per period
1255  con7c_DSM_distrib_up             Distribution of upshifts between wholesale and reserves
1256  con7d_DSM_distrib_do             Distribution of downshifts between wholesale and reserves
1257  con7e_DSMshift_recovery          Recovery times
1258   
1259  * Maximum installation conditions
1260  con8a_max_I_power                Maximum installable capacity: Conventionals
1261  con8b_max_I_sto_e                Maximum installable energy: Storage in MWh
1262  con8c_max_I_sto_p                Maximum installable capacity: Storage inflow-outflow in MW
1263  con8d_max_I_dsm_cu               Maximum installable capacity: DSM load curtailment
1264  con8e_max_I_dsm_shift_pos        Maximum installable capacity: DSM load shifting
1265  con8f_max_pro_res                Maximum installable capacity: prosumage renewables
1266  con8g_max_pro_sto_e              Maximum installable capacity: prosumage storage energy
1267  con8h_max_sto_pro_p              Maximum installable capacity: prosumage storage power
1268  con8i_max_I_ntc                  Maximum installable NTC
1269  con8j_max_I_rsvr_e               Maximum installable energy reservoirs
1270  con8k_max_I_rsvr_p               Maximum installable power reservoirs
1271   
1272  * Reserves
1273  con9a_reserve_prov_endogenous    Reserve provision SR and MR (endogenous reserve provision)
1274  con9a_reserve_prov_exogenous     Reserve provision SR and MR (exogenous reserve provision)
1275  con9b_reserve_prov_PR_endogenous Reserve provision PR (endogenous reserve provision)
1276  con9b_reserve_prov_PR_exogenous  Reserve provision PR (exogenous reserve provision)
1277   
1278  * Electric vehicles
1279  con10a_ev_ed                     Energy balance of electric vehicles
1280  con10b_ev_chargelev_start        Cumulative charging level in the first hour
1281  con10c_ev_chargelev              Cumulative charging level in hour h
1282  con10d_ev_chargelev_max          Cumulative maximal charging level
1283  con10e_ev_maxin                  Cumulative maximal charging power
1284  con10f_ev_maxout                 Cumulative maximal discharging power
1285  con10g_ev_chargelev_ending       Cumulative charging level in the last hour
1286  con10h_ev_minin                  Cumulative minimal charging power
1287  con10i_ev_maxin_lev              Cumulative maximal charging limit
1288  con10j_ev_minout                 Cumulative minimal discharging power
1289  con10k_ev_maxout_lev             Cumulative maximal discharging limit
1290  con10l_ev_exog                   Exogenous EV charging
1291   
1292  * Prosumage
1293  con11a_pro_distrib                       Prosumage: distribution of generated energy
1294  con11b_pro_balance                       Prosumage: energy balance
1295  con11c_pro_selfcon                       Prosumage: minimum self-generation requirement
1296  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumager-to-prosumagers
1297  con11e_pro_stolev_PRO2M                  Prosumage: storage level prosumagers-to-market
1298  con11f_pro_stolev_M2PRO                  Prosumage: storage level market-to-prosumagers
1299  con11g_pro_stolev_M2M                    Prosumage: storage level market-to-market
1300  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial conditions
1301  con11h_2_pro_stolev_start_PRO2M          Prosumage: storage level initial conditions
1302  con11h_3_pro_stolev_start_M2PRO          Prosumage: storage level initial conditions
1303  con11h_4_pro_stolev_start_M2M            Prosumage: storage level initial conditions
1304  con11i_pro_stolev                        Prosumage: storage level total
1305  con11j_pro_stolev_max                    Prosumage: maximum overall storage level
1306  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
1307  con11l_pro_maxout_sto                    Prosumage: maximum storage outflow
1308  con11m_pro_maxout_lev                    Prosumage: maximum storage outflow linked to level
1309  con11n_pro_maxin_lev                     Prosumage: maximum storage inflow linked to level
1310  con11o_pro_ending                        Prosumage: storage ending condition
1311   
1312  * Cross-nodal trade
1313  con12a_max_f                     Maximum energy flow limited to positive NTC
1314  con12b_min_f                     Minimum energy flow limited to negative NTC
1315   
1316  * Resevoirs
1317  con13a_rsvrlev_start             Reservoir level law of motion initial condition
1318  con13b_rsvrlev                   Reservoir level law of motion
1319  con13c_rsvrlev_max               Maximum reservoir energy level
1320  con13d_maxout_rsvr               Maximum hourly reservoir outflow in relation to installed power capacity
1321  con13e_resrv_rsvr                Minimum hourly reservoir outflow in relation to provided negativr reserves
1322  con13f_maxout_lev                Maximum hourly reservoir outflow in relation tom installed energy capacity
1323  con13g_ending                    Reservoir level law of motion ending condition
1324  con13h_smooth                    Smooth reservoir outflow
1325  con13i_min_level                 Reservoir minimum level
1326  con13j_min_FLH
1327   
1328  * Residential heat
1329  con14a_heat_balance              Space heating energy balance
1330  con14b_dhw_balance               Domestic hot water energy balance
1331  con14c_sets_level                SETS - level law of motion
1332  con14d_sets_level_start          SETS - storage level initial condition
1333  con14e_sets_maxin                SETS - maximum energy inflow
1334  con14f_sets_maxout               SETS - maximum energy outflow
1335  con14g_sets_minin                SETS - minimum energy inflow if reserves contracted
1336  con14h_sets_maxlev               SETS - maximum storage level
1337  con14i_sets_aux_dhw_level        SETS auxiliary DHW module - storage level law of motion
1338  con14j_sets_aux_dhw_level_start  SETS auxiliary DHW module - storage level initial consition
1339  con14k_sets_aux_dhw_maxin        SETS auxiliary DHW module - maximum energy inflow
1340  con14l_sets_aux_dhw_minin        SETS auxiliary DHW module - minimum energy inflow if reserves contracted
1341  con14m_sets_aux_dhw_maxlev       SETS auxiliary DHW module - maximum storage level
1342  con14n_hp_in                     Heat pumps - electricity demand
1343  con14o_hp_maxin                  Heat pumps - maximum electricity demand
1344  con14p_hp_minin                  Heat pumps - minimum electricity demand if reserves contracted
1345  con14q_storage_elec_in           Hybrid electric heating - electricity demand
1346  con14r_storage_elec_maxin        Hybrid electric heating - maximum electricity demand
1347  con14s_storage_elec_minin        Hybrid electric heating - minimum electricity demand if reserves contracted
1348  con14t_storage_level             Storage heating - level law of motion
1349  con14u_storage_level_start       Hybrid electric heating - storage level initial condition
1350  con14v_storage_maxlev            Hybrid electric heating - maximum storage level
1351  ;
1352   
1353   
1354   
1355   
1356  ********************************************************************************
1357   
1358  * ---------------------------------------------------------------------------- *
1359  ***** Objective function *****
1360  * ---------------------------------------------------------------------------- *
1361   
1362  obj..
1363           Z =E=
1364                     sum( (h,map_n_tech(n,dis)) , c_m(n,dis)*G_L(n,dis,h) )
1365                   + sum( (h,map_n_tech(n,dis))$(ord(h)>1) , c_up(n,dis)*G_UP(n,dis,h) )
1366                   + sum( (h,map_n_tech(n,dis)) , c_do(n,dis)*G_DO(n,dis,h) )
1367                   + sum( (h,map_n_tech(n,nondis)) , c_cu(n,nondis)*CU(n,nondis,h) )
1368                   + sum( (h,map_n_sto(n,sto)) , c_m_sto(n,sto) * ( STO_OUT(n,sto,h) + STO_IN(n,sto,h) ) )
                       + sum( (h,map_n_dsm(n,dsm_curt)) , c_m_dsm_cu(n,dsm_curt)*DSM_CU(n,dsm_curt,h) )
                       + sum( (h,map_n_dsm(n,dsm_shift)) , c_m_dsm_shift(n,dsm_shift) * DSM_UP_DEMAND(n,dsm_shift,h) )
                       + sum( (h,map_n_dsm(n,dsm_shift)) , c_m_dsm_shift(n,dsm_shift) * DSM_DO_DEMAND(n,dsm_shift,h) )
      $ontext
                       + sum( (h,map_n_ev(n,ev)) , c_m_ev(n,ev) * EV_DISCHARGE(n,ev,h) )
                       + sum( (h,map_n_ev(n,ev)) , pen_phevfuel(n,ev) * EV_PHEVFUEL(n,ev,h) )
      $ontext
1380                   + sum( map_n_tech(n,tech) , c_i(n,tech)*N_TECH(n,tech) )
1381                   + sum( map_n_tech(n,tech) , c_fix(n,tech)*N_TECH(n,tech) )
1382                   + sum( map_n_sto(n,sto) , c_i_sto_e(n,sto)*N_STO_E(n,sto) )
1383                   + sum( map_n_sto(n,sto) , c_fix_sto(n,sto)/2*(N_STO_P(n,sto)+N_STO_E(n,sto)) )
1384                   + sum( map_n_sto(n,sto) , c_i_sto_p(n,sto)*N_STO_P(n,sto) )
                       + sum( map_n_dsm(n,dsm_curt) , c_i_dsm_cu(n,dsm_curt)*N_DSM_CU(n,dsm_curt) )
                       + sum( map_n_dsm(n,dsm_curt) , c_fix_dsm_cu(n,dsm_curt)*N_DSM_CU(n,dsm_curt) )
                       + sum( map_n_dsm(n,dsm_shift) , c_i_dsm_shift(n,dsm_shift)*N_DSM_SHIFT(n,dsm_shift) )
                       + sum( map_n_dsm(n,dsm_shift) , c_fix_dsm_shift(n,dsm_shift)*N_DSM_SHIFT(n,dsm_shift) )
      $ontext
                       + sum( (h,map_n_sto(n,sto),reserves_up) , phi_reserves_call(n,reserves_up,h) * c_m_sto(n,sto) * (RP_STO_OUT(n,reserves_up,sto,h) - RP_STO_IN(n,reserves_up,sto,h)) )
                       - sum( (h,map_n_sto(n,sto),reserves_do) , phi_reserves_call(n,reserves_do,h) * c_m_sto(n,sto) * (RP_STO_OUT(n,reserves_do,sto,h) - RP_STO_IN(n,reserves_do,sto,h)) )
                       + sum( (h,map_n_rsvr(n,rsvr),reserves_up) , RP_RSVR(n,reserves_up,rsvr,h) * phi_reserves_call(n,reserves_up,h) * c_m_rsvr(n,rsvr) )
                       - sum( (h,map_n_rsvr(n,rsvr),reserves_do) , RP_RSVR(n,reserves_do,rsvr,h) * phi_reserves_call(n,reserves_do,h) * c_m_rsvr(n,rsvr) )
      $ontext
      %EV%$ontext
      %EV_EXOG%        + sum( (h,map_n_ev(n,ev),reserves_up) , RP_EV_V2G(n,reserves_up,ev,h) * phi_reserves_call(n,reserves_up,h) * c_m_ev(n,ev) )
      %EV_EXOG%        - sum( (h,map_n_ev(n,ev),reserves_do) , RP_EV_V2G(n,reserves_do,ev,h) * phi_reserves_call(n,reserves_do,h) * c_m_ev(n,ev) )
      $ontext
      %reserves%$ontext
                       + sum( (h,map_n_dsm(n,dsm_curt),reserves_up) , RP_DSM_CU(n,reserves_up,dsm_curt,h) * phi_reserves_call(n,reserves_up,h) * c_m_dsm_cu(n,dsm_curt) )
                       + sum( (h,map_n_dsm(n,dsm_shift),reserves) , RP_DSM_SHIFT(n,reserves,dsm_shift,h) * phi_reserves_call(n,reserves,h) * c_m_dsm_shift(n,dsm_shift) )
      $ontext
                       + sum( map_n_res_pro(n,res) , c_i(n,res)*N_RES_PRO(n,res) )
                       + sum( map_n_res_pro(n,res) , c_fix(n,res)*N_RES_PRO(n,res) )
       
                       + sum( map_n_sto_pro(n,sto) , c_i_sto_e(n,sto)*N_STO_E_PRO(n,sto) )
                       + sum( map_n_sto_pro(n,sto) , c_fix_sto(n,sto)/2*(N_STO_P_PRO(n,sto) + N_STO_E_PRO(n,sto)) )
                       + sum( map_n_sto_pro(n,sto) , c_i_sto_p(n,sto)*N_STO_P_PRO(n,sto) )
       
                       + sum( (h,map_n_sto_pro(n,sto)) , c_m_sto(n,sto) * ( STO_OUT_PRO2PRO(n,sto,h) + STO_OUT_M2PRO(n,sto,h) + STO_OUT_PRO2M(n,sto,h) + STO_OUT_M2M(n,sto,h) + sum( res , STO_IN_PRO2PRO(n,res,sto,h) + STO_IN_PRO2M(n,res,sto,h)) + STO_OUT_P
      RO2M(n,sto,h) + STO_OUT_M2M(n,sto,h) ) )
      $ontext
1422                   + sum( map_l(l) , c_i_ntc(l) * NTC(l)*dist(l) )
1423   
1424                   + sum( (h,map_n_rsvr(n,rsvr)), c_m_rsvr(n,rsvr) * RSVR_OUT(n,rsvr,h) )
1425                   + sum( map_n_rsvr(n,rsvr) , c_i_rsvr_e(n,rsvr) * N_RSVR_E(n,rsvr) )
1426                   + sum( map_n_rsvr(n,rsvr) , c_i_rsvr_p(n,rsvr) * N_RSVR_P(n,rsvr) )
1427                   + sum( map_n_rsvr(n,rsvr) , c_fix_rsvr(n,rsvr) * N_RSVR_P(n,rsvr) )
                       + sum( (h,n,bu,hfo) , pen_heat_fuel(n,bu,hfo) * H_STO_IN_FOSSIL(n,bu,hfo,h))
      $ontext
1432                   + sum( (h,n) , c_infes * G_INFES(n,h) )
1433  ;
1434   
1435  * ---------------------------------------------------------------------------- *
1436  ***** Energy balance and load levels *****
1437  * ---------------------------------------------------------------------------- *
1438   
1439  * Energy balance
1440  con1a_bal(n,hh)..
1441           ( 1 - phi_pro_load(n) ) * d(n,hh) + sum( map_n_sto(n,sto) , STO_IN(n,sto,hh) )
               + sum( map_n_dsm(n,dsm_shift) , DSM_UP_DEMAND(n,dsm_shift,hh) )
      $ontext
               + sum( map_n_ev(n,ev) , EV_CHARGE(n,ev,hh) )
      $ontext
               + G_MARKET_M2PRO(n,hh)
               + sum( map_n_sto_pro(n,sto) , STO_IN_M2PRO(n,sto,hh))
               + sum( map_n_sto_pro(n,sto) , STO_IN_M2M(n,sto,hh))
      $ontext
              + sum( (bu,ch) , theta_dir(n,bu,ch) * (H_DIR(n,bu,ch,hh) + H_DHW_DIR(n,bu,ch,hh)) )
              + sum( (bu,ch) , theta_sets(n,bu,ch) * (H_SETS_IN(n,bu,ch,hh) + H_DHW_AUX_ELEC_IN(n,bu,ch,hh)) )
              + sum( (bu,hp) , theta_hp(n,bu,hp) * H_HP_IN(n,bu,hp,hh) )
              + sum( (bu,hel) , theta_elec(n,bu,hel) * H_ELECTRIC_IN(n,bu,hel,hh) )
      $ontext
1463           =E=
1464           sum( map_n_tech(n,dis) , G_L(n,dis,hh)) + sum( map_n_tech(n,nondis) , G_RES(n,nondis,hh)) + sum( sto , STO_OUT(n,sto,hh) ) + sum( map_n_rsvr(n,rsvr) , RSVR_OUT(n,rsvr,hh))
1465  *       + sum( map_l(l) , inc(l,n) * F(l,hh))
      *Balancing Correction Factor
              + sum( map_n_tech(n,dis) ,
                sum( reserves_do ,  RP_DIS(n,reserves_do,dis,hh) * phi_reserves_call(n,reserves_do,hh))
              - sum( reserves_up ,  RP_DIS(n,reserves_up,dis,hh) * phi_reserves_call(n,reserves_up,hh))
               )
      $ontext
               + sum( map_n_dsm(n,dsm_curt) , DSM_CU(n,dsm_curt,hh))
               + sum( map_n_dsm(n,dsm_shift) , DSM_DO_DEMAND(n,dsm_shift,hh))
      $ontext
              + sum( map_n_ev(n,ev) , EV_DISCHARGE(n,ev,hh) )
      $ontext
               + sum( map_n_res_pro(n,res) , G_MARKET_PRO2M(n,res,hh) )
               + sum( map_n_sto_pro(n,sto) , STO_OUT_PRO2M(n,sto,hh))
               + sum( map_n_sto_pro(n,sto) , STO_OUT_M2M(n,sto,hh))
      $ontext
1489           + G_INFES(n,hh)
1490  ;
1491   
1492  con2a_loadlevel(n,dis,h)$(ord(h) > 1 AND map_n_tech(n,dis))..
1493          G_L(n,dis,h) =E= G_L(n,dis,h-1) + G_UP(n,dis,h) - G_DO(n,dis,h)
1494  ;
1495   
1496  con2b_loadlevelstart(n,dis,h)$(ord(h) = 1 AND map_n_tech(n,dis))..
1497           G_L(n,dis,h) =E= G_UP(n,dis,h)
1498  ;
1499   
1500  * ---------------------------------------------------------------------------- *
1501  ***** Hourly maximum generation caps and constraints related to reserves   *****
1502  * ---------------------------------------------------------------------------- *
1503   
1504  con3a_maxprod_dispatchable(n,dis,h)$(map_n_tech(n,dis))..
1505          G_L(n,dis,h)
              + sum( reserves_up , RP_DIS(n,reserves_up,dis,h))
      *Balancing Correction Factor
              + sum( reserves_do ,  RP_DIS(n,reserves_do,dis,h) * phi_reserves_call(n,reserves_do,h))
              - sum( reserves_up ,  RP_DIS(n,reserves_up,dis,h) * phi_reserves_call(n,reserves_up,h))
      $ontext
1513          =L= N_TECH(n,dis)
1514  ;
1515   
1516  con3b_minprod_dispatchable(n,dis,h)$(map_n_tech(n,dis))..
1517          sum( reserves_do , RP_DIS(n,reserves_do,dis,h))
1518          =L= G_L(n,dis,h)
1519  * Balancing Correction Factor
1520          + sum( reserves_do ,  RP_DIS(n,reserves_do,dis,h) * phi_reserves_call(n,reserves_do,h))
1521          - sum( reserves_up ,  RP_DIS(n,reserves_up,dis,h) * phi_reserves_call(n,reserves_up,h))
1522  ;
1523   
1524  con3c_flex_reserves_spin(n,dis,reserves_spin,h)$(map_n_tech(n,dis))..
1525          RP_DIS(n,reserves_spin,dis,h)
1526          =L= grad_per_min(n,dis) * reserves_reaction(n,reserves_spin) * ( G_L(n,dis,h)
1527  * Balancing Correction Factor
1528          + sum( reserves_do ,  RP_DIS(n,reserves_do,dis,h) * phi_reserves_call(n,reserves_do,h))
1529          - sum( reserves_up ,  RP_DIS(n,reserves_up,dis,h) * phi_reserves_call(n,reserves_up,h)) )
1530  ;
1531   
1532  con3d_flex_reserves_nonspin(n,dis,reserves_nonspin,h)$(map_n_tech(n,dis))..
1533          RP_DIS(n,reserves_nonspin,dis,h)
1534          =L= grad_per_min(n,dis) * reserves_reaction(n,reserves_nonspin) * N_TECH(n,dis)
1535  ;
1536   
1537  con3e_maxprod_res(n,nondis,h)$(map_n_tech(n,nondis))..
1538          G_RES(n,nondis,h) + CU(n,nondis,h)
              + sum( reserves_up , RP_NONDIS(n,reserves_up,nondis,h))
      $ontext
1543          =E= phi_res(n,nondis,h) * N_TECH(n,nondis)
1544  ;
1545   
1546  con3f_minprod_res(n,nondis,h)$(map_n_tech(n,nondis))..
1547          sum( reserves_do , RP_NONDIS(n,reserves_do,nondis,h))
1548          =L= G_RES(n,nondis,h)
1549  ;
1550   
1551  * ---------------------------------------------------------------------------- *
1552  ***** Storage constraints *****
1553  * ---------------------------------------------------------------------------- *
1554   
1555  con4a_stolev_start(n,sto,h)$(map_n_sto(n,sto) AND ord(h) = 1)..
1556          STO_L(n,sto,h) =E= phi_sto_ini(n,sto) * N_STO_E(n,sto) + STO_IN(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT(n,sto,h)/(1+eta_sto(n,sto))*2
1557  ;
1558   
1559  con4b_stolev(n,sto,h)$((ord(h)>1) AND map_n_sto(n,sto))..
1560           STO_L(n,sto,h) =E= STO_L(n,sto,h-1) + STO_IN(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT(n,sto,h)/(1+eta_sto(n,sto))*2
               + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( RP_STO_IN(n,reserves_do,sto,h)*(1+eta_sto(n,sto))/2 + RP_STO_OUT(n,reserves_do,sto,h)/(1+eta_sto(n,sto))*2 ))
               - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( RP_STO_IN(n,reserves_up,sto,h)*(1+eta_sto(n,sto))/2 + RP_STO_OUT(n,reserves_up,sto,h)/(1+eta_sto(n,sto))*2 ))
      $ontext
1566  ;
1567   
1568  con4c_stolev_max(n,sto,h)$(map_n_sto(n,sto))..
1569          STO_L(n,sto,h) =L= N_STO_E(n,sto)
1570  ;
1571   
1572  con4d_maxin_sto(n,sto,h)$(map_n_sto(n,sto))..
1573          STO_IN(n,sto,h)
              + sum( reserves_do , RP_STO_IN(n,reserves_do,sto,h))
      $ontext
1578          =L= N_STO_P(n,sto)
1579  ;
1580   
1581  con4e_maxout_sto(n,sto,h)$(map_n_sto(n,sto))..
1582          STO_OUT(n,sto,h)
              + sum( reserves_up , RP_STO_OUT(n,reserves_up,sto,h))
      $ontext
1587          =L= N_STO_P(n,sto)
1588  ;
1589   
1590  con4f_resrv_sto(n,sto,h)$(map_n_sto(n,sto))..
1591          sum( reserves_up , RP_STO_IN(n,reserves_up,sto,h))
1592          =L= STO_IN(n,sto,h)
1593  ;
1594   
1595  con4g_resrv_sto(n,sto,h)$(map_n_sto(n,sto))..
1596          sum( reserves_do , RP_STO_OUT(n,reserves_do,sto,h))
1597          =L= STO_OUT(n,sto,h)
1598  ;
1599   
1600  con4h_maxout_lev(n,sto,h)$(map_n_sto(n,sto))..
1601          ( STO_OUT(n,sto,h)
              + sum( reserves_up , RP_STO_OUT(n,reserves_up,sto,h))
      $ontext
1606          ) /(1+eta_sto(n,sto))*2
1607          =L= STO_L(n,sto,h-1)
1608  ;
1609   
1610  con4i_maxin_lev(n,sto,h)$(map_n_sto(n,sto))..
1611          ( STO_IN(n,sto,h)
              + sum( reserves_do , RP_STO_IN(n,reserves_do,sto,h))
      $ontext
1616          ) * (1+eta_sto(n,sto))/2
1617          =L= N_STO_E(n,sto) - STO_L(n,sto,h-1)
1618  ;
1619   
1620  con4j_ending(n,sto,h)$(ord(h) = card(h) AND map_n_sto(n,sto))..
1621           STO_L(n,sto,h) =E= phi_sto_ini(n,sto) * N_STO_E(n,sto)
1622  ;
1623   
1624  con4k_PHS_EtoP(n,sto)$(map_n_sto(n,sto))..
1625          N_STO_E(n,sto) =L= etop_max(n,sto) * N_STO_P(n,sto)
1626  ;
1627   
1628  * ---------------------------------------------------------------------------- *
1629  ***** Quotas for renewables and biomass *****
1630  * ---------------------------------------------------------------------------- *
1631   
1632  con5a_minRES(n)..
1633  sum( h , G_L(n,'bio',h) + sum( map_n_tech(n,nondis) , G_RES(n,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RSVR_OUT(n,rsvr,h))
               - sum( reserves_do , (sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_do,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_do,rsvr,h))) * phi_reserves_call(n,reserves_do,h))
               + sum( reserves_up , (sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_up,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_up,rsvr,h))) * phi_reserves_call(n,reserves_up,h))
      $ontext
               + sum( map_n_sto_pro(n,sto) , STO_OUT_PRO2PRO(n,sto,h) + STO_OUT_PRO2M(n,sto,h)) + sum( map_n_res_pro(n,res) , G_MARKET_PRO2M(n,res,h) + G_RES_PRO(n,res,h))
      $ontext
1643  )
1644          =G= phi_min_res * phi_min_res_exog(n) * sum( h ,
1645           sum( map_n_tech(n,dis) , G_L(n,dis,h)) + sum( map_n_tech(n,nondis) , G_RES(n,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RSVR_OUT(n,rsvr,h))
               - sum( reserves_do , (sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_do,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_do,rsvr,h))) * phi_reserves_call(n,reserves_do,h))
               + sum( reserves_up , (sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_up,nondis,h)) + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_up,rsvr,h))) * phi_reserves_call(n,reserves_up,h))
      $ontext
               + sum( map_n_res_pro(n,res) , phi_res(n,res,h) * N_RES_PRO(n,res) - CU_PRO(n,res,h))
      $ontext
1655           )
1656  ;
1657   
1658  con5b_max_energy(n,dis)$(map_n_tech(n,dis) AND m_e(n,dis))..
1659           sum( h , G_L(n,dis,h) ) =L= m_e(n,dis)
1660  ;
1661   
1662  * ---------------------------------------------------------------------------- *
1663  ***** DSM constraints - curtailment *****
1664  * ---------------------------------------------------------------------------- *
1665   
1666  con6a_DSMcurt_duration_max(n,dsm_curt,h)$(map_n_dsm(n,dsm_curt))..
1667           sum( hh$( ord(hh) >= ord(h) AND ord(hh) < ord(h) + t_off_dsm_cu(n,dsm_curt) ) , DSM_CU(n,dsm_curt,hh)
              + sum( reserves_up , RP_DSM_CU(n,reserves_up,dsm_curt,hh) * phi_reserves_call(n,reserves_up,hh) )
      $ontext
1672           )
1673           =L= N_DSM_CU(n,dsm_curt) * t_dur_dsm_cu(n,dsm_curt)
1674  ;
1675   
1676  con6b_DSMcurt_max(n,dsm_curt,h)$(map_n_dsm(n,dsm_curt))..
1677          DSM_CU(n,dsm_curt,h)
              + sum( reserves_up , RP_DSM_CU(n,reserves_up,dsm_curt,h) )
      $ontext
1682            =L= N_DSM_CU(n,dsm_curt)
1683  ;
1684   
1685  * ---------------------------------------------------------------------------- *
1686  ***** DSM constraints - shifting *****
1687  * ---------------------------------------------------------------------------- *
1688   
1689  con7a_DSMshift_upanddown(n,dsm_shift,h)$(map_n_dsm(n,dsm_shift))..
1690           DSM_UP(n,dsm_shift,h) * (1 + eta_dsm_shift(n,dsm_shift))/2 =E= 2/(1+eta_dsm_shift(n,dsm_shift)) * sum( hh$( ord(hh) >= ord(h) - t_dur_dsm_shift(n,dsm_shift) AND ord(hh) <= ord(h) + t_dur_dsm_shift(n,dsm_shift) ) , DSM_DO(n,dsm_shift,h,hh))
1691  ;
1692   
1693  con7b_DSMshift_granular_max(n,dsm_shift,h)$(map_n_dsm(n,dsm_shift))..
1694           DSM_UP_DEMAND(n,dsm_shift,h) + DSM_DO_DEMAND(n,dsm_shift,h)
               + sum( reserves , RP_DSM_SHIFT(n,reserves,dsm_shift,h) )
      $ontext
1699           =L= N_DSM_SHIFT(n,dsm_shift)
1700  ;
1701   
1702  con7c_DSM_distrib_up(n,dsm_shift,h)$(map_n_dsm(n,dsm_shift))..
1703           DSM_UP(n,dsm_shift,h) =E= DSM_UP_DEMAND(n,dsm_shift,h)
               + sum( reserves_do , RP_DSM_SHIFT(n,reserves_do,dsm_shift,h) * phi_reserves_call(n,reserves_do,h))
      $ontext
1708  ;
1709   
1710  con7d_DSM_distrib_do(n,dsm_shift,h)$(map_n_dsm(n,dsm_shift))..
1711           sum( hh$( ord(hh) >= ord(h) - t_dur_dsm_shift(n,dsm_shift) AND ord(hh) <= ord(h) + t_dur_dsm_shift(n,dsm_shift) ) , DSM_DO(n,dsm_shift,hh,h) )
1712                   =E=
1713           DSM_DO_DEMAND(n,dsm_shift,h)
               + sum( reserves_up , RP_DSM_SHIFT(n,reserves_up,dsm_shift,h) * phi_reserves_call(n,reserves_up,h))
      $ontext
1718  ;
1719   
1720  con7e_DSMshift_recovery(n,dsm_shift,h)$(map_n_dsm(n,dsm_shift))..
1721           sum( hh$( ord(hh) >= ord(h) AND ord(hh) < ord(h) + t_off_dsm_shift(n,dsm_shift) ) , DSM_UP(n,dsm_shift,hh))
1722           =L= N_DSM_SHIFT(n,dsm_shift) * t_dur_dsm_shift(n,dsm_shift)
1723  ;
1724   
1725  * ---------------------------------------------------------------------------- *
1726  ***** Maximum installation constraints *****
1727  * ---------------------------------------------------------------------------- *
1728   
1729  con8a_max_I_power(n,tech)$(map_n_tech(n,tech))..
1730           N_TECH(n,tech) =L= m_p(n,tech)
1731  ;
1732   
1733  con8b_max_I_sto_e(n,sto)$(map_n_sto(n,sto))..
1734           N_STO_E(n,sto) =L= m_sto_e(n,sto)
1735  ;
1736   
1737  con8c_max_I_sto_p(n,sto)$(map_n_sto(n,sto))..
1738           N_STO_P(n,sto) =L= m_sto_p(n,sto)
1739  ;
1740   
1741  con8d_max_I_dsm_cu(n,dsm_curt)$(map_n_dsm(n,dsm_curt))..
1742           N_DSM_CU(n,dsm_curt) =L= m_dsm_cu(n,dsm_curt)
1743  ;
1744   
1745  con8e_max_I_dsm_shift_pos(n,dsm_shift)$(map_n_dsm(n,dsm_shift))..
1746           N_DSM_SHIFT(n,dsm_shift) =L= m_dsm_shift(n,dsm_shift)
1747  ;
1748   
1749  con8f_max_pro_res(n,res)$(map_n_res_pro(n,res))..
1750           N_RES_PRO(n,res) =L= m_res_pro(n,res)
1751  ;
1752   
1753  con8g_max_pro_sto_e(n,sto)$(map_n_sto_pro(n,sto))..
1754           N_STO_E_PRO(n,sto) =L= m_sto_pro_e(n,sto)
1755  ;
1756   
1757  con8h_max_sto_pro_p(n,sto)$(map_n_sto_pro(n,sto))..
1758           N_STO_P_PRO(n,sto) =L= m_sto_pro_p(n,sto)
1759  ;
1760   
1761  con8i_max_I_ntc(l)$(map_l(l))..
1762           NTC(l) =L= m_ntc(l)
1763  ;
1764   
1765  con8j_max_I_rsvr_e(n,rsvr)$(map_n_rsvr(n,rsvr))..
1766           N_RSVR_E(n,rsvr) =L= m_rsvr_e(n,rsvr)
1767  ;
1768   
1769  con8k_max_I_rsvr_p(n,rsvr)$(map_n_rsvr(n,rsvr))..
1770           N_RSVR_P(n,rsvr) =L= m_rsvr_p(n,rsvr)
1771  ;
1772   
1773  * ---------------------------------------------------------------------------- *
1774  ***** Reserve constraints *****
1775  * ---------------------------------------------------------------------------- *
1776   
1777  con9a_reserve_prov_endogenous(n,reserves_nonprim,h)..
1778            sum( map_n_tech(n,dis) , RP_DIS(n,reserves_nonprim,dis,h))
1779          + sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_nonprim,nondis,h))
1780          + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_nonprim,rsvr,h))
1781          + sum( map_n_sto(n,sto) , RP_STO_IN(n,reserves_nonprim,sto,h) + RP_STO_OUT(n,reserves_nonprim,sto,h))
              + sum( map_n_dsm(n,dsm_curt) , RP_DSM_CU(n,reserves_nonprim,dsm_curt,h))
              + sum( map_n_dsm(n,dsm_shift) , RP_DSM_SHIFT(n,reserves_nonprim,dsm_shift,h) )
      $ontext
      %EV_EXOG%   + sum( map_n_ev(n,ev) , RP_EV_G2V(n,reserves_nonprim,ev,h) + RP_EV_V2G(n,reserves_nonprim,ev,h) )
      $ontext
              + sum( (bu,ch) , theta_sets(n,bu,ch) * ( RP_SETS(n,reserves_nonprim,bu,ch,h) + RP_SETS_AUX(n,reserves_nonprim,bu,ch,h)) )
              + sum( (bu,ch) , theta_hp(n,bu,ch) * RP_HP(n,reserves_nonprim,bu,ch,h) )
              + sum( (bu,ch) , theta_elec(n,bu,ch) * RP_H_ELEC(n,reserves_nonprim,bu,ch,h) )
      $ontext
1797          =E= (
1798              feat_node('reserves',n) *
1799              1000 * phi_reserves_share(n,reserves_nonprim) * (
1800              reserves_intercept(n,reserves_nonprim) + sum( map_n_tech(n,nondis) , reserves_slope(n,reserves_nonprim,nondis) * (N_TECH(n,nondis)
                  + N_RES_PRO(n,nondis)
      $ontext
1805              )/1000 ) ) )$(ord(h) > 1)
1806  ;
1807   
1808  con9a_reserve_prov_exogenous(n,reserves_nonprim,h)..
1809            sum( map_n_tech(n,dis) , RP_DIS(n,reserves_nonprim,dis,h))
1810          + sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_nonprim,nondis,h))
1811          + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_nonprim,rsvr,h))
1812          + sum( map_n_sto(n,sto) , RP_STO_IN(n,reserves_nonprim,sto,h) + RP_STO_OUT(n,reserves_nonprim,sto,h))
              + sum( map_n_dsm(n,dsm_curt) , RP_DSM_CU(n,reserves_nonprim,dsm_curt,h))
              + sum( map_n_dsm(n,dsm_shift) , RP_DSM_SHIFT(n,reserves_nonprim,dsm_shift,h) )
      $ontext
      %EV_EXOG%   + sum( map_n_ev(n,ev) , RP_EV_G2V(n,reserves_nonprim,ev,h) + RP_EV_V2G(n,reserves_nonprim,ev,h) )
      $ontext
              + sum( (bu,ch) , theta_sets(n,bu,ch) * ( RP_SETS(n,reserves_nonprim,bu,ch,h) + RP_SETS_AUX(n,reserves_nonprim,bu,ch,h)) )
              + sum( (bu,ch) , theta_hp(n,bu,ch) * RP_HP(n,reserves_nonprim,bu,ch,h) )
              + sum( (bu,ch) , theta_elec(n,bu,ch) * RP_H_ELEC(n,reserves_nonprim,bu,ch,h) )
      $ontext
1828          =E= feat_node('reserves',n) * reserves_exogenous(n,reserves_nonprim,h)$(ord(h) > 1)
1829  ;
1830   
1831  con9b_reserve_prov_PR_endogenous(n,reserves_prim,h)..
1832            sum( map_n_tech(n,dis) , RP_DIS(n,reserves_prim,dis,h))
1833          + sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_prim,nondis,h))
1834          + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_prim,rsvr,h))
1835          + sum( map_n_sto(n,sto) , RP_STO_IN(n,reserves_prim,sto,h) + RP_STO_OUT(n,reserves_prim,sto,h) )
      %EV_EXOG%   + sum( map_n_ev(n,ev) , RP_EV_G2V(n,reserves_prim,ev,h) + RP_EV_V2G(n,reserves_prim,ev,h) )
      $ontext
1840           =E=
1841               feat_node('reserves',n) *
1842               phi_reserves_pr_up(n)* sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * (
1843               reserves_intercept(n,reserves_nonprim) + sum( map_n_tech(n,nondis) , reserves_slope(n,reserves_nonprim,nondis) * (N_TECH(n,nondis)
                   + N_RES_PRO(n,nondis)
      $ontext
1848               )/1000 ) ) )$(ord(h) > 1)
1849  ;
1850   
1851  con9b_reserve_prov_PR_exogenous(n,reserves_prim,h)..
1852            sum( map_n_tech(n,dis) , RP_DIS(n,reserves_prim,dis,h))
1853          + sum( map_n_tech(n,nondis) , RP_NONDIS(n,reserves_prim,nondis,h))
1854          + sum( map_n_rsvr(n,rsvr) , RP_RSVR(n,reserves_prim,rsvr,h))
1855          + sum( map_n_sto(n,sto) , RP_STO_IN(n,reserves_prim,sto,h) + RP_STO_OUT(n,reserves_prim,sto,h) )
      %EV_EXOG%   + sum( map_n_ev(n,ev) , RP_EV_G2V(n,reserves_prim,ev,h) + RP_EV_V2G(n,reserves_prim,ev,h) )
      $ontext
1860           =E= feat_node('reserves',n) * reserves_exogenous(n,reserves_prim,h)$(ord(h) > 1)
1861  ;
1862   
1863  * ---------------------------------------------------------------------------- *
1864  ***** Electric vehicle constraints *****
1865  * ---------------------------------------------------------------------------- *
1866   
1867  con10a_ev_ed(n,ev,h)$(map_n_ev(n,ev))..
1868           feat_node('ev',n) *
1869           ev_ed(n,ev,h) * phi_ev(n,ev) * ev_quant
1870           =e= EV_GED(n,ev,h) + EV_PHEVFUEL(n,ev,h)$(ev_phev(n,ev)=1)
1871  ;
1872   
1873  con10b_ev_chargelev_start(ev,h,n)$(map_n_ev(n,ev) AND ord(h) = 1 AND feat_node('ev',n))..
1874           EV_L(n,ev,h) =E= feat_node('ev',n) * phi_ev_ini(n,ev) * n_ev_e(n,ev) * phi_ev(n,ev) * ev_quant
1875           + EV_CHARGE(n,ev,h) * eta_ev_in(n,ev)
1876           - EV_DISCHARGE(n,ev,h) / eta_ev_out(n,ev)
1877           - EV_GED(n,ev,h)
1878  ;
1879   
1880  con10c_ev_chargelev(n,ev,h)$(map_n_ev(n,ev) AND ord(h) > 1 AND feat_node('ev',n))..
1881           EV_L(n,ev,h) =E= EV_L(n,ev,h-1)
1882           + EV_CHARGE(n,ev,h) * eta_ev_in(n,ev)
1883           - EV_DISCHARGE(n,ev,h) / eta_ev_out(n,ev)
      %EV_EXOG%   + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * (RP_EV_G2V(n,reserves_do,ev,h)*eta_ev_in(n,ev) + RP_EV_V2G(n,reserves_do,ev,h)/eta_ev_out(n,ev)) )
      %EV_EXOG%   - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * (RP_EV_G2V(n,reserves_up,ev,h)*eta_ev_in(n,ev) + RP_EV_V2G(n,reserves_up,ev,h)/eta_ev_out(n,ev)) )
      $ontext
1889           - EV_GED(n,ev,h)
1890  ;
1891   
1892  con10d_ev_chargelev_max(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1893           EV_L(n,ev,h)
1894           =L= n_ev_e(n,ev) * phi_ev(n,ev) * ev_quant
1895               * feat_node('ev',n)
1896  ;
1897   
1898  con10e_ev_maxin(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1899          EV_CHARGE(n,ev,h)
              + sum( reserves_do , RP_EV_G2V(n,reserves_do,ev,h))
      $ontext
1904          =L= n_ev_p(n,ev,h) * phi_ev(n,ev) * ev_quant
1905              * feat_node('ev',n)
1906  ;
1907   
1908  con10f_ev_maxout(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1909          EV_DISCHARGE(n,ev,h)
              + sum( reserves_up , RP_EV_V2G(n,reserves_up,ev,h))
      $ontext
1914          =L= n_ev_p(n,ev,h) * phi_ev(n,ev) * ev_quant
1915              * feat_node('ev',n)
1916  ;
1917   
1918  con10g_ev_chargelev_ending(n,ev,h)$(map_n_ev(n,ev) AND ord(h) = card(h) AND feat_node('ev',n))..
1919           EV_L(n,ev,h) =E= phi_ev_ini(n,ev) * n_ev_e(n,ev) * phi_ev(n,ev) * ev_quant * feat_node('ev',n)
1920  ;
1921   
1922  con10h_ev_minin(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1923           0 =L= EV_CHARGE(n,ev,h)
1924          - sum( reserves_up , RP_EV_G2V(n,reserves_up,ev,h))
1925  ;
1926   
1927  con10i_ev_maxin_lev(n,ev,h)$(map_n_ev(n,ev))..
1928          ( EV_CHARGE(n,ev,h)
1929          + sum( reserves_do , RP_EV_G2V(n,reserves_do,ev,h))
1930          ) * eta_ev_in(n,ev)
1931          =L= n_ev_e(n,ev) * phi_ev(n,ev) * ev_quant - EV_L(n,ev,h-1)
1932  ;
1933   
1934  con10j_ev_minout(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1935           0 =L= EV_DISCHARGE(n,ev,h)
1936          - sum( reserves_do , RP_EV_V2G(n,reserves_do,ev,h))
1937  ;
1938   
1939  con10k_ev_maxout_lev(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1940          ( EV_DISCHARGE(n,ev,h)
1941          + sum( reserves_up , RP_EV_V2G(n,reserves_up,ev,h))
1942  ) / eta_ev_out(n,ev)
1943          =L= EV_L(n,ev,h-1)
1944  ;
1945   
1946  con10l_ev_exog(n,ev,h)$(map_n_ev(n,ev) AND feat_node('ev',n))..
1947           EV_CHARGE(n,ev,h)
1948           =E=
1949           ev_ged_exog(n,ev,h) * phi_ev(n,ev) * ev_quant
1950           * feat_node('ev',n)
1951  ;
1952   
1953  * ---------------------------------------------------------------------------- *
1954  ***** Prosumage constraints *****
1955  * ---------------------------------------------------------------------------- *
1956   
1957  con11a_pro_distrib(n,res,h)$(map_n_res_pro(n,res))..
1958           phi_res(n,res,h) * N_RES_PRO(n,res)
1959           =E=
1960           CU_PRO(n,res,h) + G_MARKET_PRO2M(n,res,h) + G_RES_PRO(n,res,h) + sum( map_n_sto_pro(n,sto) , STO_IN_PRO2PRO(n,res,sto,h) + STO_IN_PRO2M(n,res,sto,h) )
1961  ;
1962   
1963  con11b_pro_balance(n,h)..
1964           phi_pro_load(n) * d(n,h)
1965           =E=
1966           sum( map_n_res_pro(n,res) , G_RES_PRO(n,res,h)) + sum( map_n_sto_pro(n,sto) , STO_OUT_PRO2PRO(n,sto,h) + STO_OUT_M2PRO(n,sto,h) ) + G_MARKET_M2PRO(n,h)
1967  ;
1968   
1969  con11c_pro_selfcon(n)..
1970           sum( (h,map_n_res_pro(n,res)) , G_RES_PRO(n,res,h) ) + sum( (h,sto) , STO_OUT_PRO2PRO(n,sto,h) )
1971           =G=
1972           phi_pro_self * sum( h , phi_pro_load(n) * d(n,h))
1973  ;
1974   
1975  con11d_pro_stolev_PRO2PRO(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) > 1 )..
1976           STO_L_PRO2PRO(n,sto,h) =E= STO_L_PRO2PRO(n,sto,h-1) + sum( map_n_res_pro(n,res) , STO_IN_PRO2PRO(n,res,sto,h))*(1+eta_sto(n,sto))/2 - STO_OUT_PRO2PRO(n,sto,h)/(1+eta_sto(n,sto))*2
1977  ;
1978   
1979  con11e_pro_stolev_PRO2M(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) > 1)..
1980           STO_L_PRO2M(n,sto,h) =E= STO_L_PRO2M(n,sto,h-1) + sum( map_n_res_pro(n,res) , STO_IN_PRO2M(n,res,sto,h))*(1+eta_sto(n,sto))/2 - STO_OUT_PRO2M(n,sto,h)/(1+eta_sto(n,sto))*2
1981  ;
1982   
1983  con11f_pro_stolev_M2PRO(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) > 1)..
1984           STO_L_M2PRO(n,sto,h) =E= STO_L_M2PRO(n,sto,h-1) + STO_IN_M2PRO(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT_M2PRO(n,sto,h)/(1+eta_sto(n,sto))*2
1985  ;
1986   
1987  con11g_pro_stolev_M2M(n,sto,h)$(ord(h) > 1)..
1988           STO_L_M2M(n,sto,h) =E= STO_L_M2M(n,sto,h-1) + STO_IN_M2M(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT_M2M(n,sto,h)/(1+eta_sto(n,sto))*2
1989  ;
1990   
1991  con11h_1_pro_stolev_start_PRO2PRO(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) = 1)..
1992          STO_L_PRO2PRO(n,sto,h) =E=
1993  *$ontext
1994          4*
1997           0.25 * phi_sto_pro_ini(n,sto) * N_STO_E_PRO(n,sto)
1998           + sum( map_n_res_pro(n,res) , STO_IN_PRO2PRO(n,res,sto,h))*(1+eta_sto(n,sto))/2 - STO_OUT_PRO2PRO(n,sto,h)/(1+eta_sto(n,sto))*2
1999  ;
2000   
2001  con11h_2_pro_stolev_start_PRO2M(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) = 1)..
2002          STO_L_PRO2M(n,sto,h) =E= 0.25 * phi_sto_pro_ini(n,sto) * N_STO_E_PRO(n,sto) + sum( map_n_res_pro(n,res) , STO_IN_PRO2M(n,res,sto,h))*(1+eta_sto(n,sto))/2 - STO_OUT_PRO2M(n,sto,h)/(1+eta_sto(n,sto))*2
2003  ;
2004   
2005  con11h_3_pro_stolev_start_M2PRO(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) = 1)..
2006          STO_L_M2PRO(n,sto,h) =E= 0.25 * phi_sto_pro_ini(n,sto) * N_STO_E_PRO(n,sto) + STO_IN_M2PRO(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT_M2PRO(n,sto,h)/(1+eta_sto(n,sto))*2
2007  ;
2008   
2009  con11h_4_pro_stolev_start_M2M(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) = 1)..
2010          STO_L_M2M(n,sto,h) =E= 0.25 * phi_sto_pro_ini(n,sto) * N_STO_E_PRO(n,sto) + STO_IN_M2M(n,sto,h)*(1+eta_sto(n,sto))/2 - STO_OUT_M2M(n,sto,h)/(1+eta_sto(n,sto))*2
2011  ;
2012   
2013  con11i_pro_stolev(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h)>1)..
2014           STO_L_PRO(n,sto,h) =E=   STO_L_PRO2PRO(n,sto,h) +  STO_L_PRO2M(n,sto,h) + STO_L_M2PRO(n,sto,h) + STO_L_M2M(n,sto,h)
2015  ;
2016   
2017  con11j_pro_stolev_max(n,sto,h)..
2018          STO_L_PRO(n,sto,h) =L= N_STO_E_PRO(n,sto)
2019  ;
2020   
2021  con11k_pro_maxin_sto(n,sto,h)$(map_n_sto_pro(n,sto))..
2022          sum( map_n_res_pro(n,res) , STO_IN_PRO2PRO(n,res,sto,h) + STO_IN_PRO2M(n,res,sto,h) ) + STO_IN_M2PRO(n,sto,h) + STO_IN_M2M(n,sto,h)
2023          =L= N_STO_P_PRO(n,sto)
2024  ;
2025   
2026  con11l_pro_maxout_sto(n,sto,h)$(map_n_sto_pro(n,sto))..
2027          STO_OUT_PRO2PRO(n,sto,h) + STO_OUT_PRO2M(n,sto,h) + STO_OUT_M2PRO(n,sto,h) + STO_OUT_M2M(n,sto,h)
2028          =L= N_STO_P_PRO(n,sto)
2029  ;
2030   
2031  con11m_pro_maxout_lev(n,sto,h)$(map_n_sto_pro(n,sto))..
2032          ( STO_OUT_PRO2PRO(n,sto,h) + STO_OUT_M2PRO(n,sto,h) + STO_OUT_PRO2M(n,sto,h) + STO_OUT_M2M(n,sto,h) ) / (1+eta_sto(n,sto))*2
2033          =L= STO_L_PRO(n,sto,h-1)
2034  ;
2035   
2036  con11n_pro_maxin_lev(n,sto,h)$(map_n_sto_pro(n,sto))..
2037          ( sum( map_n_res_pro(n,res) , STO_IN_PRO2PRO(n,res,sto,h) + STO_IN_PRO2M(n,res,sto,h) ) + STO_IN_M2PRO(n,sto,h) + STO_IN_M2M(n,sto,h) ) * (1+eta_sto(n,sto))/2
2038          =L= N_STO_E_PRO(n,sto) - STO_L_PRO(n,sto,h-1)
2039  ;
2040   
2041  con11o_pro_ending(n,sto,h)$(map_n_sto_pro(n,sto) AND ord(h) = card(h))..
2042           STO_L_PRO(n,sto,h) =E= phi_sto_pro_ini(n,sto) * N_STO_E_PRO(n,sto)
2043  ;
2044   
2045  * ---------------------------------------------------------------------------- *
2046  ***** NTC constraints *****
2047  * ---------------------------------------------------------------------------- *
2048   
2049  ***** Constraint on energy flow between nodes ******
2050  con12a_max_f(l,h)$(map_l(l))..
2051           F(l,h) =L= NTC(l)
2052  ;
2053   
2054  con12b_min_f(l,h)$(map_l(l))..
2055           F(l,h) =G= -NTC(l)
2056  ;
2057   
2058  * ---------------------------------------------------------------------------- *
2059  ***** Reservoir constraints *****
2060  * ---------------------------------------------------------------------------- *
2061   
2062  con13a_rsvrlev_start(n,rsvr,h)$(map_n_rsvr(n,rsvr) AND ord(h) = 1)..
2063          RSVR_L(n,rsvr,h) =E= phi_rsvr_ini(n,rsvr) * N_RSVR_E(n,rsvr) + rsvr_in(n,rsvr,h)/1000 * N_RSVR_E(n,rsvr) - RSVR_OUT(n,rsvr,h)
2064  ;
2065   
2066  con13b_rsvrlev(rsvr,h,n)$(ord(h) > 1 AND map_n_rsvr(n,rsvr))..
2067           RSVR_L(n,rsvr,h) =E= RSVR_L(n,rsvr,h-1) + rsvr_in(n,rsvr,h)/1000 * N_RSVR_E(n,rsvr) - RSVR_OUT(n,rsvr,h)
                      - sum( reserves_up , RP_RSVR(n,reserves_up,rsvr,h) * phi_reserves_call(n,reserves_up,h) )
                      + sum( reserves_do , RP_RSVR(n,reserves_do,rsvr,h) * phi_reserves_call(n,reserves_do,h) )
      $ontext
2073  ;
2074   
2075  con13c_rsvrlev_max(n,rsvr,h)$(map_n_rsvr(n,rsvr))..
2076          RSVR_L(n,rsvr,h) =L= N_RSVR_E(n,rsvr)
2077  ;
2078   
2079  con13d_maxout_rsvr(rsvr,h,n)$(map_n_rsvr(n,rsvr))..
2080          RSVR_OUT(n,rsvr,h)
              + sum( reserves_up , RP_RSVR(n,reserves_up,rsvr,h))
      $ontext
2085          =L= N_RSVR_P(n,rsvr)
2086  ;
2087   
2088  con13e_resrv_rsvr(n,rsvr,h)$(map_n_rsvr(n,rsvr))..
2089          sum( reserves_do , RP_RSVR(n,reserves_do,rsvr,h))
2090          =L= RSVR_OUT(n,rsvr,h)
2091  ;
2092   
2093  con13f_maxout_lev(n,rsvr,h)$(map_n_rsvr(n,rsvr))..
2094          RSVR_OUT(n,rsvr,h)
              + sum( reserves_up , RP_RSVR(n,reserves_up,rsvr,h))
      $ontext
2099          =L= RSVR_L(n,rsvr,h-1)
2100  ;
2101   
2102  con13g_ending(n,rsvr,h)$(map_n_rsvr(n,rsvr) AND ord(h) = card(h))..
2103           RSVR_L(n,rsvr,h) =E= phi_rsvr_ini(n,rsvr) * N_RSVR_E(n,rsvr)
2104  ;
2105   
2106  con13h_smooth(n,rsvr,h)$(map_n_rsvr(n,rsvr) AND feat_node('rsvr_outflow',n))..
2107           RSVR_OUT(n,rsvr,h) =G= phi_rsvr_min(n) * sum( hh , rsvr_in(n,rsvr,hh)/1000/card(hh)) * N_RSVR_E(n,rsvr)
2108  ;
2109   
2110  con13i_min_level(n,rsvr,h)$(map_n_rsvr(n,rsvr))..
2111           RSVR_L(n,rsvr,h) =G= phi_rsvr_lev_min(n,rsvr) * N_RSVR_E(n,rsvr)
2112  ;
2113   
2114  con13j_min_FLH(n,rsvr)$(map_n_rsvr(n,rsvr))..
2115           sum( h , RSVR_OUT(n,rsvr,h) ) =G= min_flh(n,rsvr) * N_RSVR_P(n,rsvr)
2116  ;
2117   
2118   
2119  * ---------------------------------------------------------------------------- *
2120  ***** Heating constraints *****
2121  * ---------------------------------------------------------------------------- *
2122   
2123  * Energy balances
2124  con14a_heat_balance(n,bu,ch,h)$feat_node('heat',n)..
2125           theta_dir(n,bu,ch) * H_DIR(n,bu,ch,h) + theta_sets(n,bu,ch) * H_SETS_OUT(n,bu,ch,h)+ theta_storage(n,bu,ch) * H_STO_OUT(n,bu,ch,h)
2126           + theta_sets(n,bu,ch) * (1-eta_heat_stat(n,bu,ch)) * H_SETS_LEV(n,bu,ch,h-1)$(theta_sets(n,bu,ch) AND ord(h) > 1)
2127           =G= dh(n,bu,ch,h)
2128  ;
2129   
2130  con14b_dhw_balance(n,bu,ch,h)$feat_node('heat',n)..
2131           theta_storage(n,bu,ch) * H_DHW_STO_OUT(n,bu,ch,h) + theta_dir(n,bu,ch) * H_DHW_DIR(n,bu,ch,h) + theta_sets(n,bu,ch) * H_DHW_AUX_OUT(n,bu,ch,h)
2132           =E=
2133           d_dhw(n,bu,ch,h)
2134  ;
2135   
2136  * SETS
2137  con14c_sets_level(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) AND ord(h) > 1)..
2138           H_SETS_LEV(n,bu,ch,h) =E= eta_heat_stat(n,bu,ch) * H_SETS_LEV(n,bu,ch,h-1) + eta_heat_dyn(n,bu,ch) * H_SETS_IN(n,bu,ch,h) - H_SETS_OUT(n,bu,ch,h)
               - theta_sets(n,bu,ch) * eta_heat_dyn(n,bu,ch) * (sum( reserves_up , RP_SETS(n,reserves_up,bu,ch,h) * phi_reserves_call(n,reserves_up,h) )
               - sum( reserves_do , RP_SETS(n,reserves_do,bu,ch,h) * phi_reserves_call(n,reserves_do,h) ))
      $ontext
2144  ;
2145   
2146  con14d_sets_level_start(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) AND (ord(h) = 1 OR ord(h) = card(h)))..
2147           H_SETS_LEV(n,bu,ch,h) =E= phi_heat_ini(n,bu,ch) * n_sets_e(n,bu,ch)
2148  ;
2149   
2150  con14e_sets_maxin(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch))..
2151           H_SETS_IN(n,bu,ch,h)
               + theta_sets(n,bu,ch) * sum( reserves_do , RP_SETS(n,reserves_do,bu,ch,h) )
      $ontext
2156           =L= n_sets_p_in(n,bu,ch)
2157  ;
2158   
2159  con14f_sets_maxout(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch))..
2160           H_SETS_OUT(n,bu,ch,h) =L= n_sets_p_out(n,bu,ch)
2161  ;
2162   
2163  con14g_sets_minin(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch))..
2164          sum( reserves_up , RP_SETS(n,reserves_up,bu,ch,h))
2165          =L= H_SETS_IN(n,bu,ch,h)
2166  ;
2167   
2168  con14h_sets_maxlev(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch))..
2169           H_SETS_LEV(n,bu,ch,h) =L= n_sets_e(n,bu,ch)
2170  ;
2171   
2172  * SETS and DHW
2173  con14i_sets_aux_dhw_level(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) AND ord(h) > 1)..
2174           H_DHW_AUX_LEV(n,bu,ch,h) =E= eta_dhw_aux_stat(n,bu,ch) * H_DHW_AUX_LEV(n,bu,ch,h-1) + H_DHW_AUX_ELEC_IN(n,bu,ch,h) - H_DHW_AUX_OUT(n,bu,ch,h)
               - theta_sets(n,bu,ch) * (sum( reserves_up , RP_SETS_AUX(n,reserves_up,bu,ch,h) * phi_reserves_call(n,reserves_up,h) )
               - sum( reserves_do , RP_SETS_AUX(n,reserves_do,bu,ch,h) * phi_reserves_call(n,reserves_do,h) ))
      $ontext
2180  ;
2181   
2182  con14j_sets_aux_dhw_level_start(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) AND (ord(h) = 1 OR ord(h) = card(h)) )..
2183           H_DHW_AUX_LEV(n,bu,ch,h) =E= phi_heat_ini(n,bu,ch) * n_sets_dhw_e(n,bu,ch)
2184  ;
2185   
2186  con14k_sets_aux_dhw_maxin(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) )..
2187           H_DHW_AUX_ELEC_IN(n,bu,ch,h)
               + theta_sets(n,bu,ch) * sum( reserves_do , RP_SETS_AUX(n,reserves_do,bu,ch,h) )
      $ontext
2192           =L= n_sets_dhw_p_in(n,bu,ch)
2193  ;
2194   
2195  con14l_sets_aux_dhw_minin(n,bu,ch,h)$(feat_node('heat',n) AND feat_node('reserves',n) AND theta_sets(n,bu,ch)  )..
2196          sum( reserves_up , RP_SETS_AUX(n,reserves_up,bu,ch,h))
2197          =L= H_DHW_AUX_ELEC_IN(n,bu,ch,h)
2198  ;
2199   
2200  con14m_sets_aux_dhw_maxlev(n,bu,ch,h)$(feat_node('heat',n) AND theta_sets(n,bu,ch) )..
2201           H_DHW_AUX_LEV(n,bu,ch,h) =L= n_sets_dhw_e(n,bu,ch)
2202  ;
2203   
2204  * HEAT PUMPS
2205  con14n_hp_in(n,bu,hp,h)$(feat_node('heat',n) AND theta_hp(n,bu,hp))..
2206           H_STO_IN_HP(n,bu,hp,h) =E= (H_HP_IN(n,bu,hp,h)
               - theta_hp(n,bu,hp) * (sum( reserves_up , RP_HP(n,reserves_up,bu,hp,h) * phi_reserves_call(n,reserves_up,h) )
               - sum( reserves_do , RP_HP(n,reserves_do,bu,hp,h) * phi_reserves_call(n,reserves_do,h) ))
      $ontext
2212           ) * eta_heat_dyn(n,bu,hp) * ((temp_sink(n,bu,hp)+273.15)/(temp_sink(n,bu,hp) - temp_source(n,bu,hp,h)))
2213  ;
2214   
2215  con14o_hp_maxin(n,bu,hp,h)$(feat_node('heat',n) AND theta_hp(n,bu,hp))..
2216           H_HP_IN(n,bu,hp,h)
               + sum( reserves_do , RP_HP(n,reserves_do,bu,hp,h) )
      $ontext
2221           =L= n_heat_p_in(n,bu,hp)
2222  ;
2223   
2224  con14p_hp_minin(n,bu,hp,h)$(feat_node('heat',n) AND theta_hp(n,bu,hp))..
2225          sum( reserves_up , RP_HP(n,reserves_up,bu,hp,h))
2226          =L= H_HP_IN(n,bu,hp,h)
2227  ;
2228   
2229  * (Hybrid) ELECTRIC HEATING
2230  con14q_storage_elec_in(n,bu,hel,h)$(feat_node('heat',n) AND theta_storage(n,bu,hel) AND theta_elec(n,bu,hel) )..
2231           H_STO_IN_ELECTRIC(n,bu,hel,h) =E= H_ELECTRIC_IN(n,bu,hel,h)
               - theta_elec(n,bu,hel) * (sum( reserves_up , RP_H_ELEC(n,reserves_up,bu,hel,h) * phi_reserves_call(n,reserves_up,h) )
               - sum( reserves_do , RP_H_ELEC(n,reserves_do,bu,hel,h) * phi_reserves_call(n,reserves_do,h) ))
      $ontext
2237  ;
2238   
2239  con14r_storage_elec_maxin(n,bu,hel,h)$(feat_node('heat',n) AND theta_storage(n,bu,hel) AND theta_elec(n,bu,hel ))..
2240           H_ELECTRIC_IN(n,bu,hel,h)
               + sum( reserves_do , RP_H_ELEC(n,reserves_do,bu,hel,h) )
      $ontext
2245           =L= n_heat_p_in(n,bu,hel)
2246  ;
2247   
2248  con14s_storage_elec_minin(n,bu,hel,h)$(feat_node('heat',n) AND feat_node('reserves',n) AND theta_storage(n,bu,hel) AND theta_elec(n,bu,hel) )..
2249          sum( reserves_up , RP_H_ELEC(n,reserves_up,bu,hel,h))
2250          =L= H_ELECTRIC_IN(n,bu,hel,h)
2251  ;
2252   
2253  * HEAT STORAGE
2254  con14t_storage_level(n,bu,hst,h)$(feat_node('heat',n) AND theta_storage(n,bu,hst) AND ord(h) > 1)..
2255           H_STO_LEV(n,bu,hst,h)
2256           =E=
2257           eta_heat_stat(n,bu,hst) * H_STO_LEV(n,bu,hst,h-1) + theta_hp(n,bu,hst)*H_STO_IN_HP(n,bu,hst,h) + theta_elec(n,bu,hst)*H_STO_IN_ELECTRIC(n,bu,hst,h) + theta_fossil(n,bu,hst) * H_STO_IN_FOSSIL(n,bu,hst,h)
2258           - H_STO_OUT(n,bu,hst,h) - H_DHW_STO_OUT(n,bu,hst,h)
2259  ;
2260   
2261  con14u_storage_level_start(n,bu,hst,h)$(feat_node('heat',n) AND theta_storage(n,bu,hst) AND (ord(h) = 1 OR ord(h) = card(h)))..
2262           H_STO_LEV(n,bu,hst,h) =E= phi_heat_ini(n,bu,hst) * theta_storage(n,bu,hst)*n_heat_e(n,bu,hst)
2263  ;
2264   
2265  con14v_storage_maxlev(n,bu,hst,h)$(feat_node('heat',n) AND theta_storage(n,bu,hst))..
2266           H_STO_LEV(n,bu,hst,h) =L= n_heat_e(n,bu,hst)
2267  ;
2268   
2269   
2270   
2271   
2272  ********************************************************************************
2273  ***** MODEL *****
2274  ********************************************************************************
2275   
2276  model DIETER /
2277  obj
2278   
2279  con1a_bal
2280   
2281  con2a_loadlevel
2282  con2b_loadlevelstart
2283   
2284  con3a_maxprod_dispatchable
        con3b_minprod_dispatchable
        con3c_flex_reserves_spin
        con3d_flex_reserves_nonspin
      $ontext
2291  con3e_maxprod_res
        con3f_minprod_res
      $ontext
2296   
2297  con4a_stolev_start
2298  con4b_stolev
2299  con4c_stolev_max
2300  con4d_maxin_sto
2301  con4e_maxout_sto
        con4f_resrv_sto
        con4g_resrv_sto
      $ontext
2307   
2308  *con4h_maxout_lev
2309  *con4i_maxin_lev
2310  *con4j_ending
2311  *con4k_PHS_EtoP
2312   
2313  con5a_minRES
2314  con5b_max_energy
2315   
      con6a_DSMcurt_duration_max
      con6b_DSMcurt_max
       
      con7a_DSMshift_upanddown
      con7b_DSMshift_granular_max
      con7c_DSM_distrib_up
      con7d_DSM_distrib_do
      *con_7e_DSMshift_recovery
      $ontext
2327   
2328  con8a_max_I_power
2329  con8b_max_I_sto_e
2330  con8c_max_I_sto_p
        con8d_max_I_dsm_cu
        con8e_max_I_dsm_shift_pos
      $ontext
2336  con8i_max_I_ntc
2337  con8j_max_I_rsvr_e
2338  con8k_max_I_rsvr_p
2339   
       con9a_reserve_prov_endogenous
       con9b_reserve_prov_PR_endogenous
      $ontext
2345   
       con9a_reserve_prov_exogenous
       con9b_reserve_prov_PR_exogenous
      $ontext
2351   
       con10a_ev_ed
      %EV_EXOG% con10b_ev_chargelev_start
       con10c_ev_chargelev
       con10d_ev_chargelev_max
      %EV_EXOG% con10e_ev_maxin
      %EV_EXOG% con10f_ev_maxout
      %EV_EXOG% con10g_ev_chargelev_ending
      $ontext
      %reserves%$ontext
      %EV_EXOG% con10h_ev_minin
      %EV_EXOG% con10i_ev_maxin_lev
      %EV_EXOG% con10j_ev_minout
      %EV_EXOG% con10k_ev_maxout_lev
      $ontext
      %EV_EXOG%$ontext
       con10l_ev_exog
      $ontext
2375   
      con8f_max_pro_res
      con8g_max_pro_sto_e
      con8h_max_sto_pro_p
      con11a_pro_distrib
      con11b_pro_balance
      con11c_pro_selfcon
      con11d_pro_stolev_PRO2PRO
      con11e_pro_stolev_PRO2M
      con11f_pro_stolev_M2PRO
      con11g_pro_stolev_M2M
      con11h_1_pro_stolev_start_PRO2PRO
      con11h_2_pro_stolev_start_PRO2M
      con11h_3_pro_stolev_start_M2PRO
      con11h_4_pro_stolev_start_M2M
      con11i_pro_stolev
      con11j_pro_stolev_max
      con11k_pro_maxin_sto
      con11l_pro_maxout_sto
      con11m_pro_maxout_lev
      con11n_pro_maxin_lev
      con11o_pro_ending
      $ontext
2400   
2401  con12a_max_f
2402  con12b_min_f
2403   
2404  con13a_rsvrlev_start
2405  con13b_rsvrlev
2406  con13c_rsvrlev_max
2407  con13d_maxout_rsvr
2408  con13e_resrv_rsvr
2409  con13f_maxout_lev
2410  con13g_ending
2411  *con13h_smooth
2412  con13i_min_level
2413  *con13j_min_FLH
2414   
      con14a_heat_balance
      con14b_dhw_balance
      con14c_sets_level
      con14d_sets_level_start
      con14e_sets_maxin
      con14f_sets_maxout
      con14h_sets_maxlev
       
      con14i_sets_aux_dhw_level
      con14j_sets_aux_dhw_level_start
      con14k_sets_aux_dhw_maxin
      con14l_sets_aux_dhw_minin
      con14m_sets_aux_dhw_maxlev
       
      con14n_hp_in
      con14o_hp_maxin
      con14q_storage_elec_in
      con14r_storage_elec_maxin
      con14t_storage_level
      con14u_storage_level_start
      con14v_storage_maxlev
      $ontext
2439   
      %reserves%$ontext
      con14g_sets_minin
      con14p_hp_minin
      con14s_storage_elec_minin
      $ontext
2447  /;
2448   
2449   
2450   
2451   
2452  ********************************************************************************
2453  ***** Options, fixings, report preparation *****
2454  ********************************************************************************
2455   
2456  * Solver options
2462   
      $onecho > cplex.opt
      lpmethod 4
      threads 4
      epgap 1e-3
      barcrossalg -1
      barepcomp 1e-8
      $offecho
      $ontext
2473   
2474  dieter.OptFile = 1;
2475  dieter.holdFixed = 1 ;
2476   
2477   
2478   
2479   
2480  ********************************************************************************
2481  ***** Solve *****
2482  ********************************************************************************
2483   
2484  * Preparation of GUSS tool for scenario analysis
2485  phi_min_res = eps ;
2486  ev_quant = eps ;
2487  phi_pro_self = eps ;
2488   
2490   
2491  Set
2492  modelstats       model stats collection                  /modelstat, solvestat, resusd/
2493  superscen        Scenarios                               /scen1*scen1000/
2494  map(superscen,loop_res_share,loop_ev,loop_prosumage)    /#superscen:(#loop_res_share.#loop_ev.#loop_prosumage)/
2495  ;
2496   
2497  set
2498  scen(superscen);
2499  scen(superscen) = yes$( sum((loop_res_share,loop_ev,loop_prosumage) , map(superscen,loop_res_share,loop_ev,loop_prosumage)) )    ;
2500   
2501  Parameters
2502  gussoptions                              /Logoption 2, Optfile 1, Skipbasecase 1/
2503  modstats(superscen, modelstats)
2504  min_res
2505  number_ev
2506  pro_selfcon
2507  ;
2508   
2509  min_res(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,loop_res_share,loop_ev,loop_prosumage) , loop_res_share.val/100 ) ;
2510  number_ev(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,loop_res_share,loop_ev,loop_prosumage) , loop_ev.val ) ;
2511  pro_selfcon(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,loop_res_share,loop_ev,loop_prosumage) , loop_prosumage.val/100 ) ;
2512   
2513  Parameters
2514  * Equations
2515  marginal_con5a(superscen,*)
2516  marginal_con1a(superscen,*,*)
2517  marginal_con9a(superscen,*,*,*)
2518  marginal_con9b(superscen,*,*,*)
2519   
2520  * Basic
2521  lev_Z(superscen)
2522  lev_G_L(superscen,n,tech,h)
2523  lev_G_UP(superscen,n,tech,h)
2524  lev_G_DO(superscen,n,tech,h)
2525  lev_G_RES(superscen,n,tech,h)
2526  lev_CU(superscen,n,tech,h)
2527  lev_STO_IN(superscen,n,sto,h)
2528  lev_STO_OUT(superscen,n,sto,h)
2529  lev_STO_L(superscen,n,sto,h)
2530  lev_N_TECH(superscen,n,tech)
2531  lev_N_STO_E(superscen,n,sto)
2532  lev_N_STO_P(superscen,n,sto)
2533  lev_NTC(superscen,l)
2534  lev_F(superscen,l,h)
2535  lev_RSVR_OUT(superscen,n,rsvr,h)
2536  lev_RSVR_L(superscen,n,rsvr,h)
2537  lev_N_RSVR_E(superscen,n,rsvr)
2538  lev_N_RSVR_P(superscen,n,rsvr)
2539   
2540  * EV
2541  lev_EV_CHARGE(superscen,n,ev,h)
2542  lev_EV_DISCHARGE(superscen,n,ev,h)
2543  lev_EV_L(superscen,n,ev,h)
2544  lev_EV_PHEVFUEL(superscen,n,ev,h)
2545  lev_EV_GED(superscen,n,ev,h)
2546   
2547  * DSM
2548  lev_DSM_CU(superscen,n,dsm,h)
2549  lev_DSM_UP(superscen,n,dsm,h)
2550  lev_DSM_DO(superscen,n,dsm,h,hh)
2551  lev_DSM_UP_DEMAND(superscen,n,dsm,h)
2552  lev_DSM_DO_DEMAND(superscen,n,dsm,h)
2553  lev_N_DSM_CU(superscen,n,dsm)
2554  lev_N_DSM_SHIFT(superscen,n,dsm)
2555   
2556  * Reserves
2557  lev_RP_DIS(superscen,n,reserves,tech,h)
2558  lev_RP_NONDIS(superscen,n,reserves,tech,h)
2559  lev_RP_STO_IN(superscen,n,reserves,sto,h)
2560  lev_RP_STO_OUT(superscen,n,reserves,sto,h)
2561  lev_RP_RSVR(superscen,n,reserves,rsvr,h)
2562   
2563  * EV & reserves
2564  lev_RP_EV_V2G(superscen,n,reserves,ev,h)
2565  lev_RP_EV_G2V(superscen,n,reserves,ev,h)
2566   
2567  * DSM $ reserves
2568  lev_RP_DSM_CU(superscen,n,reserves,dsm,h)
2569  lev_RP_DSM_SHIFT(superscen,n,reserves,dsm,h)
2570   
2571  * Prosumage
2572  lev_CU_PRO(superscen,n,tech,h)
2573  lev_G_MARKET_PRO2M(superscen,n,tech,h)
2574  lev_G_MARKET_M2PRO(superscen,n,h)
2575  lev_G_RES_PRO(superscen,n,tech,h)
2576  lev_STO_IN_PRO2PRO(superscen,n,tech,sto,h)
2577  lev_STO_IN_PRO2M(superscen,n,tech,sto,h)
2578  lev_STO_IN_M2PRO(superscen,n,sto,h)
2579  lev_STO_IN_M2M(superscen,n,sto,h)
2580  lev_STO_OUT_PRO2PRO(superscen,n,sto,h)
2581  lev_STO_OUT_PRO2M(superscen,n,sto,h)
2582  lev_STO_OUT_M2PRO(superscen,n,sto,h)
2583  lev_STO_OUT_M2M(superscen,n,sto,h)
2584  lev_STO_L_PRO2PRO(superscen,n,sto,h)
2585  lev_STO_L_PRO2M(superscen,n,sto,h)
2586  lev_STO_L_M2PRO(superscen,n,sto,h)
2587  lev_STO_L_M2M(superscen,n,sto,h)
2588  lev_N_STO_E_PRO(superscen,n,sto)
2589  lev_N_STO_P_PRO(superscen,n,sto)
2590  lev_STO_L_PRO(superscen,n,sto,h)
2591  lev_N_RES_PRO(superscen,n,tech)
2592   
2593  * Heat
2594  lev_H_DIR(superscen,n,bu,ch,h)
2595  lev_H_SETS_LEV(superscen,n,bu,ch,h)
2596  lev_H_SETS_IN(superscen,n,bu,ch,h)
2597  lev_H_SETS_OUT(superscen,n,bu,ch,h)
2598  lev_H_HP_IN(superscen,n,bu,ch,h)
2599  lev_H_STO_LEV(superscen,n,bu,ch,h)
2600  lev_H_STO_IN_HP(superscen,n,bu,ch,h)
2601  lev_H_STO_IN_ELECTRIC(superscen,n,bu,ch,h)
2602  lev_H_ELECTRIC_IN(superscen,n,bu,ch,h)
2603  lev_H_STO_IN_FOSSIL(superscen,n,bu,ch,h)
2604  lev_H_STO_OUT(superscen,n,bu,ch,h)
2605   
2606  lev_H_DHW_STO(superscen,n,bu,ch,h)
2607  lev_H_DHW_STO_OUT(superscen,n,bu,ch,h)
2608  lev_H_DHW_DIR(superscen,n,bu,ch,h)
2609   
2610  lev_H_DHW_AUX_ELEC_IN(superscen,n,bu,ch,h)
2611  lev_H_DHW_AUX_LEV(superscen,n,bu,ch,h)
2612  lev_H_DHW_AUX_OUT(superscen,n,bu,ch,h)
2613   
2614   
2615  lev_RP_SETS(superscen,n,reserves,bu,ch,h)
2616  lev_RP_HP(superscen,n,reserves,bu,ch,h)
2617  lev_RP_H_ELEC(superscen,n,reserves,bu,ch,h)
2618  lev_RP_SETS_AUX(superscen,n,reserves,bu,ch,h)
2619   
2620  * Infeasibility
2621  lev_G_INFES(superscen,n,h)
2622  ;
2623   
2624   
2625  * Inclusion of scenario and fixing
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\fix.gms
2627   
2628  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
2638  ********************************************************************************
2639   
2640   
2641   
2642  ********************************************************************************
2643  **** Run of river  *************************************************************
2644  ********************************************************************************
2645   
2646  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('ror') (but no reserve provision):
2647   
2648  *$ontext
2649  N_TECH.fx(n,'ror') = 5857.47 ;
2650  G_RES.fx(n,'ror',h) = N_TECH.l(n,'ror') * phi_res(n,'ror',h) ;
      RP_NONDIS.fx(n,reserves,'ror',h) = 0 ;
      $ontext
2655   
2656  * Fix everything to zero in case no ROR option is selected:
2657  *N_TECH.fx(n,'ror') = 0 ;
2658  *G_RES.fx(n,'ror',h) = 0 ;
2659  *RP_NONDIS.fx(n,reserves,'ror',h) = 0 ;
2660   
2661   
2662   
2663  ********************************************************************************
2664  **** Exogenous EV  *************************************************************
2665  ********************************************************************************
2666   
      %EV_EXOG%$ontext
      EV_DISCHARGE.fx(n,ev,h) = 0 ;
      RP_EV_G2V.fx(n,reserves,ev,h) = 0 ;
      RP_EV_V2G.fx(n,reserves,ev,h) = 0 ;
      $ontext
2674   
2675   
2676   
2677  ********************************************************************************
2678  **** No storage and DSM in first period  ***************************************
2679  ********************************************************************************
2680   
2681  ** No storage inflow in first period **
2682  STO_IN.fx(n,sto,h)$(ord(h) = 1) = 0;
2683   
      ** No DSM load shifting in the first period **
      DSM_UP.fx(n,dsm_shift,h)$(ord(h) = 1) = 0;
      DSM_DO.fx(n,dsm_shift,h,hh)$(ord(h) = 1) = 0 ;
      DSM_DO.fx(n,dsm_shift,h,h)$(ord(h) = 1) = 0 ;
      DSM_UP_DEMAND.fx(n,dsm_shift,h)$(ord(h) = 1) = 0 ;
      DSM_DO_DEMAND.fx(n,dsm_shift,h)$(ord(h) = 1) = 0 ;
       
      ** No reserves provision by DSM in first period **
      RP_DSM_SHIFT.fx(n,reserves,dsm_shift,h)$(ord(h) = 1) = 0;
      RP_DSM_CU.fx(n,reserves,dsm_curt,h)$(ord(h) = 1) = 0 ;
      RP_DSM_CU.fx(n,reserves,dsm_curt,h)$(ord(h) = 1) = 0 ;
       
      ** No provision of PR and negative reserves by DSM load curtailment **
      RP_DSM_CU.fx(n,reserves_prim,dsm_curt,h) = 0 ;
      RP_DSM_CU.fx(n,reserves_do,dsm_curt,h) = 0 ;
       
      ** No provision of PR by DSM load shifting **
      RP_DSM_SHIFT.fx(n,reserves_prim,dsm_shift,h) = 0 ;
      $ontext
2705   
2706   
2707   
2708  ********************************************************************************
2709  **** No primary reserves by heating devices  ***********************************
2710  ********************************************************************************
2711   
      %reserves%$ontext
      RP_HP.fx(n,reserves_prim,bu,hp,h) = 0 ;
      RP_SETS.fx(n,reserves_prim,bu,ch,h) = 0 ;
      RP_SETS_AUX.fx(n,reserves_prim,bu,ch,h) = 0 ;
      RP_H_ELEC.fx(n,reserves_prim,bu,ch,h) = 0 ;
      $ontext
2720   
2721   
2722   
2723  ********************************************************************************
2724  **** Fixing to reduce model size  **********************************************
2725  ********************************************************************************
2726   
2727  F.fx(l,h)$(m_ntc(l) = 0) = 0 ;
2728  NTC.fx(l)$(m_ntc(l) = 0) = 0 ;
2729   
2730  G_L.fx(n,tech,h)$(m_p(n,tech) = 0) = 0 ;
2731  G_UP.fx(n,tech,h)$(m_p(n,tech) = 0) = 0 ;
2732  G_DO.fx(n,tech,h)$(m_p(n,tech) = 0) = 0 ;
2733  N_TECH.fx(n,tech)$(m_p(n,tech) = 0) = 0 ;
2734  G_RES.fx(n,tech,h)$(m_p(n,tech) = 0) = 0 ;
2735  CU.fx(n,tech,h)$(m_p(n,tech) = 0) = 0 ;
2736   
2737  N_STO_P.fx(n,sto)$(m_sto_p(n,sto) = 0) = 0 ;
2738  N_STO_E.fx(n,sto)$(m_sto_e(n,sto) = 0) = 0 ;
2739  STO_IN.fx(n,sto,h)$(m_sto_p(n,sto) = 0) = 0 ;
2740  STO_OUT.fx(n,sto,h)$(m_sto_p(n,sto) = 0) = 0 ;
2741  STO_L.fx(n,sto,h)$(m_sto_p(n,sto) = 0) = 0 ;
2742  RP_STO_IN.fx(n,reserves,sto,h)$(m_sto_p(n,sto) = 0) = 0 ;
2743  RP_STO_OUT.fx(n,reserves,sto,h)$(m_sto_p(n,sto) = 0) = 0 ;
2744   
2745  RSVR_OUT.fx(n,rsvr,h)$(m_rsvr_p(n,rsvr) = 0) = 0 ;
2746  RSVR_L.fx(n,rsvr,h)$(m_rsvr_p(n,rsvr) = 0) = 0 ;
2747  N_RSVR_E.fx(n,rsvr)$(m_rsvr_p(n,rsvr) = 0) = 0 ;
2748  N_RSVR_P.fx(n,rsvr)$(m_rsvr_p(n,rsvr) = 0) = 0 ;
2749   
      RP_DIS.fx(n,reserves,tech,h)$(feat_node('reserves',n) = 0 OR m_p(n,tech) = 0) = 0 ;
      RP_NONDIS.fx(n,reserves,tech,h)$(feat_node('reserves',n) = 0 OR m_p(n,tech) = 0) = 0 ;
      RP_STO_IN.fx(n,reserves,sto,h)$(feat_node('reserves',n) = 0 OR m_sto_p(n,sto) = 0) = 0 ;
      RP_STO_OUT.fx(n,reserves,sto,h)$(feat_node('reserves',n) = 0 OR m_sto_p(n,sto) = 0) = 0 ;
      RP_EV_V2G.fx(n,reserves,ev,h)$(feat_node('reserves',n) = 0) = 0 ;
      RP_EV_G2V.fx(n,reserves,ev,h)$(feat_node('reserves',n) = 0) = 0 ;
      RP_DSM_CU.fx(n,reserves,dsm_curt,h)$(feat_node('reserves',n) = 0 OR m_dsm_cu(n,dsm_curt) = 0) = 0 ;
      RP_DSM_SHIFT.fx(n,reserves,dsm_shift,h)$(feat_node('reserves',n) = 0 OR m_dsm_shift(n,dsm_shift) = 0) = 0 ;
      RP_RSVR.fx(n,reserves,rsvr,h)$(feat_node('reserves',n) = 0  OR m_rsvr_p(n,rsvr) = 0) = 0 ;
      $ontext
2762   
      CU_PRO.fx(n,res,h)$(feat_node('prosumage',n) = 0 OR m_res_pro(n,res) = 0) = 0 ;
      G_MARKET_PRO2M.fx(n,res,h)$(feat_node('prosumage',n) = 0 OR m_res_pro(n,res) = 0) = 0 ;
      G_MARKET_M2PRO.fx(n,h)$(feat_node('prosumage',n) = 0) = 0 ;
      G_RES_PRO.fx(n,res,h)$(feat_node('prosumage',n) = 0 OR m_res_pro(n,res) = 0) = 0 ;
      STO_IN_PRO2PRO.fx(n,res,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_IN_PRO2M.fx(n,res,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_IN_M2PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_IN_M2M.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_OUT_PRO2PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_OUT_PRO2M.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_OUT_M2PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_OUT_M2M.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_L_PRO2PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_L_PRO2M.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_L_M2PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_L_M2M.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      N_STO_E_PRO.fx(n,sto)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      N_STO_P_PRO.fx(n,sto)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      STO_L_PRO.fx(n,sto,h)$(feat_node('prosumage',n) = 0 OR m_sto_pro_p(n,sto) = 0) = 0 ;
      N_RES_PRO.fx(n,res)$(feat_node('prosumage',n) = 0 OR m_res_pro(n,res) = 0) = 0 ;
      $ontext
2786   
2787  *$ontext
2788  STO_IN_PRO2M.fx(n,res,sto,h) = 0 ;
2789  STO_IN_M2PRO.fx(n,sto,h)     = 0 ;
2790  STO_IN_M2M.fx(n,sto,h)       = 0 ;
2791  STO_OUT_PRO2M.fx(n,sto,h)    = 0 ;
2792  STO_OUT_M2PRO.fx(n,sto,h)    = 0 ;
2793  STO_OUT_M2M.fx(n,sto,h)      = 0 ;
2794  STO_L_PRO2M.fx(n,sto,h)      = 0 ;
2795  STO_L_M2PRO.fx(n,sto,h)      = 0 ;
2796  STO_L_M2M.fx(n,sto,h)        = 0 ;
2799   
2800   
      EV_CHARGE.fx(n,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      EV_DISCHARGE.fx(n,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      EV_L.fx(n,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      EV_PHEVFUEL.fx(n,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      EV_GED.fx(n,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      RP_EV_V2G.fx(n,reserves,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      RP_EV_G2V.fx(n,reserves,ev,h)$(feat_node('ev',n) = 0) = 0 ;
      $ontext
2811   
2812  *%heat%
      H_DIR.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_SETS_LEV.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_SETS_IN.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_SETS_OUT.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_HP_IN.up(n,bu,ch,hh)$(feat_node('heat',n) = 0) = 0 ;
      H_STO_LEV.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_STO_IN_HP.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_STO_IN_ELECTRIC.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_STO_IN_NONELECTRIC.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      H_STO_OUT.up(n,bu,ch,h)$(feat_node('heat',n) = 0) = 0 ;
      $ontext
2826   
2827   
2828   
2829  ********************************************************************************
2830  **** DEFAULT LEVELS FOR REPORT PARAMETERS  *************************************
2831  ********************************************************************************
2832   
2833  * Default level zero for report parameters
2834  lev_Z(scen) = 0 ;
2835  lev_G_L(scen,n,tech,h) = 0 ;
2836  lev_G_UP(scen,n,tech,h) = 0 ;
2837  lev_G_DO(scen,n,tech,h) = 0 ;
2838  lev_G_RES(scen,n,tech,h) = 0 ;
2839  lev_CU(scen,n,tech,h) = 0 ;
2840  lev_STO_IN(scen,n,sto,h) = 0 ;
2841  lev_STO_OUT(scen,n,sto,h) = 0 ;
2842  lev_STO_L(scen,n,sto,h) = 0 ;
2843  lev_N_TECH(scen,n,tech) = 0 ;
2844  lev_N_STO_E(scen,n,sto) = 0 ;
2845  lev_N_STO_P(scen,n,sto) = 0 ;
2846  marginal_con1a(scen,h,n) = 0 ;
2847  marginal_con5a(superscen,n) = 0 ;
2848  lev_NTC(superscen,l) = 0 ;
2849  lev_F(superscen,l,h) = 0 ;
2850  lev_RSVR_OUT(superscen,n,rsvr,h) = 0 ;
2851  lev_RSVR_L(superscen,n,rsvr,h) = 0 ;
2852  lev_N_RSVR_E(superscen,n,rsvr) = 0 ;
2853  lev_N_RSVR_P(superscen,n,rsvr) = 0 ;
2854  lev_G_INFES(superscen,n,h) = 0 ;
2855   
2856  * EV
2857  lev_EV_CHARGE(scen,n,ev,h) = 0 ;
2858  lev_EV_DISCHARGE(scen,n,ev,h) = 0 ;
2859  lev_EV_L(scen,n,ev,h) = 0 ;
2860  lev_EV_PHEVFUEL(scen,n,ev,h) = 0 ;
2861  lev_EV_GED(scen,n,ev,h) = 0 ;
2862   
2863  * DSM
2864  lev_DSM_CU(scen,n,dsm,h) = 0 ;
2865  lev_DSM_UP(scen,n,dsm,h) = 0 ;
2866  lev_DSM_DO(scen,n,dsm,h,hh) = 0 ;
2867  lev_DSM_UP_DEMAND(scen,n,dsm,h) = 0 ;
2868  lev_DSM_DO_DEMAND(scen,n,dsm,h) = 0 ;
2869  lev_N_DSM_CU(scen,n,dsm) = 0 ;
2870  lev_N_DSM_SHIFT(scen,n,dsm) = 0 ;
2871   
2872  * Reserves
2873  lev_RP_DIS(scen,n,reserves,dis,h) = 0 ;
2874  lev_RP_NONDIS(scen,n,reserves,nondis,h) = 0 ;
2875  lev_RP_STO_IN(scen,n,reserves,sto,h) = 0 ;
2876  lev_RP_STO_OUT(scen,n,reserves,sto,h) = 0 ;
2877  lev_RP_RSVR(superscen,n,reserves,rsvr,h) = 0 ;
2878   
2879  * EV & reserves
2880  lev_RP_EV_V2G(scen,n,reserves,ev,h) = 0 ;
2881  lev_RP_EV_G2V(scen,n,reserves,ev,h) = 0 ;
2882   
2883  * DSM & reserves
2884  lev_RP_DSM_CU(scen,n,reserves,dsm_curt,h) = 0 ;
2885  lev_RP_DSM_SHIFT(scen,n,reserves,dsm_shift,h) = 0 ;
2886   
2887  * Prosumage
2888  lev_CU_PRO(scen,n,tech,h) = 0 ;
2889  lev_G_MARKET_PRO2M(scen,n,tech,h) = 0  ;
2890  lev_G_MARKET_M2PRO(scen,n,h) = 0  ;
2891  lev_G_RES_PRO(scen,n,tech,h) = 0  ;
2892  lev_STO_IN_PRO2PRO(scen,n,tech,sto,h) = 0  ;
2893  lev_STO_IN_PRO2M(scen,n,tech,sto,h) = 0  ;
2894  lev_STO_IN_M2PRO(scen,n,sto,h) = 0   ;
2895  lev_STO_IN_M2M(scen,n,sto,h) = 0  ;
2896  lev_STO_OUT_PRO2PRO(scen,n,sto,h) = 0  ;
2897  lev_STO_OUT_PRO2M(scen,n,sto,h) = 0  ;
2898  lev_STO_OUT_M2PRO(scen,n,sto,h) = 0  ;
2899  lev_STO_OUT_M2M(scen,n,sto,h) = 0  ;
2900  lev_STO_L_PRO2PRO(scen,n,sto,h) = 0  ;
2901  lev_STO_L_PRO2M(scen,n,sto,h) = 0  ;
2902  lev_STO_L_M2PRO(scen,n,sto,h) = 0  ;
2903  lev_STO_L_M2M(scen,n,sto,h) = 0  ;
2904  lev_N_STO_E_PRO(scen,n,sto) = 0  ;
2905  lev_N_STO_P_PRO(scen,n,sto) = 0  ;
2906  lev_STO_L_PRO(scen,n,sto,h) = 0  ;
2907  lev_N_RES_PRO(scen,n,tech) = 0  ;
2908   
2909  * Heat
2910  lev_H_DIR(superscen,n,bu,ch,h) = 0 ;
2911  lev_H_SETS_LEV(superscen,n,bu,ch,h) = 0 ;
2912  lev_H_SETS_IN(superscen,n,bu,ch,h) = 0 ;
2913  lev_H_SETS_OUT(superscen,n,bu,ch,h) = 0 ;
2914  lev_H_HP_IN(superscen,n,bu,ch,h) = 0 ;
2915  lev_H_STO_LEV(superscen,n,bu,ch,h) = 0 ;
2916  lev_H_STO_IN_HP(superscen,n,bu,ch,h) = 0 ;
2917  lev_H_STO_IN_ELECTRIC(superscen,n,bu,ch,h) = 0 ;
2918  lev_H_STO_IN_FOSSIL(superscen,n,bu,ch,h) = 0 ;
2919  lev_H_STO_OUT(superscen,n,bu,ch,h) = 0 ;
2920   
2921  * Heat - DHW
2922  lev_H_DHW_DIR(superscen,n,bu,ch,h) = 0  ;
2923  lev_H_DHW_STO_OUT(superscen,n,bu,ch,h) = 0  ;
2924  lev_H_DHW_AUX_ELEC_IN(superscen,n,bu,ch,h) = 0  ;
2925  lev_H_DHW_AUX_LEV(superscen,n,bu,ch,h) = 0  ;
2926  lev_H_DHW_AUX_OUT(superscen,n,bu,ch,h) = 0  ;
2927   
2928  * Heat & reserves
2929  lev_RP_SETS_AUX(superscen,n,reserves,bu,ch,h) = 0 ;
2930  lev_RP_SETS(superscen,n,reserves,bu,ch,h) = 0 ;
2931  lev_RP_HP(superscen,n,reserves,bu,ch,h) = 0 ;
2932  lev_RP_H_ELEC(superscen,n,reserves,bu,ch,h) = 0 ;
2933   
2934   
2935  * Fixing of report parameters for run-of-river
2936  *$ontext
2937  lev_N_TECH(scen,n,'ror') = 5857.47 ;
2938  lev_G_RES(scen,n,'ror',h) = lev_N_TECH(scen,n,'ror') * phi_res(n,'ror',h) ;
      lev_RP_NONDIS(scen,n,reserves,'ror',h) = 0 ;
      $ontext
2943   
2944  *lev_N_TECH(scen,n,'ror') = 0 ;
2945  *lev_G_RES(scen,n,'ror',h) = 0 ;
      %ror_parameter%%ror_variable%lev_RP_CON(scen,n,reserves,'ror',h) = 0 ;
      $ontext
2950   
2951   
2952   
2953   
2954   
2955   
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\scenario.gms
2957   
2958  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
2968  ********************************************************************************
2969   
2970   
2971   
2972   
2973  *****************************************
2974  **** Scenario file                   ****
2975  ****                                 ****
2976  *****************************************
2977   
2978  Parameter
2979  m_exog_p(n,tech)
2980  m_exog_sto_e(n,sto)
2981  m_exog_sto_p(n,sto)
2982  m_exog_rsvr_p(n,rsvr)
2983  m_exog_ntc(l)
2984  ;
2985   
2986  m_exog_p(n,tech) = technology_data(n,tech,'fixed_capacities') ;
2987  m_exog_sto_e(n,sto) = storage_data(n,sto,'fixed_capacities_energy');
2988  m_exog_sto_p(n,sto) = storage_data(n,sto,'fixed_capacities_power');
2989  m_exog_rsvr_p(n,rsvr) = reservoir_data(n,rsvr,'fixed_capacities_power');
2990  m_exog_ntc(l) = topology_data(l,'fixed_capacities_ntc') ;
2991   
2992   
2993  *** Dispatch model
      N_TECH.lo(n,tech) = m_exog_p(n,tech) ;
      N_STO_P.lo(n,sto) = m_exog_sto_p(n,sto) ;
      N_STO_E.lo(n,sto) = m_exog_sto_e(n,sto) ;
      N_RSVR_P.lo(n,rsvr) =  m_exog_rsvr_p(n,rsvr) ;
      NTC.lo(l) = m_exog_ntc(l) ;
       
      N_TECH.up(n,tech) = m_exog_p(n,tech) + 0.1 ;
      N_STO_P.up(n,sto) = m_exog_sto_p(n,sto) + 0.1 ;
      N_STO_E.up(n,sto) = m_exog_sto_e(n,sto) + 0.1 ;
      N_RSVR_P.up(n,rsvr) =  m_exog_rsvr_p(n,rsvr) + 0.1 ;
      NTC.up(l) = m_exog_ntc(l) + 0.1 ;
       
      *N_TECH.lo(n,'OCGT') = m_exog_p(n,'OCGT') ;
      *N_TECH.up(n,'OCGT') = inf ;
3010   
3011  *** Investment model
3012  *$ontext
3013  N_TECH.lo(n,tech) = 0 ;
3014  N_TECH.lo(n,'wind_on') = m_exog_p(n,'wind_on') ;
3015  N_TECH.lo(n,'wind_off') = m_exog_p(n,'wind_off') ;
3016  N_TECH.lo(n,'pv') = m_exog_p(n,'pv') ;
3017  N_STO_P.lo(n,sto) = m_exog_sto_p(n,sto) ;
3018  N_STO_E.lo(n,sto) = m_exog_sto_e(n,sto) ;
3019  N_RSVR_P.lo(n,rsvr) =  m_exog_rsvr_p(n,rsvr) ;
3020  NTC.lo(l) = m_exog_ntc(l) ;
3021   
3022  N_TECH.up(n,tech) = m_exog_p(n,tech) + 0.1 ;
3023  N_TECH.up(n,'wind_on') = inf ;
3024  N_TECH.up(n,'wind_off') = inf ;
3025  N_TECH.up(n,'pv') = inf ;
3026  N_STO_P.up(n,sto) = m_exog_sto_p(n,sto) + 0.1 ;
3027  N_STO_E.up(n,sto) = m_exog_sto_e(n,sto) + 0.1 ;
3028  N_STO_P.up(n,'sto1') = inf ;
3029  N_STO_P.up(n,'sto5') = inf ;
3030  N_STO_P.up(n,'sto7') = inf ;
3031  N_STO_E.up(n,'sto1') = inf ;
3032  N_STO_E.up(n,'sto5') = inf ;
3033  N_STO_E.up(n,'sto7') = inf ;
3034  N_RSVR_P.up(n,rsvr) =  m_exog_rsvr_p(n,rsvr) + 0.1 ;
3035  NTC.up(l) = m_exog_ntc(l) + 0.1 ;
3036  *$offtext
3037   
3038   
3039  *** Reservoir assumption - not used here
3040  *phi_rsvr_lev_min(n,rsvr) = 0.0 ;
3041  *%GER_only%N_RSVR_E.lo('FR',rsvr) = 600 * m_exog_rsvr_p('FR',rsvr) ;
3042  *%GER_only%N_RSVR_E.lo('AT',rsvr) = 1700 * m_exog_rsvr_p('AT',rsvr) ;
3043  *%GER_only%N_RSVR_E.lo('CH',rsvr) = 3000 * m_exog_rsvr_p('CH',rsvr) ;
3044   
3045   
3046  *** Germany only, no infeasibility
3047  NTC.fx(l) = 0 ;
3048  F.fx(l,h) = 0 ;
3049  G_INFES.fx(n,h) = 0 ;
3050   
3051   
3052  *** Heating
3053  Parameter
3054  security_margin_n_heat_out /1.0/
3055  ;
3056   
3057  * Parameterization of water-based heat storage
3058  n_heat_p_out(n,bu,ch) = security_margin_n_heat_out * smax( h , dh(n,bu,ch,h) + d_dhw(n,bu,ch,h) ) ;
3059  n_heat_e(n,bu,ch) = 3 * n_heat_p_out(n,bu,ch) ;
3060  n_heat_p_in(n,bu,ch) = n_heat_p_out(n,bu,ch) ;
3061  n_heat_p_in(n,bu,'hp_gs') = n_heat_p_out(n,bu,'hp_gs') / ( eta_heat_dyn(n,bu,'hp_gs') * (temp_sink(n,bu,'hp_gs')+273.15) / (temp_sink(n,bu,'hp_gs') - 10) ) ;
3062  * at least -5°C; applied to 98% of hoursn; minimum: -13.4
3063  n_heat_p_in(n,bu,'hp_as') = n_heat_p_out(n,bu,'hp_as') / ( eta_heat_dyn(n,bu,'hp_as') * (temp_sink(n,bu,'hp_as')+273.15) / (temp_sink(n,bu,'hp_as') + 5) ) ;
3064   
3065  * Parameterization of SETS
3066  n_sets_p_out(n,bu,ch) = security_margin_n_heat_out * smax( h , dh(n,bu,ch,h) ) ;
3067  n_sets_p_in(n,bu,ch) = 2 * n_sets_p_out(n,bu,ch) ;
3068  n_sets_e(n,bu,ch) = 16 * n_sets_p_out(n,bu,ch) ;
3069   
3070  * Parameterization of DHW SETS
3071  n_sets_dhw_p_out(n,bu,ch) = security_margin_n_heat_out * smax( h , d_dhw(n,bu,ch,h) ) ;
3072  n_sets_dhw_p_in(n,bu,ch) = n_sets_dhw_p_out(n,bu,ch) ;
3073  n_sets_dhw_e(n,bu,ch) = 2.2 * n_sets_dhw_p_out(n,bu,ch) ;
3074   
3075  *RP_SETS_AUX.fx(n,reserves,bu,ch,h) = 0 ;
3076  *RP_SETS.fx(n,reserves,bu,ch,h) = 0 ;
3077  *RP_HP.fx(n,reserves,bu,ch,h) = 0 ;
3078  *RP_H_ELEC.fx(n,reserves,bu,ch,h) = 0 ;
3079   
3080   
3081  * Definition of dictionary set for GUSS tool
3082  Set dict(*,*,*) /
3083  scen             .scenario       .''
3084  gussoptions      .opt            .modstats
3085   
3086  phi_min_res      .param          .min_res
      ev_quant         .param          .number_ev
      $ontext
      phi_pro_self     .param          .pro_selfcon
      $ontext
3095   
3096  con5a_minRES     .marginal       .marginal_con5a
3097  con1a_bal        .marginal       .marginal_con1a
3098   
3099  Z                .level          .lev_Z
3100  G_L              .level          .lev_G_L
3101  G_UP             .level          .lev_G_UP
3102  G_DO             .level          .lev_G_DO
3103  G_RES            .level          .lev_G_RES
3104  CU               .level          .lev_CU
3105  STO_IN           .level          .lev_STO_IN
3106  STO_OUT          .level          .lev_STO_OUT
3107  STO_L            .level          .lev_STO_L
3108  N_TECH           .level          .lev_N_TECH
3109  N_STO_E          .level          .lev_N_STO_E
3110  N_STO_P          .level          .lev_N_STO_P
3111  NTC              .level          .lev_NTC
3112  F                .level          .lev_F
3113  RSVR_OUT         .level          .lev_RSVR_OUT
3114  RSVR_L           .level          .lev_RSVR_L
3115  N_RSVR_E         .level          .lev_N_RSVR_E
3116  N_RSVR_P         .level          .lev_N_RSVR_P
3117   
      EV_CHARGE        .level          .lev_EV_CHARGE
      EV_DISCHARGE     .level          .lev_EV_DISCHARGE
      EV_L             .level          .lev_EV_L
      EV_PHEVFUEL      .level          .lev_EV_PHEVFUEL
      EV_GED           .level          .lev_EV_GED
      $ontext
3126   
      DSM_CU           .level          .lev_DSM_CU
      DSM_UP           .level          .lev_DSM_UP
      DSM_DO           .level          .lev_DSM_DO
      DSM_UP_DEMAND    .level          .lev_DSM_UP_DEMAND
      DSM_DO_DEMAND    .level          .lev_DSM_DO_DEMAND
      N_DSM_CU         .level          .lev_N_DSM_CU
      N_DSM_SHIFT      .level          .lev_N_DSM_SHIFT
      $ontext
3137   
      RP_DIS           .level          .lev_RP_DIS
      RP_NONDIS        .level          .lev_RP_NONDIS
      RP_STO_IN        .level          .lev_RP_STO_IN
      RP_STO_OUT       .level          .lev_RP_STO_OUT
      RP_RSVR          .level          .lev_RP_RSVR
      $ontext
3146   
      con9a_reserve_prov_endogenous    .marginal       .marginal_con9a
      con9b_reserve_prov_PR_endogenous .marginal       .marginal_con9b
      $ontext
      con9a_reserve_prov_exogenous     .marginal       .marginal_con9a
      con9b_reserve_prov_PR_exogenous  .marginal       .marginal_con9b
      $ontext
3157   
      %EV%$ontext
      %EV_EXOG% RP_EV_V2G      .level          .lev_RP_EV_V2G
      %EV_EXOG% RP_EV_G2V      .level          .lev_RP_EV_G2V
      $ontext
3164   
      %DSM%$ontext
      RP_DSM_CU        .level          .lev_RP_DSM_CU
      RP_DSM_SHIFT     .level          .lev_RP_DSM_SHIFT
      $ontext
3171   
      CU_PRO           .level          .lev_CU_PRO
      G_MARKET_PRO2M   .level          .lev_G_MARKET_PRO2M
      G_MARKET_M2PRO   .level          .lev_G_MARKET_M2PRO
      G_RES_PRO        .level          .lev_G_RES_PRO
      STO_IN_PRO2PRO   .level          .lev_STO_IN_PRO2PRO
      STO_IN_PRO2M     .level          .lev_STO_IN_PRO2M
      STO_IN_M2PRO     .level          .lev_STO_IN_M2PRO
      STO_IN_M2M       .level          .lev_STO_IN_M2M
      STO_OUT_PRO2PRO  .level          .lev_STO_OUT_PRO2PRO
      STO_OUT_PRO2M    .level          .lev_STO_OUT_PRO2M
      STO_OUT_M2PRO    .level          .lev_STO_OUT_M2PRO
      STO_OUT_M2M      .level          .lev_STO_OUT_M2M
      STO_L_PRO        .level          .lev_STO_L_PRO
      STO_L_PRO2PRO    .level          .lev_STO_L_PRO2PRO
      STO_L_PRO2M      .level          .lev_STO_L_PRO2M
      STO_L_M2PRO      .level          .lev_STO_L_M2PRO
      STO_L_M2M        .level          .lev_STO_L_M2M
      N_STO_E_PRO      .level          .lev_N_STO_E_PRO
      N_STO_P_PRO      .level          .lev_N_STO_P_PRO
      N_RES_PRO        .level          .lev_N_RES_PRO
      $ontext
3195   
      H_DIR                    .level          .lev_H_DIR
      H_SETS_LEV               .level          .lev_H_SETS_LEV
      H_SETS_IN                .level          .lev_H_SETS_IN
      H_SETS_OUT               .level          .lev_H_SETS_OUT
      H_HP_IN                  .level          .lev_H_HP_IN
      H_STO_LEV                .level          .lev_H_STO_LEV
      H_STO_IN_HP              .level          .lev_H_STO_IN_HP
      H_STO_IN_ELECTRIC        .level          .lev_H_STO_IN_ELECTRIC
      H_ELECTRIC_IN            .level          .lev_H_ELECTRIC_IN
      H_STO_IN_FOSSIL          .level          .lev_H_STO_IN_FOSSIL
      H_STO_OUT                .level          .lev_H_STO_OUT
       
      H_DHW_STO_OUT            .level          .lev_H_DHW_STO_OUT
      H_DHW_DIR                .level          .lev_H_DHW_DIR
       
      H_DHW_AUX_ELEC_IN        .level          .lev_H_DHW_AUX_ELEC_IN
      H_DHW_AUX_LEV            .level          .lev_H_DHW_AUX_LEV
      H_DHW_AUX_OUT            .level          .lev_H_DHW_AUX_OUT
       
      $ontext
3218   
      %reserves%$ontext
      RP_SETS          .level          .lev_RP_SETS
      RP_SETS_AUX      .level          .lev_RP_SETS_AUX
      RP_HP            .level          .lev_RP_HP
      RP_H_ELEC        .level          .lev_RP_H_ELEC
      $ontext
3227   
3228  G_INFES          .level          .lev_G_INFES
3229  /
3230  ;
3231   
3232  *$ontext
3233  phi_sto_ini(n,sto) = 0;
3236   
3237  solve DIETER using lp min Z scenario dict;
3238   
3239   
3240  * Reporting
INCLUDE    C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\report.gms
3242   
3243  ********************************************************************************
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DIETER).
      Version 1.3.0, October 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses/mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
3253  ********************************************************************************
3254   
3256   
3257   
3258   
3259   
3260  ********************************************************************************
3261  **** Parameters for report file  ***********************************************
3262  ********************************************************************************
3263   
3264  Parameter
3265  corr_fac_dis             Balancing correction factor - dispatchable technologies
3266  corr_fac_nondis          Balancing correction factor - nondispatchable technologies
3267  corr_fac_sto             Balancing correction factor - storage technologies
3268  corr_fac_dsm_cu          Balancing correction factor - DSM curtailment technologies
3269  corr_fac_dsm_shift       Balancing correction factor - DSM shifting technologies
3270  corr_fac_ev              Balancing correction factor - electric vehicles
3271  corr_fac_rsvr            Balancing correction factor - reservoir
3272  corr_fac_sets            Balancing correction factor - SETS
3273  corr_fac_sets_aux        Balancing correction factor - SETS auxiliary DHW
3274  corr_fac_hp              Balancing correction factor - heat pumps
3275  corr_fac_h_elec          Balancing correction factor - hybrid electric storage heating
3276   
3277  corr_fac_ev_sep
3278   
3279  gross_energy_demand                      Gross energy demand
3280  gross_energy_demand_market               Gross energy demand - market (non-prosumage segment)
3281  gross_energy_demand_prosumers            Gross energy demand - prosumagers
3282  gross_energy_demand_prosumers_selfgen    Gross energy demand - prosumagers self-generated
3283  gross_energy_demand_prosumers_market     Gross energy demand - prosumagers from market
3284   
3285  reserves_activated
3286   
3287  calc_maxprice
3288  calc_minprice
3289   
3290  report
3291  report_tech
3292  report_tech_hours
3293  report_hours
3294  report_node
3295  report_line
3296  report_cost
3297   
3298  report_reserves
3299  report_reserves_hours
3300  report_reserves_tech
3301  report_reserves_tech_hours
3302   
3303  report_prosumage
3304  report_prosumage_tech
3305  report_prosumage_tech_hours
3306  report_market
3307  report_market_tech
3308  report_market_tech_hours
3309   
3310  report_heat_tech_hours
3311  report_heat_tech
3312  ;
3313   
3314   
3315   
3316   
3317  ********************************************************************************
3318  **** Initialize reporting paremetrs  *******************************************
3319  ********************************************************************************
3320   
3321  * Set reporting sensitivity. All results below will be reported as zero
3322  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        / 1e-4 / ;
3323  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         / 1e-2 / ;
3324  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   / 1 /    ;
3325   
3326   
3327  * ----------------------------------------------------------------------------
3328   
3329  * Min and max for prices
3330  calc_maxprice = 0 ;
3331  calc_minprice = 1000 ;
3332   
3333   
3334  * ----------------------------------------------------------------------------
3335   
3336  * Default values for correction factors
3337  corr_fac_dis(scen,n,dis,h) = 0 ;
3338  corr_fac_nondis(scen,n,nondis,h) = 0 ;
3339  corr_fac_sto(scen,n,sto,h) = 0 ;
3340  corr_fac_dsm_cu(scen,n,dsm_curt,h) = 0 ;
3341  corr_fac_dsm_shift(scen,n,dsm_shift,h) = 0 ;
3342  corr_fac_ev(scen,n,h) = 0 ;
3343  corr_fac_rsvr(scen,n,rsvr,h) = 0 ;
3344  corr_fac_sets(scen,n,bu,ch,h) = 0 ;
3345  corr_fac_sets_aux(scen,n,bu,ch,h) = 0 ;
3346  corr_fac_hp(scen,n,bu,ch,h) = 0 ;
3347  corr_fac_h_elec(scen,n,bu,ch,h) = 0 ;
3348   
3349  corr_fac_ev_sep(scen,n,ev,h) = 0 ;
3350   
3351   
3352  * ----------------------------------------------------------------------------
3353   
3354  * Parameter for hourly nodal reserves activated
3355  reserves_activated(scen,n,h) = 0 ;
      reserves_activated(scen,n,h)$(ord(h) > 1) =
      feat_node('reserves',n) * (
      sum( reserves_nonprim_up , phi_reserves_call(n,reserves_nonprim_up,h) * 1000 * phi_reserves_share(n,reserves_nonprim_up) * ( reserves_intercept(n,reserves_nonprim_up) + sum( nondis , reserves_slope(n,reserves_nonprim_up,nondis) * (lev_N_TECH(scen,n,
      nondis) + lev_N_RES_PRO(scen,n,nondis)))/1000))
      - sum( reserves_nonprim_do , phi_reserves_call(n,reserves_nonprim_do,h) * 1000 * phi_reserves_share(n,reserves_nonprim_do) * ( reserves_intercept(n,reserves_nonprim_do) + sum( nondis , reserves_slope(n,reserves_nonprim_do,nondis) * (lev_N_TECH(scen,
      n,nondis) + lev_N_RES_PRO(scen,n,nondis)))/1000))
      ) ;
      $ontext
3364   
      reserves_activated(scen,n,h)$(ord(h) > 1) =
      feat_node('reserves',n) * (
      sum( reserves_nonprim_up , phi_reserves_call(n,reserves_nonprim_up,h) * reserves_exogenous(n,reserves_nonprim_up,h))
      - sum( reserves_nonprim_do , phi_reserves_call(n,reserves_nonprim_do,h) * reserves_exogenous(n,reserves_nonprim_do,h))
      ) ;
      $ontext
3373   
3374   
3375  * ----------------------------------------------------------------------------
3376   
3377  * Prepare prosumage reporting parameters
      gross_energy_demand_prosumers(scen,n) = sum( h , phi_pro_load(n) * d(n,h));
      gross_energy_demand_prosumers_selfgen(scen,n) = sum( (h,res) , lev_G_RES_PRO(scen,n,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,n,sto,h) ) ;
      gross_energy_demand_prosumers_market(scen,n) = sum( h , lev_G_MARKET_M2PRO(scen,n,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,n,sto,h) ) ;
      $ontext
3384   
3385   
3386  * ----------------------------------------------------------------------------
3387   
3388  *Determine balancing correction factors
              corr_fac_dis(scen,n,tech,h) =
                sum( reserves_do ,  lev_RP_DIS(scen,n,reserves_do,tech,h) * phi_reserves_call(n,reserves_do,h))
              - sum( reserves_up ,  lev_RP_DIS(scen,n,reserves_up,tech,h) * phi_reserves_call(n,reserves_up,h))
      ;
              corr_fac_nondis(scen,n,tech,h) =
                sum( reserves_do ,  lev_RP_NONDIS(scen,n,reserves_do,tech,h) * phi_reserves_call(n,reserves_do,h))
              - sum( reserves_up ,  lev_RP_NONDIS(scen,n,reserves_up,tech,h) * phi_reserves_call(n,reserves_up,h))
      ;
              corr_fac_sto(scen,n,sto,h) =
                 sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( lev_RP_STO_IN(scen,n,reserves_do,sto,h) + lev_RP_STO_OUT(scen,n,reserves_do,sto,h)) )
               - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( lev_RP_STO_IN(scen,n,reserves_up,sto,h) + lev_RP_STO_OUT(scen,n,reserves_up,sto,h)) )
      ;
              corr_fac_rsvr(scen,n,rsvr,h) =
                sum( reserves_do ,  lev_RP_RSVR(scen,n,reserves_do,rsvr,h) * phi_reserves_call(n,reserves_do,h))
              - sum( reserves_up ,  lev_RP_RSVR(scen,n,reserves_up,rsvr,h) * phi_reserves_call(n,reserves_up,h))
      ;
       
      %DSM%$ontext
              corr_fac_dsm_cu(scen,n,dsm_curt,h) =
             - sum( reserves_up , lev_RP_DSM_CU(scen,n,reserves_up,dsm_curt,h) * phi_reserves_call(n,reserves_up,h) )
      ;
              corr_fac_dsm_shift(scen,n,dsm_shift,h) =
                sum( reserves_do ,  lev_RP_DSM_SHIFT(scen,n,reserves_do,dsm_shift,h) * phi_reserves_call(n,reserves_do,h))
              - sum( reserves_up ,  lev_RP_DSM_SHIFT(scen,n,reserves_up,dsm_shift,h) * phi_reserves_call(n,reserves_up,h))
      ;
      $ontext
      %reserves%$ontext
               corr_fac_ev(scen,n,h) = sum( ev ,
               + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * (lev_RP_EV_G2V(scen,n,reserves_do,ev,h) + lev_RP_EV_V2G(scen,n,reserves_do,ev,h)))
               - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * (lev_RP_EV_G2V(scen,n,reserves_up,ev,h) + lev_RP_EV_V2G(scen,n,reserves_up,ev,h))) )
      ;
       
               corr_fac_ev_sep(scen,n,ev,h) =
               + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * (lev_RP_EV_G2V(scen,n,reserves_do,ev,h) + lev_RP_EV_V2G(scen,n,reserves_do,ev,h)))
               - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * (lev_RP_EV_G2V(scen,n,reserves_up,ev,h) + lev_RP_EV_V2G(scen,n,reserves_up,ev,h)))
      ;
       
       
       
      $ontext
3433   
      %reserves%$ontext
               corr_fac_sets(scen,n,bu,ch,h) =
              + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( theta_sets(n,bu,ch) * lev_RP_SETS(scen,n,reserves_do,bu,ch,h) ))
              - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( theta_sets(n,bu,ch) * lev_RP_SETS(scen,n,reserves_up,bu,ch,h) ))
      ;
               corr_fac_sets_aux(scen,n,bu,ch,h) =
              + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( theta_sets(n,bu,ch) * lev_RP_SETS_AUX(scen,n,reserves_do,bu,ch,h) ))
              - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( theta_sets(n,bu,ch) * lev_RP_SETS_AUX(scen,n,reserves_up,bu,ch,h) ))
      ;
               corr_fac_hp(scen,n,bu,ch,h) =
              + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( theta_hp(n,bu,ch) * lev_RP_HP(scen,n,reserves_do,bu,ch,h) ))
              - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( theta_hp(n,bu,ch) * lev_RP_HP(scen,n,reserves_up,bu,ch,h) ))
      ;
               corr_fac_h_elec(scen,n,bu,ch,h) =
              + sum( reserves_do , phi_reserves_call(n,reserves_do,h) * ( theta_storage(n,bu,ch) * lev_RP_H_ELEC(scen,n,reserves_do,bu,ch,h) ))
              - sum( reserves_up , phi_reserves_call(n,reserves_up,h) * ( theta_storage(n,bu,ch) * lev_RP_H_ELEC(scen,n,reserves_up,bu,ch,h) ))
      ;
      $ontext
3454   
3455   
3456  * ----------------------------------------------------------------------------
3457   
3458  * Define gross energy demand for reporting
3459  gross_energy_demand(scen,n) = sum( h , d(n,h) + sum( sto , lev_STO_IN(scen,n,sto,h) - lev_STO_OUT(scen,n,sto,h) )
               + sum( sto , sum( res , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h) ) + lev_STO_IN_M2PRO(scen,n,sto,h) + lev_STO_IN_M2M(scen,n,sto,h) - lev_STO_OUT_PRO2PRO(scen,n,sto,h) - lev_STO_OUT_PRO2M(scen,n,sto,h) - lev_
      STO_OUT_M2PRO(scen,n,sto,h) - lev_STO_OUT_M2M(scen,n,sto,h) )
      $ontext
               - sum( dsm_curt , lev_DSM_CU(scen,n,dsm_curt,h) )
               + sum( dsm_shift , lev_DSM_UP(scen,n,dsm_shift,h) - sum( hh$( ord(hh) >= ord(h) - t_dur_dsm_shift(n,dsm_shift) AND ord(hh) <= ord(h) + t_dur_dsm_shift(n,dsm_shift) ) , lev_DSM_DO(scen,n,dsm_shift,h,hh)) )
      $ontext
               + sum( ev , lev_EV_CHARGE(scen,n,ev,h) - lev_EV_DISCHARGE(scen,n,ev,h) )
      $ontext
               + reserves_activated(scen,n,h)
               + sum( sto , corr_fac_sto(scen,n,sto,h) )
      $ontext
      %reserves%$ontext
             - sum( (dsm,reserves_up) , lev_RP_DSM_CU(scen,n,reserves_up,dsm,h) * phi_reserves_call(n,reserves_up,h) )
      $ontext
      %EV%$ontext
             + corr_fac_ev(scen,n,h)
      $ontext
              + sum( (bu,ch) , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) * lev_H_SETS_IN(scen,n,bu,ch,h) + theta_hp(n,bu,ch) * lev_H_HP_IN(scen,n,bu,ch,h) + theta_elec(n,bu,ch) * lev_H_ELECTRIC_IN(scen,n,bu,ch,h) )
              + sum( (bu,ch) , theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) * lev_H_DHW_AUX_ELEC_IN(scen,n,bu,ch,h) )
      $ontext
      %reserves%$ontext
              + sum( (bu,ch) , corr_fac_sets(scen,n,bu,ch,h) + corr_fac_sets_aux(scen,n,bu,ch,h) + corr_fac_hp(scen,n,bu,ch,h) + corr_fac_h_elec(scen,n,bu,ch,h) )
      $ontext
3498  )
3499  ;
3500   
3501   
3502  ********************************************************************************
3503  **** Report  *******************************************************************
3504  ********************************************************************************
3505   
3506  * RPEORT model statistics
3507          report('model status',loop_res_share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen,'modelstat')) ;
3508          report('solve time',loop_res_share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen,'resusd')) ;
3509          report('obj value',loop_res_share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_Z(scen) * 1) ;
3510   
3511   
3512  * ----------------------------------------------------------------------------
3513   
3514  * REPORT HOURS
3515          report_hours('demand consumers',loop_res_share,loop_ev,loop_prosumage,h,n) = d(n,h) ;
3516          report_hours('energy generated',loop_res_share,loop_ev,loop_prosumage,h,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( dis , lev_G_L(scen,n,dis,h) ) + sum( nondis , lev_G_RES(scen,n,nondis,h) - corr_fac_nondis(scen,n,
      nondis,h)) + sum( sto , lev_STO_OUT(scen,n,sto,h) - corr_fac_sto(scen,n,sto,h)) + sum( dsm_shift, lev_DSM_DO_DEMAND(scen,n,dsm_shift,h) - corr_fac_dsm_shift(scen,n,dsm_shift,h)) + sum( ev , lev_EV_DISCHARGE(scen,n,ev,h)) - corr_fac_ev(scen,n,h) + su
      m( rsvr , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) + sum( res , lev_G_RES_PRO(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h))) + sum( sto , l
      ev_STO_OUT_PRO2PRO(scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_M2PRO(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h)) ) ;
3517          report_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_INFES(scen,n,h) ) ;
3518          report_hours('gross exports',loop_res_share,loop_ev,loop_prosumage,h,n) = sum( l , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , -min(inc(l,n) * lev_F(scen,l,h),0) )) ;
3519          report_hours('gross imports',loop_res_share,loop_ev,loop_prosumage,h,n) = sum( l , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , max(inc(l,n) * lev_F(scen,l,h),0) ) ) ;
3520          report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) = - sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con1a(scen,n,h)) ;
3521   
3522                   report_hours('energy generated',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('energy generated',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs ) = 0 ;
3523                   report_hours('energy demanded',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('energy demanded',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs ) = 0 ;
3524                   report_hours('gross exports',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('gross exports',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs ) = 0 ;
3525                   report_hours('gross imports',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('gross imports',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs ) = 0 ;
3526                   report_hours('demand consumers',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('demand consumers',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs) = 0 ;
3527                   report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs AND report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) > -eps_rep_abs) = eps
       ;
3528                   report_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs) = 0 ;
3529   
3530   
3531  * ----------------------------------------------------------------------------
3532   
3533  * REPORT TECH HOURS
3534          report_tech_hours('generation conventional',loop_res_share,loop_ev,loop_prosumage,con,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h) + corr_fac_dis(scen,n,con,h)) ;
3535          report_tech_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,'',h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_INFES(scen,n,h) ) ;
3536          report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,res,h,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + corr_fac_dis(scen,n,res,h) + lev_G_RES(scen,n,res,h) + lev_G_RES_P
      RO(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) ) ;
3537          report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) ) ;
3538          report_tech_hours('reservoir inflow',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , rsvr_in(n,rsvr,h)/1000 * lev_N_RSVR_E(scen,n,rsvr) ) ;
3539          report_tech_hours('reservoir level',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_L(scen,n,rsvr,h) ) ;
3540          report_tech_hours('curtailment of fluct res',loop_res_share,loop_ev,loop_prosumage,res,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h) + lev_CU_PRO(scen,n,res,h) ) ;
3541          report_tech_hours('generation storage',loop_res_share,loop_ev,loop_prosumage,sto,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_PRO2PRO(scen,n,st
      o,h) + lev_STO_OUT_M2PRO(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h) ) ;
3542          report_tech_hours('storage loading',loop_res_share,loop_ev,loop_prosumage,sto,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(
      scen,n,res,sto,h)) + lev_STO_IN_M2PRO(scen,n,sto,h) + lev_STO_IN_M2M(scen,n,sto,h) ) ;
3543          report_tech_hours('storage level',loop_res_share,loop_ev,loop_prosumage,sto,h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L(scen,n,sto,h) + lev_STO_L_PRO(scen,n,sto,h) ) ;
3544          report_tech_hours('netto exports',loop_res_share,loop_ev,loop_prosumage,'',h,n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - sum( l , inc(l,n) * lev_F(scen,l,h)) ) ;
3545   
3546                   report_tech_hours('generation conventional',loop_res_share,loop_ev,loop_prosumage,con,h,n)$(report_tech_hours('generation conventional',loop_res_share,loop_ev,loop_prosumage,con,h,n) < eps_rep_abs) = 0 ;
3547                   report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) = 0 ;
3548                   report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n)$(report_tech_hours('generation renewable',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) < eps_rep_abs) = 0 ;
3549                   report_tech_hours('curtailment of fluct res',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_tech_hours('curtailment of fluct res',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) = 0 ;
3550                   report_tech_hours('generation storage',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_tech_hours('generation storage',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
3551                   report_tech_hours('storage loading',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_tech_hours('storage loading',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
3552                   report_tech_hours('storage level',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_tech_hours('storage level',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
3553                   report_tech_hours('netto exports',loop_res_share,loop_ev,loop_prosumage,'',h,n)$(abs(report_tech_hours('netto exports',loop_res_share,loop_ev,loop_prosumage,'',h,n)) < eps_rep_abs ) = 0 ;
3554                   report_tech_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,'',h,n)$(report_tech_hours('infeasibility',loop_res_share,loop_ev,loop_prosumage,'',h,n) < eps_rep_abs ) = 0 ;
3555                   report_tech_hours('reservoir inflow',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n)$(report_tech_hours('reservoir inflow',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) < eps_rep_abs) = 0 ;
3556                   report_tech_hours('reservoir level',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n)$(report_tech_hours('reservoir level',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) < eps_rep_abs) = 0 ;
3557   
3558   
3559  * ----------------------------------------------------------------------------
3560   
3561  * RPEORT LINE
3562           report_line('NTC',loop_res_share,loop_ev,loop_prosumage,l) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_NTC(scen,l) ) ;
3563                           report_line('NTC',loop_res_share,loop_ev,loop_prosumage,l)$(report_line('NTC',loop_res_share,loop_ev,loop_prosumage,l) < eps_rep_ins ) = 0 ;
3564   
3565           report_line('average line use',loop_res_share,loop_ev,loop_prosumage,l)$report_line('NTC',loop_res_share,loop_ev,loop_prosumage,l) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h, abs(lev_F(scen,l,h)))) / sum( h , rep
      ort_line('NTC',loop_res_share,loop_ev,loop_prosumage,l)) ;
3566                   report_line('avergae line use',loop_res_share,loop_ev,loop_prosumage,l)$(report_line('average line use',loop_res_share,loop_ev,loop_prosumage,l) < eps_rep_rel) = 0 ;
3567   
3568   
3569  * ----------------------------------------------------------------------------
3570   
3571  * REPORT NODE
3572          report_node('energy demand total',loop_res_share,loop_ev,loop_prosumage,n) = (sum( h , d(n,h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,n,res
      ,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) + lev_STO_IN_M2PRO(scen,n,sto,h) + lev_STO_IN_M2M(scen,n,sto,h)) )) * 1
              + sum( (dsm_shift,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,n,dsm_shift,h)) ) * %sec_hour%
      $ontext
               + sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_CHARGE(scen,n,ev,h)) ) * %sec_hour%
      $ontext
               + sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , reserves_activated(scen,n,h)))
      $ontext
      *        + sum( (bu,ch,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * ( lev_H_DIR(scen,n,bu,ch,h) + lev_H_DHW_DIR(scen,n,bu,ch,h) ) + theta_sets(n,bu,ch) * lev_H_SETS_IN(scen,n,bu,ch,h) + theta_hp(n,bu,ch) * l
      ev_H_HP_IN(scen,n,bu,ch,h) + theta_elec(n,bu,ch) * lev_H_STO_IN_ELECTRIC(scen,n,bu,ch,h)) )
      $ontext
3589  ;
3590          report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand(scen,n)) ;
3591          report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( dis , lev_G_L(scen,n,dis,h)) + sum( nondis , lev_G_RES(scen,n,nondis,h) - corr_fac_nondi
      s(scen,n,nondis,h)) + sum( rsvr , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) + sum( res , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res) - lev_CU_PRO(scen,n,res,h)) )) ;
3592          report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( dis , lev_G_L(scen,n,dis,h)) + sum( nondis , lev_G_RES(scen,n,nondis,h) - corr_fac_non
      dis(scen,n,nondis,h)) + sum( rsvr , lev_RSVR_OUT(scen,n,rsvr,h)- corr_fac_rsvr(scen,n,rsvr,h)) + sum( sto , lev_STO_OUT(scen,n,sto,h) - corr_fac_sto(scen,n,sto,h)) + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h) - corr_fac_dsm_shift(scen,n,
      dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,n,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,n,ev,h)) - corr_fac_ev(scen,n,h) +  sum( res , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res) - lev_CU_PRO(scen,n,res,h)) + sum( sto , lev_STO_OUT_PRO2PRO
      (scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_M2PRO(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h)) )) ;
3593          report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n) = sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - inc(l,n) * lev_F(scen,l,h)) ) ;
3594          report_node('gross exports',loop_res_share,loop_ev,loop_prosumage,n) = sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , -min(inc(l,n) * lev_F(scen,l,h),0) ) ) ;
3595          report_node('gross imports',loop_res_share,loop_ev,loop_prosumage,n) = sum( (l,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , max(inc(l,n) * lev_F(scen,l,h),0) ) ) ;
3596          report_node('net import share in gross demand',loop_res_share,loop_ev,loop_prosumage,n) = -min(report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n),0)/report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n) ;
3597          report_node('net export share in net generation',loop_res_share,loop_ev,loop_prosumage,n) = max(report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n),0)/report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n)
       ;
3598          report_node('trade capacity',loop_res_share,loop_ev,loop_prosumage,n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( l , abs(inc(l,n) * lev_NTC(scen,l))) ) ;
3599  *        report_node('gross import share',loop_res_share,loop_ev,loop_prosumage,n) = sum( h , report_hours('gross imports',loop_res_share,loop_ev,loop_prosumage,h,n))/ sum( h , report_hours('energy demanded',loop_res_share,loop_ev,loop_prosumage,h,n
      ) ) ;
3600          report_node('gross export share in net generation',loop_res_share,loop_ev,loop_prosumage,n) = sum( h , report_hours('gross exports',loop_res_share,loop_ev,loop_prosumage,h,n))/sum( h , report_hours('energy generated',loop_res_share,loop_ev,l
      oop_prosumage,h,n) ) ;
3601          report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n) = sum( tech , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,tech))) + sum( res , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_N_RES_PRO(scen,n,res))) + sum( sto , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) )) + sum( rsvr , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_
      P(scen,n,rsvr)))
              + sum( dsm_curt , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt)) ) + sum( dsm_shift , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) )
      $ontext
3606  ;
3607          report_node('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,n) = sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,nondis,h) + lev_CU(scen,n,nondis,h))) * 1 ;
3608          report_node('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,n)$(sum((nondis,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,nondis,h) * (lev_N_TECH(scen,n,nondis)))) + sum((res,h), sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res))) > eps_rep_abs*card(res)*card(h)) = (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h))) + sum((nond
      is,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,nondis,h)))) * 1 / (sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res))) + sum((nondis,h), sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,nondis,h) * (lev_N_TECH(scen,n,nondis))))) ;
3609          report_node('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage,n)$(m_e(n,'bio')) = (m_e(n,'bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,'bio',h)))) * 1 ;
3610          report_node('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage,n)$(m_e(n,'bio')) = (m_e(n,'bio') - sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,'bio',h)))) / m_e(n,'bio') ;
3611          report_node('max price',loop_res_share,loop_ev,loop_prosumage,n)$sum(h,d(n,h)) = max( calc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - marginal_con1a(scen,n,h))) ) ;
3612          report_node('min price',loop_res_share,loop_ev,loop_prosumage,n)$sum(h,d(n,h)) = min( calc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - marginal_con1a(scen,n,h))) ) ;
3613          report_node('mean price',loop_res_share,loop_ev,loop_prosumage,n)$sum(h,d(n,h)) = -sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con1a(scen,n,h)))/card(h) ;
3614   
3615                   report_node('energy demand total',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('energy demand total',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
3616                   report_node('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)*1) = 0 ;
3617                   report_node('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
3618                   report_node('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)*1) = 0 ;
3619                   report_node('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
3620                   report_node('min price',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('min price',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs AND report_node('min price',loop_res_share,loop_ev,loop_prosumage,n) > -eps_rep_abs) = 
      eps ;
3621                   report_node('gross exports',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('gross exports',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)) = 0 ;
3622                   report_node('gross imports',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('gross imports',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)) = 0 ;
3623                   report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n)$(abs(report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n)) < eps_rep_abs*card(h)) = 0 ;
3624                   report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)) = 0 ;
3625                   report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
3626                   report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs*card(h)) = 0 ;
3627                   report_node('net import share in gross demand',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('net import share in gross demand',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
3628                   report_node('net export share in net generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('net export share in net generation',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
3629                   report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 ;
3630                   report_node('gross import share',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('gross import share',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3631                   report_node('gross export share in net generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('gross export share in net generation',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3632   
3633   
3634  * ----------------------------------------------------------------------------
3635   
3636  * REPORT COST
3637          report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_prosumage,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( dis , c_m(n,dis)*lev_G_L(scen,n,dis,h) + c_up(n,dis)*lev_G_UP(scen,n,dis,h)$(ord(h)>1) +
       c_do(n,dis)*lev_G_DO(scen,n,dis,h)) + sum( nondis , c_cu(n,nondis)*lev_CU(scen,n,nondis,h)) + sum( sto , c_m_sto(n,sto) * ( lev_STO_OUT(scen,n,sto,h) + lev_STO_IN(scen,n,sto,h) ) )
                       + sum( dsm_curt , c_m_dsm_cu(n,dsm_curt)*lev_DSM_CU(scen,n,dsm_curt,h) ) + sum( dsm_shift , c_m_dsm_shift(n,dsm_shift)*(lev_DSM_UP_DEMAND(scen,n,dsm_shift,h) + lev_DSM_DO_DEMAND(scen,n,dsm_shift,h)))
      $ontext
                       + sum( ev , c_m_ev(n,ev) * lev_EV_DISCHARGE(scen,n,ev,h))
      $ontext
                       + sum( (reserves_up,sto) , phi_reserves_call(n,reserves_up,h) * c_m_sto(n,sto) * (lev_RP_STO_OUT(scen,n,reserves_up,sto,h) - lev_RP_STO_IN(scen,n,reserves_up,sto,h)) ) - sum( (reserves_do,sto) , phi_reserves_call(n,reserves_do,h) * 
      c_m_sto(n,sto) * (lev_RP_STO_OUT(scen,n,reserves_do,sto,h) - lev_RP_STO_IN(scen,n,reserves_do,sto,h)) ) + sum( (reserves_up,rsvr) , lev_RP_RSVR(scen,n,reserves_up,rsvr,h) * phi_reserves_call(n,reserves_up,h) * c_m_rsvr(n,rsvr) ) - sum( (reserves_do,
      rsvr) , lev_RP_RSVR(scen,n,reserves_do,rsvr,h) * phi_reserves_call(n,reserves_do,h) * c_m_rsvr(n,rsvr))
      $ontext
      %EV%$ontext
      %EV_EXOG%        + sum( (reserves_up,ev) , lev_RP_EV_V2G(scen,n,reserves_up,ev,h) * phi_reserves_call(n,reserves_up,h) * c_m_ev(n,ev) ) - sum( (reserves_do,ev) , lev_RP_EV_V2G(scen,n,reserves_do,ev,h) * phi_reserves_call(n,reserves_do,h) * c_m_ev(n,
      ev) )
      %EV_EXOG%
      $ontext
      %reserves%$ontext
                       + sum( (reserves_up,dsm_curt) , lev_RP_DSM_CU(scen,n,reserves_up,dsm_curt,h) * phi_reserves_call(n,reserves_up,h) * c_m_dsm_cu(n,dsm_curt) ) + sum( (reserves,dsm_shift) , lev_RP_DSM_SHIFT(scen,n,reserves,dsm_shift,h) * phi_reserves_
      call(n,reserves,h) * c_m_dsm_shift(n,dsm_shift) )
      $ontext
3661  ));
3662           report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( tech , c_i(n,tech)*lev_N_TECH(scen,n,tech) + c_fix(n,tech)*lev_N_TECH(scen,n,tech) ) + s
      um( sto , c_i_sto_e(n,sto)*lev_N_STO_E(scen,n,sto) + c_fix_sto(n,sto)/2*(lev_N_STO_P(scen,n,sto)+lev_N_STO_E(scen,n,sto)) + c_i_sto_p(n,sto)*lev_N_STO_P(scen,n,sto) ) + sum( rsvr , c_i_rsvr_e(n,rsvr)*lev_N_RSVR_E(scen,n,rsvr) + c_i_rsvr_p(n,rsvr)*le
      v_N_RSVR_P(scen,n,rsvr) + c_fix_rsvr(n,rsvr) * lev_N_RSVR_P(scen,n,rsvr))
                       + sum( dsm_curt , c_i_dsm_cu(n,dsm_curt)*lev_N_DSM_CU(scen,n,dsm_curt) + c_fix_dsm_cu(n,dsm_curt)*lev_N_DSM_CU(scen,n,dsm_curt) ) + sum( dsm_shift , c_i_dsm_shift(n,dsm_shift)*lev_N_DSM_SHIFT(scen,n,dsm_shift) + c_fix_dsm_shift(n,ds
      m_shift)*lev_N_DSM_SHIFT(scen,n,dsm_shift) )
      $ontext
                       + sum( res , c_i(n,res)*lev_N_RES_PRO(scen,n,res) + c_fix(n,res)*lev_N_RES_PRO(scen,n,res) ) + sum( sto , c_i_sto_e(n,sto)*lev_N_STO_E_PRO(scen,n,sto) + c_fix_sto(n,sto)/2*(lev_N_STO_P_PRO(scen,n,sto) + lev_N_STO_E_PRO(scen,n,sto)) 
      + c_i_sto_p(n,sto)*lev_N_STO_P_PRO(scen,n,sto)) + sum( (sto,h) , c_m_sto(n,sto) * ( lev_STO_OUT_PRO2PRO(scen,n,sto,h) + lev_STO_OUT_M2PRO(scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h) + sum( res , lev_STO_IN_PRO2PRO
      (scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h) ) )
      $ontext
3671  );
3672   
3673           report_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , c_infes * lev_G_INFES(scen,n,h)) ) ;
3674           report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,ev) , pen_phevfuel(n,ev) * lev_EV_PHEVFUEL(scen,n,ev,h)) ) ;
3675           report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (bu,hst,h) , pen_heat_fuel(n,bu,hst) * lev_H_STO_IN_FOSSIL(scen,n,bu,hst,h)) ) ;
3676           report_cost('Nodal cost: total',loop_res_share,loop_ev,loop_prosumage,n) = report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_prosumage,n) + report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev,loop_prosumage,n) + r
      eport_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,loop_prosumage,n) + report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_prosumage,n) + report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,loop_prosumage,n) ;
3677           report_cost('Costs lines',loop_res_share,loop_ev,loop_prosumage,l) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , c_i_ntc(l) * lev_NTC(scen,l)*dist(l) ) ;
3678   
3679                   report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: dispatch',loop_res_share,loop_ev,loop_prosumage,n) < card(h) * eps_rep_abs) = 0 ;
3680                   report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: investment & fix',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 ;
3681                   report_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: infeasibility',loop_res_share,loop_ev,loop_prosumage,n) < card(h) * eps_rep_abs) = 0 ;
3682                   report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: PHEV fuel',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
3683                   report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: fossil heating',loop_res_share,loop_ev,loop_prosumage,n) < card(h) * eps_rep_abs) = 0 ;
3684                   report_cost('Nodal cost: total',loop_res_share,loop_ev,loop_prosumage,n)$(report_cost('Nodal cost: total',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
3685                   report_cost('Costs lines',loop_res_share,loop_ev,loop_prosumage,l)$(report_cost('Costs lines',loop_res_share,loop_ev,loop_prosumage,l) < eps_rep_ins) = 0 ;
3686   
3687   
3688  * ----------------------------------------------------------------------------
3689   
3690  * REPORT TECH
3691          report_tech('capacities conventional',loop_res_share,loop_ev,loop_prosumage,con,n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) ;
3692          report_tech('capacities renewable',loop_res_share,loop_ev,loop_prosumage,res,n) = 0 + sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res) + lev_N_RES_PRO(scen,n,res)) ;
3693          report_tech('capacities reservoir MW',loop_res_share,loop_ev,loop_prosumage,rsvr,n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr));
3694          report_tech('capacities reservoir MWh',loop_res_share,loop_ev,loop_prosumage,rsvr,n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_E(scen,n,rsvr));
3695          report_tech('capacities storage MW',loop_res_share,loop_ev,loop_prosumage,sto,n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)+ lev_N_STO_P_PRO(scen,n,sto)) ;
3696          report_tech('capacities storage MWh',loop_res_share,loop_ev,loop_prosumage,sto,n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)+ lev_N_STO_E_PRO(scen,n,sto)) * 1 ;
3697   
3698          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,con,n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con) ) / report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9
       ;
3699          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,res,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res)) / report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
3700          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,rsvr,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr)) / report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n) + 1e
      -9 ;
3701          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,res,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res) + lev_N_RES_PRO(scen,n,res) ) / report_node('Capacity total',loop_res_share,loop_
      ev,loop_prosumage,n) + 1e-9 ;
3702          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,sto,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) ) / report_node('Capacity total',loop_res_share,lo
      op_ev,loop_prosumage,n) + 1e-9 ;
3703   
3704          report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,res,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + lev_G_RES_PRO(scen,n
      ,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h))) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand(scen,n) )
       ;
3705          report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,rsvr,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) ) / sum( scen$(map
      (scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand(scen,n) ) ;
3706          report_tech('conshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,con,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , gross_energy_demand(scen,n) ) ;
3707          report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,res,n)$report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_G_L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + lev_G_RES_PRO(scen,n,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h)) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h))) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3708          report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3709          report_tech('conshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,con,n)$report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_G_L(scen,n,con,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3710   
3711          report_tech('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,res,n) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h) + lev_CU_PRO(scen,n,res,h) )) * 1 ;
3712          report_tech('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,res,n) AND sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_G_RES_PRO(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h) + lev_CU(scen,n,res,h))) > card(h)*eps_rep_abs 
      ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h) + lev_CU_PRO(scen,n,res,h) ))/( sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,res,h) * (lev_N_TECH(scen,n,res) + lev_N_RE
      S_PRO(scen,n,res) ))) ) ;
3713   
3714          report_tech('Storage out total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) = sum(h, report_tech_hours('generation storage',loop_res_share,loop_ev,loop_prosumage,sto,h,n) ) * 1 ;
3715          report_tech('Storage in total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) = sum(h, report_tech_hours('storage loading',loop_res_share,loop_ev,loop_prosumage,sto,h,n) ) * 1 ;
3716   
3717          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,con,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _L(scen,n,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) ;
3718          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h)) + lev_G_RES_PRO(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h))) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , lev_N_TECH(scen,n,res)) ;
3719          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr)) ;
3720          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop_res_share,loop_ev,loop
      _prosumage,sto,n)) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) ;
3721   
3722   
3723                   report_tech('capacities conventional',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('capacities conventional',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_ins) = 0 ;
3724                   report_tech('capacities renewable',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('capacities renewable',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_ins) = 0 ;
3725                   report_tech('capacities storage MW',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('capacities storage MW',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) = 0 ;
3726                   report_tech('capacities storage MWh',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('capacities storage MWh',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) = 0 ;
3727                   report_tech('capacities reservoir MW',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('capacities reservoir MW',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_ins) = 0 ;
3728                   report_tech('capacities reservoir MWh',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('capacities reservoir MWh',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_ins) = 0 ;
3729                   report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
3730                   report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_rel) = 0 ;
3731                   report_tech('conshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('conshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_rel) = 0 ;
3732                   report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
3733                   report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_rel) = 0 ;
3734                   report_tech('conshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('conshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_rel) = 0 ;
3735                   report_tech('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs*card(h)*1) = 0 ;
3736                   report_tech('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
3737                   report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_rel) = 0 ;
3738                   report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
3739                   report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_rel) = 0 ;
3740                   report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
3741                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_abs) = 0 ;
3742                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs) = 0 ;
3743                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_abs) = 0 ;
3744                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
3745                   report_tech('Storage out total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage out total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs*card(h)*1) = 0 ;
3746                   report_tech('Storage in total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage in total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs*card(h)*1) = 0 ;
3747   
3748   
3749  * ----------------------------------------------------------------------------
3750   
3751  * REPORT NODE
3752          report_node('renshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) = sum(res, report_tech('renshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,res,n)) + sum( rsvr , report_tech('renshares in nodal gross 
      demand',loop_res_share,loop_ev,loop_prosumage,rsvr,n)) ;
3753          report_node('conshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) = sum(con, report_tech('conshares in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,con,n) ) ;
3754          report_node('net import share in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) = - report_node('net exports',loop_res_share,loop_ev,loop_prosumage,n) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy
      _demand(scen,n) ) ;
3755          report_node('renshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n) = sum(res, report_tech('renshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,res,n)) + sum( rsvr , report_tech('renshares in nodal ne
      t generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)) ;
3756          report_node('conshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n) = sum(con, report_tech('conshares in nodal net generation',loop_res_share,loop_ev,loop_prosumage,con,n) ) ;
3757   
3758                   report_node('renshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) $(report_node('renshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3759                   report_node('conshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('conshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3760                   report_node('renshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('renshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3761                   report_node('conshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('conshare in nodal net generation',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel ) = 0 ;
3762   
3763   
3764   
3765  * ----------------------------------------------------------------------------
3766   
3767  * REPORT TECH
3768          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,con,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h) ) ) ;
3769          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,res,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,n,r
      es,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) + lev_G_RES_PRO(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h))) ;
3770          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,rsvr,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h) ) ) ;
3771          report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,sto,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + lev_STO_OUT_M2PRO(scen,n,s
      to,h) + lev_STO_OUT_M2M(scen,n,sto,h) + lev_STO_OUT(scen,n,sto,h) - corr_fac_sto(scen,n,sto,h)) ) ;
3772   
3773          report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,con,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h) ) ) / report_node('energy generated gross',loop_r
      es_share,loop_ev,loop_prosumage,n) * 1 + 1e-9 ;
3774          report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,res,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + sum(sto , le
      v_STO_IN_PRO2PRO(scen,n,res,sto,h) + lev_STO_IN_PRO2M(scen,n,res,sto,h)) + lev_G_RES_PRO(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h))) / report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * 1 + 
      1e-9 ;
3775          report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h) ) ) / repor
      t_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * 1 + 1e-9 ;
3776          report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,sto,n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,n,sto,h) + lev_STO_OUT_PRO2M(scen,n,sto,h) + l
      ev_STO_OUT_M2PRO(scen,n,sto,h) + lev_STO_OUT_M2M(scen,n,sto,h) + lev_STO_OUT(scen,n,sto,h) - corr_fac_sto(scen,n,sto,h)) ) / report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * 1 + 1e-9 ;
3777   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) ) > eps_rep_ins) = report_tech('Storage out total non-reserves',loop_
      res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) ) ;
3778   report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) + lev_N_STO_E_PRO(scen,n,sto) ) > eps_rep_ins) = report_tech('Storage out total non-rese
      rves',loop_res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) + lev_N_STO_E_PRO(scen,n,sto) ) * 1 ;
3779   
3780                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_ins ) = 0 ;
3781                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_ins ) = 0 ;
3782                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_ins ) = 0 ;
3783                   report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Yearly energy',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins ) = 0 ;
3784   
3785                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_rel) = 0 ;
3786                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
3787                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_rel) = 0 ;
3788                   report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
3789         report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
3790         report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
3791   
3792   
3793  * ----------------------------------------------------------------------------
3794   
3795  * RPEORT
3796          report('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage) = sum( n , report_node('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3797          report('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage) = sum( n , report_node('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage,n) ) / sum((res,h,n), sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , phi_res(n,res,h) * (lev_N_TECH(scen,n,res) + lev_N_RES_PRO(scen,n,res)) )) ;
3798          report('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage)$(sum( n , m_e(n,'bio'))) = sum( n , report_node('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3799          report('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage)$(sum( n , m_e(n,'bio'))) = report('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage) / sum( n , m_e(n,'bio')) ;
3800          report('Capacity total',loop_res_share,loop_ev,loop_prosumage) = sum( n , report_node('Capacity total',loop_res_share,loop_ev,loop_prosumage,n)) ;
3801          report('energy demand gross',loop_res_share,loop_ev,loop_prosumage) = sum( n , report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3802          report('energy demand total',loop_res_share,loop_ev,loop_prosumage) = sum ( n , report_node('energy demand total',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3803          report('energy generated net',loop_res_share,loop_ev,loop_prosumage) =  sum( n , report_node('energy generated net',loop_res_share,loop_ev,loop_prosumage,n)) ;
3804          report('energy generated gross',loop_res_share,loop_ev,loop_prosumage) =  sum( n , report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n)) ;
3805  *        report('gross trade share',loop_res_share,loop_ev,loop_prosumage) = sum( (h,n) , report_hours('gross imports',loop_res_share,loop_ev,loop_prosumage,h,n))/ sum( (h,n) , report_hours('energy demanded',loop_res_share,loop_ev,loop_prosumage,h,n
      ) ) ;
3806          report('renshare total',loop_res_share,loop_ev,loop_prosumage) = sum( (h,n) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_L(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h) + phi_res(n
      ,res,h) * lev_N_RES_PRO(scen,n,res) - lev_CU_PRO(scen,n,res,h)) + sum( rsvr , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)))) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( n , gross_energy_demand(scen,n)) ) ;
3807          report('conshare total',loop_res_share,loop_ev,loop_prosumage) = sum( (h,n) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( con , lev_G_L(scen,n,con,h)) )) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , s
      um( n, gross_energy_demand(scen,n)) ) ;
3808          report('Energy total',loop_res_share,loop_ev,loop_prosumage) = sum( n , report_node('Energy total',loop_res_share,loop_ev,loop_prosumage,n) ) ;
3809   
3810                   report('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage)$(report('curtailment of fluct res absolute',loop_res_share,loop_ev,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
3811                   report('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage)$(report('curtailment of fluct res relative',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
3812                   report('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_ev,loop_prosumage) < eps_rep_abs*card(h)) = 0 ;
3813                   report('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
3814                   report('Capacity total',loop_res_share,loop_ev,loop_prosumage)$(report('Capacity total',loop_res_share,loop_ev,loop_prosumage) < eps_rep_ins) = 0 ;
3815                   report('gross trade share',loop_res_share,loop_ev,loop_prosumage)$(report('gross trade share',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel ) = 0 ;
3816                   report('renshare total',loop_res_share,loop_ev,loop_prosumage)$(report('renshare total',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel ) = 0 ;
3817                   report('conshare total',loop_res_share,loop_ev,loop_prosumage)$(report('conshare total',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel ) = 0 ;
3818                   report('Energy total',loop_res_share,loop_ev,loop_prosumage)$(report('Energy total',loop_res_share,loop_ev,loop_prosumage) < eps_rep_abs) = 0 ;
3819   
3820   
3821  * ----------------------------------------------------------------------------
3822   
3823  * DSM
              report_tech_hours('load curtailment (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_curt,h,n)$(feat_node('dsm',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,n,dsm_curt,h)) ;
              report_tech_hours('load shift pos (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n)$(feat_node('dsm',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,n,dsm_shift,h)) ;
              report_tech_hours('load shift neg (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n)$(feat_node('dsm',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h)) ;
       
              report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) > eps_rep_ins) = sum( (h,hh) , sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO(scen,n,dsm_shift,h,hh)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) ;
              report_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('dsm',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt)) ;
              report_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) ;
              report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('dsm',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt)) / report_node('Capacity total',loop_res_share,l
      oop_ev,loop_prosumage,n) + 1e-9 ;
              report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) / report_node('Capacity total',loop_res_sh
      are,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('dsm',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,n,dsm_curt,h) - corr_fac_dsm_
      cu(scen,n,dsm_curt,h)) )  / report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h) - corr
      _fac_dsm_shift(scen,n,dsm_shift,h)) ) / report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_tech('Load shift pos absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP(scen,n,dsm_shift,h)) ) ;
              report_tech('Load shift neg absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n)) = sum( (h,hh) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO(scen,n,dsm_shift,h,hh)) ) ;
       
              report_node('load curtailment absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('dsm',n)) =  sum((dsm_curt,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,n,dsm_curt,h))) * %sec_hou
      r% ;
              report_node('load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('dsm',n)) =  sum((dsm_shift,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,n,dsm_shift,h))) * %
      sec_hour% ;
              report_node('load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('dsm',n)) =  sum((dsm_shift,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h))) * %
      sec_hour% ;
       
                       report_tech_hours('load curtailment (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_curt,h,n)$(report_tech_hours('load curtailment (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_curt,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('load shift pos (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n)$(report_tech_hours('load shift pos (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('load shift neg (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n)$(report_tech_hours('load shift neg (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h,n) < eps_rep_abs) = 0 ;
       
                       report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_abs) = 0 ;
                       report_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_ins) = 0 ;
                       report_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_ins) = 0 ;
                       report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_rel) = 0 ;
                       report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_rel) = 0 ;
                       report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_rel) = 0 ;
                       report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_rel) = 0 ;
                       report_tech('Load shift pos absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift pos absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
                       report_tech('Load shift neg absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift neg absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
      *                 report_tech('Load shift pos absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift pos absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
      *                 report_tech('Load shift neg absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift neg absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
      *                 report_tech('Load shift pos absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift pos absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
       
                       report_node('load curtailment absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('load curtailment absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n) < card(h)*eps_rep_abs*%sec_hour%) = 0 ;
                       report_node('load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n) < card(h)*eps_rep_abs*%sec_hour%) = 0 ;
                       report_node('load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,n) < card(h)*eps_rep_abs*%sec_hour%) = 0 ;
      $ontext
3865   
3866   
3867  * ----------------------------------------------------------------------------
3868   
3869  * EV
              report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(feat_node('ev',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_CHARGE(scen,n,ev,h)) ;
              report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(feat_node('ev',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_DISCHARGE(scen,n,ev,h)) ;
              report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(feat_node('ev',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_PHEVFUEL(scen,n,ev,h));
              report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(feat_node('ev',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_GED(scen,n,ev,h));
              report_tech_hours('EV battery level',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(feat_node('ev',n)) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_L(scen,n,ev,h)) ;
       
              report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n)) = (sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_DISCHARGE(scen,n,ev,h))) - sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , corr_fac_ev(scen,n,h))))/ report_node('energy generated gross',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_tech('EV charge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n)) = sum((h,ev), report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% ;
              report_tech('EV discharge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n)) = sum((h,ev), report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% ;
              report_tech('EV phevfuel total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n)) = sum((h,ev), report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% ;
              report_tech('EV electrical total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n)) = sum((h,ev), report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% ;
              report_tech('EV share of electrical consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND sum((h,ev), report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) + report_tech_h
      ours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)) > card(h)*eps_rep_abs) = sum((h,ev), report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% / (sum((h,ev), report_tech_
      hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) + report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) ) ;
              report_tech('EV share of phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND sum((h,ev), report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) + report_tech_hou
      rs('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)) > card(h)*eps_rep_abs) = sum((h,ev), report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) * %sec_hour% / (sum((h,ev), report_tech_hour
      s('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) + report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) ) ) ;
       
              report_node('gross_energy_demand w/o EV',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('ev',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand(scen,n)) - sum( (ev,h) , sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_EV_GED(scen,n,ev,h)) ) ;
              report_node('EV electricity demand',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('ev',n)) = sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_GED(scen,n,ev,h)) ) ;
              report_node('renshare EV',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('ev',n) = (report_node('renshare in nodal gross demand',loop_res_share,loop_ev,loop_prosumage,n) - report_node('gross_energy_demand w/o EV',loop_res_share,loop_ev,l
      oop_prosumage,n) * report_node('EV electricity demand',loop_res_share,loop_ev,loop_prosumage,n) ) / report_node('energy demand gross',loop_res_share,loop_ev,loop_prosumage,n) ;
              report_node('conshare EV',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('ev',n) = 1 - report_node('renshare EV',loop_res_share,loop_ev,loop_prosumage,n) ;
      %EV_FREE%%EV_DEFAULT%        report_node('renshare EV',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('ev',n)) = 1 ;
      %EV_FREE%%EV_DEFAULT%        report_node('conshare EV',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('ev',n)) = 0 ;
       
                       report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosumage,ev,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_prosumage,ev,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(report_tech_hours('EV electrical consumption',loop_res_share,loop_ev,loop_prosumage,ev,h,n) < eps_rep_abs) = 0 ;
                       report_tech_hours('EV battery level',loop_res_share,loop_ev,loop_prosumage,ev,h,n)$(report_tech_hours('EV battery level',loop_res_share,loop_ev,loop_prosumage,ev,h,n) < eps_rep_abs) = 0 ;
                       report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('Energy share in nodal gross generation',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_rel) = 0 ;
                       report_tech('EV charge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV charge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('EV discharge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV discharge total wholesale',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('EV phevfuel total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV phevfuel total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('EV electrical total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV electrical total consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('EV share of electrical consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV share of electrical consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_rel) = 0 ;
                       report_tech('EV share of phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV share of phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_rel) = 0 ;
                       report_node('EV_electricity_demand',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('EV_electricity_demand',loop_res_share,loop_ev,loop_prosumage,n) < card(h)*eps_rep_abs) = 0 ;
                       report_node('renshare EV',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('renshare EV',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = eps ;
                       report_node('conshare EV',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('conshare EV',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = eps ;
                       report_node('gross_energy_demand w/o EV',loop_res_share,loop_ev,loop_prosumage,n)$(report_node('gross_energy_demand w/o EV',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
      $ontext
3910   
3911   
3912  * ----------------------------------------------------------------------------
3913   
3914  * Reserves
               report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_prim,n) = feat_node('reserves',n) * phi_reserves_pr_up(n) * sum( reserves_nonprim ,  (1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_
      intercept(n,reserves_nonprim) + sum( nondis , reserves_slope(n,reserves_nonprim,nondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondis) + lev_N_RES_PRO(scen,n,nondis)))/1000) )) ) ;
               report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,n) = feat_node('reserves',n) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum( nondis , r
      eserves_slope(n,reserves_nonprim,nondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondis) + lev_N_RES_PRO(scen,n,nondis)))/1000) ) ;
      * ## marginals missing
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(ord(h) > 1) = feat_node('reserves',n) * (report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,
      reserves,n)) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(ord(h) > 1) = feat_node('reserves',n) * (phi_reserves_call(n,reserves,h) * report_reserves('reserve provision requirements',loo
      p_res_share,loop_ev,loop_prosumage,reserves,n)) ;
      $ontext
               report_reserves_hours('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_prim,h,n) = feat_node('reserves',n) * reserves_exogenous(n,reserves_prim,h) ;
               report_reserves_hours('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,h,n) = feat_node('reserves',n) * reserves_exogenous(n,reserves_nonprim,h) ;
               report_reserves_hours('reserve prices',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,h,n) = feat_node('reserves',n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con9a(scen,reserves_nonprim,h,n) );
               report_reserves_hours('reserve prices',loop_res_share,loop_ev,loop_prosumage,reserves_prim,h,n) = feat_node('reserves',n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con9b(scen,reserves_prim,h,n) );
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(ord(h) > 1) = feat_node('reserves',n) * (report_reserves_hours('reserve provision requirements',loop_res_share,loop_ev,loop_pros
      umage,reserves,h,n)) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(ord(h) > 1) = feat_node('reserves',n) * (phi_reserves_call(n,reserves,h) * report_reserves_hours('reserve provision requirement
      s',loop_res_share,loop_ev,loop_prosumage,reserves,h,n)) ;
      $ontext
3932   
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves,dis,h)) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves,dis,h))*phi_reserve
      s_call(n,reserves,h) ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves,nondis,h)) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves,nondis,h))*ph
      i_reserves_call(n,reserves,h) ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves,rsvr,h)) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n)$(feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves,rsvr,h))*phi_rese
      rves_call(n,reserves,h) ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n)$(feat_node('reserves',n)) = (sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves,sto,h)) + sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves,sto,h))) ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n)$(feat_node('reserves',n)) = ((sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves,sto,h)) + sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves,sto,h)))*phi_reserves_call(n,reserves,h)) ;
       
               report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,dis,h) + corr_fac_dis(sc
      en,n,dis,h))) > card(h)*eps_rep_abs)= sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves,dis,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,dis,h) + corr_fac
      _dis(scen,n,dis,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,dis,h) + corr_fac_dis(s
      cen,n,dis,h))) > card(h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves,dis,h)) * phi_reserves_call(n,reserves,h)) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_G_L(scen,n,dis,h) + corr_fac_dis(scen,n,dis,h)) ) ;
               report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,nondis,h))) >  card
      (h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves,nondis,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,nondis,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,nondis,h))) > card
      (h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves,nondis,h)) * phi_reserves_call(n,reserves,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(s
      cen,n,nondis,h)) ) ;
               report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h))) >  card(
      h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves,rsvr,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n)$(feat_node('reserves',n) AND sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h))) >  card
      (h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves,rsvr,h)) * phi_reserves_call(n,reserves,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(sc
      en,n,rsvr,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage out positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_ST
      O_OUT(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_up,sto,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(sce
      n,n,sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage out negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_ST
      O_OUT(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_do,sto,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(sce
      n,n,sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage in positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO
      _IN(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_up,sto,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,
      sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage in negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO
      _IN(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_do,sto,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,
      sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage out positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_S
      TO_OUT(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_STO_OUT(scen,n,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage out negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_S
      TO_OUT(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_STO_OUT(scen,n,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage in positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_ST
      O_IN(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev
      ,loop_prosumage)) , lev_STO_IN(scen,n,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage in negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto,n)$(feat_node('reserves',n) AND  sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_ST
      O_IN(scen,n,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev
      ,loop_prosumage)) , lev_STO_IN(scen,n,sto,h)) ) ;
      $ontext
3959   
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_nonpr
      im,dis,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum( nondis ,reserves_slope(n,reserves_nonprim,nondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH
      (scen,n,nondis) + lev_N_RES_PRO(scen,n,nondis)))/1000) ) ) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves
      _nonprim,nondis,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum( nondisnondis ,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage))  , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_non
      prim,rsvr,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  
      , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_no
      nprim,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_nonprim,sto,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,
      reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_prim,dis
      ,h))) / (phi_reserves_pr_up(n)* sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_pr
      im,nondis,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_prim,r
      svr,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) )) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_prim,
      sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_prim,sto,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercep
      t(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ));
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_prim,dis,h
      ))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum(nondisnondis ,
       reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_prim
      ,nondis,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n)* sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum(nondis
      nondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_prim,rsv
      r,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n)* sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum(nondisnondis
       , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(feat_node('reserves',n)) = sum(h,(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_prim,s
      to,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_prim,sto,h)))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim
       , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum( nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nond
      isnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   );
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_nonprim
      ,dis,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondi
      snondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_n
      onprim,nondis,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonp
      rim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis) + lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_nonpr
      im,rsvr,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,no
      ndisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(feat_node('reserves',n)) = sum(h,(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_non
      prim,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_nonprim,sto,h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,res
      erves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisn
      ondis)))/1000) )) ;
      $ontext
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_nonpr
      im,dis,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h))  ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves
      _nonprim,nondis,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_non
      prim,rsvr,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_no
      nprim,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_nonprim,sto,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_prim,dis
      ,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_pr
      im,nondis,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_prim,r
      svr,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
               report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_prim,
      sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_prim,sto,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_prim,dis,h
      ))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) * reserves_exogenous(n,reserves_prim,h) )     ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_prim
      ,nondis,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) * reserves_exogenous(n,reserves_prim,h) ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_prim,rsv
      r,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) * reserves_exogenous(n,reserves_prim,h) ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(feat_node('reserves',n)) = sum(h,(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_prim,s
      to,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_prim,sto,h)))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) * reserves_exogenous(n,reserves_prim,h) );
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DIS(scen,n,reserves_nonprim
      ,dis,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h) ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_NONDIS(scen,n,reserves_n
      onprim,nondis,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h) ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(feat_node('reserves',n)) = sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RSVR(scen,n,reserves_nonpr
      im,rsvr,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h) ) ;
               report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(feat_node('reserves',n)) = sum(h,(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,n,reserves_non
      prim,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_nonprim,sto,h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_n
      onprim,h) ) ;
      $ontext
3998   
               report_tech('Storage positive reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n)) = sum( (h,reserves_up) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen
      ,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour% ;
               report_tech('Storage negative reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n)) = sum( (h,reserves_do) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen
      ,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour% ;
               report_tech('Storage positive reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n)) = sum( (h,reserves_up) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(sc
      en,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour% ;
               report_tech('Storage negative reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n)) = sum( (h,reserves_do) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(sc
      en,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour% ;
               report_tech('Load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,n,dsm_shift,h))
       ) ;
               report_tech('Load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h))
       ) ;
       
               report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves
      ',loop_res_share,loop_ev,loop_prosumage,sto,n)
                              + sum( (h,reserves_up) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour%
                              - sum( (h,reserves_do) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour%
                              ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) ;
               report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)) > eps_rep_ins) = ( report_tech('Storage out total n
      on-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)
                              + sum( (h,reserves_up) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_up,sto,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour%
                              - sum( (h,reserves_do) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,n,reserves_do,sto,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour%
                              ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)) * %sec_hour% ;
               report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('reserves',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) ) > eps_rep_ins AND 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) + lev_N_STO_E_PRO(scen,n,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) + lev_N_STO_E_PR
      O(scen,n,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) + lev_N_STO_P_PRO(scen,n,sto) ) ;
       
       
      %reserves_exogenous%                 report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_prim,n)$(feat_node('reserves',n) AND report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_pr
      osumage,reserves_prim,n) < eps_rep_abs) = 0 ;
      %reserves_exogenous%                 report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,n)$(feat_node('reserves',n) AND report_reserves('reserve provision requirements',loop_res_share,loop_ev,loop
      _prosumage,reserves_nonprim,n) < eps_rep_abs) = 0 ;
      %reserves_endogenous%                report_reserves_hours('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_prim,h,n)$(feat_node('reserves',n) AND report_reserves_hours('reserve provision requirements',loop_res_share,l
      oop_ev,loop_prosumage,reserves_prim,h,n) < eps_rep_abs) = 0 ;
      %reserves_endogenous%                report_reserves_hours('reserve provision requirements',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,h,n)$(feat_node('reserves',n) AND report_reserves_hours('reserve provision requirements',loop_res_shar
      e,loop_ev,loop_prosumage,reserves_nonprim,h,n) < eps_rep_abs) = 0 ;
       
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n) < eps_rep
      _abs ) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'required',h,n) < eps_r
      ep_abs ) = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n) < eps_rep_abs ) = 0;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dis,h,n) < eps_rep_abs ) = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n) < eps_rep_abs ) =
       0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,h,n) < eps_rep_abs )
       = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n) < eps_rep_abs ) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h,n) < eps_rep_abs ) = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n) < eps_rep_abs) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,h,n) < eps_rep_abs) = 0 
      ;
       
                       report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n)$(report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n)$(report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,dis,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n)$(report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n)$(report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,nondis,n) < eps_rep_rel) = 0 
      ;
                       report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n)$(report_reserves_tech('Reserves provision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n)$(report_reserves_tech('Reserves activation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,rsvr,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves provision ratio (storage out positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves provision ratio (storage out positive reserves)',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves provision ratio (storage out negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves provision ratio (storage out negative reserves)',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves provision ratio (storage in positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves provision ratio (storage in positive reserves)',loop_res_share,loop
      _ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves provision ratio (storage in negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves provision ratio (storage in negative reserves)',loop_res_share,loop
      _ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio (storage out positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves activation ratio (storage out positive reserves)',loop_res_share,
      loop_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio (storage out negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves activation ratio (storage out negative reserves)',loop_res_share,
      loop_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio (storage in positive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves activation ratio (storage in positive reserves)',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('Reserves activation ratio (storage in negative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto,n)$(report_reserves_tech('Reserves activation ratio (storage in negative reserves)',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,n) < eps_rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n) < eps_rep_r
      el) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n) < eps
      _rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n) < eps_rep
      _rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n) < eps_rep_r
      el) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n) < eps_rep_rel) = 
      0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n) < eps_rep_r
      el) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n) < eps_rep_rel) 
      = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n) < eps_rep_rel) = 
      0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,dis,n) < eps_rep_rel) 
      = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,nondis,n) < eps_rep
      _rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,rsvr,n) < eps_rep_rel
      ) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,sto,n) < eps_rep_rel) 
      = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dis,n) < eps_rep
      _rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,nondis,n) < e
      ps_rep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,rsvr,n) < eps_r
      ep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,sto,n) < eps_rep
      _rel) = 0 ;
       
                       report_tech('Storage positive reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage positive reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_a
      bs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage negative reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage negative reserves activation by storage in',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_a
      bs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage positive reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage positive reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep
      _abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage negative reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage negative reserves activation by storage out',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep
      _abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
                       report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
                       report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
                       report_tech('Load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h) * eps_rep_abs
      ) = 0 ;
                       report_tech('Load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h) * eps_rep_abs
      ) = 0 ;
      $ontext
4076   
4077   
4078  * ----------------------------------------------------------------------------
4079   
4080  * Reserves and DSM
      %reserves_endogenous%$ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      RP_DSM_CU(scen,n,reserves_nonprim,dsm_curt,h))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev
      _RP_DSM_SHIFT(scen,n,reserves_nonprim,dsm_shift,h))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))   ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev
      _RP_DSM_CU(scen,n,reserves_nonprim,dsm_curt,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,
      reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_DSM_SHIFT(scen,n,reserves_nonprim,dsm_shift,h)) * phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondis
      nondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))   ;
      $ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_DSM_CU(scen,n,reserves_nonprim,dsm_curt,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      RP_DSM_SHIFT(scen,n,reserves_nonprim,dsm_shift,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h))   ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      RP_DSM_CU(scen,n,reserves_nonprim,dsm_curt,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev
      _RP_DSM_SHIFT(scen,n,reserves_nonprim,dsm_shift,h)) * phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h))   ;
      $ontext
      %reserves%$ontext
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_SHIFT(sc
      en,n,reserves,dsm_shift,h))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_SHIFT(s
      cen,n,reserves,dsm_shift,h))*phi_reserves_call(n,reserves,h)  ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_CU(scen,n
      ,reserves,dsm_curt,h))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_CU(scen,
      n,reserves,dsm_curt,h))*phi_reserves_call(n,reserves,h)  ;
       
              report_tech('Load shift pos absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = report_tech('Load shift pos absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_sh
      ift,n) - report_tech('Load shift pos absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) ;
              report_tech('Load shift neg absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('dsm',n) AND feat_node('reserves',n)) = report_tech('Load shift neg absolute (total)',loop_res_share,loop_ev,loop_prosumage,dsm_sh
      ift,n) - report_tech('Load shift neg absolute (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) ;
       
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n) <
       eps_rep_rel ) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)
       < eps_rep_rel ) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_curt,n)
       < eps_rep_rel ) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,dsm_shift,
      n) < eps_rep_rel ) = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n) < eps_rep_a
      bs) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift,h,n) < eps_rep
      _abs ) = 0 ;
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n) < eps_rep_abs
       ) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h,n) < eps_rep_a
      bs ) = 0 ;
                       report_tech('Load shift neg absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift neg absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
                       report_tech('Load shift pos absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_tech('Load shift pos absolute (reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < card(h)*eps_rep_abs) = 0 ;
      $ontext
4118   
4119   
4120  * ----------------------------------------------------------------------------
4121   
4122  * Reserves and EV
      %reserves%$ontext
             report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( ev , lev_RP_EV_V2
      G(scen,n,reserves,ev,h)))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( ev , lev_RP_EV_G2V(scen,n,reserves,ev,h)))  ;
             report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( ev , phi_reserve
      s_call(n,reserves,h) * lev_RP_EV_V2G(scen,n,reserves,ev,h)))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( ev , phi_reserves_call(n,reserves,h) * lev_RP_EV_G2V(scen,n,reserves,ev,h)))  ;
      $ontext
      %reserves_endogenous%$ontext
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP
      _EV_V2G(scen,n,reserves_prim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_prim,ev,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonp
      rim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1
      000) )) ));
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_G2V(scen,n,reserves_prim,ev,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,non
      disnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ));
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_V2G(scen,n,reserves_prim,ev,h))) / (phi_reserves_pr_up(n) * sum( reserves_nonprim ,  ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,non
      disnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ));
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_no
      nprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))) / ((card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP
      _EV_V2G(scen,n,reserves_prim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_prim,ev,h)))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(
      n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  
      , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP
      _EV_G2V(scen,n,reserves_prim,ev,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reser
      ves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP
      _EV_V2G(scen,n,reserves_prim,ev,h))*phi_reserves_call(n,reserves_prim,h)) /  sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,rese
      rves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000
       * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+l
      ev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reser
      ves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
             report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reser
      ves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
      $ontext
      %reserves_exogenous%$ontext
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP
      _EV_V2G(scen,n,reserves_prim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_prim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_G2V(scen,n,reserves_prim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_V2G(scen,n,reserves_prim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_prim,h)) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
             report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
      *** ### not completed
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_V2G(scen,n,reserves_prim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_prim,ev,h)))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up
      (n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,reserves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
       , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_G2V(scen,n,reserves_prim,ev,h))*phi_reserves_call(n,reserves_prim,h)) / sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,rese
      rves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_R
      P_EV_V2G(scen,n,reserves_prim,ev,h))*phi_reserves_call(n,reserves_prim,h)) /  sum( h , phi_reserves_call(n,reserves_prim,h) *  phi_reserves_pr_up(n) * sum( reserves_nonprim , 1000 * phi_reserves_share(n,reserves_nonprim) * ( reserves_intercept(n,res
      erves_nonprim) + sum(nondisnondis , reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000 ) ) )   ) ;
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 100
      0 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+
      lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_G2V(scen,n,reserves_nonprim,ev,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,rese
      rves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
      *       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = (sum((h,ev),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_RP_EV_V2G(scen,n,reserves_nonprim,ev,h))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,rese
      rves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))) ;
      $ontext
      %reserves%$ontext
             report_tech('EV positive reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (ev,h,reserves_up) ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RP_EV_G2V(scen,n,reserves_up,ev,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour% ;
             report_tech('EV negative reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (ev,h,reserves_do) ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RP_EV_G2V(scen,n,reserves_do,ev,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour% ;
             report_tech('EV positive reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (ev,h,reserves_up) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , lev_RP_EV_V2G(scen,n,reserves_up,ev,h)) * phi_reserves_call(n,reserves_up,h)) * %sec_hour% ;
             report_tech('EV negative reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('ev',n) AND feat_node('reserves',n)) = sum( (ev,h,reserves_do) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , lev_RP_EV_V2G(scen,n,reserves_do,ev,h)) * phi_reserves_call(n,reserves_do,h)) * %sec_hour% ;
       
                       report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n) < eps_rep_abs
       ) = 0 ;
                       report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum',h,n) < eps_rep_a
      bs ) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n) < eps_r
      ep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n) < eps
      _rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n) < eps
      _rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n) <
       eps_rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)
       < eps_rep_rel) = 0 ;
                       report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)
       < eps_rep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'ev_cum',n) < eps
      _rep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'G2V_cum',n) < e
      ps_rep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_prim,'V2G_cum',n) < e
      ps_rep_rel) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'ev_cum',n)
       < eps_rep_rel ) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'G2V_cum',
      n) < eps_rep_rel ) = 0 ;
                       report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',n)$(report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'V2G_cum',
      n) < eps_rep_rel ) = 0 ;
                       report_tech('EV positive reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV positive reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*c
      ard(h)*%sec_hour%) = 0 ;
                       report_tech('EV negative reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV negative reserves activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep_abs*c
      ard(h)*%sec_hour%) = 0 ;
                       report_tech('EV positive reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV positive reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep
      _abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('EV negative reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(report_tech('EV negative reserves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n) < eps_rep
      _abs*card(h)*%sec_hour%) = 0 ;
      $ontext
4189   
4190   
4191  * ----------------------------------------------------------------------------
4192   
4193  * PROSUMAGE
              report_hours('demand prosumers',loop_res_share,loop_ev,loop_prosumage,h,n)$feat_node('prosumage',n) = phi_pro_load(n) * d(n,h) ;
              report_hours('demand market',loop_res_share,loop_ev,loop_prosumage,h,n)$feat_node('prosumage',n) = (1 - phi_pro_load(n)) * d(n,h) ;
              gross_energy_demand_market(scen,n) = gross_energy_demand(scen,n) - gross_energy_demand_prosumers_selfgen(scen,n) ;
       
              report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res) ) ;
              report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h)) ;
              report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES_PRO(scen,n,res,h) ) ;
              report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,n,res,h) ) ;
              report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosumage,'',h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,n,h) ) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,n,res,
      sto,h))) ;
              report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,n,res,sto,
      h))) ;
              report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2M(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2M(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_PRO2M(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_M2PRO(scen,n,sto,h)) ;
              report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L_M2M(scen,n,sto,h)) ;
       
              report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,con,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h) + corr_fac_dis(scen,n,con,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + corr_fac_dis(scen,n,res,h) + lev_G_RE
      S(scen,n,res,h)) ;
              report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) + corr_fac_rsvr(scen,n,rsvr,h)) 
      ;
              report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h)) ;
              report_market_tech_hours('generation storage market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(scen,n,sto,h)) ;
              report_market_tech_hours('storage loading market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,sto,h)) ;
              report_market_tech_hours('storage level market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_L(scen,n,sto,h)) ;
              report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_I
      N_M2PRO(scen,n,sto,h)) ) ;
              report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_
      M2M(scen,n,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_O
      UT_PRO2M(scen,n,sto,h)) ) ;
              report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT
      _M2M(scen,n,sto,h)) ) ;
              report_market_tech_hours('energy market to prosumer',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,n,h
      ) )   ;
              report_market_tech_hours('energy prosumer to market',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$feat_node('prosumage',n) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_MARKET_PRO
      2M(scen,n,res,h)) )  ;
       
              report_node('gross energy demand market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n)) ;
              report_node('gross energy demand prosumers self generation',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen,n)) ;
       
              report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,n,res) ) ;
              report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto)) ;
              report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,n,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,
      sto,h,n)) ;
              report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,
      sto,h,n));
              report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,
      h,n));
              report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,
      h,n));
              report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)
      );
              report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosum
      age,sto,h,n)) ;
              report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,
      sto,h,n)) ;
              report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum( h, report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,
      sto,h,n)) ;
              report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) =  sum( h, report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto
      ,h,n)) ;
              report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) + report_pro
      sumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n) + report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) + report_prosumage_tech('Storage out total prosumer
      s M2M',loop_res_share,loop_ev,loop_prosumage,sto,n) ;
              report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage',n) =  sum( (h,res) , report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_ev,loop_prosumag
      e,res,h,n)) ;
              report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage',n) =  sum( h , report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosumage,''
      ,h,n)) ;
              report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'',n)$feat_node('prosumage',n) =  sum( (res,h) , report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,l
      oop_prosumage,res,h,n)) ;
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage',n) AND sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) )) ) = sum( scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , lev_G_RES_PRO(scen,n,res,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) )) ) = sum( scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,n,sto,h) + lev_STO_OUT_M2PRO(scen,n,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) ) );
              report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,'market',n)$sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) ) ) = sum( scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,n,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load(n) * d(n,h) ) );
              report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage',n) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h) )) * %s
      ec_hour% ;
              report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) AND sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,n,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h) ))/ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , sum( h , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res)) ) ;
              report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = su
      m( h , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loo
      p_res_share,loop_ev,loop_prosumage,sto,n) ;
              report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum( h
       , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,n,res,sto,h)))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_sh
      are,loop_ev,loop_prosumage,sto,n) ;
              report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum( h
       , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2PRO(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,loop
      _prosumage,sto,n) ;
              report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum( h , r
      eport_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN_M2M(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_prosuma
      ge,sto,n) ;
              report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = 
      sum( h , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,l
      oop_ev,loop_prosumage,sto,n) ;
              report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_ev,l
      oop_prosumage,sto,n) ;
              report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum(
       h , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,l
      oop_prosumage,sto,n) ;
              report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n) > eps_rep_abs*card(h)) = sum( h ,
       report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2M(scen,n,sto,h))) / report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_pros
      umage,sto,n) ;
              report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n) > eps_rep_abs*card(h)) = sum( h ,
       report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(scen,n,res,h)))) / report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,
      loop_ev,loop_prosumage,'',n) ;
              report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n) > eps_rep_abs*card(h)) = sum( h ,
       report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,n,h))) / report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_ev,loop_pro
      sumage,'',n) ;
              report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'',n) > eps_rep_abs*card(h)) = s
      um( h , report_hours('price',loop_res_share,loop_ev,loop_prosumage,h,n) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_RES_PRO(scen,n,res,h)))) / report_prosumage_tech('generation prosumers self-consumption',loop_res
      _share,loop_ev,loop_prosumage,'',n) ;
              report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,n,res) > eps_rep_ins)) = sum( h , sum(scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,n,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,n,res,sto,h)) + lev_G_RES_PRO(scen,n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,n,r
      es) ) ;
      %reserves% report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto)) > eps_rep_ins) = report_prosumage_t
      ech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto)) ;
      %reserves% report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,n,sto)) > eps_rep_ins) = report_
      prosumage_tech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,n,sto)) * %sec_hour% ;
              report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto) ) > eps_rep_ins AND sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,n,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,n,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto) ) ;
       
              report_market_tech('capacities renewable market',loop_res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res) ) ;
              report_market_tech('capacities reservoir MW market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr) );
              report_market_tech('capacities reservoir MWh market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_E(scen,n,rsvr) );
              report_market_tech('capacities storage MW market',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) ;
              report_market_tech('capacities storage MWh market',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)) * %sec_hour% ;
              report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res,n)$feat_node('prosumage',n) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h) )) * %sec_hour% ;
              report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res,n) AND sum(h, sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h)) ) + sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_CU(scen,n,res,h)  )) ) ;
              report_market_tech('capacities conventional market',loop_res_share,loop_ev,loop_prosumage,con,n)$feat_node('prosumage',n) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) ;
              report_market_tech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum(h, report_market_tech_hours('generation storage market',loop_res_share,loop_ev,loop_prosumage,sto,h,n) ) *
       %sec_hour% ;
              report_market_tech('Storage in total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum(h, report_market_tech_hours('storage loading market',loop_res_share,loop_ev,loop_prosumage,sto,h,n) ) * %se
      c_hour% ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res)) > eps_rep_ins) = sum( h , sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,n,res,h) + lev_G_L(scen,n,res,h)- corr_fac_dis(scen,n,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,res)) ;
              report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,con,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) > eps_rep_ins) = sum( h , sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,con)) ;
      %reserves% report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) > eps_rep_ins) = report_market_t
      ech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto)) ;
      %reserves% report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)) > eps_rep_ins) = repo
      rt_market_tech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto)) * %sec_hour% ;
              report_market_tech('Storage EP-ratio market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) ) > eps_rep_ins AND sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) ) * %sec_hour% > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,n,sto) ) * %sec_hour% / sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , lev_N_STO_P(scen,n,sto) ) ;
       
              report_prosumage('gross energy demand prosumers',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n)) ;
              report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_market(scen,n)) ;
              report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen,n))
       ;
              report_prosumage('self-generation share prosumers total',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n) )) = sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen,n)) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n) ) ;
              report_prosumage('market share prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n) )) = sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_market(scen,n)) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen,n) ) ;
              report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,n,res,h))) * %sec_ho
      ur% ;
              report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PR
      O(scen,n,res))))  = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res)) )
       ;
              report_prosumage('share self-generation curtailed',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res
      )) )) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res)) ) ;
              report_prosumage('share self-generation direct consumption',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(s
      cen,n,res)) )) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res)) )
       ;
              report_prosumage('share self-generation to market',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res
      ))) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,n,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,res)) ) ;
              report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,
      n,res))) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,n,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,
      n,res)) ) ;
              report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,
      res))) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,n,res,sto,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_RES_PRO(scen,n,re
      s)) ) ;
              report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( res , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES_PRO(scen,n,res)) ) + sum( sto , sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,n,sto)) ) ;
       
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_N_RES_PRO(scen,n,res) ) / report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_N_STO_P_PRO(scen,n,sto) ) / report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
       
              report_market('gross energy demand market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n)) ;
              report_market('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h))) * %sec_hour% ;
              report_market('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,n)$(feat_node('prosumage',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (h,res) , phi_res(n,res,h)*lev_N_TECH(scen,n,re
      s)) ) > eps_rep_abs*card(res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,n,res,h)))/ sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(n,res,h) * lev_N_TECH(sc
      en,n,res)) ) ;
              report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,n,h)) ) 
      / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(sc
      en,n,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,n
      ,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sc
      en,n,res,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M
      (scen,n,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(sce
      n,n,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_market(scen,n) ) ;
              report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( tech , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_TECH(scen,n,tech))) + sum( sto , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) )) + sum( rsvr ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr))) + sum( dsm_curt ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      lev_N_DSM_CU(scen,n,dsm_curt))) + sum( dsm_shift ,  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift))) ;
              report_market('Energy demand total market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = (sum( h , (1 - phi_pro_load(n)) * d(n,h) ) + sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2
      PRO(scen,n,h))) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,n,sto,h) + lev_STO_IN_M2M(scen,n,sto,h) + lev_STO_IN_M2PRO(scen,n,sto,h) ) )) * %sec_hour%
      %prosumage%$ontext
      %DSM%$ontext
              + sum( (dsm_shift,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,n,dsm_shift,h)) ) * %sec_hour%
      $ontext
      %EV%$ontext
               + sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_CHARGE(scen,n,ev,h)) ) * %sec_hour%
      $ontext
      %reserves%$ontext
               + sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , reserves_activated(scen,n,h)))
      $ontext
      ;
              report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)$feat_node('prosumage',n) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( dis ,lev_G_L(scen,n,dis,h)) + sum( nondis ,lev_G_RES
      (scen,n,nondis,h)) + sum( res , lev_G_MARKET_PRO2M(scen,n,res,h) - corr_fac_nondis(scen,n,res,h)) + sum( rsvr , lev_RSVR_OUT(scen,n,rsvr,h)- corr_fac_rsvr(scen,n,rsvr,h)) + sum( sto , lev_STO_OUT_M2M(scen,n,sto,h) + lev_STO_OUT(scen,n,sto,h) - corr_
      fac_sto(scen,n,sto,h)) + sum( dsm_shift , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h) - corr_fac_dsm_shift(scen,n,dsm_shift,h)) + sum( dsm_curt , lev_DSM_CU(scen,n,dsm_curt,h)) + sum( ev , lev_EV_DISCHARGE(scen,n,ev,h)) - corr_fac_ev(scen,n,h) )) ;
       
              report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,tech,n)$(feat_node('prosumage',n) AND report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( scen$(map(scen,loop_res_share,loop_
      ev,loop_prosumage)) , lev_N_TECH(scen,n,tech) ) / report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RSVR_P(scen,n,rsvr) ) / report_market('Capacity total mark
      et',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,sto,n)$feat_node('prosumage',n) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,n,sto) ) / report_market('Capacity total market'
      ,loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,con,n)$(feat_node('prosumage',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( h , 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,con,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,res,n)$(feat_node('prosumage',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( h , 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,n,res,h) + lev_G_MARKET_PRO2M(scen,n,res,h) + lev_G_RES(scen,n,res,h) - corr_fac_nondis(scen,n,res,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev
      ,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(feat_node('prosumage',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( h ,
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RSVR_OUT(scen,n,rsvr,h) - corr_fac_rsvr(scen,n,rsvr,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,sto,n)$(feat_node('prosumage',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( h , 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2M(scen,n,sto,h) + lev_STO_OUT(scen,n,sto,h) - corr_fac_sto(scen,n,sto,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n) * %sec_ho
      ur% + 1e-9 ;
       
                       report_hours('demand prosumers',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('demand prosumers',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs) = 0 ;
                       report_hours('demand market',loop_res_share,loop_ev,loop_prosumage,h,n)$(report_hours('demand market',loop_res_share,loop_ev,loop_prosumage,h,n) < eps_rep_abs) = 0 ;
       
                       report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_prosumage_tech_hours('generation prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_prosumage_tech_hours('curtailment of fluct res prosumers',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_prosumage_tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,res,h,n) <
       eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_prosumage_tech_hours('generation prosumers to market',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosumage,'',h,n)$(report_prosumage_tech_hours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosumage,'',h,n) < eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep
      _abs) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 
      0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < e
      ps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_r
      ep_abs) = 0 ;
                       report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage level prosumers',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage level prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 
      0 ;
                       report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage level prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 
      0 ;
                       report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_prosumage_tech_hours('storage level prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
       
                       report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,con,h,n)$(report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,con,h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n)$(report_market_tech_hours('generation market',loop_res_share,loop_ev,loop_prosumage,rsvr,h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_ev,loop_prosumage,res,h,n)$(report_market_tech_hours('curtailment of fluct res market',loop_res_share,loop_ev,loop_prosumage,res,h,n) < eps_rep_abs) =  0
       ;
                       report_market_tech_hours('generation storage market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_market_tech_hours('generation storage market',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) =  0 ;
                       report_market_tech_hours('storage loading market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_market_tech_hours('storage loading market',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('storage level market',loop_res_share,loop_ev,loop_prosumage,sto,h,n)$(report_market_tech_hours('storage level market',loop_res_share,loop_ev,loop_prosumage,sto,h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,'
      Interaction with prosumers',h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('market to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,'Inte
      raction with prosumers',h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share,loop_ev,loop_prosumage,'
      Interaction with prosumers',h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('prosumer storage to market M2M',loop_res_share,loop_ev,loop_prosumage,'Inte
      raction with prosumers',h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy market to prosumer',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('energy market to prosumer',loop_res_share,loop_ev,loop_prosumage,'Interaction wi
      th prosumers',h,n) < eps_rep_abs) = 0 ;
                       report_market_tech_hours('energy prosumer to market',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h,n)$(report_market_tech_hours('energy prosumer to market',loop_res_share,loop_ev,loop_prosumage,'Interaction wi
      th prosumers',h,n) < eps_rep_abs) = 0 ;
       
                       report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('capacities renewable prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('capacities storage MW prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) =  0 ;
                       report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('capacities storage MWh prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) =  0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
                       report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,'market',n)$(report_prosumage_tech('consumption share prosumers',loop_res_share,loop_ev,loop_prosumage,'market',n) < eps_rep_rel) = 0 ;
                       report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps
      _rep_ins) = 0 ;
                       report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps
      _rep_rel) = 0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) =
       0 ;
                       report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage in total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h))
       = 0 ;
                       report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0
       ;
                       report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0
       ;
                       report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)< eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Generation total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs*card(h)) = 0 ;
                       report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('generation prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs * car
      d(h)) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage in PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs
      ) = 0 ;
                       report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage in PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 
      0 ;
                       report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage in M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 
      0 ;
                       report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage in M2M',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage out PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_a
      bs) = 0 ;
                       report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage out PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage out M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('average market value storage out M2M',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 
      ;
                       report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('average market value generation PRO2M',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs) = 0 
      ;
                       report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('average market value withdrawal M2PRO',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs) = 0 
      ;
                       report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_ev,loop_prosumage,'',n)$(report_prosumage_tech('average market value generation PRO2PRO',loop_res_share,loop_ev,loop_prosumage,'',n) < eps_rep_abs) 
      = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 0 ;
                       report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Capacity share prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
                       report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs) = 0 ;
      %reserves%       report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage cycles prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
      %reserves%       report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
                       report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
       
                       report_market_tech('capacities renewable market',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('capacities renewable market',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs) =  0 ;
                       report_market_tech('capacities reservoir MW market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('capacities reservoir MW market',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_ins) = 0 ;
                       report_market_tech('capacities reservoir MWh market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('capacities reservoir MWh market',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities storage MW market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) =  0 ;
                       report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs*car
      d(h)) = 0 ;
                       report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_rel) = 
      0 ;
                       report_market_tech('capacities conventional market',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_market_tech('capacities conventional market',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_ins) = 0 ;
                       report_market_tech('capacities renewable market',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('capacities renewable market',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_ins) = 0 ;
                       report_market_tech('capacities storage MW market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities storage MW market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) =  0 ;
                       report_market_tech('capacities storage MWh market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('capacities storage MWh market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_ins) = 0 ;
                       report_market_tech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs*card(h)) 
      = 0 ;
                       report_market_tech('Storage in total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage in total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs*card(h)) = 
      0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_rep_abs) = 0 ;
                       report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('FLH market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
      %reserves%       report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage cycles market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_abs) = 0 ;
                       report_market_tech('Storage EP-ratio market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Storage EP-ratio market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
       
                       report_prosumage('gross energy demand prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('gross energy demand prosumers',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('gross energy demand prosumers from market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 ;
                       report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('gross energy demand prosumers self generation',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 
      ;
                       report_prosumage('self-generation share prosumage total',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('self-generation share prosumage total',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('market share prosumage',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('market share prosumage',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_ins) = 0 ;
                       report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation curtailed',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generation curtailed',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation direct consumption',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generation direct consumption',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation to market',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generation to market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generation stored PRO2PRO',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('share self-generation stored PRO2M',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n)$(report_prosumage('Capacity total prosumers',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
       
                       report_market('gross energy demand market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('gross energy demand market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('curtailment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
                       report_market('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('curtailment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy transferred to prosumer consumption',loop_res_share,loop_ev,loop_prosumage,n) < eps
      _rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy transferred to prosumer storage M2PRO',loop_res_share,loop_ev,loop_prosumage,n) <
       eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy transferred to prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n) < eps
      _rep_rel) = 0 ;
                       report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy tranferred from prosumer generation',loop_res_share,loop_ev,loop_prosumage,n) < eps
      _rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy transferred from prosumer storage PRO2M',loop_res_share,loop_ev,loop_prosumage,
      n) < eps_rep_rel) = 0 ;
                       report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Share market energy transferred from prosumer storage M2M',loop_res_share,loop_ev,loop_prosumage,n) <
       eps_rep_rel) = 0 ;
                       report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
                       report_market('Energy demand total market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('Energy demand total market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
                       report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n)$(report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n) < eps_rep_abs) = 0 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,tech,n)$(report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,tech,n) < eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,con,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,con,n) < eps_r
      ep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,res,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,res,n) < eps_r
      ep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,sto,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,sto,n) < eps_r
      ep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,rsvr,n) < eps
      _rep_rel) = 0 ;
      $ontext
4472   
4473   
4474  * ----------------------------------------------------------------------------
4475   
4476  * PROSUMAGE & DSM
      %DSM%$ontext
              report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt) ) / report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n)) = sum( scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift) ) / report_market('Capacity total market',loop_res_share,loop_ev,loop_prosumage,n) + 1e-9 ;
              report_market_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('prosumage',n) AND feat_node('dsm',n)) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_cur
      t) );
              report_market_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('prosumage',n) AND feat_node('dsm',n)) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift
      ) );
              report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt)) > eps_rep_ins)
       = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,n,dsm_curt,h) - corr_fac_dsm_cu(scen,n,dsm_curt,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_CU(scen,n,dsm_curt)) ;
              report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) > eps_rep
      _ins) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,n,dsm_shift)) ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,lo
      op_prosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,n,dsm_curt,h) - corr_fac_dsm_cu(scen,n,dsm_curt,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev,loop_prosumage,n) *
       %sec_hour% + 1e-9 ;
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(feat_node('prosumage',n) AND feat_node('dsm',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,l
      oop_prosumage,n)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,n,dsm_shift,h) - corr_fac_dsm_shift(scen,n,dsm_shift,h)) ) / report_market('energy generated gross market',loop_res_share,loop_ev,loop_p
      rosumage,n) * %sec_hour% + 1e-9 ;
       
                       report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_rel) = 0 ;
                       report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_market_tech('Capacity share market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_rel) = 0 ;
                       report_market_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_market_tech('capacities load curtailment',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_ins) = 0 ;
                       report_market_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_market_tech('capacities load shift',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_ins) = 0 ;
                       report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n) < eps_rep_abs) = 0 ;
                       report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_market_tech('FLH market',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n) < eps_rep_abs) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_curt,
      n) < eps_rep_rel) = 0 ;
                       report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_shift,n)$(report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,dsm_shif
      t,n) < eps_rep_rel) = 0 ;
      $ontext
4498   
4499   
4500  * ----------------------------------------------------------------------------
4501   
4502  * PROSUMAGE & EV
      %EV%$ontext
              report_market_tech('Energy share in gross nodal market generation',loop_res_share,loop_ev,loop_prosumage,'ev_cum',n)$(feat_node('prosumage',n) AND feat_node('ev',n) AND report_market('energy generated gross market',loop_res_share,loop_ev,loo
      p_prosumage,n)) = (sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_EV_DISCHARGE(scen,n,ev,h))) - sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , corr_fac_ev(scen,n,h))))/ report_market('energy gen
      erated gross market',loop_res_share,loop_ev,loop_prosumage,n) * %sec_hour% + 1e-9 ;
      $ontext
4508   
4509   
4510  * ----------------------------------------------------------------------------
4511   
4512  * HEAT
               report_heat_tech_hours('heat demand - heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = dh(n,bu,ch,h) ;
               report_heat_tech_hours('heat supply direct electric heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h)
       ) ;
               report_heat_tech_hours('heat supply SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * (lev_H_SETS_OUT(scen,n,bu,ch,h) + (1-eta_he
      at_stat(n,bu,ch)) * lev_H_SETS_LEV(scen,n,bu,ch,h-1)) ) ;
               report_heat_tech_hours('heat supply storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_storage(n,bu,ch) * lev_H_STO_OUT(scen,n,bu,ch,h)
       ) ;
               report_heat_tech_hours('electricity demand direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h) 
      ) ;
               report_heat_tech_hours('electricity demand SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * (lev_H_SETS_IN(scen,n,bu,ch,h) + cor
      r_fac_sets(scen,n,bu,ch,h)) ) ;
               report_heat_tech_hours('electricity demand HP',loop_res_share,loop_ev,loop_prosumage,n,bu,hp,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_hp(n,bu,hp) * ( lev_H_HP_IN(scen,n,bu,hp,h) + corr_fac
      _hp(scen,n,bu,hp,h)) ) ;
               report_heat_tech_hours('electricity demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hel,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_elec(n,bu,hel) * (lev_H_ELECTRIC_IN(scen,
      n,bu,hel,h) + corr_fac_h_elec(scen,n,bu,hel,h)) ) ;
               report_heat_tech_hours('fossil fuel demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hfo,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_fossil(n,bu,hfo) * lev_H_STO_IN_FOSSIL(sc
      en,n,bu,hfo,h) ) ;
               report_heat_tech_hours('SETS inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * lev_H_SETS_IN(scen,n,bu,ch,h) ) ;
               report_heat_tech_hours('SETS level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * lev_H_SETS_LEV(scen,n,bu,ch,h) ) ;
               report_heat_tech_hours('SETS outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * (lev_H_SETS_OUT(scen,n,bu,ch,h) + (1-eta_heat_s
      tat(n,bu,ch)) * lev_H_SETS_LEV(scen,n,bu,ch,h-1) ) ) ;
               report_heat_tech_hours('Storage inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,hst,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_hp(n,bu,hst) * lev_H_STO_IN_HP(scen,n,bu,hst,h) + theta_elec
      (n,bu,hst) * lev_H_STO_IN_ELECTRIC(scen,n,bu,hst,h) + theta_elec(n,bu,hst) * lev_H_STO_IN_FOSSIL(scen,n,bu,hst,h) ) ;
               report_heat_tech_hours('Storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_storage(n,bu,ch) * lev_H_STO_LEV(scen,n,bu,ch,h) ) ;
               report_heat_tech_hours('Storage outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_storage(n,bu,ch) * lev_H_STO_OUT(scen,n,bu,ch,h) ) ;
       
               report_heat_tech_hours('heat demand - DHW',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = d_dhw(n,bu,ch,h) ;
               report_heat_tech_hours('DHW supply - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n,bu,ch,h) ) 
      ;
               report_heat_tech_hours('DHW supply - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * lev_H_DHW_AUX_OUT(scen,n,bu,c
      h,h) ) ;
               report_heat_tech_hours('DHW supply - storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_storage(n,bu,ch) * lev_H_DHW_STO_OUT(scen,n,bu,
      ch,h) ) ;
               report_heat_tech_hours('electricity demand DHW - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n
      ,bu,ch,h) ) ;
               report_heat_tech_hours('electricity demand DHW - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * (lev_H_DHW_AUX_EL
      EC_IN(scen,n,bu,ch,h) + corr_fac_sets_aux(scen,n,bu,ch,h)) ) ;
               report_heat_tech_hours('DHW - SETS aux hot water storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * lev_H_DHW_AUX_LEV(sce
      n,n,bu,ch,h) ) ;
       
               report_heat_tech_hours('price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(feat_node('heat',n) AND sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,
      h) + theta_sets(n,bu,ch) * lev_H_SETS_IN(scen,n,bu,ch,h) + theta_storage(n,bu,ch) * lev_H_HP_IN(scen,n,bu,ch,h) + theta_storage(n,bu,ch) * lev_H_ELECTRIC_IN(scen,n,bu,ch,h)) > 0.25 ) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - 
      marginal_con1a(scen,n,h)) ;
               report_heat_tech_hours('price DHW electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(feat_node('heat',n) AND sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n,bu,
      ch,h) + theta_sets(n,bu,ch) * lev_H_DHW_AUX_ELEC_IN(scen,n,bu,ch,h)) > 0.25 ) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , - marginal_con1a(scen,n,h)) ;
       
                       report_heat_tech_hours('heat demand - heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('heat demand - heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('heat supply direct electric heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('heat supply direct electric heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_a
      bs) = 0 ;
                       report_heat_tech_hours('heat supply SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('heat supply SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('heat supply storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('heat supply storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('electricity demand direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('electricity demand direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs
      ) = 0 ;
                       report_heat_tech_hours('electricity demand SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('electricity demand SETS',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('electricity demand HP',loop_res_share,loop_ev,loop_prosumage,n,bu,hp,h)$(report_heat_tech_hours('electricity demand HP',loop_res_share,loop_ev,loop_prosumage,n,bu,hp,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('electricity demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hel,h)$(report_heat_tech_hours('electricity demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hel,h) < eps_rep_abs
      ) = 0 ;
                       report_heat_tech_hours('fossil fuel demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hfo,h)$(report_heat_tech_hours('fossil fuel demand hybrid heating',loop_res_share,loop_ev,loop_prosumage,n,bu,hfo,h) < eps_rep_abs
      ) = 0 ;
                       report_heat_tech_hours('SETS inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('SETS inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('SETS level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('SETS level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('SETS outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('SETS outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('Storage inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,hst,h)$(report_heat_tech_hours('Storage inflow',loop_res_share,loop_ev,loop_prosumage,n,bu,hst,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('Storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('Storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('Storage outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('Storage outflow',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
       
                       report_heat_tech_hours('heat demand - DHW',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('heat demand - DHW',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('DHW supply - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('DHW supply - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('DHW supply - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('DHW supply - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('DHW supply - storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('DHW supply - storage heating',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('electricity demand DHW - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('electricity demand DHW - direct electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) <
       eps_rep_abs) = 0 ;
                       report_heat_tech_hours('electricity demand DHW - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('electricity demand DHW - SETS aux electric',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,
      h) < eps_rep_abs) = 0 ;
                       report_heat_tech_hours('DHW - SETS aux hot water storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('DHW - SETS aux hot water storage level',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps
      _rep_abs) = 0 ;
       
                       report_heat_tech_hours('price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$(report_heat_tech_hours('price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) < eps_rep_abs
      ) = 0 ;
                       report_heat_tech_hours('price DHW electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)$( report_heat_tech_hours('price DHW electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h)< eps_rep_abs) 
      = 0 ;
       
       
               report_heat_tech('heat supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) 
      * (lev_H_SETS_OUT(scen,n,bu,ch,h) + (1-eta_heat_stat(n,bu,ch)) * lev_H_SETS_LEV(scen,n,bu,ch,h-1)) + theta_storage(n,bu,ch) * lev_H_STO_OUT(scen,n,bu,ch,h) )) ;
               report_heat_tech('DHW supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,c
      h) * lev_H_DHW_AUX_OUT(scen,n,bu,ch,h) + theta_storage(n,bu,ch) * lev_H_DHW_STO_OUT(scen,n,bu,ch,h) )) ;
               report_heat_tech('total costs',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , report_heat_tech_hours('price heat electricity consumption',loop_res_
      share,loop_ev,loop_prosumage,n,bu,ch,h) * ( theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) * (lev_H_SETS_IN(scen,n,bu,ch,h) + corr_fac_sets(scen,n,bu,ch,h)) + theta_hp(n,bu,ch) * ( lev_H_HP_IN(scen,n,bu,ch,h) + corr_fac_hp(scen
      ,n,bu,ch,h)) + theta_elec(n,bu,ch) * lev_H_ELECTRIC_IN(scen,n,bu,ch,h) + corr_fac_h_elec(scen,n,bu,ch,h)) + report_heat_tech_hours('price DHW electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch,h) * (theta_dir(n,bu,ch) * lev_H_DHW
      _DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) * (lev_H_DHW_AUX_ELEC_IN(scen,n,bu,ch,h) + corr_fac_sets_aux(scen,n,bu,ch,h))) )) ;
               report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$feat_node('heat',n) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , theta_dir(n,bu,ch) * lev_H_DIR(scen,n,bu,ch,h) + th
      eta_sets(n,bu,ch) * (lev_H_SETS_IN(scen,n,bu,ch,h) + corr_fac_sets(scen,n,bu,ch,h)) + theta_hp(n,bu,ch) * ( lev_H_HP_IN(scen,n,bu,ch,h) + corr_fac_hp(scen,n,bu,ch,h)) + theta_elec(n,bu,ch) * lev_H_ELECTRIC_IN(scen,n,bu,ch,h) + corr_fac_h_elec(scen,n
      ,bu,ch,h) + theta_dir(n,bu,ch) * lev_H_DHW_DIR(scen,n,bu,ch,h) + theta_sets(n,bu,ch) * (lev_H_DHW_AUX_ELEC_IN(scen,n,bu,ch,h) + corr_fac_sets_aux(scen,n,bu,ch,h)) )) ;
               report_heat_tech('average price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(feat_node('heat',n) AND report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)) = report_
      heat_tech('total costs',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) / report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) ;
               report_heat_tech('average price heat electricity consumption over all bu',loop_res_share,loop_ev,loop_prosumage,n,'over all bu',ch)$(feat_node('heat',n) AND report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosum
      age,n,'bu1',ch)) = sum( bu, report_heat_tech('average price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) * report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) ) / sum( bu, r
      eport_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) ) ;
               report_heat_tech('Storage cycles (inflow)',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(feat_node('heat',n) AND n_heat_e(n,bu,ch)) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , theta_sets(n,bu,ch) * (lev_H_SETS_
      IN(scen,n,bu,ch,h) + corr_fac_sets(scen,n,bu,ch,h)) + theta_hp(n,bu,ch) * ( lev_H_HP_IN(scen,n,bu,ch,h) + corr_fac_hp(scen,n,bu,ch,h))) )/n_heat_e(n,bu,ch);
       
                       report_heat_tech('heat supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('heat supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs) = 0 ;
                       report_heat_tech('DHW supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('DHW supply',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs) = 0 ;
                       report_heat_tech('total costs',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('total costs',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs) = 0 ;
                       report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('total electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs) = 0 ;
                       report_heat_tech('average price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('average price heat electricity consumption',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs
      ) = 0 ;
                       report_heat_tech('average price heat electricity consumption over all bu',loop_res_share,loop_ev,loop_prosumage,n,'over all bu',ch)$(report_heat_tech('average price heat electricity consumption over all bu',loop_res_share,loop_ev,lo
      op_prosumage,n,'over all bu',ch) < eps_rep_abs) = 0 ;
                       report_heat_tech('Storage cycles (inflow)',loop_res_share,loop_ev,loop_prosumage,n,bu,ch)$(report_heat_tech('Storage cycles (inflow)',loop_res_share,loop_ev,loop_prosumage,n,bu,ch) < eps_rep_abs) = 0 ;
      $ontext
4586   
4587   
4588  * ----------------------------------------------------------------------------
4589   
4590   
4591  * Reserves and heat
      %reserves_endogenous%$ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum(
       bu , theta_sets(n,bu,'setsh') * lev_RP_SETS(scen,n,reserves_nonprim,bu,'setsh',h)))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nond
      isnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum
      ( bu , theta_sets(n,bu,'setsh') * lev_RP_SETS(scen,n,reserves_nonprim,bu,'setsh',h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n
      ,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
      *        report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( b
      u , theta_storage(n,bu,hst) * (lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) )))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisn
      ondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))  ;
      *        report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( 
      bu , theta_storage(n,bu,hst) * (lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h)  ))*phi_reserves_call(n,reserves_nonprim,h))) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_shar
      e(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,
      nondisnondis)))/1000) ))  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu
       , theta_storage(n,bu,hst) * (lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h))))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnon
      dis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( b
      u , theta_storage(n,bu,hst) * (lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h))))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n
      ,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,non
      disnondis)))/1000) )))  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      sum( bu , theta_sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves_nonprim,bu,'setsh',h)))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonp
      rim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       sum( bu , theta_sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves_nonprim,bu,'setsh',h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_int
      ercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) )))  ;
      $ontext
      %reserves_exogenous%$ontext
      *** ### Noch nicht vollständig
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( 
      bu , theta_sets(n,bu,'setsh') * lev_RP_SETS(scen,n,reserves_nonprim,bu,'setsh',h)))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum(
       bu , theta_sets(n,bu,'setsh') * lev_RP_SETS(scen,n,reserves_nonprim,bu,'setsh',h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h) )  ;
      *        report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( b
      u , theta_storage(n,bu,hst) * (lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) )))) / ( (card(h)-1) * 1000 * phi_reserves_share(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisn
      ondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,nondisnondis)))/1000) ))  ;
      *        report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = (sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( 
      bu , theta_storage(n,bu,hst) * (lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h)  ))*phi_reserves_call(n,reserves_nonprim,h))) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * 1000 * phi_reserves_shar
      e(n,reserves_nonprim) * (reserves_intercept(n,reserves_nonprim) + sum(nondisnondis,reserves_slope(n,reserves_nonprim,nondisnondis) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_TECH(scen,n,nondisnondis)+lev_N_RES_PRO(scen,n,
      nondisnondis)))/1000) ))  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu 
      , theta_storage(n,bu,hst) * (lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h))))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu
       , theta_storage(n,bu,hst) * (lev_RP_H_ELEC(scen,n,reserves_nonprim,bu,hst,h) + lev_RP_HP(scen,n,reserves_nonprim,bu,hst,h))))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserve
      s_nonprim,h) )  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , s
      um( bu , theta_sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves_nonprim,bu,'setsh',h)))) / sum( h$(ord(h) > 1), reserves_exogenous(n,reserves_nonprim,h)) ;
              report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      sum( bu , theta_sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves_nonprim,bu,'setsh',h)))*phi_reserves_call(n,reserves_nonprim,h)) / sum( h , phi_reserves_call(n,reserves_nonprim,h) * reserves_exogenous(n,reserves_nonprim,h) )  ;
      $ontext
4617   
      %reserves%$ontext
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_
      sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves,bu,'setsh',h)))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta
      _sets(n,bu,'setsh') * lev_RP_SETS_AUX(scen,n,reserves,bu,'setsh',h)))*phi_reserves_call(n,reserves,h)  ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_sets
      (n,bu,'setsh') * lev_RP_SETS(scen,n,reserves,bu,'setsh',h)))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_set
      s(n,bu,'setsh') * lev_RP_SETS(scen,n,reserves,bu,'setsh',h)))*phi_reserves_call(n,reserves,h)  ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_hp(n,bu,
      hp) * lev_RP_HP(scen,n,reserves,bu,hp,h)))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_hp(n,bu
      ,hp) * lev_RP_HP(scen,n,reserves,bu,hp,h)))*phi_reserves_call(n,reserves,h)  ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_storage
      (n,bu,hel) * lev_RP_H_ELEC(scen,n,reserves,bu,hel,h)))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n)$(feat_node('heat',n) AND feat_node('reserves',n) ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( bu , theta_storag
      e(n,bu,hel) * lev_RP_H_ELEC(scen,n,reserves,bu,hel,h)))*phi_reserves_call(n,reserves,h)  ;
       
                        report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$( report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n) < e
      ps_rep_rel) = 0 ;
                        report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n)$( report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets',n) <
       eps_rep_rel) = 0 ;
                        report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$( report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n) < eps_rep
      _rel) = 0 ;
                        report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n)$( report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hst,n) < eps_r
      ep_rel) = 0 ;
      *                  report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hel,n)$( report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hel,n) < eps_re
      p_rel) = 0 ;
      *                  report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hel,n)$( report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,hel,n) < eps_
      rep_rel) = 0 ;
                        report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$( report_reserves_tech('reserve provision shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux
      ',n) < eps_rep_rel) = 0 ;
                        report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets aux',n)$( report_reserves_tech('reserve activation shares',loop_res_share,loop_ev,loop_prosumage,reserves_nonprim,'sets a
      ux',n) < eps_rep_rel) = 0 ;
       
                        report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n) < eps_re
      p_abs) = 0 ;
                        report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n)$(report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets aux',h,n) < eps_
      rep_abs) = 0 ;
                        report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n)$(report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n) < eps_rep_abs) =
       0 ;
                        report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n)$( report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'sets',h,n) < eps_rep_abs
      ) = 0 ;
                        report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n)$( report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n) < eps_rep_abs) = 0 ;
                        report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n)$( report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hp,h,n) < eps_rep_abs) = 0 ;
                        report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n)$( report_reserves_tech_hours('Reserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n) < eps_rep_abs) = 0 ;
                        report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n)$( report_reserves_tech_hours('Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,hel,h,n) < eps_rep_abs) = 0 
      ;
      $ontext
4648   
4649   
4650  * ---------------------------------------------------------------------------- *
4651  * ---------------------------------------------------------------------------- *
4652  * ---------------------------------------------------------------------------- *
4653   
4654   
4655  execute_unload "results", report, report_tech, report_node, report_line, report_tech_hours, report_hours, report_cost
      , report_prosumage, report_prosumage_tech, report_prosumage_tech_hours, report_market, report_market_tech, report_market_tech_hours
      $ontext
      , report_heat_tech_hours, report_heat_tech
      $ontext
      , report_reserves, report_reserves_tech, report_reserves_tech_hours
      $ontext
      , report_reserves_tech, report_reserves_tech_hours, report_reserves_hours
      $ontext
4672  ;
4673   
      $include report_to_excel.gms
      $ontext
4678   
4679   
4680   
4681  * ---------------------------------------------------------------------------- *
4682  * ---------------------------------------------------------------------------- *
4683  * ---------------------------------------------------------------------------- *
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\DIETER.gms
     2      163 INCLUDE        1     163  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\dataload.gms
     3      568 GDXIN          2     405  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\Data_input.gdx
     4      620 GDXIN          2     457  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\time_series.gdx
     5     1093 INCLUDE        1     306  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\model.gms
     6     2626 INCLUDE        1     485  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\fix.gms
     7     2956 INCLUDE        1     486  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\scenario.gms
     8     3241 INCLUDE        1     649  .C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\report.gms


COMPILATION TIME     =        0.078 SECONDS     25 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Setup/Generation    SOLVE DIETER Using LP From line 3237


Warning GUSS turns holdFixed for DIETER off.
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 3237


MODEL STATISTICS

BLOCKS OF EQUATIONS          29     SINGLE EQUATIONS      516,880
BLOCKS OF VARIABLES          16     SINGLE VARIABLES      499,353  5 projected
NON ZERO ELEMENTS     1,818,263     NON LINEAR N-Z         96,361
DERIVATIVE POOL              20     CONSTANT POOL              16
CODE LENGTH             140,165


GENERATION TIME      =       43.977 SECONDS    335 MB  25.1.2 r67455 WEX-WEI


EXECUTION TIME       =       44.664 SECONDS    335 MB  25.1.2 r67455 WEX-WEI
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 3237


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  3237

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT         40.685  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             25.1.2 r67420 Released Jul 31, 2018 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\cplex.opt"
Space for names approximately 30.47 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 18.86sec (det. 19737.24 ticks)
Optimal solution found.
Objective : 33544675636.589790

--- Scenario scen1:     Records read:    1
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  33544675636.5898
---   Resource Usage   19485
---   Total Time (ms)  19593

IBM ILOG CPLEX   25.1.2 r67455 Released Aug  1, 2018 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.8.0.0

Reading parameter(s) from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
Finished reading from "C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\cplex.opt"
Space for names approximately 30.47 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 20.65sec (det. 27164.85 ticks)
Optimal solution found.
Objective : 40093268939.343048

--- Scenario scen2:     Records read:    1
--- Solution statistics for scenario scen2
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  40093268939.343
---   Resource Usage   21263
---   Total Time (ms)  21373

No solution returned
GAMS 25.1.2  r67455 Released Aug  1, 2018 WEX-WEI x86 64bit/MS Windows - 11/30/18 09:30:44 Page 6
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =        2.028 SECONDS    212 MB  25.1.2 r67455 WEX-WEI


USER: Medium MUD - 10 User License                   S180308:0349AO-GEN
      Deutsches Institut fuer Wirtschaftsforschung DIW, AbteilungDC3975
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\DIETER.gms
Output     C:\Users\cguenther\Documents\GitHub\prosumage\Code\Prosumage_Opt\Dieter_Module\Original\DIETER.lst
