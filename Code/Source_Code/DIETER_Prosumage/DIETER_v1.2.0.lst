GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 08/04/18 18:17:21 Page 1
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
C o m p i l a t i o n


   1   
   2  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.2.0, February 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
  12  **************************************************************************
      ******
  13   
  14  **************************
  15  ***** GLOBAL OPTIONS *****
  16  **************************
  17   
  18  * Set star to skip Excel upload and load data from gdx
  20   
  21  * Choose base year
  23   
  24  * Set star to activate options
  29   
  31   
  32  * Set star to indicate renewables constraint on electric vehicles - DEFAUL
      T is same quota as for the rest of the electricity system
  36   
  37  * Set star to select run-of-river options either as a simple exogenous par
      ameter or as an endogenous variable including reserve provision:
  38  * if nothing is selected, ROR capacity will be set to zero
  39  * if parameter option is selected, set appropriate values in fix.gmx
  40  * if variable option is selected, set appropriate bound in data_input exce
      l
  43   
  44  * Set star to determine loops, otherwise default 100% renewables
  46   
  47  * Set star to run test variant with each second hour
  49   
  50  * Set star for no crossover to speed up calculation time by skipping cross
      over in LP solver
  52   
  53  * Set reporting sensitivity. All results below will be reported as zero
  54  Scalar eps_rep_rel Sensitivity for shares defined between 0 and 1        /
       1e-4 / ;
  55  Scalar eps_rep_abs Sensitivity for absolute values - e.g. hourly         /
       1e-2 / ;
  56  Scalar eps_rep_ins Sensitivity for absolute values - e.g. installed MW   /
       1 /    ;
  57   
  58  **************************************************************************
      ******
  59   
  60  * Definition of strings for report parameters and sanity checks
  61  * (Do not change settings below)
  63   
      $setglobal sec_hour "8760/2208"
      $ontext
  68   
  69  * Sanity checks
  71   
  73   
  77   
  81   
  82  **************************************************************************
      ******
  83   
  84  **************************
  85  ***** SOLVER OPTIONS *****
  86  **************************
  87   
  88  options
  89  optcr = 0.00
  90  reslim = 10000000
  91  lp = cplex
  92  mip = cplex
  93  nlp = conopt
  94  ;
  95   
  96  options
  97  dispwidth = 15
  98  limrow = 0
  99  limcol = 0
 100  solprint = off
 101  sysout = off
 102  ;
 103   
 104  **************************************************************************
      ******
 105   
 106  Sets
 107  year      yearly time data                       /2011, 2012, 2013, 2013_w
      indonsmooth/
 108  ct        Dispatchable Technologies              /ror, nuc, lig, hc, CCGT,
       OCGT_eff, OCGT_ineff, bio/
 109   ct_ren(ct)       Renewable dispatchable technologies    /ror, bio/
 110   ct_the(ct)       Thermal dispatchable technologies      /nuc, lig, hc, CC
      GT, OCGT_eff, OCGT_ineff/
 111   
 112  res       Renewable technologies                 /Wind_on, Wind_off, Solar
      /
 113  sto       Storage technolgies                    /Sto1*Sto7/
 114  ev        Set of 28 EV profiles                  /ev1*ev28/
 115  dsm_shift DSM shifting technologies              /DSM_shift1*DSM_shift5/
 116  dsm_curt  Set of load curtailment technologies   /DSM_curt1*DSM_curt3/
 117  reserves  Set of reserve qualities               /PR_up, PR_do, SR_up, SR_
      do, MR_up, MR_do/
 118   reserves_up(reserves)  Set of positive reserve qualities       /PR_up, SR
      _up, MR_up/
 119   reserves_do(reserves)  Set of positive reserve qualities       /PR_do, SR
      _do, MR_do/
 120   reserves_spin(reserves)    Set of spinning reserves            /PR_up, PR
      _do, SR_up, SR_do/
 121   reserves_nonspin(reserves) Set of nonspinning reserves         /MR_up, MR
      _do/
 122   
 123  h  hour                             /h1*h8760/
      $include second_hour.gms
      $ontext
 128   
 129  *$ontext
 130  loop_res_share   Solution loop for different shares of renewables       /e
      ps/
 133   
      loop_ev          Solution loop for different fleets of EVs              /0
      , 1e+6, 2e+6, 4e+6, 8e+6, 16e+6, 32e+6/
      $ontext
 138   
 139  *$ontext
 140  loop_prosumage   Solution loop for different prosumer self-consumption lev
      els    /40, 45, 50, 55, 60, 65, 70/
 143   
 144  *      loop_res_share                          /100/
 145                               loop_ev                                 /0/
 146  *                      loop_prosumage                          /0/
 147  ;
 148   
 149  Alias (h,hh) ;
 150  alias (res,resres) ;
 151  alias (reserves,reservesreserves) ;
 152   
 153   
 154  **************************************************************************
      ******
 155   
INCLUDE    C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\dataload.gms
 157   
 158  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.2.0, February 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
 168  **************************************************************************
      ******
 169   
 170   
 171  *********************************************
 172  **** Defines and uploads parameters      ****
 173  *********************************************
 174   
 175   
 176  Parameters
 177   
 178  ***** Conventionals *****
 179   
 180  *--- Generation and fixed ---*
 181  eta_con(ct)              Efficiency of conventional technologies
 182  carbon_content(ct)       CO2 emissions per fuel unit used
 183  c_up(ct)                 Load change costs UP in EUR per MW
 184  c_do(ct)                 Load change costs DOWN in EUR per MW
 185  c_fix_con(ct)            Annual fixed costs per MW
 186  c_var_con(ct)            Variable O&M costs per MWh
 187   
 188  *--- Investment ---*
 189  c_inv_overnight_con(ct)  Investment costs: Overnight
 190  inv_lifetime_con(ct)     Investment costs: technical lifetime
 191  inv_recovery_con(ct)     Investment costs: Recovery period according to de
      preciation tables
 192  inv_interest_con(ct)     Investment costs: Interest rate
 193  m_con(ct)                Investment: maximum installable capacity per tech
      nology
 194  m_con_e(ct)              Investment: maximum installable energy in TWh per
       a
 195   
 196  *--- Flexibility ---*
 197  grad_per_min(ct)         Maximum load change per minute relative to instal
      led capacity
 198   
 199   
 200  ***** Fuel and CO2 costs *****
 201   
 202  con_fuelprice(ct)        Fuel price conventionals in Euro per MWth
 203  con_CO2price             CO2 price
 204   
 205   
 206  ***** Renewables *****
 207   
 208  *--- Generation and fixed costs ---*
 209  c_cu(res)                Hourly Curtailment costs for renewables per MW
 210  c_fix_res(res)           Annual fixed costs per MW
 211  phi_min_res              Upload parameter: Minimum required renewables gen
      eration
 212   
 213  *--- Investment ---*
 214  c_inv_overnight_res(res) Investment costs: Overnight
 215  inv_lifetime_res(res)    Investment costs: technical lifetime
 216  inv_recovery_res(res)    Investment costs: Recovery period
 217  inv_interest_res(res)    Investment costs: Interest rate
 218  m_res(res)               Investment: maximum installable capacity
 219  m_res_e(res)             Investment: maximum installable energy in TWh per
       a
 220   
 221   
 222  ***** Time Data *****
 223  d_y(year,h)              Demand hour h for cost minimization for different
       years
 224  d(h)                     Demand hour h for cost minimization
 225  phi_res_y(year,res,h)    Renewables availability technology res in hour h 
      for different years
 226  phi_res(res,h)           Renewables availability technology res in hour h
 227  phi_ror(h)               Run-of-river availability in hour h
 228  n_ev_p(ev,h)             Power rating of the charging connection in MW in 
      hour h (0 when car is in use or parked without grid connection)
 229  ev_ed(ev,h)              Electricity demand for mobility vehicle profile e
      v in hour h in MW
 230  ev_ged_exog(ev,h)        Electricity demand for mobility in case of uncont
      rolled charging vehicle profile ev in hour h in MW
 231   
 232   
 233  ***** Storage *****
 234   
 235  *--- Generation and fixed costs ---*
 236  c_m_sto(sto)             Marginal costs of storing in or out
 237  eta_sto(sto)             Storage efficiency
 238  eta_sto_in(sto)          Storage loading efficiency
 239  eta_sto_out(sto)         Storage discharging efficiency
 240  phi_sto_ini(sto)         Initial storage level
 241  etop_max(sto)            Maximum E to P ratio of storage types
 242  c_fix_sto(sto)           Annual fixed costs per MW
 243   
 244  *--- Investment ---*
 245  c_inv_overnight_sto_e(sto)       Investment costs for storage energy in MW
      h: Overnight
 246  c_inv_overnight_sto_p(sto)       Investment costs for storage capacity in 
      MW: Overnight
 247  inv_lifetime_sto(sto)            Investment costs for storage: technical l
      ifetime
 248  inv_recovery_sto(sto)            Investment costs for storage: Recovery pe
      riod
 249  inv_interest_sto(sto)            Investment costs for storage: Interest ra
      te
 250  m_sto_e(sto)                     Investment into storage: maximum installa
      ble energy in MWh
 251  m_sto_p(sto)                     Investment into storage: maximum installa
      ble capacity in MW
 252   
 253   
 254  ***** Electric vehicles *****
 255  c_m_ev(ev)               Marginal costs of discharging V2G
 256  pen_phevfuel             Penalty for non-electric PHEV operation mode
 257  eta_ev_in(ev)            Electric vehicle efficiency of charging (G2V)
 258  eta_ev_out(ev)           Electric vehicle efficiency of discharging (V2G)
 259  phi_ev_ini(ev)           Electric vehicle charging level in initial period
 260   
 261  n_ev_e(ev)               Electric vehicle battery capacity in MWh
 262  ev_quant                 Overall number of electirc vehicles
 263  phi_ev(ev)               Share of electric vehicles per load profile in ac
      tual scenario
 264  ev_phev(ev)              Defines whether an electric vehicle is a PHEV REE
      V (1 if yes 0 otherwise)
 265   
 266   
 267  ***** DSM *****
 268   
 269  *--- Generation and fixed costs ---*
 270  c_m_dsm_cu(dsm_curt)             DSM: hourly costs of load curtailment
 271  c_m_dsm_shift(dsm_shift)         DSM: costs for load shifting
 272  c_fix_dsm_cu(dsm_curt)           Annual fixed costs per MW load curtailmen
      t capacity
 273  c_fix_dsm_shift(dsm_shift)       Annual fixed costs per MW load shifting c
      apacity
 274   
 275  *--- Flexibility, efficiency, recovery ---*
 276  t_dur_dsm_cu(dsm_curt)           DSM: Maximum duration load curtailment
 277  t_off_dsm_cu(dsm_curt)           DSM: Minimum recovery time between two lo
      ad curtailment instances
 278   
 279  t_dur_dsm_shift(dsm_shift)       DSM: Maximum duration load shifting
 280  t_off_dsm_shift(dsm_shift)       DSM: Minimum recovery time between two gr
      anular load upshift instances
 281  eta_dsm_shift(dsm_shift)         DSM: Efficiency of load shifting technolo
      gies
 282   
 283  *--- Investment ---*
 284  c_inv_overnight_dsm_cu(dsm_curt)         Investment costs for DSM load cur
      tailment: Overnight
 285  c_inv_overnight_dsm_shift(dsm_shift)     Investment costs for DSM load shi
      fting: Overnight
 286  inv_recovery_dsm_cu(dsm_curt)            Investment costs for DSM load cur
      tailment: Recovery period
 287  inv_recovery_dsm_shift(dsm_shift)        Investment costs for DSM load shi
      fting: Recovery period
 288  inv_interest_dsm_cu(dsm_curt)            Investment costs for DSM load cur
      tailment: Interest rate
 289  inv_interest_dsm_shift(dsm_shift)        Investment costs for DSM load shi
      fting: Interest rate
 290  m_dsm_cu(dsm_curt)                       DSM: Maximum installable capacity
       load curtailment
 291  m_dsm_shift(dsm_shift)                   DSM: Maximum installable capacity
       load shifting
 292   
 293   
 294  ***** Reserves *****
 295  phi_reserves_share(reserves)             Shares of SRL and MRL up and down
 296  reserves_intercept(reserves)
 297  reserves_slope(reserves,res)
 298  reserves_reaction(reserves)              Activation reaction time for rese
      rves qualities in minutes
 299  phi_reserves_call_y(year,reserves,h)     Hourly share of reserve provision
       that is actually activated
 300  phi_reserves_call(reserves,h)            Hourly share of reserve provision
       that is actually activated
 301  phi_reserves_pr                          Primary reserves demand as fracti
      on of sum of all secondary and tertiary reserves demand
 302   
 303   
 304  ***** Prosumage *****
 305  phi_pro_load                             Share of prosumagers among total 
      load
 306  phi_pro_self                             Minimum self-generation shares fo
      r prosumagers
 307  m_res_pro(res)                           Maximum installable: renewables c
      apacity
 308  m_sto_pro_e(sto)                         Maximum installable: storage ener
      gy
 309  m_sto_pro_p(sto)                         Maximum installable: storage capa
      city
 310  phi_sto_pro_ini                          Prosumagers' initial storage load
      ing
 311  ;
 312   
 313  **************************************************************************
      ******
 314   
 315   
 404   
 406   
GDXIN   C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumage\D
        ata_input.gdx
--- LOAD  d_y = 24:d_y
--- LOAD  phi_ror = 26:phi_ror
--- LOAD  phi_res_y = 25:phi_res_y
--- LOAD  n_ev_p = 27:n_ev_p
--- LOAD  ev_ed = 28:ev_ed
--- LOAD  ev_ged_exog = 29:ev_ged_exog
--- LOAD  eta_con = 1:eta_con
--- LOAD  carbon_content = 2:carbon_content
--- LOAD  c_up = 3:c_up
--- LOAD  c_do = 4:c_do
--- LOAD  c_fix_con = 5:c_fix_con
--- LOAD  c_var_con = 6:c_var_con
--- LOAD  c_inv_overnight_con = 7:c_inv_overnight_con
--- LOAD  inv_lifetime_con = 8:inv_lifetime_con
--- LOAD  inv_recovery_con = 9:inv_recovery_con
--- LOAD  inv_interest_con = 10:inv_interest_con
--- LOAD  m_con = 11:m_con
--- LOAD  m_con_e = 12:m_con_e
--- LOAD  grad_per_min = 13:grad_per_min
--- LOAD  con_fuelprice = 22:con_fuelprice
--- LOAD  con_CO2price = 23:con_CO2price
--- LOAD  c_cu = 14:c_cu
--- LOAD  c_fix_res = 15:c_fix_res
--- LOAD  c_inv_overnight_res = 16:c_inv_overnight_res
--- LOAD  inv_lifetime_res = 17:inv_lifetime_res
--- LOAD  inv_recovery_res = 18:inv_recovery_res
--- LOAD  inv_interest_res = 19:inv_interest_res
--- LOAD  m_res = 20:m_res
--- LOAD  m_res_e = 21:m_res_e
--- LOAD  c_m_sto = 47:c_m_sto
--- LOAD  eta_sto = 48:eta_sto
--- LOAD  c_fix_sto = 49:c_fix_sto
--- LOAD  c_inv_overnight_sto_e = 50:c_inv_overnight_sto_e
--- LOAD  c_inv_overnight_sto_p = 51:c_inv_overnight_sto_p
--- LOAD  inv_lifetime_sto = 52:inv_lifetime_sto
--- LOAD  inv_interest_sto = 54:inv_interest_sto
--- LOAD  m_sto_e = 55:m_sto_e
--- LOAD  m_sto_p = 56:m_sto_p
--- LOAD  phi_sto_ini = 57:phi_sto_ini
--- LOAD  etop_max = 58:etop_max
--- LOAD  c_m_dsm_shift = 30:c_m_dsm_shift
--- LOAD  c_fix_dsm_shift = 31:c_fix_dsm_shift
--- LOAD  c_inv_overnight_dsm_shift = 32:c_inv_overnight_dsm_shift
--- LOAD  inv_recovery_dsm_shift = 33:inv_recovery_dsm_shift
--- LOAD  inv_interest_dsm_shift = 34:inv_interest_dsm_shift
--- LOAD  m_dsm_shift = 35:m_dsm_shift
--- LOAD  t_dur_dsm_shift = 36:t_dur_dsm_shift
--- LOAD  eta_dsm_shift = 38:eta_dsm_shift
--- LOAD  t_off_dsm_shift = 37:t_off_dsm_shift
--- LOAD  c_m_dsm_cu = 39:c_m_dsm_cu
--- LOAD  c_fix_dsm_cu = 40:c_fix_dsm_cu
--- LOAD  c_inv_overnight_dsm_cu = 41:c_inv_overnight_dsm_cu
--- LOAD  inv_recovery_dsm_cu = 42:inv_recovery_dsm_cu
--- LOAD  inv_interest_dsm_cu = 43:inv_interest_dsm_cu
--- LOAD  m_dsm_cu = 44:m_dsm_cu
--- LOAD  t_dur_dsm_cu = 45:t_dur_dsm_cu
--- LOAD  t_off_dsm_cu = 46:t_off_dsm_cu
--- LOAD  c_m_ev = 59:c_m_ev
--- LOAD  eta_ev_in = 61:eta_ev_in
--- LOAD  eta_ev_out = 62:eta_ev_out
--- LOAD  pen_phevfuel = 60:pen_phevfuel
--- LOAD  phi_ev_ini = 63:phi_ev_ini
--- LOAD  n_ev_e = 64:n_ev_e
--- LOAD  phi_ev = 65:phi_ev
--- LOAD  ev_phev = 66:ev_phev
--- LOAD  phi_reserves_share = 67:phi_reserves_share
--- LOAD  reserves_intercept = 68:reserves_intercept
--- LOAD  reserves_slope = 69:reserves_slope
--- LOAD  reserves_reaction = 70:reserves_reaction
--- LOAD  phi_reserves_call_y = 71:phi_reserves_call_y
--- LOAD  phi_reserves_pr = 72:phi_reserves_pr
--- LOAD  m_res_pro = 73:m_res_pro
--- LOAD  m_sto_pro_e = 74:m_sto_pro_e
--- LOAD  m_sto_pro_p = 75:m_sto_pro_p
--- LOAD  phi_sto_pro_ini = 76:phi_sto_pro_ini
 418  ;
 419   
 420   
 421  **************************************************************************
      ******
 422   
 423   
 424  Parameters
 425  c_m(ct)        Marginal production costs for conventional plants including
       variable O and M costs
 426  c_i(ct)        Annualized investment costs by conventioanl plant per MW
 427   
 428  c_i_res(res)     Annualized investment costs by renewable plant per MW
 429   
 430  c_i_sto_e(sto)   Annualized investment costs storage energy per MWh
 431  c_i_sto_p(sto)   Annualized investment costs storage capacity per MW
 432   
 433  c_i_dsm_cu(dsm_curt)     DSM: Investment costs load curtailment
 434  c_i_dsm_shift(dsm_shift) DSM: Investment costs load shifting
 435  ;
 436   
 437  c_m(ct) = con_fuelprice(ct)/eta_con(ct) + carbon_content(ct)/eta_con(ct)*c
      on_CO2price + c_var_con(ct)   ;
 438  c_i(ct) = c_inv_overnight_con(ct)*( inv_interest_con(ct) * (1+inv_interest
      _con(ct))**(inv_lifetime_con(ct)) )
 439                   / ( (1+inv_interest_con(ct))**(inv_lifetime_con(ct))-1 ) 
            ;
 440   
 441  c_i_res(res) = c_inv_overnight_res(res)*( inv_interest_res(res) * (1+inv_i
      nterest_res(res))**(inv_lifetime_res(res)) )
 442                   / ( (1+inv_interest_res(res))**(inv_lifetime_res(res))-1 
      )       ;
 443   
 444  c_i_sto_e(sto) = c_inv_overnight_sto_e(sto)*( inv_interest_sto(sto) * (1+i
      nv_interest_sto(sto))**(inv_lifetime_sto(sto)) )
 445                   / ( (1+inv_interest_sto(sto))**(inv_lifetime_sto(sto))-1 
      )       ;
 446  c_i_sto_p(sto) = c_inv_overnight_sto_p(sto)*( inv_interest_sto(sto) * (1+i
      nv_interest_sto(sto))**(inv_lifetime_sto(sto)) )
 447                   / ( (1+inv_interest_sto(sto))**(inv_lifetime_sto(sto))-1 
      )       ;
 448   
 449  c_i_dsm_cu(dsm_curt) = c_inv_overnight_dsm_cu(dsm_curt)*( inv_interest_dsm
      _cu(dsm_curt) * (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_cu(ds
      m_curt)) )
 450                   / ( (1+inv_interest_dsm_cu(dsm_curt))**(inv_recovery_dsm_
      cu(dsm_curt))-1 )       ;
 451  c_i_dsm_shift(dsm_shift) = c_inv_overnight_dsm_shift(dsm_shift)*( inv_inte
      rest_dsm_shift(dsm_shift) * (1+inv_interest_dsm_shift(dsm_shift))**(inv_re
      covery_dsm_shift(dsm_shift)) )
 452                   / ( (1+inv_interest_dsm_shift(dsm_shift))**(inv_recovery_
      dsm_shift(dsm_shift))-1 )       ;
 453   
 454   
 455   
 456  * Adjust investment costs on model's hourly basis
 457   
 458  c_i(ct) = c_i(ct)*card(h)/8760 ;
 459  c_i_res(res) = c_i_res(res)*card(h)/8760 ;
 460  c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 ;
 461  c_i_sto_p(sto) = c_i_sto_p(sto)*card(h)/8760 ;
 462  c_i_dsm_cu(dsm_curt) = c_i_dsm_cu(dsm_curt)*card(h)/8760 ;
 463  c_i_dsm_shift(dsm_shift) = c_i_dsm_shift(dsm_shift)*card(h)/8760 ;
      c_i_sto_e(sto) = c_i_sto_e(sto)*card(h)/8760 * 2 ;
      t_dur_dsm_cu(dsm_curt) = t_dur_dsm_cu(dsm_curt) / 2 ;
      t_off_dsm_cu(dsm_curt) = t_off_dsm_cu(dsm_curt) / 2 ;
      t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=2 or ord(dsm_shift)=4 or ord(ds
      m_shift)=5) = t_dur_dsm_shift(dsm_shift) / 2 ;
      t_dur_dsm_shift(dsm_shift)$(ord(dsm_shift)=1 or ord(dsm_shift)=3) = 2 ;
      $ontext
 472   
 473  c_fix_con(ct) = c_fix_con(ct)*card(h)/8760 ;
 474  c_fix_res(res) = c_fix_res(res)*card(h)/8760 ;
 475  c_fix_sto(sto) = c_fix_sto(sto)*card(h)/8760 ;
 476  c_fix_dsm_cu(dsm_curt) = c_fix_dsm_cu(dsm_curt)*card(h)/8760 ;
 477  c_fix_dsm_shift(dsm_shift) = c_fix_dsm_shift(dsm_shift)*card(h)/8760 ;
 478   
 479  m_con_e('bio') = m_con_e('bio')*card(h)/8760 ;
 480   
 481  eta_sto_in(sto) = 0.5*eta_sto(sto);
 482  eta_sto_out(sto) = 0.5*eta_sto(sto);
 483   
 484  parameter phi_mean_reserves_call, phi_mean_reserves_call_y ;
 485  phi_mean_reserves_call_y(year,reserves) = sum(h, phi_reserves_call_y(year,
      reserves,h) ) / card(h) + eps ;
 486   
 487   
 488   
 489  *$stop
 490   
 491  **************************************************************************
      ******
 492   
 493  Variables
 494  Z                Value objective function
 495  ;
 496   
 497  Positive Variables
 498  G_L(ct,h)        Generation level in hour h in MWh
 499  G_UP(ct,h)       Generation upshift in hour h in MWh
 500  G_DO(ct,h)       Generation downshift in hour h in MWh
 501   
 502  G_RES(res,h)     Generation renewables type res in hour h in MWh
 503  CU(res,h)        Renewables curtailment technology res in hour h in MWh
 504   
 505  STO_IN(sto,h)    Storage inflow technology sto hour h in MWh
 506  STO_OUT(sto,h)   Storage outflow technology sto hour h in MWh
 507  STO_L(sto,h)     Storage level technology sto hour h in MWh
 508   
 509  EV_CHARGE(ev,h)         Electric vehicle charging vehicle profile ev hour 
      h in MWh
 510  EV_DISCHARGE(ev,h)      Electric vehicle discharging vehicle profile ev ho
      ur h in MWh
 511  EV_L(ev,h)              Electric vehicle charging level vehicle profile ev
       hour h in MWh
 512  EV_PHEVFUEL(ev,h)       Plug in hybrid electric vehicle conventional fuel 
      use vehicle profile ev hour h in MWh
 513  EV_GED(ev,h)            Grid electricity demand for mobility vehicle profi
      le ev hour h in MWh
 514   
 515  N_CON(ct)        Conventional technology ct built in MW
 516  N_RES(res)       Renewable technology built in MW
 517  N_STO_E(sto)     Storage technology built - Energy in MWh
 518  N_STO_P(sto)     Storage loading and discharging capacity built - Capacity
       in MW
 519   
 520  DSM_CU(dsm_curt,h)       DSM: Load curtailment hour h in MWh
 521  DSM_UP(dsm_shift,h)      DSM: Load shifting up hour h technology dsm in MW
      h
 522  DSM_DO(dsm_shift,h,hh)   DSM: Load shifting down in hour hh to account for
       upshifts in hour h technology dsm in MWh
 523   
 524  DSM_UP_DEMAND(dsm_shift,h)   DSM: Load shifting up active for wholesale de
      mand in hour h of technology dsm in MWh
 525  DSM_DO_DEMAND(dsm_shift,h)   DSM: Load shifting down active for wholesale 
      demand in hour h of technology dsm in MWh
 526   
 527  N_DSM_CU(dsm_curt)        DSM: Load curtailment capacity in MW
 528  N_DSM_SHIFT(dsm_shift)    DSM: Load shifting capacity in MWh
 529   
 530  RP_CON(reserves,ct,h)                     Reserve provision by conventiona
      ls in hour h in MW
 531  RP_RES(reserves,res,h)                    Reserve provision by renewables 
      in hour h in MW
 532  RP_STO_IN(reserves,sto,h)                 Reserve provision by storage in 
      in hour h in MW
 533  RP_STO_OUT(reserves,sto,h)                Reserve provision by storage out
       in hour h in MW
 534  RP_EV_V2G(reserves,ev,h)                  Reserve provision by electric ve
      hicles V2G hour h in MW
 535  RP_EV_G2V(reserves,ev,h)                  Reserve provision by electric ve
      hicles G2V hour h in MW
 536  RP_DSM_CU(reserves,dsm_curt,h)            Reserve provision by DSM load cu
      rtailment in hour h in MW
 537  RP_DSM_SHIFT(reserves,dsm_shift,h)        Reserve provision by DSM load sh
      ifting in hour h in MW
 538   
 539  CU_PRO(res,h)                    Prosumage: curtailment of renewable gener
      ation
 540  G_MARKET_PRO2M(res,h)            Prosumage. energy sent to market
 541  G_MARKET_M2PRO(h)                Prosumage: withdrawal of energy from mark
      et
 542  G_RES_PRO(res,h)                 Prosumage: hourly renewables generation
 543  STO_IN_PRO2PRO(res,sto,h)        Prosumage: storage loading from generatio
      n for discharging to consumption
 544  STO_IN_PRO2M(res,sto,h)          Prosumage: storage loading from generatio
      n for discharging to market
 545  STO_IN_M2PRO(sto,h)              Prosumage: storage loading from market fo
      r discharging to consumption
 546  STO_IN_M2M(sto,h)                Prosumage: storage loading from market fo
      r discharging to market
 547  STO_OUT_PRO2PRO(sto,h)           Prosumage: storage discharging to consump
      tion from generation
 548  STO_OUT_PRO2M(sto,h)             Prosumage: storage discharging to market 
      from generation
 549  STO_OUT_M2PRO(sto,h)             Prosumage: storage discharging to consump
      tion from market
 550  STO_OUT_M2M(sto,h)               Prosumage: storage discharging to market 
      from market
 551  STO_L_PRO2PRO(sto,h)             Prosumage: storage level generation to co
      nsumption
 552  STO_L_PRO2M(sto,h)               Prosumage: storage level generation to ma
      rket
 553  STO_L_M2PRO(sto,h)               Prosumage: storage level market to consum
      otion
 554  STO_L_M2M(sto,h)                 Prosumage: storage level market to market
 555  N_STO_E_PRO(sto)                 Prosumage: installed storage energy
 556  N_STO_P_PRO(sto)                 Prosumage: installed storage power
 557  STO_L_PRO(sto,h)                 Prosumage: overall storage level
 558  N_RES_PRO(res)                   Prosumage: installed renewables capacitie
      s
 559  ;
 560   
 561  **************************************************************************
      ******
 562   
 563  Equations
 564  * Objective
 565  obj                      Objective cost minimization
 566   
 567  * Energy balance
 568  con1a_bal(h)             Supply Demand Balance
 569   
 570  con1b_bal_pro(h)
 571   
 572  * Load change costs
 573  con2a_loadlevel          Load change costs: Level
 574  con2b_loadlevelstart     Load change costs: Level for first period
 575   
 576  * Capacity contraints and flexibility constraints
 577  con3a_maxprod_conv       Capacity Constraint conventionals
 578  con3b_minprod_conv       Minimum production conventionals if reserves cont
      racted
 579   
 580  con3c_flex_reserves_spin     Flexibility of conventionals for reserves pro
      vision
 581  con3d_flex_reserves_nonspin  Flexibility of conventionals for reserves pro
      vision
 582   
 583  con3e_maxprod_ror        Capacity constraint Run-of-river
 584  con3f_maxprod_res        Capacity constraints renewables
 585  con3g_minprod_res        Minimum production RES if reserves contracted
 586   
 587  * Storage constraints
 588  con4a_stolev_start        Storage Level Dynamics Initial Condition
 589  con4b_stolev              Storage Level Dynamics
 590   
 591  con4c_stolev_max          Storage Power Capacity
 592  con4d_maxin_sto           Storage maximum inflow
 593  con4e_maxout_sto          Storage maximum outflow
 594  con4f_resrv_sto           Constraint on reserves (up)
 595  con4g_resrv_sto           Constraint on reserves (down)
 596   
 597  con4h_maxout_lev          Maximum storage outflow - no more than level of 
      last period
 598  con4i_maxin_lev           Maximum storage inflow - no more than ebergy cap
      acity minus level of last period
 599  con4j_ending              End level equal to initial level
 600  con4k_PHS_EtoP            Maximum E to P ratio for PHS
 601   
 602  * Minimum restrictions for renewables and biomass
 603  con5a_minRES             Minimum yearly renewables requirement
 604  con5b_maxBIO             Maximum yearly biomass energy
 605   
 606  * DSM conditions: Load curtailment
 607  con6a_DSMcurt_duration_max       Maximum curtailment energy budget per tim
      e
 608  con6b_DSMcurt_max                Maximum curtailment per period
 609   
 610  * DSM conditions: Load shifting
 611  con7a_DSMshift_upanddown         Equalization of upshifts and downshifts i
      n due time
 612  con7b_DSMshift_granular_max      Maximum shifting in either direction per 
      period
 613  con7c_DSM_distrib_up             Distribution of upshifts between wholesal
      e and reserves
 614  con7d_DSM_distrib_do             Distribution of downshifts between wholes
      ale and reserves
 615  con7e_DSMshift_recovery          Recovery times
 616   
 617  * Maximum installation conditions
 618  con8a_max_I_con                 Maximum installable capacity: Conventional
      s
 619  con8b_max_I_res                 Maximum installable capacity: Renewables
 620  con8c_max_I_sto_e               Maximum installable energy: Storage in MWh
 621  con8d_max_I_sto_p               Maximum installable capacity: Storage infl
      ow-outflow in MW
 622  con8e_max_I_dsm_cu              Maximum installable capacity: DSM load cur
      tailment
 623  con8f_max_I_dsm_shift_pos       Maximum installable capacity: DSM load shi
      fting
 624  con8g_max_pro_res               Maximum installable capacity: prosumage re
      newables
 625  con8h_max_pro_sto_e             Maximum installable capacity: prosumage st
      orage energy
 626  con8i_max_sto_pro_p             Maximum installable capacity: prosumage st
      orage power
 627   
 628  * Reserves
 629  con9a_reserve_prov             Reserve provision SR and MR
 630  con9b_reserve_prov_PR          Reserve provision PR
 631   
 632  * Electric vehicles
 633  con10a_ev_ed                Energy balance of electric vehicles
 634  con10b_ev_chargelev_start   Cumulative charging level in the first hour
 635  con10c_ev_chargelev         Cumulative charging level in hour h
 636  con10d_ev_chargelev_max     Cumulative maximal charging level
 637  con10e_ev_maxin             Cumulative maximal charging power
 638  con10f_ev_maxout            Cumulative maximal discharging power
 639  con10g_ev_chargelev_ending  Cumulative charging level in the last hour
 640  con10h_ev_minin             Cumulative minimal charging power
 641  con10i_ev_maxin_lev         Cumulative maximal charging limit
 642  con10j_ev_minout            Cumulative minimal discharging power
 643  con10k_ev_maxout_lev        Cumulative maximal discharging limit
 644  con10l_ev_exog              Exogenous EV charging
 645   
 646   
 647  con11a_pro_distrib                       Prosumage: distribution of genera
      ted energy
 648  con11b_pro_balance                       Prosumage: energy balance
 649  con11c_pro_selfcon                       Prosumage: minimum self-generatio
      n requirement
 650  con11d_pro_stolev_PRO2PRO                Prosumage: storage level prosumag
      er-to-prosumagers
 651  con11e_pro_stolev_PRO2M                  Prosumage: storage level prosumag
      ers-to-market
 652  con11f_pro_stolev_M2PRO                  Prosumage: storage level market-t
      o-prosumagers
 653  con11g_pro_stolev_M2M                    Prosumage: storage level market-t
      o-market
 654  con11h_1_pro_stolev_start_PRO2PRO        Prosumage: storage level initial 
      conditions
 655  con11h_2_pro_stolev_start_PRO2M          Prosumage: storage level initial 
      conditions
 656  con11h_3_pro_stolev_start_M2PRO          Prosumage: storage level initial 
      conditions
 657  con11h_4_pro_stolev_start_M2M            Prosumage: storage level initial 
      conditions
 658  con11i_pro_stolev                        Prosumage: storage level total
 659  con11j_pro_stolev_max                    Prosumage: maximum overall storag
      e level
 660  con11k_pro_maxin_sto                     Prosumage: maximum storage inflow
 661  con11l_pro_maxout_sto                    Prosumage: maximum storage outflo
      w
 662  con11m_pro_maxout_lev                    Prosumage: maximum storage outflo
      w linked to level
 663  con11n_pro_maxin_lev                     Prosumage: maximum storage inflow
       linked to level
 664  con11o_pro_ending                        Prosumage: storage ending conditi
      on
 665  ;
 666   
 667   
 668  **************************************************************************
      ******
 669   
 670  * ------------------------------------------------------------------------
      ---- *
 671  ***** Objective function *****
 672  * ------------------------------------------------------------------------
      ---- *
 673   
 674  obj..
 675           Z =E=
 676                   sum( (ct,h) , c_m(ct)*G_L(ct,h) )
 677                   + sum( (ct,h)$(ord(h)>1) , c_up(ct)*G_UP(ct,h) )
 678                   + sum( (ct,h) , c_do(ct)*G_DO(ct,h) )
 679                   + sum( (res,h) , c_cu(res)*CU(res,h) )
 680                   + sum( (sto,h) , c_m_sto(sto) * ( STO_OUT(sto,h) + STO_IN
      (sto,h) ) )
                       + sum( (dsm_curt,h) , c_m_dsm_cu(dsm_curt)*DSM_CU(dsm_cur
      t,h) )
                       + sum( (dsm_shift,h) , c_m_dsm_shift(dsm_shift) * DSM_UP_
      DEMAND(dsm_shift,h) )
                       + sum( (dsm_shift,h) , c_m_dsm_shift(dsm_shift) * DSM_DO_
      DEMAND(dsm_shift,h) )
      $ontext
                       + sum( (ev,h) , c_m_ev(ev) * EV_DISCHARGE(ev,h) )
                       + sum( (ev,h) , pen_phevfuel * EV_PHEVFUEL(ev,h) )
      $ontext
 692                   + sum( ct , c_i(ct)*N_CON(ct) )
 693                   + sum( ct , c_fix_con(ct)*N_CON(ct) )
 694   
 695                   + sum( res , c_i_res(res)*N_RES(res) )
 696                   + sum( res , c_fix_res(res)*N_RES(res) )
 697   
 698                   + sum( sto , c_i_sto_e(sto)*N_STO_E(sto) )
 699                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P(sto)+N_STO_E(sto))
       )
 700                   + sum( sto , c_i_sto_p(sto)*N_STO_P(sto) )
                       + sum( dsm_curt , c_i_dsm_cu(dsm_curt)*N_DSM_CU(dsm_curt)
       )
                       + sum( dsm_curt , c_fix_dsm_cu(dsm_curt)*N_DSM_CU(dsm_cur
      t) )
                       + sum( dsm_shift , c_i_dsm_shift(dsm_shift)*N_DSM_SHIFT(d
      sm_shift) )
                       + sum( dsm_shift , c_fix_dsm_shift(dsm_shift)*N_DSM_SHIFT
      (dsm_shift) )
      $ontext
                       + sum( (reserves_up,sto,h) , phi_reserves_call(reserves_u
      p,h) * c_m_sto(sto) * (RP_STO_OUT(reserves_up,sto,h) - RP_STO_IN(reserves_
      up,sto,h)) )
                       - sum( (reserves_do,sto,h) , phi_reserves_call(reserves_d
      o,h) * c_m_sto(sto) * (RP_STO_OUT(reserves_do,sto,h) - RP_STO_IN(reserves_
      do,sto,h)) )
      $ontext
      %EV%$ontext
      %EV_EXOG%        + sum( (reserves_up,ev,h) , RP_EV_V2G(reserves_up,ev,h)* 
      phi_reserves_call(reserves_up,h) * c_m_ev(ev) )
      %EV_EXOG%        - sum( (reserves_do,ev,h) , RP_EV_V2G(reserves_do,ev,h)* 
      phi_reserves_call(reserves_do,h) * c_m_ev(ev) )
      $ontext
      %reserves%$ontext
                       + sum( (reserves_up,dsm_curt,h) , RP_DSM_CU(reserves_up,d
      sm_curt,h) * phi_reserves_call(reserves_up,h) * c_m_dsm_cu(dsm_curt) )
                       + sum( (reserves,dsm_shift,h) , RP_DSM_SHIFT(reserves,dsm
      _shift,h) * phi_reserves_call(reserves,h) * c_m_dsm_shift(dsm_shift) )
      $ontext
 725  *$ontext
 726                   + sum( res , c_i_res(res)*N_RES_PRO(res) )
 727                   + sum( res , c_fix_res(res)*N_RES_PRO(res) )
 728   
 729                   + sum( sto , c_i_sto_e(sto)*N_STO_E_PRO(sto) )
 730                   + sum( sto , c_fix_sto(sto)/2*(N_STO_P_PRO(sto)+N_STO_E_P
      RO(sto)) )
 731                   + sum( sto , c_i_sto_p(sto)*N_STO_P_PRO(sto) )
 732   
 733                   + sum( (sto,h) , c_m_sto(sto) * ( STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2M(sto,h) + sum( 
      res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h)) + STO_OUT_PRO2M
      (sto,h) + STO_OUT_M2M(sto,h) ) )
 736  ;
 737   
 738  * ------------------------------------------------------------------------
      ---- *
 739  ***** Energy balance and load levels *****
 740  * ------------------------------------------------------------------------
      ---- *
 741   
 742  * Energy balance
 743  con1a_bal(hh)..
 744           ( 1 - phi_pro_load ) * d(hh) + sum( sto , STO_IN(sto,hh) )
               + sum( dsm_shift , DSM_UP_DEMAND(dsm_shift,hh) )
      $ontext
               + sum( ev , EV_CHARGE(ev,hh) )
      $ontext
 753  *$ontext
 754           + G_MARKET_M2PRO(hh)
 755           + sum( sto , STO_IN_M2PRO(sto,hh))
 756           + sum( sto , STO_IN_M2M(sto,hh))
 759           =E=
 760           sum( ct , G_L(ct,hh)) + sum( res , G_RES(res,hh)) + sum( sto , ST
      O_OUT(sto,hh) )
      * Balancing Correction Factor
              + sum( ct ,
                sum( reserves_do ,  RP_CON(reserves_do,ct,hh) * phi_reserves_cal
      l(reserves_do,hh))
              - sum( reserves_up ,  RP_CON(reserves_up,ct,hh) * phi_reserves_cal
      l(reserves_up,hh))
               )
      $ontext
               + sum(dsm_curt, DSM_CU(dsm_curt,hh))
               + sum(dsm_shift, DSM_DO_DEMAND(dsm_shift,hh))
      $ontext
              + sum( ev , EV_DISCHARGE(ev,hh) )
      $ontext
 778  *$ontext
 779           + sum( res , G_MARKET_PRO2M(res,hh) )
 780           + sum( sto , STO_OUT_PRO2M(sto,hh))
 781           + sum( sto , STO_OUT_M2M(sto,hh))
 784  ;
 785   
 786  con2a_loadlevel(ct,h)$(ord(h) > 1)..
 787          G_L(ct,h) =E= G_L(ct,h-1) + G_UP(ct,h) - G_DO(ct,h)
 788  ;
 789   
 790  con2b_loadlevelstart(ct,'h1')..
 791           G_L(ct,'h1') =E= G_UP(ct,'h1')
 792  ;
 793   
 794  * ------------------------------------------------------------------------
      ---- *
 795  ***** Hourly maximum generation caps and constraints related to reserves  
       *****
 796  * ------------------------------------------------------------------------
      ---- *
 797   
 798  con3a_maxprod_conv(ct,h)$(ord(ct)>1 )..
 799          G_L(ct,h)
              + sum( reserves_up , RP_CON(reserves_up,ct,h))
      * Balancing Correction Factor
              + sum( reserves_do ,  RP_CON(reserves_do,ct,h) * phi_reserves_call
      (reserves_do,h))
              - sum( reserves_up ,  RP_CON(reserves_up,ct,h) * phi_reserves_call
      (reserves_up,h))
      $ontext
 807          =L= N_CON(ct)
 808  ;
 809   
 810  con3b_minprod_conv(ct,h)..
 811          sum( reserves_do , RP_CON(reserves_do,ct,h))
 812          =L= G_L(ct,h)
 813  * Balancing Correction Factor
 814          + sum( reserves_do ,  RP_CON(reserves_do,ct,h) * phi_reserves_call
      (reserves_do,h))
 815          - sum( reserves_up ,  RP_CON(reserves_up,ct,h) * phi_reserves_call
      (reserves_up,h))
 816  ;
 817   
 818  con3c_flex_reserves_spin(reserves_spin,ct,h)..
 819          RP_CON(reserves_spin,ct,h)
 820          =L= grad_per_min(ct) * reserves_reaction(reserves_spin) * ( G_L(ct
      ,h)
 821  * Balancing Correction Factor
 822          + sum( reserves_do ,  RP_CON(reserves_do,ct,h) * phi_reserves_call
      (reserves_do,h))
 823          - sum( reserves_up ,  RP_CON(reserves_up,ct,h) * phi_reserves_call
      (reserves_up,h)) )
 824  ;
 825   
 826  con3d_flex_reserves_nonspin(reserves_nonspin,ct,h)..
 827          RP_CON(reserves_nonspin,ct,h)
 828          =L= grad_per_min(ct) * reserves_reaction(reserves_nonspin) * N_CON
      (ct)
 829  ;
 830   
 831   
 832  * Constraints on run of river
 833  con3e_maxprod_ror(h)..
 834          G_L('ror',h)
              + sum( reserves_up , RP_CON(reserves_up,'ror',h))
      * Balancing Correction Factor
              + sum( reserves_do ,  RP_CON(reserves_do,'ror',h) * phi_reserves_c
      all(reserves_do,h))
              - sum( reserves_up ,  RP_CON(reserves_up,'ror',h) * phi_reserves_c
      all(reserves_up,h))
      $ontext
 842          =L= phi_ror(h)*N_CON('ror')
 843  ;
 844   
 845   
 846  * Constraints on renewables
 847  con3f_maxprod_res(res,h)..
 848          G_RES(res,h) + CU(res,h)
              + sum( reserves_up , RP_RES(reserves_up,res,h))
      $ontext
 853          =E= phi_res(res,h)*N_RES(res)
 854  ;
 855   
 856  con3g_minprod_res(res,h)..
 857          sum( reserves_do , RP_RES(reserves_do,res,h))
 858          =L= G_RES(res,h)
 859  ;
 860   
 861  * ------------------------------------------------------------------------
      ---- *
 862  ***** Storage constraints *****
 863  * ------------------------------------------------------------------------
      ---- *
 864   
 865  con4a_stolev_start(sto,'h1')..
 866          STO_L(sto,'h1') =E= phi_sto_ini(sto) * N_STO_E(sto) + STO_IN(sto,'
      h1')*(1+eta_sto(sto))/2 - STO_OUT(sto,'h1')/(1+eta_sto(sto))*2
 867  ;
 868   
 869  con4b_stolev(sto,h)$( (ord(h)>1) )..
 870           STO_L(sto,h) =E= STO_L(sto,h-1) + STO_IN(sto,h)*(1+eta_sto(sto))/
      2 - STO_OUT(sto,h)/(1+eta_sto(sto))*2
               + sum( reserves_do , phi_reserves_call(reserves_do,h) * ( RP_STO_
      IN(reserves_do,sto,h)*(1+eta_sto(sto))/2 + RP_STO_OUT(reserves_do,sto,h)/(
      1+eta_sto(sto))*2 ))
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * ( RP_STO_
      IN(reserves_up,sto,h)*(1+eta_sto(sto))/2 + RP_STO_OUT(reserves_up,sto,h)/(
      1+eta_sto(sto))*2 ))
      $ontext
 876  ;
 877   
 878  con4c_stolev_max(sto,h)..
 879          STO_L(sto,h) =L= N_STO_E(sto)
 880  ;
 881   
 882  con4d_maxin_sto(sto,h)..
 883          STO_IN(sto,h)
              + sum( reserves_do , RP_STO_IN(reserves_do,sto,h))
      $ontext
 888          =L= N_STO_P(sto)
 889  ;
 890   
 891  con4e_maxout_sto(sto,h)..
 892          STO_OUT(sto,h)
              + sum( reserves_up , RP_STO_OUT(reserves_up,sto,h))
      $ontext
 897          =L= N_STO_P(sto)
 898  ;
 899   
 900  con4f_resrv_sto(sto,h)..
 901          sum( reserves_up , RP_STO_IN(reserves_up,sto,h))
 902          =L= STO_IN(sto,h)
 903  ;
 904   
 905  con4g_resrv_sto(sto,h)..
 906          sum( reserves_do , RP_STO_OUT(reserves_do,sto,h))
 907          =L= STO_OUT(sto,h)
 908  ;
 909   
 910  con4h_maxout_lev(sto,h)..
 911          ( STO_OUT(sto,h)
              + sum( reserves_up , RP_STO_OUT(reserves_up,sto,h))
      $ontext
 916          ) /(1+eta_sto(sto))*2
 917          =L= STO_L(sto,h-1)
 918  ;
 919   
 920  con4i_maxin_lev(sto,h)..
 921          ( STO_IN(sto,h)
              + sum( reserves_do , RP_STO_IN(reserves_do,sto,h))
      $ontext
 926          ) * (1+eta_sto(sto))/2
 927          =L= N_STO_E(sto) - STO_L(sto,h-1)
 928  ;
 929   
 930  con4j_ending(sto,h)$( ord(h) = card(h) )..
 931           STO_L(sto,h) =E= phi_sto_ini(sto) * N_STO_E(sto)
 932  ;
 933   
 934  con4k_PHS_EtoP('Sto5')..
 935          N_STO_E('Sto5') =L= etop_max('Sto5') * N_STO_P('Sto5')
 936  ;
 937   
 938  * ------------------------------------------------------------------------
      ---- *
 939  ***** Quotas for renewables and biomass *****
 940  * ------------------------------------------------------------------------
      ---- *
 941   
 942  con5a_minRES..
 943  sum( ct_the , sum( h , G_L(ct_the,h) ) )
 944          =L= (1-phi_min_res) * sum( h , d(h) + sum( (sto) , STO_IN(sto,h) -
       STO_OUT(sto,h) )
 945  *$ontext
 946           + sum( sto , sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(
      res,sto,h)) + STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h) - STO_OUT_PRO2PRO(st
      o,h) - STO_OUT_PRO2M(sto,h) - STO_OUT_M2PRO(sto,h) - STO_OUT_M2M(sto,h) )
               - sum( dsm_curt , DSM_CU(dsm_curt,h) )
               + sum( dsm_shift , DSM_UP(dsm_shift,h) - sum( hh$( ord(hh) >= ord
      (h) - t_dur_dsm_shift(dsm_shift) AND ord(hh) <= ord(h) + t_dur_dsm_shift(d
      sm_shift) ) , DSM_DO(dsm_shift,h,hh)) )
      $ontext
              + sum( ev , EV_CHARGE(ev,h) - EV_DISCHARGE(ev,h) )
      %EV_DEFAULT%%EV_FREE%    - sum( ev , EV_GED(ev,h) )
      %EV_DEFAULT%%EV_100RES%  + phi_min_res/(1-phi_min_res)*sum( ev , EV_GED(ev
      ,h) )
      $ontext
              + phi_mean_reserves_call('PR_up') * phi_reserves_pr * sum( reserve
      s$( ord(reserves) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_i
      ntercept(reserves) + sum( res , reserves_slope(reserves,res) * N_RES(res)/
      1000 ) ) )
              + phi_mean_reserves_call('SR_up') *( 1000 * phi_reserves_share('SR
      _up') * (reserves_intercept('SR_up') + sum( res , reserves_slope('SR_up',r
      es) * N_RES(res)/1000 ) ) )
              + phi_mean_reserves_call('MR_up') *( 1000 * phi_reserves_share('MR
      _up') * (reserves_intercept('MR_up') + sum( res , reserves_slope('MR_up',r
      es) * N_RES(res)/1000 ) ) )
              - phi_mean_reserves_call('PR_do') * phi_reserves_pr * sum( reserve
      s$( ord(reserves) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_i
      ntercept(reserves) + sum( res , reserves_slope(reserves,res) * N_RES(res)/
      1000 ) ) )
              - phi_mean_reserves_call('SR_do') *( 1000 * phi_reserves_share('SR
      _do') * (reserves_intercept('SR_do') + sum( res , reserves_slope('SR_do',r
      es) * N_RES(res)/1000 ) ) )
              - phi_mean_reserves_call('MR_do') *( 1000 * phi_reserves_share('MR
      _do') * (reserves_intercept('MR_do') + sum( res , reserves_slope('MR_do',r
      es) * N_RES(res)/1000 ) ) )
       
             + sum( sto ,
                 sum( reserves_do , phi_reserves_call(reserves_do,h) * (RP_STO_I
      N(reserves_do,sto,h) + RP_STO_OUT(reserves_do,sto,h)))
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * (RP_STO_I
      N(reserves_up,sto,h) + RP_STO_OUT(reserves_up,sto,h))) )
      $ontext
      %reserves%$ontext
             - sum( (dsm_curt,reserves_up) , RP_DSM_CU(reserves_up,dsm_curt,h) *
       phi_reserves_call(reserves_up,h) )
      $ontext
      %EV%$ontext
      %EV_EXOG%  + sum( ev ,
      %EV_EXOG%      sum( reserves_do , phi_reserves_call(reserves_do,h) * (RP_E
      V_G2V(reserves_do,ev,h) + RP_EV_V2G(reserves_do,ev,h)))
      %EV_EXOG%    - sum( reserves_up , phi_reserves_call(reserves_up,h) * (RP_E
      V_G2V(reserves_up,ev,h) + RP_EV_V2G(reserves_up,ev,h))) )
      $ontext
 985  )
 986  ;
 987   
 988  con5b_maxBIO..
 989           sum( h , G_L('bio',h) ) =L= m_con_e('bio')
 990  ;
 991   
 992  * ------------------------------------------------------------------------
      ---- *
 993  ***** DSM constraints - curtailment *****
 994  * ------------------------------------------------------------------------
      ---- *
 995   
 996  con6a_DSMcurt_duration_max(dsm_curt,h)..
 997           sum( hh$( ord(hh) >= ord(h) AND ord(hh) < ord(h) + t_off_dsm_cu(d
      sm_curt) ) , DSM_CU(dsm_curt,hh)
              + sum( reserves_up , RP_DSM_CU(reserves_up,dsm_curt,hh) * phi_rese
      rves_call(reserves_up,hh) )
      $ontext
1002           )
1003           =L= N_DSM_CU(dsm_curt) * t_dur_dsm_cu(dsm_curt)
1004  ;
1005   
1006  con6b_DSMcurt_max(dsm_curt,h)..
1007          DSM_CU(dsm_curt,h)
              + sum( reserves_up , RP_DSM_CU(reserves_up,dsm_curt,h) )
      $ontext
1012            =L= N_DSM_CU(dsm_curt)
1013  ;
1014   
1015  * ------------------------------------------------------------------------
      ---- *
1016  ***** DSM constraints - shifting *****
1017  * ------------------------------------------------------------------------
      ---- *
1018   
1019  con7a_DSMshift_upanddown(dsm_shift,h)..
1020           DSM_UP(dsm_shift,h) * (1 + eta_dsm_shift(dsm_shift))/2 =E= 2/(1+e
      ta_dsm_shift(dsm_shift)) * sum( hh$( ord(hh) >= ord(h) - t_dur_dsm_shift(d
      sm_shift) AND ord(hh) <= ord(h) + t_dur_dsm_shift(dsm_shift) ) , DSM_DO(ds
      m_shift,h,hh))
1021  ;
1022   
1023  con7b_DSMshift_granular_max(dsm_shift,h)..
1024           DSM_UP_DEMAND(dsm_shift,h) + DSM_DO_DEMAND(dsm_shift,h)
               + sum( reserves , RP_DSM_SHIFT(reserves,dsm_shift,h) )
      $ontext
1029           =L= N_DSM_SHIFT(dsm_shift)
1030  ;
1031   
1032  con7c_DSM_distrib_up(dsm_shift,h)..
1033           DSM_UP(dsm_shift,h) =E= DSM_UP_DEMAND(dsm_shift,h)
               + sum( reserves_do , RP_DSM_SHIFT(reserves_do,dsm_shift,h) * phi_
      reserves_call(reserves_do,h))
      $ontext
1038  ;
1039   
1040  con7d_DSM_distrib_do(dsm_shift,h)..
1041           sum( hh$( ord(hh) >= ord(h) - t_dur_dsm_shift(dsm_shift) AND ord(
      hh) <= ord(h) + t_dur_dsm_shift(dsm_shift) ) , DSM_DO(dsm_shift,hh,h) )
1042                   =E=
1043           DSM_DO_DEMAND(dsm_shift,h)
               + sum( reserves_up , RP_DSM_SHIFT(reserves_up,dsm_shift,h) * phi_
      reserves_call(reserves_up,h))
      $ontext
1048  ;
1049   
1050  con7e_DSMshift_recovery(dsm_shift,h)..
1051           sum( hh$( ord(hh) >= ord(h) AND ord(hh) < ord(h) + t_off_dsm_shif
      t(dsm_shift) ) , DSM_UP(dsm_shift,hh))
1052           =L= N_DSM_SHIFT(dsm_shift) * t_dur_dsm_shift(dsm_shift)
1053  ;
1054   
1055  * ------------------------------------------------------------------------
      ---- *
1056  ***** Maximum installation constraints *****
1057  * ------------------------------------------------------------------------
      ---- *
1058   
1059  con8a_max_I_con(ct)..
1060           N_CON(ct) =L= m_con(ct)
1061  ;
1062   
1063  con8b_max_I_res(res)..
1064           N_RES(res) =L= m_res(res)
1065  ;
1066   
1067  con8c_max_I_sto_e(sto)..
1068           N_STO_E(sto) =L= m_sto_e(sto)
1069  ;
1070   
1071  con8d_max_I_sto_p(sto)..
1072           N_STO_P(sto) =L= m_sto_p(sto)
1073  ;
1074   
1075  con8e_max_I_dsm_cu(dsm_curt)..
1076           N_DSM_CU(dsm_curt) =L= m_dsm_cu(dsm_curt)
1077  ;
1078   
1079  con8f_max_I_dsm_shift_pos(dsm_shift)..
1080           N_DSM_SHIFT(dsm_shift) =L= m_dsm_shift(dsm_shift)
1081  ;
1082   
1083  con8g_max_pro_res(res)..
1084           N_RES_PRO(res) =L= m_res_pro(res)
1085  ;
1086   
1087  con8h_max_pro_sto_e(sto)..
1088           N_STO_E_PRO(sto) =L= m_sto_pro_e(sto)
1089  ;
1090   
1091  con8i_max_sto_pro_p(sto)..
1092           N_STO_P_PRO(sto) =L= m_sto_pro_p(sto)
1093  ;
1094   
1095  * ------------------------------------------------------------------------
      ---- *
1096  ***** Reserve constraints *****
1097  * ------------------------------------------------------------------------
      ---- *
1098   
1099  con9a_reserve_prov(reserves,h)$( ord(reserves) > 2)..
1100          sum(ct, RP_CON(reserves,ct,h))
1101          + sum(res, RP_RES(reserves,res,h))
1102          + sum(sto, RP_STO_IN(reserves,sto,h) + RP_STO_OUT(reserves,sto,h))
              + sum(dsm_curt, RP_DSM_CU(reserves,dsm_curt,h))
              + sum(dsm_shift , RP_DSM_SHIFT(reserves,dsm_shift,h) )
      $ontext
      %EV_EXOG%   + sum(ev, RP_EV_G2V(reserves,ev,h) + RP_EV_V2G(reserves,ev,h) 
      )
      $ontext
1112          =E= (
1113              1000 * phi_reserves_share(reserves) * (
1114              reserves_intercept(reserves) + sum( res , reserves_slope(reser
      ves,res) * (N_RES(res)
1115  *$ontext
1116              + N_RES_PRO(res)
1119              )/1000 ) ) )$(ord(h) > 1)
1120  ;
1121   
1122  con9b_reserve_prov_PR(reserves,h)$( ord(reserves) < 3)..
1123          sum(ct, RP_CON(reserves,ct,h))
1124          + sum(res, RP_RES(reserves,res,h))
1125          + sum(sto, RP_STO_IN(reserves,sto,h) + RP_STO_OUT(reserves,sto,h) 
      )
      %EV_EXOG%   + sum(ev, RP_EV_G2V(reserves,ev,h) + RP_EV_V2G(reserves,ev,h) 
      )
      $ontext
1130           =E= phi_reserves_pr* sum( reservesreserves$( ord(reservesreserves
      ) > 2), 1000 * phi_reserves_share(reservesreserves) * (
1131               reserves_intercept(reservesreserves) + sum( res , reserves_sl
      ope(reservesreserves,res) * (N_RES(res)
1132  *$ontext
1133               + N_RES_PRO(res)
1136               )/1000 ) ) )$(ord(h) > 1)
1137   
1138  ;
1139   
1140  * ------------------------------------------------------------------------
      ---- *
1141  ***** Electric vehicle constraints *****
1142  * ------------------------------------------------------------------------
      ---- *
1143   
1144  con10a_ev_ed(ev,h)..
1145           ev_ed(ev,h) * phi_ev(ev) * ev_quant
1146           =e= EV_GED(ev,h) + EV_PHEVFUEL(ev,h)$(ev_phev(ev)=1)
1147  ;
1148   
1149  con10b_ev_chargelev_start(ev,'h1')..
1150           EV_L(ev,'h1') =E= phi_ev_ini(ev) * n_ev_e(ev) * phi_ev(ev) * ev_q
      uant
1151           + EV_CHARGE(ev,'h1') * eta_ev_in(ev)
1152           - EV_DISCHARGE(ev,'h1') / eta_ev_out(ev)
1153           - EV_GED(ev,'h1')
1154  ;
1155   
1156  con10c_ev_chargelev(ev,h)$( (ord(h)>1) )..
1157           EV_L(ev,h) =E= EV_L(ev,h-1)
1158           + EV_CHARGE(ev,h) * eta_ev_in(ev)
1159           - EV_DISCHARGE(ev,h) / eta_ev_out(ev)
      %EV_EXOG%   + sum( reserves_do , phi_reserves_call(reserves_do,h) * (RP_EV
      _G2V(reserves_do,ev,h)*eta_ev_in(ev) + RP_EV_V2G(reserves_do,ev,h)/eta_ev_
      out(ev)) )
      %EV_EXOG%   - sum( reserves_up , phi_reserves_call(reserves_up,h) * ( RP_E
      V_G2V(reserves_up,ev,h)*eta_ev_in(ev) + RP_EV_V2G(reserves_up,ev,h)/eta_ev
      _out(ev)) )
      $ontext
1165           - EV_GED(ev,h)
1166  ;
1167   
1168  con10d_ev_chargelev_max(ev,h)..
1169          EV_L(ev,h) =L= n_ev_e(ev) * phi_ev(ev) * ev_quant
1170  ;
1171   
1172  con10e_ev_maxin(ev,h)..
1173          EV_CHARGE(ev,h)
              + sum( reserves_do , RP_EV_G2V(reserves_do,ev,h))
      $ontext
1178          =L= n_ev_p(ev,h) * phi_ev(ev) * ev_quant
1179  ;
1180   
1181  con10f_ev_maxout(ev,h)..
1182          EV_DISCHARGE(ev,h)
              + sum( reserves_up , RP_EV_V2G(reserves_up,ev,h))
      $ontext
1187          =L= n_ev_p(ev,h) * phi_ev(ev) * ev_quant
1188  ;
1189   
1190  con10g_ev_chargelev_ending(ev,h)$( ord(h) = card(h) )..
1191           EV_L(ev,h) =E= phi_ev_ini(ev) * n_ev_e(ev) * phi_ev(ev) * ev_quan
      t
1192  ;
1193   
1194  con10h_ev_minin(ev,h)..
1195           0 =L= EV_CHARGE(ev,h)
1196          - sum( reserves_up , RP_EV_G2V(reserves_up,ev,h))
1197  ;
1198   
1199  con10i_ev_maxin_lev(ev,h)..
1200          ( EV_CHARGE(ev,h)
1201          + sum( reserves_do , RP_EV_G2V(reserves_do,ev,h))) * eta_ev_in(ev)
1202          =L= n_ev_e(ev) * phi_ev(ev) * ev_quant - EV_L(ev,h-1)
1203  ;
1204   
1205  con10j_ev_minout(ev,h)..
1206           0 =L= EV_DISCHARGE(ev,h)
1207          - sum( reserves_do , RP_EV_V2G(reserves_do,ev,h))
1208  ;
1209   
1210  con10k_ev_maxout_lev(ev,h)..
1211          ( EV_DISCHARGE(ev,h)
1212          + sum( reserves_up , RP_EV_V2G(reserves_up,ev,h))) / eta_ev_out(ev
      )
1213          =L= EV_L(ev,h-1)
1214  ;
1215   
1216  con10l_ev_exog(ev,h)..
1217           EV_CHARGE(ev,h) =E= ev_ged_exog(ev,h) * phi_ev(ev) * ev_quant
1218  ;
1219   
1220  * ------------------------------------------------------------------------
      ---- *
1221  ***** Prosumage constraints *****
1222  * ------------------------------------------------------------------------
      ---- *
1223   
1224  con11a_pro_distrib(res,h)..
1225           phi_res(res,h) * N_RES_PRO(res)
1226           =E=
1227           CU_PRO(res,h) + G_MARKET_PRO2M(res,h) + G_RES_PRO(res,h) + sum( s
      to , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
1228  ;
1229   
1230  con11b_pro_balance(h)..
1231           phi_pro_load * d(h)
1232           =E=
1233           sum( res , G_RES_PRO(res,h)) + sum( sto , STO_OUT_PRO2PRO(sto,h) 
      + STO_OUT_M2PRO(sto,h) ) + G_MARKET_M2PRO(h)
1234  ;
1235   
1236  con11c_pro_selfcon..
1237           sum( (res,h) , G_RES_PRO(res,h) ) + sum( (h,sto) , STO_OUT_PRO2PR
      O(sto,h) )
1238           =g=
1239           phi_pro_self * sum( h , phi_pro_load * d(h))
1240  ;
1241   
1242  con11d_pro_stolev_PRO2PRO(sto,h)$( (ord(h)>1) )..
1243           STO_L_PRO2PRO(sto,h) =E= STO_L_PRO2PRO(sto,h-1) + sum( res , STO_
      IN_PRO2PRO(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2PRO(sto,h)/(1+eta_
      sto(sto))*2
1244  ;
1245   
1246  con11e_pro_stolev_PRO2M(sto,h)$( (ord(h)>1) )..
1247           STO_L_PRO2M(sto,h) =E= STO_L_PRO2M(sto,h-1) + sum( res , STO_IN_P
      RO2M(res,sto,h))*(1+eta_sto(sto))/2 - STO_OUT_PRO2M(sto,h)/(1+eta_sto(sto)
      )*2
1248  ;
1249   
1250  con11f_pro_stolev_M2PRO(sto,h)$( (ord(h)>1) )..
1251           STO_L_M2PRO(sto,h) =E= STO_L_M2PRO(sto,h-1) + STO_IN_M2PRO(sto,h)
      *(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,h)/(1+eta_sto(sto))*2
1252  ;
1253   
1254  con11g_pro_stolev_M2M(sto,h)$( (ord(h)>1) )..
1255           STO_L_M2M(sto,h) =E= STO_L_M2M(sto,h-1) + STO_IN_M2M(sto,h)*(1+et
      a_sto(sto))/2 - STO_OUT_M2M(sto,h)/(1+eta_sto(sto))*2
1256  ;
1257   
1258  con11h_1_pro_stolev_start_PRO2PRO(sto,'h1')..
1259          STO_L_PRO2PRO(sto,'h1') =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E(
      sto) + sum( res , STO_IN_PRO2PRO(res,sto,'h1'))*(1+eta_sto(sto))/2 - STO_O
      UT_PRO2PRO(sto,'h1')/(1+eta_sto(sto))*2
1260  ;
1261   
1262  con11h_2_pro_stolev_start_PRO2M(sto,'h1')..
1263          STO_L_PRO2M(sto,'h1') =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E(st
      o) + sum( res , STO_IN_PRO2M(res,sto,'h1'))*(1+eta_sto(sto))/2 - STO_OUT_P
      RO2M(sto,'h1')/(1+eta_sto(sto))*2
1264  ;
1265   
1266  con11h_3_pro_stolev_start_M2PRO(sto,'h1')..
1267          STO_L_M2PRO(sto,'h1') =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E(st
      o) + STO_IN_M2PRO(sto,'h1')*(1+eta_sto(sto))/2 - STO_OUT_M2PRO(sto,'h1')/(
      1+eta_sto(sto))*2
1268  ;
1269   
1270  con11h_4_pro_stolev_start_M2M(sto,'h1')..
1271          STO_L_M2M(sto,'h1') =E= 0.25 * phi_sto_pro_ini(sto) * N_STO_E(sto)
       + STO_IN_M2M(sto,'h1')*(1+eta_sto(sto))/2 - STO_OUT_M2M(sto,'h1')/(1+eta_
      sto(sto))*2
1272  ;
1273   
1274  con11i_pro_stolev(sto,h)$( (ord(h)>1) )..
1275           STO_L_PRO(sto,h) =E=   STO_L_PRO2PRO(sto,h) +  STO_L_PRO2M(sto,h)
       + STO_L_M2PRO(sto,h) + STO_L_M2M(sto,h)
1276  ;
1277   
1278  con11j_pro_stolev_max(sto,h)..
1279          STO_L_PRO(sto,h) =L= N_STO_E_PRO(sto)
1280  ;
1281   
1282  con11k_pro_maxin_sto(sto,h)..
1283          sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) ) +
       STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h)
1284          =L= N_STO_P_PRO(sto)
1285  ;
1286   
1287  con11l_pro_maxout_sto(sto,h)..
1288          STO_OUT_PRO2PRO(sto,h) + STO_OUT_PRO2M(sto,h) + STO_OUT_M2PRO(sto,
      h) + STO_OUT_M2M(sto,h)
1289          =L= N_STO_P_PRO(sto)
1290  ;
1291   
1292  con11m_pro_maxout_lev(sto,h)..
1293          ( STO_OUT_PRO2PRO(sto,h) + STO_OUT_M2PRO(sto,h) + STO_OUT_PRO2M(st
      o,h) + STO_OUT_M2M(sto,h) ) / (1+eta_sto(sto))*2
1294          =L= STO_L_PRO(sto,h-1)
1295  ;
1296   
1297  con11n_pro_maxin_lev(sto,h)..
1298          ( sum( res , STO_IN_PRO2PRO(res,sto,h) + STO_IN_PRO2M(res,sto,h) )
       + STO_IN_M2PRO(sto,h) + STO_IN_M2M(sto,h) ) * (1+eta_sto(sto))/2
1299          =L= N_STO_E_PRO(sto) - STO_L_PRO(sto,h-1)
1300  ;
1301   
1302  con11o_pro_ending(sto,h)$( ord(h) = card(h) )..
1303           STO_L_PRO(sto,h) =E= phi_sto_pro_ini(sto) * N_STO_E_PRO(sto)
1304  ;
1305   
1306  **************************************************************************
      ******
1307  ***** MODEL *****
1308  **************************************************************************
      ******
1309   
1310  model DIETER /
1311  obj
1312   
1313  con1a_bal
1314   
1315  con2a_loadlevel
1316  con2b_loadlevelstart
1317   
1318  con3a_maxprod_conv
        con3b_minprod_conv
        con3c_flex_reserves_spin
        con3d_flex_reserves_nonspin
      $ontext
1325  *$ontext
1326    con3e_maxprod_ror
1329  con3f_maxprod_res
        con3g_minprod_res
      $ontext
1334   
1335  con4a_stolev_start
1336  con4b_stolev
1337  con4c_stolev_max
1338  con4d_maxin_sto
1339  con4e_maxout_sto
        con4f_resrv_sto
        con4g_resrv_sto
      $ontext
1345  con4h_maxout_lev
1346  con4i_maxin_lev
1347  con4j_ending
1348  con4k_PHS_EtoP
1349   
1350  con5a_minRES
1351  con5b_maxBIO
1352   
      con6a_DSMcurt_duration_max
      con6b_DSMcurt_max
       
      con7a_DSMshift_upanddown
      con7b_DSMshift_granular_max
      con7c_DSM_distrib_up
      con7d_DSM_distrib_do
      * con_7e_DSMshift_recovery
      $ontext
1364   
1365  con8a_max_I_con
1366  con8b_max_I_res
1367  con8c_max_I_sto_e
1368  con8d_max_I_sto_p
        con8e_max_I_dsm_cu
        con8f_max_I_dsm_shift_pos
      $ontext
1374   
       con9a_reserve_prov
       con9b_reserve_prov_PR
      $ontext
1380   
       con10a_ev_ed
      %EV_EXOG% con10b_ev_chargelev_start
       con10c_ev_chargelev
       con10d_ev_chargelev_max
      %EV_EXOG% con10e_ev_maxin
      %EV_EXOG% con10f_ev_maxout
      %EV_EXOG% con10g_ev_chargelev_ending
      $ontext
      %reserves%$ontext
      %EV_EXOG% con10h_ev_minin
      %EV_EXOG% con10i_ev_maxin_lev
      %EV_EXOG% con10j_ev_minout
      %EV_EXOG% con10k_ev_maxout_lev
      $ontext
      %EV_EXOG%$ontext
       con10l_ev_exog
      $ontext
1404   
1405  *$ontext
1406  con8g_max_pro_res
1407  con8h_max_pro_sto_e
1408  con8i_max_sto_pro_p
1409  con11a_pro_distrib
1410  con11b_pro_balance
1411  con11c_pro_selfcon
1412  con11d_pro_stolev_PRO2PRO
1413  con11e_pro_stolev_PRO2M
1414  con11f_pro_stolev_M2PRO
1415  con11g_pro_stolev_M2M
1416  con11h_1_pro_stolev_start_PRO2PRO
1417  con11h_2_pro_stolev_start_PRO2M
1418  con11h_3_pro_stolev_start_M2PRO
1419  con11h_4_pro_stolev_start_M2M
1420  con11i_pro_stolev
1421  con11j_pro_stolev_max
1422  con11k_pro_maxin_sto
1423  con11l_pro_maxout_sto
1424  con11m_pro_maxout_lev
1425  con11n_pro_maxin_lev
1426  con11o_pro_ending
1429  /;
1430   
1431  **************************************************************************
      ******
1432  ***** Options, fixings, report preparation *****
1433  **************************************************************************
      ******
1434   
1435  * Solver options
1442   
1443  *$ontext
1454   
1455  dieter.OptFile = 1;
1456  dieter.holdFixed = 1 ;
1457   
1458  * Parameters for default base year
1459  d(h) = d_y('2013',h) ;
1460  phi_res(res,h) = phi_res_y('2013',res,h) ;
1461  phi_reserves_call(reserves,h) = phi_reserves_call_y('2013',reserves,h) ;
1462  phi_mean_reserves_call(reserves) = phi_mean_reserves_call_y('2013',reserve
      s) ;
1463   
1464   
1465  **************************************************************************
      ******
1466  ***** Solve *****
1467  **************************************************************************
      ******
1468   
1469  * Preparation of GUSS tool for scenario analysis
1470  phi_min_res = eps ;
1471  ev_quant = eps ;
1472  phi_pro_self = eps ;
1473   
1475   
1476  Set
1477  modelstats       model stats collection                  /modelstat, solve
      stat, resusd/
1478  superscen        Scenarios                               /scen1*scen1000/
1479  map(superscen,loop_res_share,loop_ev,loop_prosumage)    /#superscen:(#loop
      _res_share.#loop_ev.#loop_prosumage)/
1480  ;
1481   
1482  set
1483  scen(superscen);
1484  scen(superscen) = yes$( sum((loop_res_share,loop_ev,loop_prosumage) , map(
      superscen,loop_res_share,loop_ev,loop_prosumage)) )    ;
1485   
1486  Parameters
1487  gussoptions                              /Logoption 2, Optfile 1, Skipbase
      case 1/
1488  modstats(superscen, modelstats)
1489  min_res
1490  number_ev
1491  pro_selfcon
1492  ;
1493   
1494  min_res(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,loop
      _res_share,loop_ev,loop_prosumage) , loop_res_share.val/100 ) ;
1495  number_ev(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,lo
      op_res_share,loop_ev,loop_prosumage) , loop_ev.val ) ;
1496  pro_selfcon(scen) = sum( (loop_res_share,loop_ev,loop_prosumage)$map(scen,
      loop_res_share,loop_ev,loop_prosumage) , loop_prosumage.val/100 ) ;
1497   
1498  Parameters
1499  marginal_con5a(superscen)
1500  marginal_con1a(superscen,h)
1501   
1502  lev_Z(superscen)
1503  lev_G_L(superscen,ct,h)
1504  lev_G_UP(superscen,ct,h)
1505  lev_G_DO(superscen,ct,h)
1506  lev_G_RES(superscen,res,h)
1507  lev_CU(superscen,res,h)
1508  lev_STO_IN(superscen,sto,h)
1509  lev_STO_OUT(superscen,sto,h)
1510  lev_STO_L(superscen,sto,h)
1511  lev_N_CON(superscen,ct)
1512  lev_N_RES(superscen,res)
1513  lev_N_STO_E(superscen,sto)
1514  lev_N_STO_P(superscen,sto)
1515   
      lev_EV_CHARGE(superscen,ev,h)
      lev_EV_DISCHARGE(superscen,ev,h)
      lev_EV_L(superscen,ev,h)
      lev_EV_PHEVFUEL(superscen,ev,h)
      lev_EV_GED(superscen,ev,h)
      $ontext
1524   
      lev_DSM_CU(superscen,dsm_curt,h)
      lev_DSM_UP(superscen,dsm_shift,h)
      lev_DSM_DO(superscen,dsm_shift,h,hh)
      lev_DSM_UP_DEMAND(superscen,dsm_shift,h)
      lev_DSM_DO_DEMAND(superscen,dsm_shift,h)
      lev_N_DSM_CU(superscen,dsm_curt)
      lev_N_DSM_SHIFT(superscen,dsm_shift)
      $ontext
1535   
      lev_RP_CON(superscen,reserves,ct,h)
      lev_RP_RES(superscen,reserves,res,h)
      lev_RP_STO_IN(superscen,reserves,sto,h)
      lev_RP_STO_OUT(superscen,reserves,sto,h)
      $ontext
1543   
      %reserves%$ontext
      lev_RP_EV_V2G(superscen,reserves,ev,h)
      lev_RP_EV_G2V(superscen,reserves,ev,h)
      $ontext
1550   
      %reserves%$ontext
      lev_RP_DSM_CU(superscen,reserves,dsm_curt,h)
      lev_RP_DSM_SHIFT(superscen,reserves,dsm_shift,h)
      $ontext
1557   
1558  *$ontext
1559  lev_CU_PRO(superscen,res,h)
1560  lev_G_MARKET_PRO2M(superscen,res,h)
1561  lev_G_MARKET_M2PRO(superscen,h)
1562  lev_G_RES_PRO(superscen,res,h)
1563  lev_STO_IN_PRO2PRO(superscen,res,sto,h)
1564  lev_STO_IN_PRO2M(superscen,res,sto,h)
1565  lev_STO_IN_M2PRO(superscen,sto,h)
1566  lev_STO_IN_M2M(superscen,sto,h)
1567  lev_STO_OUT_PRO2PRO(superscen,sto,h)
1568  lev_STO_OUT_PRO2M(superscen,sto,h)
1569  lev_STO_OUT_M2PRO(superscen,sto,h)
1570  lev_STO_OUT_M2M(superscen,sto,h)
1571  lev_STO_L_PRO2PRO(superscen,sto,h)
1572  lev_STO_L_PRO2M(superscen,sto,h)
1573  lev_STO_L_M2PRO(superscen,sto,h)
1574  lev_STO_L_M2M(superscen,sto,h)
1575  lev_N_STO_E_PRO(superscen,sto)
1576  lev_N_STO_P_PRO(superscen,sto)
1577  lev_STO_L_PRO(superscen,sto,h)
1578  lev_N_RES_PRO(superscen,res)
1581  ;
1582   
1583   
1584  * Inclusion of scenario and fixing
INCLUDE    C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\fix.gms
1586   
1587  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.2.0, February 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1597  **************************************************************************
      ******
1598   
1599   
1600  *************************************************************
1601  **** Fixes unneccessary or inadequate variables to zero  ****
1602  *************************************************************
1603   
1604  ** Run-of-river **
1605  * If $setglobal ror_parameter "*": choose appropriate value for N_CON.fx('
      ror') (but no reserve provision):
1606  N_CON.fx('ror') = 4200 ;
1607  G_L.fx('ror',h) = N_CON.l('ror')*phi_ror(h) ;
1608  RP_CON.fx(reserves,'ror',h) = 0 ;
1609   
1610  * Fix everything to zero in case no ROR option is selected:
1611  *N_CON.fx('ror') = 0 ;
1612  *G_L.fx('ror',h) = 0 ;
1613  *G_UP.fx('ror',h) = 0 ;
1614  *G_DO.fx('ror',h) = 0 ;
1615  *RP_CON.fx(reserves,'ror',h) = 0 ;
1616   
1617   
1618  ** Exogenous EV **
      %EV_EXOG%$ontext
      EV_DISCHARGE.fx(ev,h) = 0 ;
      RP_EV_G2V.fx(reserves,ev,h) = 0 ;
      RP_EV_V2G.fx(reserves,ev,h) = 0 ;
      $ontext
1626   
1627   
1628  ** No nuclear **
1629  G_L.fx('nuc',h) = 0 ;
1630  G_UP.fx('nuc',h) = 0 ;
1631  G_DO.fx('nuc',h) = 0 ;
1632  RP_CON.fx(reserves,'nuc',h) = 0 ;
1633  N_CON.fx('nuc') = 0 ;
1634   
1635   
1636  ** No storage types 2, 3, 4, 6 and 7 by default **
1637  N_STO_P.fx('Sto2') = 0 ;
1638  N_STO_E.fx('Sto2') = 0 ;
1639  STO_IN.fx('Sto2',h) = 0 ;
1640  STO_OUT.fx('Sto2',h) = 0 ;
1641  STO_L.fx('Sto2',h) = 0 ;
1642  RP_STO_IN.fx(reserves,'Sto2',h) = 0 ;
1643  RP_STO_OUT.fx(reserves,'Sto2',h) = 0 ;
1644   
1645  N_STO_P.fx('Sto3') = 0 ;
1646  N_STO_E.fx('Sto3') = 0 ;
1647  STO_IN.fx('Sto3',h) = 0 ;
1648  STO_OUT.fx('Sto3',h) = 0 ;
1649  STO_L.fx('Sto3',h) = 0 ;
1650  RP_STO_IN.fx(reserves,'Sto3',h) = 0 ;
1651  RP_STO_OUT.fx(reserves,'Sto3',h) = 0 ;
1652   
1653  N_STO_P.fx('Sto4') = 0 ;
1654  N_STO_E.fx('Sto4') = 0 ;
1655  STO_IN.fx('Sto4',h) = 0 ;
1656  STO_OUT.fx('Sto4',h) = 0 ;
1657  STO_L.fx('Sto4',h) = 0 ;
1658  RP_STO_IN.fx(reserves,'Sto4',h) = 0 ;
1659  RP_STO_OUT.fx(reserves,'Sto4',h) = 0 ;
1660   
1661  N_STO_P.fx('Sto6') = 0 ;
1662  N_STO_E.fx('Sto6') = 0 ;
1663  STO_IN.fx('Sto6',h) = 0 ;
1664  STO_OUT.fx('Sto6',h) = 0 ;
1665  STO_L.fx('Sto6',h) = 0 ;
1666  RP_STO_IN.fx(reserves,'Sto6',h) = 0 ;
1667  RP_STO_OUT.fx(reserves,'Sto6',h) = 0 ;
1668   
1669   
1670  *Prosumers can only use li-ion batteries by default
1671  *$ontext
1672  N_STO_P_PRO.fx(sto) = 0 ;
1673  N_STO_E_PRO.fx(sto) = 0 ;
1674  STO_IN_PRO2PRO.fx(res,sto,h) = 0 ;
1675  STO_IN_M2PRO.fx(sto,h) = 0 ;
1676  STO_OUT_PRO2PRO.fx(sto,h) = 0 ;
1677  STO_OUT_PRO2M.fx(sto,h) = 0 ;
1678  STO_L_PRO.fx(sto,h) = 0 ;
1679   
1680  N_STO_P_PRO.lo('sto1') = 0 ;
1681  N_STO_E_PRO.lo('sto1') = 0 ;
1682  STO_IN_PRO2PRO.lo(res,'sto1',h) = 0 ;
1683  STO_IN_M2PRO.lo('sto1',h) = 0 ;
1684  STO_OUT_PRO2PRO.lo('sto1',h) = 0 ;
1685  STO_OUT_PRO2M.lo('sto1',h) = 0 ;
1686  STO_L_PRO.lo('sto1',h) = 0 ;
1687   
1688  N_STO_P_PRO.up('sto1') = inf ;
1689  N_STO_E_PRO.up('sto1') = inf ;
1690  STO_IN_PRO2PRO.up(res,'sto1',h) = inf ;
1691  STO_IN_M2PRO.up('sto1',h) = inf ;
1692  STO_OUT_PRO2PRO.up('sto1',h) = inf ;
1693  STO_OUT_PRO2M.up('sto1',h) = inf ;
1694  STO_L_PRO.up('sto1',h) = inf ;
1697   
1698  ** Default share of prosumage load
1699  phi_pro_load = 0 ;
1700   
1701  ** E to P ratio of PHS free by default **
1702  etop_max('Sto5') = 1000 ;
1703   
1704  ** No storage inflow in first period **
1705  STO_IN.fx(sto,'h1') = 0;
1706   
1707   
      ** No DSM load shifting in the first period **
               DSM_UP.fx(dsm_shift,'h1') = 0;
               DSM_DO.fx(dsm_shift,'h1',hh) = 0 ;
               DSM_DO.fx(dsm_shift,h,'h1') = 0 ;
               DSM_UP_DEMAND.fx(dsm_shift,'h1') = 0 ;
               DSM_DO_DEMAND.fx(dsm_shift,'h1') = 0 ;
       
      ** No reserves provision by DSM in first period **
               RP_DSM_SHIFT.fx(reserves,dsm_shift,'h1') = 0;
               RP_DSM_CU.fx('SR_up',dsm_curt,'h1') = 0 ;
               RP_DSM_CU.fx('MR_up',dsm_curt,'h1') = 0 ;
       
      ** No provision of PR and negative reserves by DSM load curtailment **
               RP_DSM_CU.fx('PR_up',dsm_curt,h) = 0 ;
               RP_DSM_CU.fx('PR_do',dsm_curt,h) = 0 ;
               RP_DSM_CU.fx('SR_do',dsm_curt,h) = 0 ;
               RP_DSM_CU.fx('MR_do',dsm_curt,h) = 0 ;
       
      ** No provision of PR by DSM load shifting **
               RP_DSM_SHIFT.fx('PR_up',dsm_shift,h) = 0 ;
               RP_DSM_SHIFT.fx('PR_do',dsm_shift,h) = 0 ;
      $ontext
1732   
1733   
1734  * Default level zero for report parameters
1735  lev_Z(scen) = 0 ;
1736  lev_G_L(scen,ct,h) = 0 ;
1737  lev_G_UP(scen,ct,h) = 0 ;
1738  lev_G_DO(scen,ct,h) = 0 ;
1739  lev_G_RES(scen,res,h) = 0 ;
1740  lev_CU(scen,res,h) = 0 ;
1741  lev_STO_IN(scen,sto,h) = 0 ;
1742  lev_STO_OUT(scen,sto,h) = 0 ;
1743  lev_STO_L(scen,sto,h) = 0 ;
1744  lev_N_CON(scen,ct) = 0 ;
1745  lev_N_RES(scen,res) = 0 ;
1746  lev_N_STO_E(scen,sto) = 0 ;
1747  lev_N_STO_P(scen,sto) = 0 ;
1748   
      lev_EV_CHARGE(scen,ev,h) = 0 ;
      lev_EV_DISCHARGE(scen,ev,h) = 0 ;
      lev_EV_L(scen,ev,h) = 0 ;
      lev_EV_PHEVFUEL(scen,ev,h) = 0 ;
      lev_EV_GED(scen,ev,h) = 0 ;
      $ontext
1757   
      lev_DSM_CU(scen,dsm_curt,h) = 0 ;
      lev_DSM_UP(scen,dsm_shift,h) = 0 ;
      lev_DSM_DO(scen,dsm_shift,h,hh) = 0 ;
      lev_DSM_UP_DEMAND(scen,dsm_shift,h) = 0 ;
      lev_DSM_DO_DEMAND(scen,dsm_shift,h) = 0 ;
      lev_N_DSM_CU(scen,dsm_curt) = 0 ;
      lev_N_DSM_SHIFT(scen,dsm_shift) = 0 ;
      $ontext
1768   
      lev_RP_CON(scen,reserves,ct,h) = 0 ;
      lev_RP_RES(scen,reserves,res,h) = 0 ;
      lev_RP_STO_IN(scen,reserves,sto,h) = 0 ;
      lev_RP_STO_OUT(scen,reserves,sto,h) = 0 ;
      $ontext
1776   
      %reserves%$ontext
      lev_RP_EV_V2G(scen,reserves,ev,h) = 0 ;
      lev_RP_EV_G2V(scen,reserves,ev,h) = 0 ;
      $ontext
1783   
      %reserves%$ontext
      lev_RP_DSM_CU(scen,reserves,dsm_curt,h) = 0 ;
      lev_RP_DSM_SHIFT(scen,reserves,dsm_shift,h) = 0 ;
      $ontext
      $ontext
1791   
1792  *$ontext
1793  lev_CU_PRO(scen,res,h) = 0 ;
1794  lev_G_MARKET_PRO2M(scen,res,h) = 0  ;
1795  lev_G_MARKET_M2PRO(scen,h) = 0  ;
1796  lev_G_RES_PRO(scen,res,h) = 0  ;
1797  lev_STO_IN_PRO2PRO(scen,res,sto,h) = 0  ;
1798  lev_STO_IN_PRO2M(scen,res,sto,h) = 0  ;
1799  lev_STO_IN_M2PRO(scen,sto,h) = 0   ;
1800  lev_STO_IN_M2M(scen,sto,h) = 0  ;
1801  lev_STO_OUT_PRO2PRO(scen,sto,h) = 0  ;
1802  lev_STO_OUT_PRO2M(scen,sto,h) = 0  ;
1803  lev_STO_OUT_M2PRO(scen,sto,h) = 0  ;
1804  lev_STO_OUT_M2M(scen,sto,h) = 0  ;
1805  lev_STO_L_PRO2PRO(scen,sto,h) = 0  ;
1806  lev_STO_L_PRO2M(scen,sto,h) = 0  ;
1807  lev_STO_L_M2PRO(scen,sto,h) = 0  ;
1808  lev_STO_L_M2M(scen,sto,h) = 0  ;
1809  lev_N_STO_E_PRO(scen,sto) = 0  ;
1810  lev_N_STO_P_PRO(scen,sto) = 0  ;
1811  lev_STO_L_PRO(scen,sto,h) = 0  ;
1812  lev_N_RES_PRO(scen,res) = 0  ;
1815   
1816   
1817  * Fixing of report parameters for run-of-river
1818  lev_N_CON(scen,'ror') = 4200 ;
1819  lev_G_L(scen,'ror',h) = lev_N_CON(scen,'ror')*phi_ror(h) ;
      %ror_variable%lev_RP_CON(scen,reserves,'ror',h) = 0 ;
      $ontext
1824  *lev_N_CON(scen,'ror') = 0 ;
1825  *lev_G_L(scen,'ror',h) = 0 ;
1826  *lev_G_UP(scen,'ror',h) = 0 ;
1827  *lev_G_DO(scen,'ror',h) = 0 ;
      %ror_parameter%%ror_variable%lev_RP_CON(scen,reserves,'ror',h) = 0 ;
      $ontext
1832   
1833   
1834   
1835   
1836   
1837   
1838   
1839   
1840   
1841   
INCLUDE    C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\scenario.gms
1843   
1844  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.2.0, February 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
1854  **************************************************************************
      ******
1855   
1856  *****************************************
1857  **** Scenario file                   ****
1858  ****                                 ****
1859  *****************************************
1860   
1861  ** Conventionals in scenario 2035 **
1862  N_CON.fx('bio') = 8400;
1863  N_CON.fx('lig') = 9100;
1864  N_CON.fx('hc') = 11000;
1865  N_CON.fx('CCGT') = 40700/2 ;
1866  N_CON.fx('OCGT_eff') = 0;
1867  N_CON.fx('OCGT_ineff') = 40700/2 ;
1868  N_STO_P.lo('Sto5') = 6400 ;
1869  N_STO_E.lo('Sto5') = 6400*7 ;
1870   
1871  lev_N_CON(scen,'bio') = 8400;
1872  lev_N_CON(scen,'lig') = 9100;
1873  lev_N_CON(scen,'hc') = 11000;
1874  lev_N_CON(scen,'CCGT') = 40700/2 ;
1875  lev_N_CON(scen,'OCGT_eff') = 0;
1876  lev_N_CON(scen,'OCGT_ineff') = 40700/2 ;
1877   
1878   
1879  Parameter
1880  phi_pro_pv
1881  ;
1882   
1883  phi_pro_pv = 0.25 ;
1884   
1885  ** Renewables in scenario 2035 **
1886  N_RES.fx('Wind_on') = 88800 ;
1887  N_RES.fx('Wind_off') = 18500 ;
1888  N_RES.fx('Solar') = 59900*(1-phi_pro_pv) ;
1889   
1890  lev_N_RES(scen,'Wind_on') = 88800 ;
1891  lev_N_RES(scen,'Wind_off') = 18500 ;
1892  lev_N_RES(scen,'Solar') = 59900*(1-phi_pro_pv) ;
1893   
1894  *$ontext
1895  N_RES_PRO.fx('Wind_on') = 0 ;
1896  N_RES_PRO.fx('Wind_off') = 0 ;
1897  N_RES_PRO.fx('Solar') = 59900*phi_pro_pv ;
1898   
1899  lev_N_RES_PRO(scen,'Wind_on') = 0 ;
1900  lev_N_RES_PRO(scen,'Wind_off') = 0 ;
1901  lev_N_RES_PRO(scen,'Solar') = 59900*phi_pro_pv ;
1902   
1903  phi_pro_load = 0.95 * N_RES_PRO.l('Solar')*sum(h,phi_res('Solar',h))/sum(h
      ,d_y('2013',h)) ;
1904   
1905   
1906  ** Prosumage cases **
1907   
1908  *STO_IN_PRO2M.fx(res,sto,h) = 0 ;
1909  *STO_OUT_PRO2M.fx(sto,h) = 0 ;
1910   
1911  *STO_IN_M2PRO.fx(sto,h) = 0 ;
1912  *STO_OUT_M2PRO.fx(sto,h) = 0 ;
1913   
1914  *STO_IN_M2M.fx(sto,h) = 0 ;
1915  *STO_OUT_M2M.fx(sto,h) = 0 ;
1916   
1919   
1920   
1921   
1922   
1923  * Definition of dictionary set for GUSS tool
1924  Set dict(*,*,*) /
1925  scen             .scenario       .''
1926  gussoptions      .opt            .modstats
1927   
1928  phi_min_res      .param          .min_res
      ev_quant         .param          .number_ev
      $ontext
1933  *$ontext
1934  phi_pro_self     .param          .pro_selfcon
1937   
1938  con5a_minRES    .marginal       .marginal_con5a
1939  con1a_bal       .marginal       .marginal_con1a
1940   
1941  Z                .level          .lev_Z
1942  G_L              .level          .lev_G_L
1943  G_DO             .level          .lev_G_DO
1944  G_RES            .level          .lev_G_RES
1945  CU               .level          .lev_CU
1946  STO_IN           .level          .lev_STO_IN
1947  STO_OUT          .level          .lev_STO_OUT
1948  STO_L            .level          .lev_STO_L
1949  N_CON            .level          .lev_N_CON
1950  N_RES            .level          .lev_N_RES
1951  N_STO_E          .level          .lev_N_STO_E
1952  N_STO_P          .level          .lev_N_STO_P
1953   
      EV_CHARGE        .level          .lev_EV_CHARGE
      EV_DISCHARGE     .level          .lev_EV_DISCHARGE
      EV_L             .level          .lev_EV_L
      EV_PHEVFUEL      .level          .lev_EV_PHEVFUEL
      EV_GED           .level          .lev_EV_GED
      $ontext
1962   
      DSM_CU           .level          .lev_DSM_CU
      DSM_UP           .level          .lev_DSM_UP
      DSM_DO           .level          .lev_DSM_DO
      DSM_UP_DEMAND    .level          .lev_DSM_UP_DEMAND
      DSM_DO_DEMAND    .level          .lev_DSM_DO_DEMAND
      N_DSM_CU         .level          .lev_N_DSM_CU
      N_DSM_SHIFT      .level          .lev_N_DSM_SHIFT
      $ontext
1973   
      RP_CON           .level          .lev_RP_CON
      RP_RES           .level          .lev_RP_RES
      RP_STO_IN        .level          .lev_RP_STO_IN
      RP_STO_OUT       .level          .lev_RP_STO_OUT
      $ontext
1981   
      %EV%$ontext
      %EV_EXOG% RP_EV_V2G        .level          .lev_RP_EV_V2G
      %EV_EXOG% RP_EV_G2V        .level          .lev_RP_EV_G2V
      $ontext
1988   
      %DSM%$ontext
      RP_DSM_CU        .level          .lev_RP_DSM_CU
      RP_DSM_SHIFT     .level          .lev_RP_DSM_SHIFT
      $ontext
1995   
1996  *$ontext
1997  CU_PRO           .level           .lev_CU_PRO
1998  G_MARKET_PRO2M   .level           .lev_G_MARKET_PRO2M
1999  G_MARKET_M2PRO   .level           .lev_G_MARKET_M2PRO
2000  G_RES_PRO        .level           .lev_G_RES_PRO
2001  STO_IN_PRO2PRO   .level           .lev_STO_IN_PRO2PRO
2002  STO_IN_PRO2M     .level           .lev_STO_IN_PRO2M
2003  STO_IN_M2PRO     .level           .lev_STO_IN_M2PRO
2004  STO_IN_M2M       .level           .lev_STO_IN_M2M
2005  STO_OUT_PRO2PRO  .level           .lev_STO_OUT_PRO2PRO
2006  STO_OUT_PRO2M    .level           .lev_STO_OUT_PRO2M
2007  STO_OUT_M2PRO    .level           .lev_STO_OUT_M2PRO
2008  STO_OUT_M2M      .level           .lev_STO_OUT_M2M
2009  STO_L_PRO        .level           .lev_STO_L_PRO
2010  STO_L_PRO2PRO    .level           .lev_STO_L_PRO2PRO
2011  STO_L_PRO2M      .level           .lev_STO_L_PRO2M
2012  STO_L_M2PRO      .level           .lev_STO_L_M2PRO
2013  STO_L_M2M        .level           .lev_STO_L_M2M
2014  N_STO_E_PRO      .level           .lev_N_STO_E_PRO
2015  N_STO_P_PRO      .level           .lev_N_STO_P_PRO
2016  N_RES_PRO        .level           .lev_N_RES_PRO
2019  /
2020  ;
2021   
2022  solve DIETER using lp min Z scenario dict;
2023   
2024  *$stop
2025  * Reporting
INCLUDE    C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\report.gms
2027   
2028  **************************************************************************
      ******
      The Dispatch and Investment Evaluation Tool with Endogenous Renewables (DI
      ETER).
      Version 1.2.0, February 2017.
      Written by Alexander Zerrahn and Wolf-Peter Schill. Moritz Niemeyer contri
      buted to electric vehicle modeling.
      This work is licensed under the MIT License (MIT).
      For more information on this license, visit http://opensource.org/licenses
      /mit-license.php.
      Whenever you use this code, please refer to http://www.diw.de/dieter.
      We are happy to receive feedback under azerrahn@diw.de and wschill@diw.de.
2038  **************************************************************************
      ******
2039   
2041   
2042   
2043  * Parameters for the report file
2044  parameter
2045  corr_fac_con
2046  corr_fac_res
2047  corr_fac_sto
2048  corr_fac_dsm_cu
2049  corr_fac_dsm_shift
2050  corr_fac_ev
2051   
2052  gross_energy_demand
2053  gross_energy_demand_market
2054  gross_energy_demand_prosumers
2055  gross_energy_demand_prosumers_selfgen
2056  gross_energy_demand_prosumers_market
2057   
2058  calc_maxprice
2059  calc_minprice
2060   
2061  report
2062  report_tech
2063  report_tech_hours
2064  report_hours
2065   
2066   
2067  report_reserves
2068  report_reserves_hours
2069  report_reserves_tech
2070  report_reserves_tech_hours
2073   
2074  *$ontext
2075  report_prosumage
2076  report_prosumage_tech
2077  report_prosumage_tech_hours
2078  report_market
2079  report_market_tech
2080  report_market_tech_hours
2083  ;
2084   
2085   
2086  * Min and max for prices
2087  calc_maxprice = 0 ;
2088  calc_minprice = 1000 ;
2089   
2090   
2091  * Default values for correction factors
2092  corr_fac_con(scen,ct,h) = 0 ;
2093  corr_fac_res(scen,res,h) = 0 ;
2094  corr_fac_sto(scen,sto,h) = 0 ;
2095  corr_fac_dsm_cu(scen,dsm_curt,h) = 0 ;
2096  corr_fac_dsm_shift(scen,dsm_shift,h) = 0 ;
2097  corr_fac_ev(scen,h) = 0 ;
2098   
2099   
2100  * Define gross energy demand for reporting, egual to equation 5a
2101  gross_energy_demand(scen) = sum( h , d(h) + sum( sto , lev_STO_IN(scen,sto
      ,h) - lev_STO_OUT(scen,sto,h) )
2102  *$ontext
2103           + sum( (sto) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h) + le
      v_STO_IN_PRO2M(scen,res,sto,h) ) + lev_STO_IN_M2PRO(scen,sto,h) + lev_STO_
      IN_M2M(scen,sto,h) - lev_STO_OUT_PRO2PRO(scen,sto,h) - lev_STO_OUT_PRO2M(s
      cen,sto,h) - lev_STO_OUT_M2PRO(scen,sto,h) - lev_STO_OUT_M2M(scen,sto,h) )
               - sum( dsm_curt , lev_DSM_CU(scen,dsm_curt,h) )
               + sum( dsm_shift , lev_DSM_UP(scen,dsm_shift,h) - sum( hh$( ord(h
      h) >= ord(h) - t_dur_dsm_shift(dsm_shift) AND ord(hh) <= ord(h) + t_dur_ds
      m_shift(dsm_shift) ) , lev_DSM_DO(scen,dsm_shift,h,hh)) )
      $ontext
               + sum( ev , lev_EV_CHARGE(scen,ev,h) - lev_EV_DISCHARGE(scen,ev,h
      ) )
      $ontext
              + phi_mean_reserves_call('PR_up') * phi_reserves_pr* sum( reserves
      $( ord(reserves) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_in
      tercept(reserves) + sum( res , reserves_slope(reserves,res) * (lev_N_RES(s
      cen,res) + lev_N_RES_PRO(scen,res))/1000 )) )
              + phi_mean_reserves_call('SR_up') *( 1000 * phi_reserves_share('SR
      _up') * (reserves_intercept('SR_up') + sum( res , reserves_slope('SR_up',r
      es) * (lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res))/1000)) )
              + phi_mean_reserves_call('MR_up') *( 1000 * phi_reserves_share('MR
      _up') * (reserves_intercept('MR_up') + sum( res , reserves_slope('MR_up',r
      es) * (lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res))/1000)) )
              - phi_mean_reserves_call('PR_do') * phi_reserves_pr* sum( reserves
      $( ord(reserves) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_in
      tercept(reserves) + sum( res , reserves_slope(reserves,res) * (lev_N_RES(s
      cen,res) + lev_N_RES_PRO(scen,res))/1000)) )
              - phi_mean_reserves_call('SR_do') *( 1000 * phi_reserves_share('SR
      _do') * (reserves_intercept('SR_do') + sum( res , reserves_slope('SR_do',r
      es) * (lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res))/1000)) )
              - phi_mean_reserves_call('MR_do') *( 1000 * phi_reserves_share('MR
      _do') * (reserves_intercept('MR_do') + sum( res , reserves_slope('MR_do',r
      es) * (lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res))/1000)) )
       
             + sum( sto ,
                 sum( reserves_do , phi_reserves_call(reserves_do,h) * ( lev_RP_
      STO_IN(scen,reserves_do,sto,h) + lev_RP_STO_OUT(scen,reserves_do,sto,h)))
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * ( lev_RP_
      STO_IN(scen,reserves_up,sto,h) + lev_RP_STO_OUT(scen,reserves_up,sto,h))))
      $ontext
      %reserves%$ontext
             - sum( (dsm_curt,reserves_up) , lev_RP_DSM_CU(scen,reserves_up,dsm_
      curt,h) * phi_reserves_call(reserves_up,h) )
      $ontext
      %EV%$ontext
             + sum( ev ,
                 sum( reserves_do , phi_reserves_call(reserves_do,h) * (lev_RP_E
      V_G2V(scen,reserves_do,ev,h) + lev_RP_EV_V2G(scen,reserves_do,ev,h)))
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * (lev_RP_E
      V_G2V(scen,reserves_up,ev,h) + lev_RP_EV_V2G(scen,reserves_up,ev,h))) )
      $ontext
2140  )
2141  ;
2142   
2143   
2144  * Prepare prosumage reporting parameters
2145  *$ontext
2146  gross_energy_demand_prosumers(scen) = sum( h , phi_pro_load * d(h));
2147  gross_energy_demand_prosumers_selfgen(scen) = sum( (h,res) , lev_G_RES_PRO
      (scen,res,h)) + sum( (sto,h) , lev_STO_OUT_PRO2PRO(scen,sto,h) ) ;
2148  gross_energy_demand_prosumers_market(scen) = sum( h , lev_G_MARKET_M2PRO(s
      cen,h)) + sum( (sto,h) , lev_STO_OUT_M2PRO(scen,sto,h) ) ;
2149  gross_energy_demand_market(scen) = gross_energy_demand(scen) - gross_energ
      y_demand_prosumers_selfgen(scen) ;
2152   
2153  * Parameters
2154  * lev_CU_PRO(superscen,res,h)
2155  * lev_G_MARKET_PRO2M(superscen,res,h)
2156  * lev_G_MARKET_M2PRO(superscen,h)
2157  * lev_G_RES_PRO(superscen,res,h)
2158  * lev_STO_IN_PRO2PRO(superscen,res,sto,h)
2159  * lev_STO_IN_PRO2M(superscen,res,sto,h)
2160  * lev_STO_IN_M2PRO(superscen,sto,h)
2161  * lev_STO_IN_M2M(superscen,sto,h)
2162  * lev_STO_OUT_PRO2PRO(superscen,sto,h)
2163  * lev_STO_OUT_PRO2M(superscen,sto,h)
2164  * lev_STO_OUT_M2PRO(superscen,sto,h)
2165  * lev_STO_OUT_M2M(superscen,sto,h)
2166  * lev_STO_L_PRO2PRO(superscen,sto,h)
2167  * lev_STO_L_PRO2M(superscen,sto,h)
2168  * lev_STO_L_M2PRO(superscen,sto,h)
2169  * lev_STO_L_M2M(superscen,sto,h)
2170  * lev_N_STO_E_PRO(superscen,sto)
2171  * lev_N_STO_P_PRO(superscen,sto)
2172  * lev_STO_L_PRO(superscen,sto,h)
2173  * lev_N_RES_PRO(superscen,res)
2174  ;
2175   
2176  * lev_CU_PRO(superscen,res,h) = 0 ;
2177  * lev_G_MARKET_PRO2M(superscen,res,h) = 0 ;
2178  * lev_G_MARKET_M2PRO(superscen,h) = 0 ;
2179  * lev_G_RES_PRO(superscen,res,h) = 0 ;
2180  * lev_STO_IN_PRO2PRO(superscen,res,sto,h) = 0 ;
2181  * lev_STO_IN_PRO2M(superscen,res,sto,h) = 0 ;
2182  * lev_STO_IN_M2PRO(superscen,sto,h) = 0 ;
2183  * lev_STO_IN_M2M(superscen,sto,h) = 0 ;
2184  * lev_STO_OUT_PRO2PRO(superscen,sto,h) = 0 ;
2185  * lev_STO_OUT_PRO2M(superscen,sto,h) = 0 ;
2186  * lev_STO_OUT_M2PRO(superscen,sto,h) = 0 ;
2187  * lev_STO_OUT_M2M(superscen,sto,h) = 0 ;
2188  * lev_STO_L_PRO2PRO(superscen,sto,h) = 0 ;
2189  * lev_STO_L_PRO2M(superscen,sto,h) = 0 ;
2190  * lev_STO_L_M2PRO(superscen,sto,h) = 0 ;
2191  * lev_STO_L_M2M(superscen,sto,h) = 0 ;
2192  * lev_N_STO_E_PRO(superscen,sto) = 0 ;
2193  * lev_N_STO_P_PRO(superscen,sto) = 0 ;
2194  * lev_STO_L_PRO(superscen,sto,h) = 0 ;
2195  * lev_N_RES_PRO(superscen,res) = 0 ;
2196   
2197   
2198  * Determine correction factors
              corr_fac_con(scen,ct,h) =
                sum( reserves_do ,  lev_RP_CON(scen,reserves_do,ct,h) * phi_rese
      rves_call(reserves_do,h))
              - sum( reserves_up ,  lev_RP_CON(scen,reserves_up,ct,h) * phi_rese
      rves_call(reserves_up,h))
      ;
              corr_fac_res(scen,res,h) =
                sum( reserves_do ,  lev_RP_RES(scen,reserves_do,res,h) * phi_res
      erves_call(reserves_do,h))
              - sum( reserves_up ,  lev_RP_RES(scen,reserves_up,res,h) * phi_res
      erves_call(reserves_up,h))
      ;
              corr_fac_sto(scen,sto,h) =
                 sum( reserves_do , phi_reserves_call(reserves_do,h) * ( lev_RP_
      STO_IN(scen,reserves_do,sto,h) + lev_RP_STO_OUT(scen,reserves_do,sto,h)) )
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * ( lev_RP_
      STO_IN(scen,reserves_up,sto,h) + lev_RP_STO_OUT(scen,reserves_up,sto,h)) )
      ;
      %DSM%$ontext
              corr_fac_dsm_cu(scen,dsm_curt,h) =
             - sum( reserves_up , lev_RP_DSM_CU(scen,reserves_up,dsm_curt,h) * p
      hi_reserves_call(reserves_up,h) )
      ;
              corr_fac_dsm_shift(scen,dsm_shift,h) =
                sum( reserves_do ,  lev_RP_DSM_SHIFT(scen,reserves_do,dsm_shift,
      h) * phi_reserves_call(reserves_do,h))
              - sum( reserves_up ,  lev_RP_DSM_SHIFT(scen,reserves_up,dsm_shift,
      h) * phi_reserves_call(reserves_up,h))
      ;
      $ontext
      %reserves%$ontext
               corr_fac_ev(scen,h) = sum( ev ,
               + sum( reserves_do , phi_reserves_call(reserves_do,h) * (lev_RP_E
      V_G2V(scen,reserves_do,ev,h) + lev_RP_EV_V2G(scen,reserves_do,ev,h)))
               - sum( reserves_up , phi_reserves_call(reserves_up,h) * (lev_RP_E
      V_G2V(scen,reserves_up,ev,h) + lev_RP_EV_V2G(scen,reserves_up,ev,h))) )
      ;
      $ontext
2230   
2231  * ------------------------------------------------------------------------
      ----
2232   
2233  * Report parameter RPEORT
2234          report('model status',loop_res_share,loop_ev,loop_prosumage) = sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen, '
      modelstat')) ;
2235          report('solve time',loop_res_share,loop_ev,loop_prosumage) = sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , modstats(scen, 're
      susd')) ;
2236          report('obj value',loop_res_share,loop_ev,loop_prosumage) = sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_Z(scen) * 1) ;
2237          report('curtailment of fluct res absolute',loop_res_share,loop_ev,
      loop_prosumage) = sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU(scen,res,h))) * 1 ;
2238          report('curtailment of fluct res relative',loop_res_share,loop_ev,
      loop_prosumage)$(sum((res,h), sum(scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , phi_res(res,h) * (lev_N_RES(scen,res) + lev_N_RES_PRO(sce
      n,res)) )) > eps_rep_abs*card(res)*card(h)) = sum((res,h), sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev
      _CU(scen,res,h))) * 1 / sum((res,h), sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , phi_res(res,h) * (lev_N_RES(scen,res) + lev_N_RES_
      PRO(scen,res)) )) ;
2239          report('bio not utilized absolute',loop_res_share,loop_ev,loop_pro
      sumage)$(m_con_e('bio')) = (m_con_e('bio') - sum(h, sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,'bio',h)))) * 1 ;
2240          report('bio not utilized relative',loop_res_share,loop_ev,loop_pro
      sumage)$(m_con_e('bio')) = (m_con_e('bio') - sum(h, sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,'bio',h)))) / m_con_e(
      'bio') ;
2241          report('max price',loop_res_share,loop_ev,loop_prosumage) = max( c
      alc_maxprice , smax( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , - marginal_con1a(scen,h))) ) ;
2242          report('min price',loop_res_share,loop_ev,loop_prosumage) = min( c
      alc_minprice , smin( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , - marginal_con1a(scen,h))) ) ;
2243          report('mean price',loop_res_share,loop_ev,loop_prosumage) = -sum(
      h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_c
      on1a(scen,h)))/card(h) ;
2244          report('Capacity total',loop_res_share,loop_ev,loop_prosumage) = s
      um( ct , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      N_CON(scen,ct)) ) + sum( res , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res) )) + sum( 
      sto , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_S
      TO_P(scen,sto) + lev_N_STO_P_PRO(Scen,sto) ))
              + sum( dsm_curt , sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_N_DSM_CU(scen,dsm_curt)) ) + sum( dsm_shift , sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_SHIFT(scen,dsm
      _shift)) )
      $ontext
2249  ;
2250                   report('curtailment of fluct res absolute',loop_res_share
      ,loop_ev,loop_prosumage)$(report('curtailment of fluct res absolute',loop_
      res_share,loop_ev,loop_prosumage) < eps_rep_abs*card(h)*1) = 0 ;
2251                   report('curtailment of fluct res relative',loop_res_share
      ,loop_ev,loop_prosumage)$(report('curtailment of fluct res relative',loop_
      res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2252                   report('bio not utilized absolute',loop_res_share,loop_ev
      ,loop_prosumage)$(report('bio not utilized absolute',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_abs*card(h)*1) = 0 ;
2253                   report('bio not utilized relative',loop_res_share,loop_ev
      ,loop_prosumage)$(report('bio not utilized relative',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_rel) = 0 ;
2254                   report('min price',loop_res_share,loop_ev,loop_prosumage)
      $(report('min price',loop_res_share,loop_ev,loop_prosumage) < eps_rep_abs 
      AND report('min price',loop_res_share,loop_ev,loop_prosumage) > -eps_rep_a
      bs) = eps ;
2255   
2256  * ------------------------------------------------------------------------
      ----
2257   
2258  *$exit
2259  * Report parameter REPORT HOURS
2260          report_hours('demand',loop_res_share,loop_ev,loop_prosumage,h) = d
      (h) ;
2261          report_hours('price',loop_res_share,loop_ev,loop_prosumage,h) = -s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con1a
      (scen,h)) ;
2262  *$ontext
2263          report_hours('demand prosumers',loop_res_share,loop_ev,loop_prosum
      age,h) = phi_pro_load * d(h) ;
2264          report_hours('demand market',loop_res_share,loop_ev,loop_prosumage
      ,h) = (1 - phi_pro_load) * d(h) ;
2267  ;
2268                   report_hours('demand',loop_res_share,loop_ev,loop_prosuma
      ge,h)$(report_hours('demand',loop_res_share,loop_ev,loop_prosumage,h) < ep
      s_rep_abs) = 0 ;
2269                   report_hours('price',loop_res_share,loop_ev,loop_prosumag
      e,h)$(report_hours('price',loop_res_share,loop_ev,loop_prosumage,h) < eps_
      rep_abs AND report_hours('price',loop_res_share,loop_ev,loop_prosumage,h) 
      > -eps_rep_abs) = eps ;
2270  *$ontext
2271                   report_hours('demand prosumers',loop_res_share,loop_ev,lo
      op_prosumage,h)$(report_hours('demand prosumers',loop_res_share,loop_ev,lo
      op_prosumage,h) < eps_rep_abs) = 0 ;
2272                   report_hours('demand market',loop_res_share,loop_ev,loop_
      prosumage,h)$(report_hours('demand market',loop_res_share,loop_ev,loop_pro
      sumage,h) < eps_rep_abs) = 0 ;
2275   
2276  * ------------------------------------------------------------------------
      ----
2277   
2278  *$exit
2279  * Report parameter REPORT TECH
2280          report_tech('capacities conventional',loop_res_share,loop_ev,loop_
      prosumage,ct_the) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_N_CON(scen,ct_the)) ;
2281          report_tech('capacities renewable',loop_res_share,loop_ev,loop_pro
      sumage,ct_ren) = 0 + sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_N_CON(scen,ct_ren)) ;
2282          report_tech('capacities renewable',loop_res_share,loop_ev,loop_pro
      sumage,res) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res));
2283          report_tech('capacities storage MW',loop_res_share,loop_ev,loop_pr
      osumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_N_STO_P(scen,sto)+ lev_N_STO_P_PRO(scen,sto)) ;
2284          report_tech('capacities storage MWh',loop_res_share,loop_ev,loop_p
      rosumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_N_STO_E(scen,sto)+ lev_N_STO_E_PRO(scen,sto)) * 1 ;
2285          report('gross energy demand',loop_res_share,loop_ev,loop_prosumage
      ) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_en
      ergy_demand(scen)) ;
2286  *$ontext
2287          report('gross energy demand market',loop_res_share,loop_ev,loop_pr
      osumage) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , g
      ross_energy_demand_market(scen)) ;
2288          report('gross energy demand prosumers self generation',loop_res_sh
      are,loop_ev,loop_prosumage) = sum( scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2291          report_tech('renshares',loop_res_share,loop_ev,loop_prosumage,ct_r
      en) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_G_L(scen,ct_ren,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , gross_energy_demand(scen) ) ;
2292          report_tech('renshares',loop_res_share,loop_ev,loop_prosumage,res)
       = sum( h, sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES_PRO(scen,res,h) + sum( sto , lev
      _STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES(scen,res,h) - corr_fac_res(sc
      en,res,h)))/ sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       gross_energy_demand(scen) );
2293          report('renshare total',loop_res_share,loop_ev,loop_prosumage) = s
      um(res, report_tech('renshares',loop_res_share,loop_ev,loop_prosumage,res)
      ) + sum(ct_ren,report_tech('renshares',loop_res_share,loop_ev,loop_prosuma
      ge,ct_ren)) ;
2294          report_tech('conshares',loop_res_share,loop_ev,loop_prosumage,ct_t
      he) = sum( h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_G_L(scen,ct_the,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , gross_energy_demand(scen) ) ;
2295          report('conshare total',loop_res_share,loop_ev,loop_prosumage) = s
      um(ct_the, report_tech('conshares',loop_res_share,loop_ev,loop_prosumage,c
      t_the) ) ;
2296   
2297          report_tech('curtailment of fluct res absolute',loop_res_share,loo
      p_ev,loop_prosumage,res) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_
      ev,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) )) * 1 ;
2298          report_tech('curtailment of fluct res relative',loop_res_share,loo
      p_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res absolute',
      loop_res_share,loop_ev,loop_prosumage,res) AND sum(h, sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) + lev_G
      _RES(scen,res,h) - corr_fac_res(scen,res,h)) ) + sum(h, sum(scen$(map(scen
      ,loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) + lev_CU
      (scen,res,h))) > card(h)*eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,r
      es,h) ))/( sum(h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , phi_res(res,h)*(lev_N_RES(scen,res) + lev_N_RES_PRO(scen,res) ))) ) 
      ;
2299   
2300                   report_tech('capacities conventional',loop_res_share,loop
      _ev,loop_prosumage,ct_the)$(report_tech('capacities conventional',loop_res
      _share,loop_ev,loop_prosumage,ct_the) < eps_rep_ins) = 0 ;
2301                   report_tech('capacities renewable',loop_res_share,loop_ev
      ,loop_prosumage,ct_ren)$(report_tech('capacities renewable',loop_res_share
      ,loop_ev,loop_prosumage,ct_ren) < eps_rep_ins) = 0 ;
2302                   report_tech('capacities renewable',loop_res_share,loop_ev
      ,loop_prosumage,res)$(report_tech('capacities renewable',loop_res_share,lo
      op_ev,loop_prosumage,res) < eps_rep_ins) = 0 ;
2303                   report_tech('capacities storage MW',loop_res_share,loop_e
      v,loop_prosumage,sto)$(report_tech('capacities storage MW',loop_res_share,
      loop_ev,loop_prosumage,sto) < eps_rep_ins) = 0 ;
2304                   report_tech('capacities storage MWh',loop_res_share,loop_
      ev,loop_prosumage,sto)$(report_tech('capacities storage MWh',loop_res_shar
      e,loop_ev,loop_prosumage,sto) < eps_rep_ins) = 0 ;
2305                   report_tech('conshares',loop_res_share,loop_ev,loop_prosu
      mage,ct)$(report_tech('conshares',loop_res_share,loop_ev,loop_prosumage,ct
      ) < eps_rep_rel) = 0 ;
2306                   report('conshare total',loop_res_share,loop_ev,loop_prosu
      mage)$(report('conshare total',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_rel) = 0 ;
2307                   report_tech('renshares',loop_res_share,loop_ev,loop_prosu
      mage,ct_ren)$(report_tech('renshares',loop_res_share,loop_ev,loop_prosumag
      e,ct_ren) < eps_rep_rel) = 0 ;
2308                   report_tech('renshares',loop_res_share,loop_ev,loop_prosu
      mage,res)$(report_tech('renshares',loop_res_share,loop_ev,loop_prosumage,r
      es) < eps_rep_rel) = 0 ;
2309                   report('renshare total',loop_res_share,loop_ev,loop_prosu
      mage)$(report('renshare total',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_rel) = 0 ;
2310                   report_tech('curtailment of fluct res absolute',loop_res_
      share,loop_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res a
      bsolute',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_abs*card(h)*
      1) = 0 ;
2311                   report_tech('curtailment of fluct res relative',loop_res_
      share,loop_ev,loop_prosumage,res)$(report_tech('curtailment of fluct res r
      elative',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_rel) = 0 ;
2312   
2313  * ------------------------------------------------------------------------
      ----
2314   
2315  *$exit
2316  * Report parameter REPORT TECH HOURS
2317   
2318          report_tech_hours('generation conventional',loop_res_share,loop_ev
      ,loop_prosumage,ct_the,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , lev_G_L(scen,ct_the,h) + corr_fac_con(scen,ct_the,h)) ;
2319          report_tech_hours('generation renewable',loop_res_share,loop_ev,lo
      op_prosumage,ct_ren,h) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_G_L(scen,ct_ren,h) + corr_fac_con(scen,ct_ren,h)) ;
2320          report_tech_hours('generation renewable',loop_res_share,loop_ev,lo
      op_prosumage,res,h) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_G_RES(scen,res,h) + lev_G_RES_PRO(scen,res,h) + lev_G_MARKET_
      PRO2M(scen,res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) ) ;
2321          report_tech_hours('curtailment of fluct res',loop_res_share,loop_e
      v,loop_prosumage,res,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_CU(scen,res,h) + lev_CU_PRO(scen,res,h) ) ;
2322          report_tech_hours('generation storage',loop_res_share,loop_ev,loop
      _prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_STO_OUT(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_STO_
      OUT_PRO2PRO(scen,sto,h) ) ;
2323          report_tech_hours('storage loading',loop_res_share,loop_ev,loop_pr
      osumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h
      )) + lev_STO_IN_M2PRO(scen,sto,h) ) ;
2324          report_tech_hours('storage level',loop_res_share,loop_ev,loop_pros
      umage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_STO_L(scen,sto,h) + lev_STO_L_PRO(scen,sto,h) ) ;
2325   
2326                   report_tech_hours('generation conventional',loop_res_shar
      e,loop_ev,loop_prosumage,ct,h)$(report_tech_hours('generation conventional
      ',loop_res_share,loop_ev,loop_prosumage,ct,h) < eps_rep_abs) = 0 ;
2327                   report_tech_hours('generation renewable',loop_res_share,l
      oop_ev,loop_prosumage,ct_ren,h)$(report_tech_hours('generation renewable',
      loop_res_share,loop_ev,loop_prosumage,ct_ren,h) < eps_rep_abs) = 0 ;
2328                   report_tech_hours('generation renewable',loop_res_share,l
      oop_ev,loop_prosumage,res,h)$(report_tech_hours('generation renewable',loo
      p_res_share,loop_ev,loop_prosumage,res,h) < eps_rep_abs) = 0 ;
2329                   report_tech_hours('curtailment of fluct res',loop_res_sha
      re,loop_ev,loop_prosumage,res,h)$(report_tech_hours('curtailment of fluct 
      res',loop_res_share,loop_ev,loop_prosumage,res,h) < eps_rep_abs) = 0 ;
2330                   report_tech_hours('generation storage',loop_res_share,loo
      p_ev,loop_prosumage,sto,h)$(report_tech_hours('generation storage',loop_re
      s_share,loop_ev,loop_prosumage,sto,h) < eps_rep_abs) = 0 ;
2331                   report_tech_hours('storage loading',loop_res_share,loop_e
      v,loop_prosumage,sto,h)$(report_tech_hours('storage loading',loop_res_shar
      e,loop_ev,loop_prosumage,sto,h) < eps_rep_abs) = 0 ;
2332                   report_tech_hours('storage level',loop_res_share,loop_ev,
      loop_prosumage,sto,h)$(report_tech_hours('storage level',loop_res_share,lo
      op_ev,loop_prosumage,sto,h) < eps_rep_abs) = 0 ;
2333   
2334   
2335  * ------------------------------------------------------------------------
      ----
2336   
2337  *$exit
2338  * Report parameter REPORT PROSUMAGE TECH HOURS
2339   
2340  *$ontext
2341          report_prosumage_tech_hours('generation prosumers',loop_res_share,
      loop_ev,loop_prosumage,res,h) = sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , phi_res(res,h) * lev_N_RES_PRO(scen,res) ) ;
2342          report_prosumage_tech_hours('curtailment of fluct res prosumers',l
      oop_res_share,loop_ev,loop_prosumage,res,h) =  sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h)) ;
2343          report_prosumage_tech_hours('generation prosumers self-consumption
      ',loop_res_share,loop_ev,loop_prosumage,res,h) = sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_G_RES_PRO(scen,res,h) ) ;
2344          report_prosumage_tech_hours('generation prosumers to market',loop_
      res_share,loop_ev,loop_prosumage,res,h) = sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) ) ;
2345          report_prosumage_tech_hours('withdrawal prosumers from market',loo
      p_res_share,loop_ev,loop_prosumage,'',h) = sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) ) ;
2346          report_prosumage_tech_hours('storage loading prosumers PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,st
      o,h))) ;
2347          report_prosumage_tech_hours('storage loading prosumers PRO2M',loop
      _res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)
      )) ;
2348          report_prosumage_tech_hours('storage loading prosumers M2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_STO_IN_M2PRO(scen,sto,h)) ;
2349          report_prosumage_tech_hours('storage loading prosumers M2M',loop_r
      es_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_STO_IN_M2M(scen,sto,h)) ;
2350          report_prosumage_tech_hours('storage generation prosumers PRO2PRO'
      ,loop_res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2PRO(scen,sto,h)) ;
2351          report_prosumage_tech_hours('storage generation prosumers PRO2M',l
      oop_res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_STO_OUT_PRO2M(scen,sto,h)) ;
2352          report_prosumage_tech_hours('storage generation prosumers M2PRO',l
      oop_res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res
      _share,loop_ev,loop_prosumage)) , lev_STO_OUT_M2PRO(scen,sto,h)) ;
2353          report_prosumage_tech_hours('storage generation prosumers M2M',loo
      p_res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_STO_OUT_M2M(scen,sto,h)) ;
2354          report_prosumage_tech_hours('storage level prosumers',loop_res_sha
      re,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_STO_L_PRO(scen,sto,h)) ;
2355          report_prosumage_tech_hours('storage level prosumers PRO2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_STO_L_PRO2PRO(scen,sto,h)) ;
2356          report_prosumage_tech_hours('storage level prosumers PRO2M',loop_r
      es_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_STO_L_PRO2M(scen,sto,h)) ;
2357          report_prosumage_tech_hours('storage level prosumers M2PRO',loop_r
      es_share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_STO_L_M2PRO(scen,sto,h)) ;
2358          report_prosumage_tech_hours('storage level prosumers M2M',loop_res
      _share,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_STO_L_M2M(scen,sto,h)) ;
2359   
2360                   report_prosumage_tech_hours('generation prosumers',loop_r
      es_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tech_hours('gener
      ation prosumers',loop_res_share,loop_ev,loop_prosumage,res,h) < eps_rep_ab
      s) = 0 ;
2361                   report_prosumage_tech_hours('curtailment of fluct res pro
      sumers',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tec
      h_hours('curtailment of fluct res prosumers',loop_res_share,loop_ev,loop_p
      rosumage,res,h) < eps_rep_abs) = 0 ;
2362                   report_prosumage_tech_hours('generation prosumers self-co
      nsumption',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_
      tech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,
      loop_prosumage,res,h) < eps_rep_abs) = 0 ;
2363                   report_prosumage_tech_hours('generation prosumers to mark
      et',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_prosumage_tech_ho
      urs('generation prosumers to market',loop_res_share,loop_ev,loop_prosumage
      ,res,h) < eps_rep_abs) = 0 ;
2364                   report_prosumage_tech_hours('withdrawal prosumers from ma
      rket',loop_res_share,loop_ev,loop_prosumage,'',h)$(report_prosumage_tech_h
      ours('withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosum
      age,'',h) < eps_rep_abs) = 0 ;
2365                   report_prosumage_tech_hours('storage loading prosumers PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech
      _hours('storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto,h) < eps_rep_abs) = 0 ;
2366                   report_prosumage_tech_hours('storage loading prosumers PR
      O2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h) < eps_rep_abs) = 0 ;
2367                   report_prosumage_tech_hours('storage loading prosumers M2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h) < eps_rep_abs) = 0 ;
2368                   report_prosumage_tech_hours('storage loading prosumers M2
      M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,s
      to,h) < eps_rep_abs) = 0 ;
2369                   report_prosumage_tech_hours('storage generation prosumers
       PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_t
      ech_hours('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,lo
      op_prosumage,sto,h) < eps_rep_abs) = 0 ;
2370                   report_prosumage_tech_hours('storage generation prosumers
       PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tec
      h_hours('storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_p
      rosumage,sto,h) < eps_rep_abs) = 0 ;
2371                   report_prosumage_tech_hours('storage generation prosumers
       M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tec
      h_hours('storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_p
      rosumage,sto,h) < eps_rep_abs) = 0 ;
2372                   report_prosumage_tech_hours('storage generation prosumers
       M2M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_
      hours('storage generation prosumers M2M',loop_res_share,loop_ev,loop_prosu
      mage,sto,h) < eps_rep_abs) = 0 ;
2373                   report_prosumage_tech_hours('storage level prosumers',loo
      p_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hours('st
      orage level prosumers',loop_res_share,loop_ev,loop_prosumage,sto,h) < eps_
      rep_abs) = 0 ;
2374                   report_prosumage_tech_hours('storage level prosumers PRO2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_h
      ours('storage level prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto,h) < eps_rep_abs) = 0 ;
2375                   report_prosumage_tech_hours('storage level prosumers PRO2
      M',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage level prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,s
      to,h) < eps_rep_abs) = 0 ;
2376                   report_prosumage_tech_hours('storage level prosumers M2PR
      O',loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hou
      rs('storage level prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,s
      to,h) < eps_rep_abs) = 0 ;
2377                   report_prosumage_tech_hours('storage level prosumers M2M'
      ,loop_res_share,loop_ev,loop_prosumage,sto,h)$(report_prosumage_tech_hours
      ('storage level prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h
      ) < eps_rep_abs) = 0 ;
2378   
2379   
2380  * ------------------------------------------------------------------------
      ----
2381   
2382  *$exit
2383  * Report parameter REPORT PROSUMAGE TECH
2384   
2385          report_prosumage_tech('capacities renewable prosumers',loop_res_sh
      are,loop_ev,loop_prosumage,res) =  sum( scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_N_RES_PRO(scen,res) ) ;
2386          report_prosumage_tech('capacities storage MW prosumers',loop_res_s
      hare,loop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ;
2387          report_prosumage_tech('capacities storage MWh prosumers',loop_res_
      share,loop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)) * 1 ;        report_pr
      osumage_tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,l
      oop_prosumage,sto) = sum( h, report_prosumage_tech_hours('storage loading 
      prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto,h)) ;
2388          report_prosumage_tech('Storage in total prosumers PRO2PRO',loop_re
      s_share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours(
      'storage loading prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,
      sto,h));
2389          report_prosumage_tech('Storage in total prosumers PRO2M',loop_res_
      share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours('s
      torage loading prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto,
      h));
2390          report_prosumage_tech('Storage in total prosumers M2PRO',loop_res_
      share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours('s
      torage loading prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto,
      h));
2391          report_prosumage_tech('Storage in total prosumers M2M',loop_res_sh
      are,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours('sto
      rage loading prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto,h));
2392          report_prosumage_tech('Storage out total prosumers PRO2PRO',loop_r
      es_share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours
      ('storage generation prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosum
      age,sto,h)) ;
2393          report_prosumage_tech('Storage out total prosumers PRO2M',loop_res
      _share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours('
      storage generation prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,
      sto,h)) ;
2394          report_prosumage_tech('Storage out total prosumers M2PRO',loop_res
      _share,loop_ev,loop_prosumage,sto) = sum( h, report_prosumage_tech_hours('
      storage generation prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,
      sto,h)) ;
2395          report_prosumage_tech('Storage out total prosumers M2M',loop_res_s
      hare,loop_ev,loop_prosumage,sto) =  sum( h, report_prosumage_tech_hours('s
      torage generation prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto
      ,h)) ;
2396          report_prosumage_tech('Storage out total prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto) = report_prosumage_tech('Storage out total pr
      osumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto) + report_prosu
      mage_tech('Storage out total prosumers PRO2M',loop_res_share,loop_ev,loop_
      prosumage,sto) + report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_ev,loop_prosumage,sto) + report_prosumage_tech('Stora
      ge out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto) ;
2397          report_prosumage_tech('Generation total prosumers PRO2M',loop_res_
      share,loop_ev,loop_prosumage,'') =  sum( (h,res) , report_prosumage_tech_h
      ours('generation prosumers to market',loop_res_share,loop_ev,loop_prosumag
      e,res,h)) ;
2398          report_prosumage_tech('Withdrawal total prosumers M2PRO',loop_res_
      share,loop_ev,loop_prosumage,'') =  sum( h , report_prosumage_tech_hours('
      withdrawal prosumers from market',loop_res_share,loop_ev,loop_prosumage,''
      ,h)) ;
2399          report_prosumage_tech('generation prosumers self-consumption',loop
      _res_share,loop_ev,loop_prosumage,'') =  sum( (res,h) , report_prosumage_t
      ech_hours('generation prosumers self-consumption',loop_res_share,loop_ev,l
      oop_prosumage,res,h)) ;
2400          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,res) = sum( scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , sum( h , lev_G_RES_PRO(scen,res,h)) ) / sum( scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load * d(h
      ) ) );
2401          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto) = sum( scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , sum( h , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_
      M2PRO(scen,sto,h)) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , sum( h , phi_pro_load * d(h) ) );
2402          report_prosumage_tech('consumption share prosumers',loop_res_share
      ,loop_ev,loop_prosumage,'market') = sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , sum( h , lev_G_MARKET_M2PRO(scen,h)) ) / sum( scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_pro_load
       * d(h) ) );
2403          report_prosumage_tech('curtailment of fluct res absolute prosumers
      ',loop_res_share,loop_ev,loop_prosumage,res) =  sum(h, sum(scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) )) * 1 ;
2404          report_prosumage_tech('curtailment of fluct res relative prosumers
      ',loop_res_share,loop_ev,loop_prosumage,res)$(report_prosumage_tech('curta
      ilment of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosum
      age,res) AND sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      lev_N_RES_PRO(scen,res)) > eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h) ))/ sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( h , phi_res(res,h
      ) * lev_N_RES_PRO(scen,res)) ) ;
2405   
2406          report_prosumage_tech('average market value storage in PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage i
      n total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto) > ep
      s_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,
      loop_prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , sum( res , lev_STO_IN_PRO2PRO(scen,res,sto,h)))) / report_prosumage
      _tech('Storage in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto) ;
2407          report_prosumage_tech('average market value storage in PRO2M',loop
      _res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage in 
      total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto) > eps_re
      p_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop
      _prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , sum( res , lev_STO_IN_PRO2M(scen,res,sto,h)))) / report_prosumage_tech(
      'Storage in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,s
      to) ;
2408          report_prosumage_tech('average market value storage in M2PRO',loop
      _res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage in 
      total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto) > eps_re
      p_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop
      _prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_STO_IN_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in tota
      l prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto) ;
2409          report_prosumage_tech('average market value storage in M2M',loop_r
      es_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage in to
      tal prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto) > eps_rep_ab
      s*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_pro
      sumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_STO_IN_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total pros
      umers M2M',loop_res_share,loop_ev,loop_prosumage,sto) ;
2410          report_prosumage_tech('average market value storage out PRO2PRO',l
      oop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage 
      out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto) > 
      eps_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_e
      v,loop_prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_STO_OUT_PRO2PRO(scen,sto,h))) / report_prosumage_tech('Storag
      e in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto) ;
2411          report_prosumage_tech('average market value storage out PRO2M',loo
      p_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage ou
      t total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto) > eps_
      rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,lo
      op_prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT_PRO2M(scen,sto,h))) / report_prosumage_tech('Storage in t
      otal prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto) ;
2412          report_prosumage_tech('average market value storage out M2PRO',loo
      p_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage ou
      t total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto) > eps_
      rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,lo
      op_prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT_M2PRO(scen,sto,h))) / report_prosumage_tech('Storage in t
      otal prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto) ;
2413          report_prosumage_tech('average market value storage out M2M',loop_
      res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto) > eps_rep_
      abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_p
      rosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_STO_OUT_M2M(scen,sto,h))) / report_prosumage_tech('Storage in total p
      rosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto) ;
2414          report_prosumage_tech('average market value generation PRO2M',loop
      _res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('Generation t
      otal prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'') > eps_rep_
      abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_p
      rosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       sum( res , lev_G_MARKET_PRO2M(scen,res,h)))) / report_prosumage_tech('Gen
      eration total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'') ;
2415          report_prosumage_tech('average market value withdrawal M2PRO',loop
      _res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('Withdrawal t
      otal prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'') > eps_rep_
      abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev,loop_p
      rosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_G_MARKET_M2PRO(scen,h))) / report_prosumage_tech('Withdrawal total pr
      osumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'') ;
2416          report_prosumage_tech('average market value generation PRO2PRO',lo
      op_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('generation
       prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,'') > e
      ps_rep_abs*card(h)) = sum( h , report_hours('price',loop_res_share,loop_ev
      ,loop_prosumage,h) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , sum( res , lev_G_RES_PRO(scen,res,h)))) / report_prosumage_tech('g
      eneration prosumers self-consumption',loop_res_share,loop_ev,loop_prosumag
      e,'') ;
2417   
2418                   report_prosumage_tech('capacities renewable prosumers',lo
      op_res_share,loop_ev,loop_prosumage,res)$(report_prosumage_tech('capacitie
      s renewable prosumers',loop_res_share,loop_ev,loop_prosumage,res) < eps_re
      p_ins) =  0 ;
2419                   report_prosumage_tech('capacities storage MW prosumers',l
      oop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('capaciti
      es storage MW prosumers',loop_res_share,loop_ev,loop_prosumage,sto) < eps_
      rep_ins) =  0 ;
2420                   report_prosumage_tech('capacities storage MWh prosumers',
      loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('capacit
      ies storage MWh prosumers',loop_res_share,loop_ev,loop_prosumage,sto) < ep
      s_rep_ins) =  0 ;
2421                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('consumption 
      share prosumers',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel)
       = 0 ;
2422                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,res)$(report_prosumage_tech('consumption 
      share prosumers',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_rel)
       = 0 ;
2423                   report_prosumage_tech('consumption share prosumers',loop_
      res_share,loop_ev,loop_prosumage,'market')$(report_prosumage_tech('consump
      tion share prosumers',loop_res_share,loop_ev,loop_prosumage,'market') < ep
      s_rep_rel) = 0 ;
2424                   report_prosumage_tech('curtailment of fluct res absolute 
      prosumers',loop_res_share,loop_ev,loop_prosumage,res)$(report_prosumage_te
      ch('curtailment of fluct res absolute prosumers',loop_res_share,loop_ev,lo
      op_prosumage,res) < eps_rep_ins) = 0 ;
2425                   report_prosumage_tech('curtailment of fluct res relative 
      prosumers',loop_res_share,loop_ev,loop_prosumage,res)$(report_prosumage_te
      ch('curtailment of fluct res relative prosumers',loop_res_share,loop_ev,lo
      op_prosumage,res) < eps_rep_rel) = 0 ;
2426                   report_prosumage_tech('Storage in total prosumers PRO2PRO
      ',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Stora
      ge in total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto)<
       eps_rep_abs*card(h)) = 0 ;
2427                   report_prosumage_tech('Storage in total prosumers PRO2M',
      loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage
       in total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto)< eps
      _rep_abs*card(h)) = 0 ;
2428                   report_prosumage_tech('Storage in total prosumers M2PRO',
      loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage
       in total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto)< eps
      _rep_abs*card(h)) = 0 ;
2429                   report_prosumage_tech('Storage in total prosumers M2M',lo
      op_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage i
      n total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep
      _abs*card(h)) = 0 ;
2430                   report_prosumage_tech('Storage out total prosumers PRO2PR
      O',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Stor
      age out total prosumers PRO2PRO',loop_res_share,loop_ev,loop_prosumage,sto
      )< eps_rep_abs*card(h)) = 0 ;
2431                   report_prosumage_tech('Storage out total prosumers PRO2M'
      ,loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storag
      e out total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,sto)< e
      ps_rep_abs*card(h)) = 0 ;
2432                   report_prosumage_tech('Storage out total prosumers M2PRO'
      ,loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storag
      e out total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,sto)< e
      ps_rep_abs*card(h)) = 0 ;
2433                   report_prosumage_tech('Storage out total prosumers M2M',l
      oop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage 
      out total prosumers M2M',loop_res_share,loop_ev,loop_prosumage,sto)< eps_r
      ep_abs*card(h)) = 0 ;
2434                   report_prosumage_tech('Storage out total prosumers',loop_
      res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage out 
      total prosumers',loop_res_share,loop_ev,loop_prosumage,sto)< eps_rep_abs*c
      ard(h)) = 0 ;
2435                   report_prosumage_tech('Generation total prosumers PRO2M',
      loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('Generati
      on total prosumers PRO2M',loop_res_share,loop_ev,loop_prosumage,'') < eps_
      rep_abs*card(h)) = 0 ;
2436                   report_prosumage_tech('Withdrawal total prosumers M2PRO',
      loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('Withdraw
      al total prosumers M2PRO',loop_res_share,loop_ev,loop_prosumage,'') < eps_
      rep_abs*card(h)) = 0 ;
2437                   report_prosumage_tech('generation prosumers self-consumpt
      ion',loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('gen
      eration prosumers self-consumption',loop_res_share,loop_ev,loop_prosumage,
      '') < eps_rep_abs * card(h)) = 0 ;
2438   
2439                   report_prosumage_tech('average market value storage in PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('
      average market value storage in PRO2PRO',loop_res_share,loop_ev,loop_prosu
      mage,sto) < eps_rep_abs) = 0 ;
2440                   report_prosumage_tech('average market value storage in PR
      O2M',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('av
      erage market value storage in PRO2M',loop_res_share,loop_ev,loop_prosumage
      ,sto) < eps_rep_abs) = 0 ;
2441                   report_prosumage_tech('average market value storage in M2
      PRO',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('av
      erage market value storage in M2PRO',loop_res_share,loop_ev,loop_prosumage
      ,sto) < eps_rep_abs) = 0 ;
2442                   report_prosumage_tech('average market value storage in M2
      M',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('aver
      age market value storage in M2M',loop_res_share,loop_ev,loop_prosumage,sto
      ) < eps_rep_abs) = 0 ;
2443                   report_prosumage_tech('average market value storage out P
      RO2PRO',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech(
      'average market value storage out PRO2PRO',loop_res_share,loop_ev,loop_pro
      sumage,sto) < eps_rep_abs) = 0 ;
2444                   report_prosumage_tech('average market value storage out P
      RO2M',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('a
      verage market value storage out PRO2M',loop_res_share,loop_ev,loop_prosuma
      ge,sto) < eps_rep_abs) = 0 ;
2445                   report_prosumage_tech('average market value storage out M
      2PRO',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('a
      verage market value storage out M2PRO',loop_res_share,loop_ev,loop_prosuma
      ge,sto) < eps_rep_abs) = 0 ;
2446                   report_prosumage_tech('average market value storage out M
      2M',loop_res_share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('ave
      rage market value storage out M2M',loop_res_share,loop_ev,loop_prosumage,s
      to) < eps_rep_abs) = 0 ;
2447                   report_prosumage_tech('average market value generation PR
      O2M',loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('ave
      rage market value generation PRO2M',loop_res_share,loop_ev,loop_prosumage,
      '') < eps_rep_abs) = 0 ;
2448                   report_prosumage_tech('average market value withdrawal M2
      PRO',loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('ave
      rage market value withdrawal M2PRO',loop_res_share,loop_ev,loop_prosumage,
      '') < eps_rep_abs) = 0 ;
2449                   report_prosumage_tech('average market value generation PR
      O2PRO',loop_res_share,loop_ev,loop_prosumage,'')$(report_prosumage_tech('a
      verage market value generation PRO2PRO',loop_res_share,loop_ev,loop_prosum
      age,'') < eps_rep_abs) = 0 ;
2450   
2451  * ------------------------------------------------------------------------
      ----
2452   
2453  *$exit
2454  * Report parameter REPORT PROSUMAGE
2455   
2456          report_prosumage('gross energy demand prosumers',loop_res_share,lo
      op_ev,loop_prosumage) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , gross_energy_demand_prosumers(scen)) ;
2457          report_prosumage('gross energy demand prosumers from market',loop_
      res_share,loop_ev,loop_prosumage) = sum( scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , gross_energy_demand_prosumers_market(scen)) ;
2458          report_prosumage('gross energy demand prosumers self generation',l
      oop_res_share,loop_ev,loop_prosumage) = sum( scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) ;
2459          report_prosumage('self-generation share prosumers total',loop_res_
      share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , gross_energy_demand_prosumers_selfgen(scen)) / sum( sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand_
      prosumers(scen) ) ;
2460          report_prosumage('market share prosumers',loop_res_share,loop_ev,l
      oop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , gross_energy_demand_prosumers_market(scen)) / sum( scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , gross_energy_demand_prosumers(scen) 
      ) ;
2461          report_prosumage('curtailment of fluct res absolute prosumers',loo
      p_res_share,loop_ev,loop_prosumage) = sum((res,h), sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_CU_PRO(scen,res,h))) * 1 ;
2462          report_prosumage('curtailment of fluct res relative prosumers',loo
      p_res_share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_
      res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2463          report_prosumage('share self-generation curtailed',loop_res_share,
      loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , sum( (h,res) , lev_CU_PRO(scen,res,h) )) / sum(scen$(map(scen
      ,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h) *
       lev_N_RES_PRO(scen,res)) ) ;
2464          report_prosumage('share self-generation direct consumption',loop_r
      es_share,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_
      ev,loop_prosumage)) , sum( (h,res) , lev_G_RES_PRO(scen,res,h) )) / sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_
      res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2465          report_prosumage('share self-generation to market',loop_res_share,
      loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , sum( (h,res) , lev_G_MARKET_PRO2M(scen,res,h) )) / sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(
      res,h) * lev_N_RES_PRO(scen,res)) ) ;
2466          report_prosumage('share self-generation stored PRO2PRO',loop_res_s
      hare,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2PRO(scen,res,sto,h) ))
       / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,
      h) , phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2467          report_prosumage('share self-generation stored PRO2M',loop_res_sha
      re,loop_ev,loop_prosumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , sum( (h,sto,res) , lev_STO_IN_PRO2M(scen,res,sto,h) )) / s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) ,
       phi_res(res,h) * lev_N_RES_PRO(scen,res)) ) ;
2468          report_prosumage('Capacity total prosumers',loop_res_share,loop_ev
      ,loop_prosumage) = sum( res , sum(scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , lev_N_RES_PRO(scen,res)) ) + sum( sto , sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto)) ) ;
2469   
2470                   report_prosumage('gross energy demand prosumers',loop_res
      _share,loop_ev,loop_prosumage)$(report_prosumage('gross energy demand pros
      umers',loop_res_share,loop_ev,loop_prosumage) < eps_rep_ins) = 0 ;
2471                   report_prosumage('gross energy demand prosumers from mark
      et',loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('gross energy
       demand prosumers from market',loop_res_share,loop_ev,loop_prosumage) < ep
      s_rep_ins) = 0 ;
2472                   report_prosumage('gross energy demand prosumers self gene
      ration',loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('gross en
      ergy demand prosumers self generation',loop_res_share,loop_ev,loop_prosuma
      ge) < eps_rep_ins) = 0 ;
2473                   report_prosumage('self-generation share prosumage total',
      loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('self-generation 
      share prosumage total',loop_res_share,loop_ev,loop_prosumage) < eps_rep_re
      l) = 0 ;
2474                   report_prosumage('market share prosumage',loop_res_share,
      loop_ev,loop_prosumage)$(report_prosumage('market share prosumage',loop_re
      s_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2475                   report_prosumage('curtailment of fluct res absolute prosu
      mers',loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('curtailmen
      t of fluct res absolute prosumers',loop_res_share,loop_ev,loop_prosumage) 
      < eps_rep_ins) = 0 ;
2476                   report_prosumage('curtailment of fluct res relative prosu
      mers',loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('curtailmen
      t of fluct res relative prosumers',loop_res_share,loop_ev,loop_prosumage) 
      < eps_rep_rel) = 0 ;
2477                   report_prosumage('share self-generation curtailed',loop_r
      es_share,loop_ev,loop_prosumage)$(report_prosumage('share self-generation 
      curtailed',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2478                   report_prosumage('share self-generation direct consumptio
      n',loop_res_share,loop_ev,loop_prosumage)$(report_prosumage('share self-ge
      neration direct consumption',loop_res_share,loop_ev,loop_prosumage) < eps_
      rep_rel) = 0 ;
2479                   report_prosumage('share self-generation to market',loop_r
      es_share,loop_ev,loop_prosumage)$(report_prosumage('share self-generation 
      to market',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2480                   report_prosumage('share self-generation stored PRO2PRO',l
      oop_res_share,loop_ev,loop_prosumage)$(report_prosumage('share self-genera
      tion stored PRO2PRO',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel)
       = 0 ;
2481                   report_prosumage('share self-generation stored PRO2M',loo
      p_res_share,loop_ev,loop_prosumage)$(report_prosumage('share self-generati
      on stored PRO2M',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = 0
       ;
2482                   report_prosumage('Capacity total prosumers',loop_res_shar
      e,loop_ev,loop_prosumage)$(report_prosumage('Capacity total prosumers',loo
      p_res_share,loop_ev,loop_prosumage) < eps_rep_abs) = 0 ;
2483   
2484         report_prosumage_tech('Capacity share prosumers',loop_res_share,loo
      p_ev,loop_prosumage,res) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_RES_PRO(scen,res) ) / report_prosumage('Capacity total
       prosumers',loop_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2485         report_prosumage_tech('Capacity share prosumers',loop_res_share,loo
      p_ev,loop_prosumage,sto) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_STO_P_PRO(scen,sto) ) / report_prosumage('Capacity tot
      al prosumers',loop_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2486   
2487                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_ev,loop_prosumage,res)$(report_prosumage_tech('Capacity share 
      prosumers',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_rel) = 0 ;
2488                   report_prosumage_tech('Capacity share prosumers',loop_res
      _share,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Capacity share 
      prosumers',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel) = 0 ;
2489   
2490  * ------------------------------------------------------------------------
      ----
2491   
2492  *$exit
2493  * Report parameter REPORT MARKET TECH HOURS
2494   
2495          report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,ct_the,h) = sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , lev_G_L(scen,ct_the,h) + corr_fac_con(scen,ct_the,h)) ;
2496          report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,ct_ren,h) = sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , lev_G_L(scen,ct_ren,h) + corr_fac_con(scen,ct_ren,h)) ;
2497          report_market_tech_hours('generation market',loop_res_share,loop_e
      v,loop_prosumage,res,h) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_G_RES(scen,res,h) + corr_fac_res(scen,res,h)) ;
2498          report_market_tech_hours('curtailment of fluct res market',loop_re
      s_share,loop_ev,loop_prosumage,res,h) =  sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_CU(scen,res,h)) ;
2499          report_market_tech_hours('generation storage market',loop_res_shar
      e,loop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_
      ev,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ;
2500          report_market_tech_hours('storage loading market',loop_res_share,l
      oop_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , lev_STO_IN(scen,sto,h)) ;
2501          report_market_tech_hours('storage level market',loop_res_share,loo
      p_ev,loop_prosumage,sto,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , lev_STO_L(scen,sto,h)) ;
2502          report_market_tech_hours('market to prosumer storage M2PRO',loop_r
      es_share,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_I
      N_M2PRO(scen,sto,h)) ) ;
2503          report_market_tech_hours('market to prosumer storage M2M',loop_res
      _share,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_
      M2M(scen,sto,h)) ) ;
2504          report_market_tech_hours('prosumer storage to market PRO2M',loop_r
      es_share,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_O
      UT_PRO2M(scen,sto,h)) ) ;
2505          report_market_tech_hours('prosumer storage to market M2M',loop_res
      _share,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT
      _M2M(scen,sto,h)) ) ;
2506          report_market_tech_hours('energy market to prosumer',loop_res_shar
      e,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h) 
      )   ;
2507          report_market_tech_hours('energy prosumer to market',loop_res_shar
      e,loop_ev,loop_prosumage,'Interaction with prosumers',h) =  sum(scen$(map(
      scen,loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_MARKET_PRO
      2M(scen,res,h)) )  ;
2508   
2509                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,res,h)$(report_market_tech_hours('generation mar
      ket',loop_res_share,loop_ev,loop_prosumage,res,h) < eps_rep_abs) = 0 ;
2510                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,ct_the,h)$(report_market_tech_hours('generation 
      market',loop_res_share,loop_ev,loop_prosumage,ct_the,h) < eps_rep_abs) = 0
       ;
2511                   report_market_tech_hours('generation market',loop_res_sha
      re,loop_ev,loop_prosumage,ct_ren,h)$(report_market_tech_hours('generation 
      market',loop_res_share,loop_ev,loop_prosumage,ct_ren,h) < eps_rep_abs) = 0
       ;
2512                   report_market_tech_hours('curtailment of fluct res market
      ',loop_res_share,loop_ev,loop_prosumage,res,h)$(report_market_tech_hours('
      curtailment of fluct res market',loop_res_share,loop_ev,loop_prosumage,res
      ,h) < eps_rep_abs) =  0 ;
2513                   report_market_tech_hours('generation storage market',loop
      _res_share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('genera
      tion storage market',loop_res_share,loop_ev,loop_prosumage,sto,h) < eps_re
      p_abs) =  0 ;
2514                   report_market_tech_hours('storage loading market',loop_re
      s_share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('storage l
      oading market',loop_res_share,loop_ev,loop_prosumage,sto,h) < eps_rep_abs)
       = 0 ;
2515                   report_market_tech_hours('storage level market',loop_res_
      share,loop_ev,loop_prosumage,sto,h)$(report_market_tech_hours('storage lev
      el market',loop_res_share,loop_ev,loop_prosumage,sto,h) < eps_rep_abs) = 0
       ;
2516                   report_market_tech_hours('market to prosumer storage M2PR
      O',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(
      report_market_tech_hours('market to prosumer storage M2PRO',loop_res_share
      ,loop_ev,loop_prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0
       ;
2517                   report_market_tech_hours('market to prosumer storage M2M'
      ,loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(re
      port_market_tech_hours('market to prosumer storage M2M',loop_res_share,loo
      p_ev,loop_prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0 ;
2518                   report_market_tech_hours('prosumer storage to market PRO2
      M',loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(
      report_market_tech_hours('prosumer storage to market PRO2M',loop_res_share
      ,loop_ev,loop_prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0
       ;
2519                   report_market_tech_hours('prosumer storage to market M2M'
      ,loop_res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(re
      port_market_tech_hours('prosumer storage to market M2M',loop_res_share,loo
      p_ev,loop_prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0 ;
2520                   report_market_tech_hours('energy market to prosumer',loop
      _res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(report_
      market_tech_hours('energy market to prosumer',loop_res_share,loop_ev,loop_
      prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0 ;
2521                   report_market_tech_hours('energy prosumer to market',loop
      _res_share,loop_ev,loop_prosumage,'Interaction with prosumers',h)$(report_
      market_tech_hours('energy prosumer to market',loop_res_share,loop_ev,loop_
      prosumage,'Interaction with prosumers',h) < eps_rep_abs) = 0 ;
2522   
2523  * ------------------------------------------------------------------------
      ----
2524   
2525  *$exit
2526  * Report parameter REPORT MARKET TECH
2527   
2528          report_market_tech('capacities renewable market',loop_res_share,lo
      op_ev,loop_prosumage,res) =  sum( scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , lev_N_RES(scen,res) ) ;
2529          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2530          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , lev_N_STO_E(scen,sto)) * 1 ;
2531          report_market_tech('curtailment of fluct res absolute market',loop
      _res_share,loop_ev,loop_prosumage,res) =  sum(h, sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h) )) * 1 ;
2532          report_market_tech('curtailment of fluct res relative market',loop
      _res_share,loop_ev,loop_prosumage,res)$(report_market_tech('curtailment of
       fluct res absolute market',loop_res_share,loop_ev,loop_prosumage,res) AND
       sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _RES(scen,res,h) - corr_fac_res(scen,res,h)) ) + sum(h, sum(scen$(map(scen
      ,loop_res_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h))) > card(h)*
      eps_rep_abs ) =  sum(h, sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_CU(scen,res,h) ))/( sum(h,  sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_fac_res(scen,re
      s,h)) ) + sum(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_CU(scen,res,h)  )) ) ;
2533          report_market_tech('capacities conventional market',loop_res_share
      ,loop_ev,loop_prosumage,ct_the) =  sum( scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_N_CON(scen,ct_the)) ;
2534          report_market_tech('capacities renewable market',loop_res_share,lo
      op_ev,loop_prosumage,ct_ren) = 0 + sum( scen$(map(scen,loop_res_share,loop
      _ev,loop_prosumage)) , lev_N_CON(scen,ct_ren)) ;
2535          report_market_tech('capacities renewable market',loop_res_share,lo
      op_ev,loop_prosumage,res) =  sum( scen$(map(scen,loop_res_share,loop_ev,lo
      op_prosumage)) , lev_N_RES(scen,res) );
2536          report_market_tech('capacities storage MW market',loop_res_share,l
      oop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_N_STO_P(scen,sto)) ;
2537          report_market_tech('capacities storage MWh market',loop_res_share,
      loop_ev,loop_prosumage,sto) =  sum( scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , lev_N_STO_E(scen,sto)) * 1 ;
2538          report_market_tech('Storage out total market non-reserves',loop_re
      s_share,loop_ev,loop_prosumage,sto) = sum(h, report_market_tech_hours('gen
      eration storage market',loop_res_share,loop_ev,loop_prosumage,sto,h) ) * 1
       ;
2539          report_market_tech('Storage in total market non-reserves',loop_res
      _share,loop_ev,loop_prosumage,sto) = sum(h, report_market_tech_hours('stor
      age loading market',loop_res_share,loop_ev,loop_prosumage,sto,h) ) * 1 ;
2540          report_market_tech('FLH market non-reserves',loop_res_share,loop_e
      v,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_N_RES(scen,res)) > eps_rep_ins) = sum( h , sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h) - corr_f
      ac_res(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_N_RES(scen,res)) ;
2541   
2542                   report_market_tech('capacities renewable market',loop_res
      _share,loop_ev,loop_prosumage,res)$(report_market_tech('capacities renewab
      le market',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_abs) =  0 
      ;
2543                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_ev,loop_prosumage,sto)$(report_market_tech('capacities storag
      e MW market',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) =  
      0 ;
2544                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_ev,loop_prosumage,sto)$(report_market_tech('capacities stora
      ge MWh market',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) =
        0 ;
2545                   report_market_tech('curtailment of fluct res absolute mar
      ket',loop_res_share,loop_ev,loop_prosumage,res)$(report_market_tech('curta
      ilment of fluct res absolute market',loop_res_share,loop_ev,loop_prosumage
      ,res) < eps_rep_abs*card(h)) = 0 ;
2546                   report_market_tech('curtailment of fluct res relative mar
      ket',loop_res_share,loop_ev,loop_prosumage,res)$(report_market_tech('curta
      ilment of fluct res relative market',loop_res_share,loop_ev,loop_prosumage
      ,res) < eps_rep_rel) = 0 ;
2547                   report_market_tech('capacities conventional market',loop_
      res_share,loop_ev,loop_prosumage,ct_the)$(report_market_tech('capacities c
      onventional market',loop_res_share,loop_ev,loop_prosumage,ct_the) < eps_re
      p_ins) = 0 ;
2548                   report_market_tech('capacities renewable market',loop_res
      _share,loop_ev,loop_prosumage,ct_ren)$(report_market_tech('capacities rene
      wable market',loop_res_share,loop_ev,loop_prosumage,ct_ren) < eps_rep_ins)
       = 0 ;
2549                   report_market_tech('capacities renewable market',loop_res
      _share,loop_ev,loop_prosumage,res)$(report_market_tech('capacities renewab
      le market',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_ins) =  0;
2550                   report_market_tech('capacities storage MW market',loop_re
      s_share,loop_ev,loop_prosumage,sto)$(report_market_tech('capacities storag
      e MW market',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_ins) =  
      0 ;
2551                   report_market_tech('capacities storage MWh market',loop_r
      es_share,loop_ev,loop_prosumage,sto)$(report_market_tech('capacities stora
      ge MWh market',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_ins) =
       0 ;
2552                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,res)$(report_tech('FLH market non-reserves',loop
      _res_share,loop_ev,loop_prosumage,res) < eps_rep_abs) = 0 ;
2553                   report_market_tech('Storage out total market non-reserves
      ',loop_res_share,loop_ev,loop_prosumage,sto)$(report_market_tech('Storage 
      out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto) 
      < eps_rep_abs) = 0 ;
2554                   report_market_tech('Storage in total market non-reserves'
      ,loop_res_share,loop_ev,loop_prosumage,sto)$(report_market_tech('Storage i
      n total market non-reserves',loop_res_share,loop_ev,loop_prosumage,sto) < 
      eps_rep_abs) = 0 ;
2555   
2556  * ------------------------------------------------------------------------
      ----
2557   
2558  *$exit
2559  * Report parameter REPORT MARKET
2560   
2561          report_market('gross energy demand market',loop_res_share,loop_ev,
      loop_prosumage) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e)) , gross_energy_demand_market(scen)) ;
2562          report_market('curtailment of fluct res absolute market',loop_res_
      share,loop_ev,loop_prosumage) = sum((res,h), sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_CU(scen,res,h))) * 1 ;
2563          report_market('curtailment of fluct res relative market',loop_res_
      share,loop_ev,loop_prosumage)$( sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage)) , sum( (h,res) , phi_res(res,h)*lev_N_RES(scen,res)) ) > 
      eps_rep_abs*card(res)*card(h) ) = sum( (res,h), sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_CU(scen,res,h)))/ sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , sum( (res,h) , phi_res(res,h) 
      * lev_N_RES(scen,res)) ) ;
2564          report_market('Share market energy transferred to prosumer consump
      tion',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)) ) / 
      sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy
      _demand_market(scen) ) ;
2565          report_market('Share market energy transferred to prosumer storage
       M2PRO',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_M2PRO(sc
      en,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , gross_energy_demand_market(scen) ) ;
2566          report_market('Share market energy transferred to prosumer storage
       M2M',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_IN_M2M(scen,s
      to,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      gross_energy_demand_market(scen) ) ;
2567          report_market('Share market energy tranferred from prosumer genera
      tion',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(scen,
      loop_res_share,loop_ev,loop_prosumage)) , sum( res , lev_G_MARKET_PRO2M(sc
      en,res,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , gross_energy_demand_market(scen) ) ;
2568          report_market('Share market energy transferred from prosumer stora
      ge PRO2M',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT_PRO2M
      (scen,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , gross_energy_demand_market(scen) ) ;
2569          report_market('Share market energy transferred from prosumer stora
      ge M2M',loop_res_share,loop_ev,loop_prosumage) = sum( h, sum(scen$(map(sce
      n,loop_res_share,loop_ev,loop_prosumage)) , sum( sto , lev_STO_OUT_M2M(sce
      n,sto,h))) ) / sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , gross_energy_demand_market(scen) ) ;
2570          report_market('Capacity total market',loop_res_share,loop_ev,loop_
      prosumage) = sum( ct , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_N_CON(scen,ct)) ) + sum( res , sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_N_RES(scen,res)  )) + sum( sto , sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,s
      to) )) ;
2571   
2572                   report_market('gross energy demand market',loop_res_share
      ,loop_ev,loop_prosumage)$(report_market('gross energy demand market',loop_
      res_share,loop_ev,loop_prosumage) < eps_rep_abs) = 0 ;
2573                   report_market('curtailment of fluct res absolute market',
      loop_res_share,loop_ev,loop_prosumage)$(report_market('curtailment of fluc
      t res absolute market',loop_res_share,loop_ev,loop_prosumage) < eps_rep_ab
      s) = 0 ;
2574                   report_market('curtailment of fluct res relative market',
      loop_res_share,loop_ev,loop_prosumage)$(report_market('curtailment of fluc
      t res relative market',loop_res_share,loop_ev,loop_prosumage) < eps_rep_re
      l) = 0 ;
2575                   report_market('Share market energy transferred to prosume
      r consumption',loop_res_share,loop_ev,loop_prosumage)$(report_market('Shar
      e market energy transferred to prosumer consumption',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_rel) = 0 ;
2576                   report_market('Share market energy transferred to prosume
      r storage M2PRO',loop_res_share,loop_ev,loop_prosumage)$(report_market('Sh
      are market energy transferred to prosumer storage M2PRO',loop_res_share,lo
      op_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2577                   report_market('Share market energy transferred to prosume
      r storage M2M',loop_res_share,loop_ev,loop_prosumage)$(report_market('Shar
      e market energy transferred to prosumer storage M2M',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_rel) = 0 ;
2578                   report_market('Share market energy tranferred from prosum
      er generation',loop_res_share,loop_ev,loop_prosumage)$(report_market('Shar
      e market energy tranferred from prosumer generation',loop_res_share,loop_e
      v,loop_prosumage) < eps_rep_rel) = 0 ;
2579                   report_market('Share market energy transferred from prosu
      mer storage PRO2M',loop_res_share,loop_ev,loop_prosumage)$(report_market('
      Share market energy transferred from prosumer storage PRO2M',loop_res_shar
      e,loop_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2580                   report_market('Share market energy transferred from prosu
      mer storage M2M',loop_res_share,loop_ev,loop_prosumage)$(report_market('Sh
      are market energy transferred from prosumer storage M2M',loop_res_share,lo
      op_ev,loop_prosumage) < eps_rep_rel) = 0 ;
2581                   report_market('Capacity total market',loop_res_share,loop
      _ev,loop_prosumage)$(report_market('Capacity total market',loop_res_share,
      loop_ev,loop_prosumage) < eps_rep_abs) = 0 ;
2582   
2583         report_market_tech('Capacity share market',loop_res_share,loop_ev,l
      oop_prosumage,ct_the) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_N_CON(scen,ct_the) ) / report_market('Capacity total marke
      t',loop_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2584         report_market_tech('Capacity share market',loop_res_share,loop_ev,l
      oop_prosumage,ct_ren) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_N_CON(scen,ct_ren) ) / report_market('Capacity total marke
      t',loop_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2585         report_market_tech('Capacity share market',loop_res_share,loop_ev,l
      oop_prosumage,res) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_N_RES(scen,res) ) / report_market('Capacity total market',loop
      _res_share,loop_ev,loop_prosumage) + 1e-9 ;
2586         report_market_tech('Capacity share market',loop_res_share,loop_ev,l
      oop_prosumage,sto) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_N_STO_P(scen,sto) ) / report_market('Capacity total market',lo
      op_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2587   
2588                   report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,ct_the)$(report_market_tech('Capacity share market
      ',loop_res_share,loop_ev,loop_prosumage,ct_the) < eps_rep_rel) = 0 ;
2589                   report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,ct_ren)$(report_market_tech('Capacity share market
      ',loop_res_share,loop_ev,loop_prosumage,ct_ren) < eps_rep_rel) = 0 ;
2590                   report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,res)$(report_market_tech('Capacity share market',l
      oop_res_share,loop_ev,loop_prosumage,res) < eps_rep_rel) = 0 ;
2591                   report_market_tech('Capacity share market',loop_res_share
      ,loop_ev,loop_prosumage,sto)$(report_market_tech('Capacity share market',l
      oop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel) = 0 ;
2594   
2595  *$ontext
2596         report_market('Energy total market',loop_res_share,loop_ev,loop_pro
      sumage) = (sum( h , (1 - phi_pro_load) * d(h) ) + sum( h , sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_M2PRO(scen,h)))
       + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_IN(scen,sto,h) + lev_STO_IN_M2M(scen,sto,h) + lev_STO_IN_M2PR
      O(scen,sto,h) ) )) * 1
2597  *$ontext
              + sum( (dsm_shift,h) , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_DSM_UP_DEMAND(scen,dsm_shift,h)) ) * %sec_hour%
      $ontext
2602  *$ontext
               + sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_EV_CHARGE(scen,ev,h)) ) * %sec_hour%
      $ontext
2607  *$ontext
             + sum( h$(ord(h) > 1) , phi_reserves_pr* sum( reserves$( ord(reserv
      es) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_intercept(reser
      ves) + sum( res , reserves_slope(reserves,res) * sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res) + lev_N_RES_PRO(s
      cen,res)))/1000 ) ) ) * phi_reserves_call('PR_up',h) )
             + sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('SR_up') * ( rese
      rves_intercept('SR_up') + sum( res , reserves_slope('SR_up',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('SR_up',h) )
             + sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('MR_up') * ( rese
      rves_intercept('MR_up') + sum( res , reserves_slope('MR_up',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('MR_up',h) )
             - sum( h$(ord(h) > 1) , phi_reserves_pr* sum( reserves$( ord(reserv
      es) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_intercept(reser
      ves) + sum( res , reserves_slope(reserves,res) * sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res) + lev_N_RES_PRO(s
      cen,res)))/1000 ) ) ) * phi_reserves_call('PR_do',h) )
             - sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('SR_do') * ( rese
      rves_intercept('SR_do') + sum( res , reserves_slope('SR_do',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('SR_do',h) )
             - sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('MR_do') * ( rese
      rves_intercept('MR_do') + sum( res , reserves_slope('MR_do',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('MR_do',h) )
      $ontext
2617  ;
2618   
2619  *$ontext
2620         report_market_tech('Energy share market',loop_res_share,loop_ev,loo
      p_prosumage,ct_the) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_G_L(scen,ct_the,h)) ) / report_market('Energy total 
      market',loop_res_share,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2621         report_market_tech('Energy share market',loop_res_share,loop_ev,loo
      p_prosumage,ct_ren) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_G_L(scen,ct_ren,h)) ) / report_market('Energy total 
      market',loop_res_share,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2622         report_market_tech('Energy share market',loop_res_share,loop_ev,loo
      p_prosumage,res) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_G_MARKET_PRO2M(scen,res,h) + lev_G_RES(scen,res,h) - co
      rr_fac_res(scen,res,h)) ) / report_market('Energy total market',loop_res_s
      hare,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2623         report_market_tech('Energy share market',loop_res_share,loop_ev,loo
      p_prosumage,sto) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,sto,h) - cor
      r_fac_sto(scen,sto,h)) ) / report_market('Energy total market',loop_res_sh
      are,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2624   
2625                   report_market('Energy total market',loop_res_share,loop_e
      v,loop_prosumage)$(report_market('Energy total market',loop_res_share,loop
      _ev,loop_prosumage) < eps_rep_abs) = 0 ;
2626                   report_market_tech('Energy share market',loop_res_share,l
      oop_ev,loop_prosumage,ct_the)$(report_market_tech('Energy share market',lo
      op_res_share,loop_ev,loop_prosumage,ct_the) < eps_rep_rel) = 0 ;
2627                   report_market_tech('Energy share market',loop_res_share,l
      oop_ev,loop_prosumage,ct_ren)$(report_market_tech('Energy share market',lo
      op_res_share,loop_ev,loop_prosumage,ct_ren) < eps_rep_rel) = 0 ;
2628                   report_market_tech('Energy share market',loop_res_share,l
      oop_ev,loop_prosumage,res)$(report_market_tech('Energy share market',loop_
      res_share,loop_ev,loop_prosumage,res) < eps_rep_rel) = 0 ;
2629                   report_market_tech('Energy share market',loop_res_share,l
      oop_ev,loop_prosumage,sto)$(report_market_tech('Energy share market',loop_
      res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel) = 0 ;
2632   
              report('gross_energy_demand w/o EV',loop_res_share,loop_ev,loop_pr
      osumage) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gr
      oss_energy_demand(scen)) - sum( (ev,h) , sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_EV_GED(scen,ev,h)) ) ;
              report('EV electricity demand',loop_res_share,loop_ev,loop_prosuma
      ge) = sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , lev_EV_GED(scen,ev,h)) ) ;
              report('renshare EV',loop_res_share,loop_ev,loop_prosumage)$(sum( 
      (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      EV_GED(scen,ev,h))) > card(h)*eps_rep_abs AND sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , marginal_con5a(scen) = 0)) = sum(scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , min_res(scen)) + (sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , gross_energy_demand(
      scen))/ sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_EV_GED(scen,ev,h))) )*(report('renshare total',loop_res_share
      ,loop_ev,loop_prosumage) - sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , min_res(scen)) ) ;
      %EV_FREE%%EV_DEFAULT%        report('renshare EV',loop_res_share,loop_ev,l
      oop_prosumage) = 1 ;
              report('conshare EV',loop_res_share,loop_ev,loop_prosumage)$(sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , marginal_con5a(sce
      n) = 0)) = 1 - report('renshare EV',loop_res_share,loop_ev,loop_prosumage)
       ;
      %EV_FREE%%EV_DEFAULT%        report('conshare EV',loop_res_share,loop_ev,l
      oop_prosumage) = 0 ;
              report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosumag
      e,ev,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_EV_CHARGE(scen,ev,h)) ;
              report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_prosu
      mage,ev,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_EV_DISCHARGE(scen,ev,h)) ;
              report_tech_hours('EV phevfuel consumption',loop_res_share,loop_ev
      ,loop_prosumage,ev,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_EV_PHEVFUEL(scen,ev,h));
              report_tech_hours('EV electrical consumption',loop_res_share,loop_
      ev,loop_prosumage,ev,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_EV_GED(scen,ev,h));
              report_tech_hours('EV battery level',loop_res_share,loop_ev,loop_p
      rosumage,ev,h) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_EV_L(scen,ev,h)) ;
       
               report('renshare EV',loop_res_share,loop_ev,loop_prosumage)$(repo
      rt('renshare EV',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = e
      ps ;
               report('conshare EV',loop_res_share,loop_ev,loop_prosumage)$(repo
      rt('conshare EV',loop_res_share,loop_ev,loop_prosumage) < eps_rep_rel) = e
      ps ;
               report('EV_electricity_demand',loop_res_share,loop_ev,loop_prosum
      age)$(report('EV_electricity_demand',loop_res_share,loop_ev,loop_prosumage
      ) < card(h)*eps_rep_abs) = 0 ;
               report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosuma
      ge,ev,h)$(report_tech_hours('EV charge',loop_res_share,loop_ev,loop_prosum
      age,ev,h) < eps_rep_abs) = 0 ;
               report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_pros
      umage,ev,h)$(report_tech_hours('EV discharge',loop_res_share,loop_ev,loop_
      prosumage,ev,h) < eps_rep_abs) = 0 ;
               report_tech_hours('EV phevfuel consumption',loop_res_share,loop_e
      v,loop_prosumage,ev,h)$(report_tech_hours('EV phevfuel consumption',loop_r
      es_share,loop_ev,loop_prosumage,ev,h) < eps_rep_abs) = 0 ;
               report_tech_hours('EV electrical consumption',loop_res_share,loop
      _ev,loop_prosumage,ev,h)$(report_tech_hours('EV electrical consumption',lo
      op_res_share,loop_ev,loop_prosumage,ev,h) < eps_rep_abs) = 0 ;
      $ontext
2655   
2656          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,ct_the) = sum( scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , l
      ev_N_CON(scen,ct_the) ) / report('Capacity total',loop_res_share,loop_ev,l
      oop_prosumage) + 1e-9 ;
2657          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,ct_ren) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_N_CON(scen,ct_ren)) / report('Capacity total',loop_res_share,loop_ev,loo
      p_prosumage) + 1e-9 ;
2658          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,res) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N
      _RES(scen,res) + lev_N_RES_PRO(scen,res) ) / report('Capacity total',loop_
      res_share,loop_ev,loop_prosumage) + 1e-9 ;
2659          report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,sto) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N
      _STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) / report('Capacity total',l
      oop_res_share,loop_ev,loop_prosumage) + 1e-9 ;
2660          report('Energy total',loop_res_share,loop_ev,loop_prosumage) = (su
      m( h , d(h) ) + sum( (sto,h) , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_STO_IN(scen,sto,h) + sum( res , lev_STO_IN_PRO2PRO(s
      cen,res,sto,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_STO_IN_M2PRO(scen
      ,sto,h) + lev_STO_IN_M2M(scen,sto,h)) )) * 1
              + sum( (dsm_shift,h) , sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage)) , lev_DSM_UP_DEMAND(scen,dsm_shift,h)) ) * %sec_hour%
      $ontext
               + sum( (ev,h) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_EV_CHARGE(scen,ev,h)) ) * %sec_hour%
      $ontext
             + sum( h$(ord(h) > 1) , phi_reserves_pr* sum( reserves$( ord(reserv
      es) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_intercept(reser
      ves) + sum( res , reserves_slope(reserves,res) * sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res) + lev_N_RES_PRO(s
      cen,res)))/1000 ) ) ) * phi_reserves_call('PR_up',h) )
             + sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('SR_up') * ( rese
      rves_intercept('SR_up') + sum( res , reserves_slope('SR_up',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('SR_up',h) )
             + sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('MR_up') * ( rese
      rves_intercept('MR_up') + sum( res , reserves_slope('MR_up',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('MR_up',h) )
             - sum( h$(ord(h) > 1) , phi_reserves_pr* sum( reserves$( ord(reserv
      es) > 2) , 1000 * phi_reserves_share(reserves) * (reserves_intercept(reser
      ves) + sum( res , reserves_slope(reserves,res) * sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res) + lev_N_RES_PRO(s
      cen,res)))/1000 ) ) ) * phi_reserves_call('PR_do',h) )
             - sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('SR_do') * ( rese
      rves_intercept('SR_do') + sum( res , reserves_slope('SR_do',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('SR_do',h) )
             - sum( h$(ord(h) > 1) , 1000 * phi_reserves_share('MR_do') * ( rese
      rves_intercept('MR_do') + sum( res , reserves_slope('MR_do',res) * sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , (lev_N_RES(scen,res)
       + lev_N_RES_PRO(scen,res)))/1000 ) ) * phi_reserves_call('MR_do',h) )
      $ontext
2678  ;
2679   
2680          report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,c
      t_the) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_G_L(scen,ct_the,h)) ) / report('Energy total',loop_res_share,loop
      _ev,loop_prosumage) * 1 + 1e-9 ;
2681          report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,c
      t_ren) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_G_L(scen,ct_ren,h)) ) / report('Energy total',loop_res_share,loop
      _ev,loop_prosumage) * 1 + 1e-9 ;
2682          report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,r
      es) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_G_MARKET_PRO2M(scen,res,h) + sum(sto , lev_STO_IN_PRO2PRO(scen,res,s
      to,h) + lev_STO_IN_PRO2M(scen,res,sto,h)) + lev_G_RES_PRO(scen,res,h) + le
      v_G_RES(scen,res,h) - corr_fac_res(scen,res,h)) ) / report('Energy total',
      loop_res_share,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2683          report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,s
      to) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_STO_OUT_PRO2PRO(scen,sto,h) + lev_STO_OUT_PRO2M(scen,sto,h) + lev_ST
      O_OUT_M2PRO(scen,sto,h) + lev_STO_OUT_M2M(scen,sto,h) + lev_STO_OUT(scen,s
      to,h) - corr_fac_sto(scen,sto,h)) ) / report('Energy total',loop_res_share
      ,loop_ev,loop_prosumage) * 1 + 1e-9 ;
2684   
2685                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,ct_the)$(report_tech('Capacity share',loop_res_share,loop_ev,loo
      p_prosumage,ct_the) < eps_rep_rel) = 0 ;
2686                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,ct_ren)$(report_tech('Capacity share',loop_res_share,loop_ev,loo
      p_prosumage,ct_ren) < eps_rep_rel) = 0 ;
2687                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,res)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_p
      rosumage,res) < eps_rep_rel) = 0 ;
2688                   report_tech('Capacity share',loop_res_share,loop_ev,loop_
      prosumage,sto)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_p
      rosumage,sto) < eps_rep_rel) = 0 ;
2689                   report('Energy total',loop_res_share,loop_ev,loop_prosuma
      ge)$(report('Energy total',loop_res_share,loop_ev,loop_prosumage) < eps_re
      p_abs) = 0 ;
2690   
2691                   report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,ct_the)$(report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,ct_the) < eps_rep_rel) = 0 ;
2692                   report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,ct_ren)$(report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,ct_ren) < eps_rep_rel) = 0 ;
2693                   report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,res)$(report_tech('Energy share',loop_res_share,loop_ev,loop_prosu
      mage,res) < eps_rep_rel) = 0 ;
2694                   report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,sto)$(report_tech('Energy share',loop_res_share,loop_ev,loop_prosu
      mage,sto) < eps_rep_rel) = 0 ;
              report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,'
      ev_cum') = sum( (h,ev) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_EV_DISCHARGE(scen,ev,h) - corr_fac_ev(scen,h)) ) / report(
      'Energy total',loop_res_share,loop_ev,loop_prosumage) * %sec_hour% + 1e-9 
      ;
                       report_tech('Energy share',loop_res_share,loop_ev,loop_pr
      osumage,'ev_cum')$(report_tech('Energy share',loop_res_share,loop_ev,loop_
      prosumage,'ev_cum') < eps_rep_rel) = 0 ;
      $ontext
2700   
2701           report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,ct_the)$(
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_CON(sce
      n,ct_the)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_G_L(scen,ct_the,h)) ) / sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_N_CON(scen,ct_the)) ;
2702           report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,ct_ren)$(
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_CON(sce
      n,ct_ren)) > eps_rep_ins) = sum( h , sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_G_L(scen,ct_ren,h)) ) / sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_N_CON(scen,ct_ren)) ;
2703           report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res)$(sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES(scen,r
      es) + lev_N_RES_PRO(scen,res) ) > eps_rep_ins) = sum( h , sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,res,h
      ) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(scen,re
      s,h) + lev_G_RES(scen,res,h) - corr_fac_res(scen,res,h)) ) / sum(scen$(map
      (scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_RES(scen,res) + lev_
      N_RES_PRO(scen,res) ) ;
2704                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,c
      t_the)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,ct_the) < 
      eps_rep_abs) = 0 ;
2705                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,c
      t_ren)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,ct_ren) < 
      eps_rep_abs) = 0 ;
2706                   report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,r
      es)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,res) < eps_re
      p_abs) = 0 ;
               report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,dsm_shift
      )$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM_
      SHIFT(scen,dsm_shift)) > eps_rep_ins) = sum( (h,hh) , sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_DSM_DO(scen,dsm_shift,h,hh)) 
      ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_DSM
      _SHIFT(scen,dsm_shift)) ;
                       report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,d
      sm_shift)$(report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,dsm_shi
      ft) < eps_rep_abs) = 0 ;
      $ontext
2712         report_tech('Storage out total non-reserves',loop_res_share,loop_ev
      ,loop_prosumage,sto) = sum(h, report_tech_hours('generation storage',loop_
      res_share,loop_ev,loop_prosumage,sto,h) ) * 1 ;
2713         report_tech('Storage in total non-reserves',loop_res_share,loop_ev,
      loop_prosumage,sto) = sum(h, report_tech_hours('storage loading',loop_res_
      share,loop_ev,loop_prosumage,sto,h) ) * 1 ;
2714   
2715                   report_tech('Storage out total non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,sto)$(report_tech('Storage out total non-reserve
      s',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs*card(h)*1) = 0
       ;
2716                   report_tech('Storage in total non-reserves',loop_res_shar
      e,loop_ev,loop_prosumage,sto)$(report_tech('Storage in total non-reserves'
      ,loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs*card(h)*1) = 0 ;
2717   
             report_tech('Storage positive reserves activation by storage in',lo
      op_res_share,loop_ev,loop_prosumage,sto) = sum( (h,reserves_up) , sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,re
      serves_up,sto,h)) * phi_reserves_call(reserves_up,h)) * %sec_hour% ;
             report_tech('Storage negative reserves activation by storage in',lo
      op_res_share,loop_ev,loop_prosumage,sto) = sum( (h,reserves_do) , sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,re
      serves_do,sto,h)) * phi_reserves_call(reserves_do,h)) * %sec_hour% ;
             report_tech('Storage positive reserves activation by storage out',l
      oop_res_share,loop_ev,loop_prosumage,sto) = sum( (h,reserves_up) , sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,
      reserves_up,sto,h)) * phi_reserves_call(reserves_up,h)) * %sec_hour% ;
             report_tech('Storage negative reserves activation by storage out',l
      oop_res_share,loop_ev,loop_prosumage,sto) = sum( (h,reserves_do) , sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,
      reserves_do,sto,h)) * phi_reserves_call(reserves_do,h)) * %sec_hour% ;
       
                       report_tech('Storage positive reserves activation by stor
      age in',loop_res_share,loop_ev,loop_prosumage,sto)$(report_tech('Storage p
      ositive reserves activation by storage in',loop_res_share,loop_ev,loop_pro
      sumage,sto) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage negative reserves activation by stor
      age in',loop_res_share,loop_ev,loop_prosumage,sto)$(report_tech('Storage n
      egative reserves activation by storage in',loop_res_share,loop_ev,loop_pro
      sumage,sto) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage positive reserves activation by stor
      age out',loop_res_share,loop_ev,loop_prosumage,sto)$(report_tech('Storage 
      positive reserves activation by storage out',loop_res_share,loop_ev,loop_p
      rosumage,sto) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
                       report_tech('Storage negative reserves activation by stor
      age out',loop_res_share,loop_ev,loop_prosumage,sto)$(report_tech('Storage 
      negative reserves activation by storage out',loop_res_share,loop_ev,loop_p
      rosumage,sto) < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
      $ontext
2730   
2731          report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,
      sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins) = report_tech('Storage o
      ut total non-reserves',loop_res_share,loop_ev,loop_prosumage,sto) / sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,st
      o) + lev_N_STO_P_PRO(scen,sto) ) ;
2732           report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) =
       0 ;
2733          report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage
      ,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      STO_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) > eps_rep_ins) = report_tech
      ('Storage out total non-reserves',loop_res_share,loop_ev,loop_prosumage,st
      o) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_ST
      O_E(scen,sto) + lev_N_STO_E_PRO(scen,sto) ) * 1 ;
2734           report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage
      ,sto) < eps_rep_abs) = 0 ;
2735   
2736   
              report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P(scen,
      sto)) > eps_rep_ins) = ( report_tech('Storage out total non-reserves',loop
      _res_share,loop_ev,loop_prosumage,sto)
                              + sum( (h,reserves_up) , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_up,sto,h)
      ) * phi_reserves_call(reserves_up,h)) * %sec_hour%
                              - sum( (h,reserves_do) , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_do,sto,h)
      ) * phi_reserves_call(reserves_do,h)) * %sec_hour%
                              ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_N_STO_P(scen,sto)) ;
              report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage
      ,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      STO_E(scen,sto)) > eps_rep_ins) = ( report_tech('Storage out total non-res
      erves',loop_res_share,loop_ev,loop_prosumage,sto)
                              + sum( (h,reserves_up) , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_up,sto,h)
      ) * phi_reserves_call(reserves_up,h)) * %sec_hour%
                              - sum( (h,reserves_do) , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_do,sto,h)
      ) * phi_reserves_call(reserves_do,h)) * %sec_hour%
                              ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_N_STO_E(scen,sto)) * %sec_hour% ;
       
               report_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto)$(rep
      ort_tech('FLH',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) =
       0 ;
               report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumag
      e,sto)$(report_tech('Storage cycles',loop_res_share,loop_ev,loop_prosumage
      ,sto) < eps_rep_abs) = 0 ;
      $ontext
2751   
2752  *$ontext
2753          report_prosumage_tech('FLH prosumers',loop_res_share,loop_ev,loop_
      prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_N_STO_P_PRO(scen,sto)) > eps_rep_ins) = report_prosumage_tech('Stor
      age out total prosumers',loop_res_share,loop_ev,loop_prosumage,sto) / sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(s
      cen,sto)) ;
2754           report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_prosumage
      ,sto)$(report_prosumage_tech('FLH',loop_res_share,loop_ev,loop_prosumage,s
      to) < eps_rep_abs) = 0 ;
2755          report_prosumage_tech('Storage cycles prosumers',loop_res_share,lo
      op_ev,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_STO_E_PRO(scen,sto)) > eps_rep_ins) = report_prosumage
      _tech('Storage out total prosumers',loop_res_share,loop_ev,loop_prosumage,
      sto) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_
      STO_E_PRO(scen,sto)) * 1 ;
2756           report_prosumage_tech('Storage cycles prosumers',loop_res_share,l
      oop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage cycles prosumer
      s',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) = 0 ;
2757   
2758                   report_prosumage_tech('FLH prosumers',loop_res_share,loop
      _ev,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_N_RES_PRO(scen,res) > eps_rep_ins)) = sum( h , sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_MARKET_PRO2M(scen,
      res,h) + sum( sto , lev_STO_IN_PRO2PRO(scen,res,sto,h)) + lev_G_RES_PRO(sc
      en,res,h) )) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_N_RES_PRO(scen,res) ) ;
2759                           report_prosumage_tech('FLH prosumers',loop_res_sh
      are,loop_ev,loop_prosumage,res)$(report_prosumage_tech('FLH prosumers',loo
      p_res_share,loop_ev,loop_prosumage,res) < eps_rep_abs) = 0 ;
2760   
2761           report_market_tech('FLH market non-reserves',loop_res_share,loop_
      ev,loop_prosumage,res)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_N_RES(scen,res) ) > eps_rep_ins) = sum( h , sum(scen$(map(s
      cen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h) - corr
      _fac_res(scen,res,h)) ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_N_RES(scen,res) ) ;
2762           report_market_tech('FLH market non-reserves',loop_res_share,loop_
      ev,loop_prosumage,ct_the)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_CON(scen,ct_the)) > eps_rep_ins) = sum( h , sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_the,h))
       ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_CO
      N(scen,ct_the)) ;
2763           report_market_tech('FLH market non-reserves',loop_res_share,loop_
      ev,loop_prosumage,ct_ren)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_CON(scen,ct_ren)) > eps_rep_ins) = sum( h , sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_ren,h))
       ) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_CO
      N(scen,ct_ren)) ;
2764   
2765                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,res)$(report_market_tech('FLH market non-reserve
      s',loop_res_share,loop_ev,loop_prosumage,res) < eps_rep_abs) = 0 ;
2766                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,ct_the)$(report_market_tech('FLH market non-rese
      rves',loop_res_share,loop_ev,loop_prosumage,ct_the) < eps_rep_abs) = 0 ;
2767                   report_market_tech('FLH market non-reserves',loop_res_sha
      re,loop_ev,loop_prosumage,ct_ren)$(report_market_tech('FLH market non-rese
      rves',loop_res_share,loop_ev,loop_prosumage,ct_ren) < eps_rep_abs) = 0 ;
2768   
2769          report_market_tech('FLH market non-reserves',loop_res_share,loop_e
      v,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_N_STO_P(scen,sto)) > eps_rep_ins) = report_market_tech('Stor
      age out total market non-reserves',loop_res_share,loop_ev,loop_prosumage,s
      to) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_S
      TO_P(scen,sto)) ;
2770           report_market_tech('FLH market non-reserves',loop_res_share,loop_
      ev,loop_prosumage,sto)$(report_market_tech('FLH market non-reserves',loop_
      res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs) = 0 ;
2771          report_market_tech('Storage cycles market non-reserves',loop_res_s
      hare,loop_ev,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_e
      v,loop_prosumage)) , lev_N_STO_E(scen,sto)) > eps_rep_ins) = report_market
      _tech('Storage out total market non-reserves',loop_res_share,loop_ev,loop_
      prosumage,sto) / sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_N_STO_E(scen,sto)) * 1 ;
2772           report_market_tech('Storage cycles market non-reserves',loop_res_
      share,loop_ev,loop_prosumage,sto)$(report_market_tech('Storage cycles mark
      et non-reserves',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_abs)
       = 0 ;
2775   
2776          report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosuma
      ge,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_
      N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto)
       + lev_N_STO_E_PRO(scen,sto) ) * 1 > eps_rep_ins ) = sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto) + lev_N_STO_
      E_PRO(scen,sto) ) * 1 / sum(scen$(map(scen,loop_res_share,loop_ev,loop_pro
      sumage)) , lev_N_STO_P(scen,sto) + lev_N_STO_P_PRO(scen,sto) ) ;
2777           report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosum
      age,sto)$(report_tech('Storage EP-ratio',loop_res_share,loop_ev,loop_prosu
      mage,sto) < eps_rep_rel) = 0 ;
2778   
2779  *$ontext
2780          report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share,
      loop_ev,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loo
      p_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) > eps_rep_ins AND sum(scen$(ma
      p(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E_PRO(scen,sto)
       ) * 1 > eps_rep_ins ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage)) , lev_N_STO_E_PRO(scen,sto) ) * 1 / sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , lev_N_STO_P_PRO(scen,sto) ) ;
2781           report_prosumage_tech('Storage EP-ratio prosumers',loop_res_share
      ,loop_ev,loop_prosumage,sto)$(report_prosumage_tech('Storage EP-ratio pros
      umers',loop_res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel) = 0 ;
2782   
2783          report_market_tech('Storage EP-ratio market',loop_res_share,loop_e
      v,loop_prosumage,sto)$(sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_N_STO_P(scen,sto) ) > eps_rep_ins AND sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_N_STO_E(scen,sto) ) * 1 > eps_r
      ep_ins ) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_N_STO_E(scen,sto) ) * 1 / sum(scen$(map(scen,loop_res_share,loop_ev,loop
      _prosumage)) , lev_N_STO_P(scen,sto) ) ;
2784           report_market_tech('Storage EP-ratio market',loop_res_share,loop_
      ev,loop_prosumage,sto)$(report_market_tech('Storage EP-ratio market',loop_
      res_share,loop_ev,loop_prosumage,sto) < eps_rep_rel) = 0 ;
2785   
2788   
              report_tech('EV charge total wholesale',loop_res_share,loop_ev,loo
      p_prosumage,'ev_cum') = sum((h,ev), report_tech_hours('EV charge',loop_res
      _share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% ;
              report_tech('EV discharge total wholesale',loop_res_share,loop_ev,
      loop_prosumage,'ev_cum') = sum((h,ev), report_tech_hours('EV discharge',lo
      op_res_share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% ;
              report_tech('EV phevfuel total consumption',loop_res_share,loop_ev
      ,loop_prosumage,'ev_cum') = sum((h,ev), report_tech_hours('EV phevfuel con
      sumption',loop_res_share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% ;
              report_tech('EV electrical total consumption',loop_res_share,loop_
      ev,loop_prosumage,'ev_cum') = sum((h,ev), report_tech_hours('EV electrical
       consumption',loop_res_share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% ;
       
               report_tech('EV charge total wholesale',loop_res_share,loop_ev,lo
      op_prosumage,'ev_cum')$(report_tech('EV charge total wholesale',loop_res_s
      hare,loop_ev,loop_prosumage,'ev_cum') < eps_rep_abs*card(h)*%sec_hour%) = 
      0 ;
               report_tech('EV discharge total wholesale',loop_res_share,loop_ev
      ,loop_prosumage,'ev_cum')$(report_tech('EV discharge total wholesale',loop
      _res_share,loop_ev,loop_prosumage,'ev_cum') < eps_rep_abs*card(h)*%sec_hou
      r%) = 0 ;
               report_tech('EV phevfuel total consumption',loop_res_share,loop_e
      v,loop_prosumage,'ev_cum')$(report_tech('EV phevfuel total consumption',lo
      op_res_share,loop_ev,loop_prosumage,'ev_cum') < eps_rep_abs*card(h)*%sec_h
      our%) = 0 ;
               report_tech('EV electrical total consumption',loop_res_share,loop
      _ev,loop_prosumage,'ev_cum')$(report_tech('EV electrical total consumption
      ',loop_res_share,loop_ev,loop_prosumage,'ev_cum') < eps_rep_abs*card(h)*%s
      ec_hour%) = 0 ;
       
             report_tech('EV share of electrical consumption',loop_res_share,loo
      p_ev,loop_prosumage,'ev_cum')$(sum((h,ev), report_tech_hours('EV electrica
      l consumption',loop_res_share,loop_ev,loop_prosumage,ev,h) + report_tech_h
      ours('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h)
      ) > card(h)*eps_rep_abs) = sum((h,ev), report_tech_hours('EV electrical co
      nsumption',loop_res_share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% / (s
      um((h,ev), report_tech_hours('EV electrical consumption',loop_res_share,lo
      op_ev,loop_prosumage,ev,h) + report_tech_hours('EV phevfuel consumption',l
      oop_res_share,loop_ev,loop_prosumage,ev,h) ) ) ;
             report_tech('EV share of phevfuel consumption',loop_res_share,loop_
      ev,loop_prosumage,'ev_cum')$(sum((h,ev), report_tech_hours('EV electrical 
      consumption',loop_res_share,loop_ev,loop_prosumage,ev,h) + report_tech_hou
      rs('EV phevfuel consumption',loop_res_share,loop_ev,loop_prosumage,ev,h)) 
      > card(h)*eps_rep_abs) = sum((h,ev), report_tech_hours('EV phevfuel consum
      ption',loop_res_share,loop_ev,loop_prosumage,ev,h) ) * %sec_hour% / (sum((
      h,ev), report_tech_hours('EV electrical consumption',loop_res_share,loop_e
      v,loop_prosumage,ev,h) + report_tech_hours('EV phevfuel consumption',loop_
      res_share,loop_ev,loop_prosumage,ev,h) ) ) ;
       
               report_tech('EV share of electrical consumption',loop_res_share,l
      oop_ev,loop_prosumage,'ev_cum')$(report_tech('EV share of electrical consu
      mption',loop_res_share,loop_ev,loop_prosumage,'ev_cum') < eps_rep_rel) = 0
       ;
               report_tech('EV share of phevfuel consumption',loop_res_share,loo
      p_ev,loop_prosumage,'ev_cum')$(report_tech('EV share of phevfuel consumpti
      on',loop_res_share,loop_ev,loop_prosumage,'ev_cum') < eps_rep_rel) = 0 ;
       
      %reserves%$ontext
              report_tech('EV positive reserves activation by charging',loop_res
      _share,loop_ev,loop_prosumage,'ev_cum') = sum( (ev,h,reserves_up) ,  sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen
      ,reserves_up,ev,h)) * phi_reserves_call(reserves_up,h)) * %sec_hour% ;
              report_tech('EV negative reserves activation by charging',loop_res
      _share,loop_ev,loop_prosumage,'ev_cum') = sum( (ev,h,reserves_do) ,  sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen
      ,reserves_do,ev,h)) * phi_reserves_call(reserves_do,h)) * %sec_hour% ;
              report_tech('EV positive reserves activation by discharging',loop_
      res_share,loop_ev,loop_prosumage,'ev_cum') = sum( (ev,h,reserves_up) , sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2G(sc
      en,reserves_up,ev,h)) * phi_reserves_call(reserves_up,h)) * %sec_hour% ;
              report_tech('EV negative reserves activation by discharging',loop_
      res_share,loop_ev,loop_prosumage,'ev_cum') = sum( (ev,h,reserves_do) , sum
      (scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2G(sc
      en,reserves_do,ev,h)) * phi_reserves_call(reserves_do,h)) * %sec_hour% ;
       
               report_tech('EV positive reserves activation by charging',loop_re
      s_share,loop_ev,loop_prosumage,'ev_cum')$(report_tech('EV positive reserve
      s activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum') 
      < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
               report_tech('EV negative reserves activation by charging',loop_re
      s_share,loop_ev,loop_prosumage,'ev_cum')$(report_tech('EV negative reserve
      s activation by charging',loop_res_share,loop_ev,loop_prosumage,'ev_cum') 
      < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
               report_tech('EV positive reserves activation by discharging',loop
      _res_share,loop_ev,loop_prosumage,'ev_cum')$(report_tech('EV positive rese
      rves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_
      cum') < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
               report_tech('EV negative reserves activation by discharging',loop
      _res_share,loop_ev,loop_prosumage,'ev_cum')$(report_tech('EV negative rese
      rves activation by discharging',loop_res_share,loop_ev,loop_prosumage,'ev_
      cum') < eps_rep_abs*card(h)*%sec_hour%) = 0 ;
      $ontext
2818   
2819   
               report_reserves_tech('Reserves provision ratio',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the)$(sum( h , sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_the,h) + corr_fac_con(s
      cen,ct_the,h))) > card(h)*eps_rep_abs)= sum( h , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_the,h)) ) 
      / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_G_L(scen,ct_the,h) + corr_fac_con(scen,ct_the,h)) ) ;
               report_reserves_tech('Reserves provision ratio',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren)$(sum( h , sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_ren,h) + corr_fac_con(s
      cen,ct_ren,h))) > card(h)*eps_rep_abs)= sum( h , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_ren,h)) ) 
      / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , le
      v_G_L(scen,ct_ren,h) + corr_fac_con(scen,ct_ren,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_the)$(sum( h , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_the,h) + corr_fac_con(
      scen,ct_the,h))) > card(h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_the,h)) 
      * phi_reserves_call(reserves,h)) / sum( h , sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_the,h) + corr_fac_con(scen,
      ct_the,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_ren)$(sum( h , sum(scen$(map(scen,loop_r
      es_share,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_ren,h) + corr_fac_con(
      scen,ct_ren,h))) > card(h)*eps_rep_abs) = sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_ren,h)) 
      * phi_reserves_call(reserves,h)) / sum( h , sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_G_L(scen,ct_ren,h) + corr_fac_con(scen,
      ct_ren,h)) ) ;
               report_reserves_tech('Reserves provision ratio',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res)$(sum( h , sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h))) >  card(h)*eps_rep
      _abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RP_RES(scen,reserves,res,h)) ) / sum( h , sum(scen$(map(scen,loop_
      res_share,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h)) ) ;
               report_reserves_tech('Reserves activation ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,res)$(sum( h , sum(scen$(map(scen,loop_res_
      share,loop_ev,loop_prosumage)) , lev_G_RES(scen,res,h))) > card(h)*eps_rep
      _abs) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RP_RES(scen,reserves,res,h)) * phi_reserves_call(reserves,h) ) / s
      um( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_G
      _RES(scen,res,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage out posit
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto)$( su
      m(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_up,sto
      ,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage out negat
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto)$( su
      m(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_O
      UT(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_do,sto
      ,h)) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_STO_OUT(scen,sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage in positi
      ve reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto)$( sum
      (h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN
      (scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_
      res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves_up,sto,h)
      ) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ) ;
               report_reserves_tech('Reserves provision ratio (storage in negati
      ve reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto)$( sum
      (h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_IN
      (scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop_
      res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves_do,sto,h)
      ) ) / sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_STO_IN(scen,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage out posi
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto)$( s
      um(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_
      OUT(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_up,st
      o,h)) * phi_reserves_call(reserves_up,h) ) / sum( h , sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage out nega
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto)$( s
      um(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_
      OUT(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,lo
      op_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,reserves_do,st
      o,h)) * phi_reserves_call(reserves_do,h) ) / sum( h , sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage)) , lev_STO_OUT(scen,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage in posit
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_up,sto)$( su
      m(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_I
      N(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves_up,sto,h
      )) * phi_reserves_call(reserves_up,h) ) / sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ) ;
               report_reserves_tech('Reserves activation ratio (storage in negat
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves_do,sto)$( su
      m(h,sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_STO_I
      N(scen,sto,h))) > card(h)*eps_rep_abs ) = sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves_do,sto,h
      )) * phi_reserves_call(reserves_do,h) ) / sum( h , sum(scen$(map(scen,loop
      _res_share,loop_ev,loop_prosumage)) , lev_STO_IN(scen,sto,h)) ) ;
       
                report_reserves_tech('Reserves provision ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_the)$(report_reserves_tech('Reserves pro
      vision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the) < eps
      _rep_rel) = 0 ;
                report_reserves_tech('Reserves activation ratio',loop_res_share,
      loop_ev,loop_prosumage,reserves,ct_the)$(report_reserves_tech('Reserves ac
      tivation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the) < e
      ps_rep_rel) = 0 ;
                report_reserves_tech('Reserves provision ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_ren)$(report_reserves_tech('Reserves pro
      vision ratio',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren) < eps
      _rep_rel) = 0 ;
                report_reserves_tech('Reserves activation ratio',loop_res_share,
      loop_ev,loop_prosumage,reserves,ct_ren)$(report_reserves_tech('Reserves ac
      tivation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren) < e
      ps_rep_rel) = 0 ;
                report_reserves_tech('Reserves provision ratio',loop_res_share,l
      oop_ev,loop_prosumage,reserves,res)$(report_reserves_tech('Reserves provis
      ion ratio',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep_r
      el) = 0 ;
                report_reserves_tech('Reserves activation ratio',loop_res_share,
      loop_ev,loop_prosumage,reserves,res)$(report_reserves_tech('Reserves activ
      ation ratio',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep
      _rel) = 0 ;
                report_reserves_tech('Reserves provision ratio (storage out posi
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repor
      t_reserves_tech('Reserves provision ratio (storage out positive reserves)'
      ,loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
                report_reserves_tech('Reserves provision ratio (storage out nega
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repor
      t_reserves_tech('Reserves provision ratio (storage out negative reserves)'
      ,loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
                report_reserves_tech('Reserves provision ratio (storage in posit
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(report
      _reserves_tech('Reserves provision ratio (storage in positive reserves)',l
      oop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
                report_reserves_tech('Reserves provision ratio (storage in negat
      ive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(report
      _reserves_tech('Reserves provision ratio (storage in negative reserves)',l
      oop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
                report_reserves_tech('Reserves activation ratio (storage out pos
      itive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repo
      rt_reserves_tech('Reserves activation ratio (storage out positive reserves
      )',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 
      ;
                report_reserves_tech('Reserves activation ratio (storage out neg
      ative reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repo
      rt_reserves_tech('Reserves activation ratio (storage out negative reserves
      )',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 
      ;
                report_reserves_tech('Reserves activation ratio (storage in posi
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repor
      t_reserves_tech('Reserves activation ratio (storage in positive reserves)'
      ,loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
                report_reserves_tech('Reserves activation ratio (storage in nega
      tive reserves)',loop_res_share,loop_ev,loop_prosumage,reserves,sto)$(repor
      t_reserves_tech('Reserves activation ratio (storage in negative reserves)'
      ,loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_rel) = 0 ;
      $ontext
2852   
2853   
              report('load curtailment absolute (non-reserves)',loop_res_share,l
      oop_ev,loop_prosumage) =  sum((dsm_curt,h), sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_DSM_CU(scen,dsm_curt,h))) * %sec_hour% 
      ;
              report('load shift pos absolute (non-reserves)',loop_res_share,loo
      p_ev,loop_prosumage) =  sum((dsm_shift,h), sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,dsm_shift,h))) * %sec
      _hour% ;
              report('load shift neg absolute (non-reserves)',loop_res_share,loo
      p_ev,loop_prosumage) =  sum((dsm_shift,h), sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,dsm_shift,h))) * %sec
      _hour% ;
              report_tech('capacities load curtailment',loop_res_share,loop_ev,l
      oop_prosumage,dsm_curt) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage)) , lev_N_DSM_CU(scen,dsm_curt)) ;
              report_tech('capacities load shift',loop_res_share,loop_ev,loop_pr
      osumage,dsm_shift) =  sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosu
      mage)) , lev_N_DSM_SHIFT(scen,dsm_shift)) ;
              report_tech_hours('load curtailment (non-reserves)',loop_res_share
      ,loop_ev,loop_prosumage,dsm_curt,h) = sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_DSM_CU(scen,dsm_curt,h)) ;
              report_tech_hours('load shift pos (non-reserves)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift,h) = sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,dsm_shift,h)) ;
              report_tech_hours('load shift neg (non-reserves)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift,h) = sum(scen$(map(scen,loop_res_share,loo
      p_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,dsm_shift,h)) ;
              report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,dsm_curt) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , 
      lev_N_DSM_CU(scen,dsm_curt)) / report('Capacity total',loop_res_share,loop
      _ev,loop_prosumage) + 1e-9 ;
              report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumage
      ,dsm_shift) = sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) ,
       lev_N_DSM_SHIFT(scen,dsm_shift)) / report('Capacity total',loop_res_share
      ,loop_ev,loop_prosumage) + 1e-9 ;
              report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,d
      sm_curt) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge)) , lev_DSM_CU(scen,dsm_curt,h) - corr_fac_dsm_cu(scen,dsm_curt,h)) )  
      / report('Energy total',loop_res_share,loop_ev,loop_prosumage) * %sec_hour
      % + 1e-9 ;
              report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,d
      sm_shift) = sum( h , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosum
      age)) , lev_DSM_DO_DEMAND(scen,dsm_shift,h) - corr_fac_dsm_shift(scen,dsm_
      shift,h)) ) / report('Energy total',loop_res_share,loop_ev,loop_prosumage)
       * %sec_hour% + 1e-9 ;
              report_tech('Load shift pos absolute (total)',loop_res_share,loop_
      ev,loop_prosumage,dsm_shift) = sum( h , sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_DSM_UP(scen,dsm_shift,h)) ) ;
              report_tech('Load shift neg absolute (total)',loop_res_share,loop_
      ev,loop_prosumage,dsm_shift) = sum( (h,hh) , sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_DSM_DO(scen,dsm_shift,h,hh)) ) ;
              report_tech('Load shift pos absolute (wholesale)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift) = sum( h , sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_DSM_UP_DEMAND(scen,dsm_shift,h)) ) ;
              report_tech('Load shift neg absolute (wholesale)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift) = sum( h , sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_DSM_DO_DEMAND(scen,dsm_shift,h)) ) ;
              report_tech('Load shift pos absolute (reserves)',loop_res_share,lo
      op_ev,loop_prosumage,dsm_shift) = report_tech('Load shift pos absolute (to
      tal)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) - report_tech('Load
       shift pos absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm
      _shift) ;
              report_tech('Load shift neg absolute (reserves)',loop_res_share,lo
      op_ev,loop_prosumage,dsm_shift) = report_tech('Load shift neg absolute (to
      tal)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) - report_tech('Load
       shift neg absolute (wholesale)',loop_res_share,loop_ev,loop_prosumage,dsm
      _shift) ;
       
               report('load curtailment absolute (non-reserves)',loop_res_share,
      loop_ev,loop_prosumage)$(report('load curtailment absolute (non-reserves)'
      ,loop_res_share,loop_ev,loop_prosumage) < card(h)*eps_rep_abs*%sec_hour%) 
      = 0 ;
               report('load shift pos absolute (non-reserves)',loop_res_share,lo
      op_ev,loop_prosumage)$(report('load shift pos absolute (non-reserves)',loo
      p_res_share,loop_ev,loop_prosumage) < card(h)*eps_rep_abs*%sec_hour%) = 0 
      ;
               report('load shift neg absolute (non-reserves)',loop_res_share,lo
      op_ev,loop_prosumage)$(report('load shift neg absolute (non-reserves)',loo
      p_res_share,loop_ev,loop_prosumage) < card(h)*eps_rep_abs*%sec_hour%) = 0 
      ;
               report_tech('capacities load curtailment',loop_res_share,loop_ev,
      loop_prosumage,dsm_curt)$(report_tech('capacities load curtailment',loop_r
      es_share,loop_ev,loop_prosumage,dsm_curt) < eps_rep_ins) = 0 ;
               report_tech('capacities load shift',loop_res_share,loop_ev,loop_p
      rosumage,dsm_shift)$(report_tech('capacities load shift',loop_res_share,lo
      op_ev,loop_prosumage,dsm_shift) < eps_rep_ins) = 0 ;
               report_tech_hours('load curtailment (non-reserves)',loop_res_shar
      e,loop_ev,loop_prosumage,dsm_curt,h)$(report_tech_hours('load curtailment 
      (non-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_curt,h) < eps_re
      p_abs) = 0 ;
               report_tech_hours('load shift pos (non-reserves)',loop_res_share,
      loop_ev,loop_prosumage,dsm_shift,h)$(report_tech_hours('load shift pos (no
      n-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h) < eps_rep_
      abs) = 0 ;
               report_tech_hours('load shift neg (non-reserves)',loop_res_share,
      loop_ev,loop_prosumage,dsm_shift,h)$(report_tech_hours('load shift neg (no
      n-reserves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift,h) < eps_rep_
      abs) = 0 ;
               report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumag
      e,dsm_curt)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_pros
      umage,dsm_curt) < eps_rep_rel) = 0 ;
               report_tech('Capacity share',loop_res_share,loop_ev,loop_prosumag
      e,dsm_shift)$(report_tech('Capacity share',loop_res_share,loop_ev,loop_pro
      sumage,dsm_shift) < eps_rep_rel) = 0 ;
               report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,
      dsm_curt)$(report_tech('Energy share',loop_res_share,loop_ev,loop_prosumag
      e,dsm_curt) < eps_rep_rel) = 0 ;
               report_tech('Energy share',loop_res_share,loop_ev,loop_prosumage,
      dsm_shift)$(report_tech('Energy share',loop_res_share,loop_ev,loop_prosuma
      ge,dsm_shift) < eps_rep_rel) = 0 ;
               report_tech('Load shift pos absolute (total)',loop_res_share,loop
      _ev,loop_prosumage,dsm_shift)$(report_tech('Load shift pos absolute (total
      )',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_rep_abs)
       = 0 ;
               report_tech('Load shift neg absolute (total)',loop_res_share,loop
      _ev,loop_prosumage,dsm_shift)$(report_tech('Load shift neg absolute (total
      )',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_rep_abs)
       = 0 ;
               report_tech('Load shift pos absolute (wholesale)',loop_res_share,
      loop_ev,loop_prosumage,dsm_shift)$(report_tech('Load shift pos absolute (w
      holesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_
      rep_abs) = 0 ;
               report_tech('Load shift neg absolute (wholesale)',loop_res_share,
      loop_ev,loop_prosumage,dsm_shift)$(report_tech('Load shift neg absolute (w
      holesale)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_
      rep_abs) = 0 ;
               report_tech('Load shift pos absolute (reserves)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift)$(report_tech('Load shift pos absolute (re
      serves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_re
      p_abs) = 0 ;
               report_tech('Load shift neg absolute (reserves)',loop_res_share,l
      oop_ev,loop_prosumage,dsm_shift)$(report_tech('Load shift neg absolute (re
      serves)',loop_res_share,loop_ev,loop_prosumage,dsm_shift) < card(h)*eps_re
      p_abs) = 0 ;
      $ontext
2894   
              report_reserves('reserve provision requirements',loop_res_share,lo
      op_ev,loop_prosumage,reserves)$(ord(reserves) < 3) = phi_reserves_pr* sum(
       reservesreserves$( ord(reservesreserves) > 2 ) ,  (1000 * phi_reserves_sh
      are(reservesreserves) * (reserves_intercept(reservesreserves) + sum(resres
      ,reserves_slope(reservesreserves,resres) * sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres) + lev_N_RES_PRO(sce
      n,resres)))/1000) )) ) ;
              report_reserves('reserve provision requirements',loop_res_share,lo
      op_ev,loop_prosumage,reserves)$(ord(reserves) > 2) = 1000 * phi_reserves_s
      hare(reserves) * (reserves_intercept(reserves) + sum(resres,reserves_slope
      (reserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosuma
      ge))  , (lev_N_RES(scen,resres) + lev_N_RES_PRO(scen,resres)))/1000) ) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_the)$(ord(reserves) < 3) = sum( h , sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,res
      erves,ct_the,h))) / (phi_reserves_pr* sum( reservesreserves$( ord(reserves
      reserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserves_share(reservesreserv
      es) * (reserves_intercept(reservesreserves) + sum(resres,reserves_slope(re
      servesreserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage))  , (lev_N_RES(scen,resres)+lev_n_RES_PRO(scen,resres)))/1000) ))
       )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_ren)$(ord(reserves) < 3) = sum( h , sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,res
      erves,ct_ren,h))) / (phi_reserves_pr* sum( reservesreserves$( ord(reserves
      reserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserves_share(reservesreserv
      es) * (reserves_intercept(reservesreserves) + sum(resres,reserves_slope(re
      servesreserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_pr
      osumage))  , (lev_N_RES(scen,resres)+lev_n_RES_PRO(scen,resres)))/1000) ))
       )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,res)$(ord(reserves) < 3) = sum( h , sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RES(scen,reserv
      es,res,h))) / (phi_reserves_pr* sum( reservesreserves$( ord(reservesreserv
      es) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserves_share(reservesreserves) * 
      (reserves_intercept(reservesreserves) + sum(resres,reserves_slope(reserves
      reserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumag
      e))  , (lev_N_RES(scen,resres)+lev_n_RES_PRO(scen,resres)))/1000) )) )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,sto)$(ord(reserves) < 3) = sum( h , sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,res
      erves,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
       , lev_RP_STO_OUT(scen,reserves,sto,h))) / (phi_reserves_pr* sum( reserves
      reserves$( ord(reservesreserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserv
      es_share(reservesreserves) * (reserves_intercept(reservesreserves) + sum(r
      esres,reserves_slope(reservesreserves,resres) * sum(scen$(map(scen,loop_re
      s_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_n_RES_PRO(
      scen,resres)))/1000) )) ));
       
               report_reserves('reserve provision requirements',loop_res_share,l
      oop_ev,loop_prosumage,reserves)$(report_reserves('reserve provision requir
      ements',loop_res_share,loop_ev,loop_prosumage,reserves) < eps_rep_abs) = 0
       ;
               report_reserves('reserve provision requirements',loop_res_share,l
      oop_ev,loop_prosumage,reserves)$(report_reserves('reserve provision requir
      ements',loop_res_share,loop_ev,loop_prosumage,reserves) < eps_rep_abs) = 0
       ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the)$(report_reserves_tech('reserve provi
      sion shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the) < eps_
      rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren)$(report_reserves_tech('reserve provi
      sion shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren) < eps_
      rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res)$(report_reserves_tech('reserve provisio
      n shares',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep_re
      l) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto)$(report_reserves_tech('reserve provisio
      n shares',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_re
      l) = 0 ;
       
      %EV%$ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'ev_cum')$(ord(reserves) < 3) = sum( (h,ev), 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2G
      (scen,reserves,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_RP_EV_G2V(scen,reserves,ev,h))) / (phi_reserves_pr * sum( re
      servesreserves$( ord(reservesreserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_
      reserves_share(reservesreserves) * (reserves_intercept(reservesreserves) +
       sum(resres,reserves_slope(reservesreserves,resres) * sum(scen$(map(scen,l
      oop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_n_RE
      S_PRO(scen,resres)))/1000) )) ));
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'G2V_cum')$(ord(reserves) < 3) = sum( (h,ev),
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2
      V(scen,reserves,ev,h))) / (phi_reserves_pr * sum( reservesreserves$( ord(r
      eservesreserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserves_share(reserve
      sreserves) * (reserves_intercept(reservesreserves) + sum(resres,reserves_s
      lope(reservesreserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1
      000) )) ));
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'V2G_cum')$(ord(reserves) < 3) = sum( (h,ev),
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2
      G(scen,reserves,ev,h))) / (phi_reserves_pr * sum( reservesreserves$( ord(r
      eservesreserves) > 2 ) ,  ((card(h)-1) * 1000 * phi_reserves_share(reserve
      sreserves) * (reserves_intercept(reservesreserves) + sum(resres,reserves_s
      lope(reservesreserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,
      loop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1
      000) )) ));
       
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'ev_cum')$(report_reserves_tech('reserve pro
      vision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum') < 
      eps_rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'G2V_cum')$(report_reserves_tech('reserve pr
      ovision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'G2V_cum') 
      < eps_rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'V2G_cum')$(report_reserves_tech('reserve pr
      ovision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'V2G_cum') 
      < eps_rep_rel) = 0 ;
      $ontext
2920   
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_the)$( ord(reserves) > 2 ) = sum( h , sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,r
      eserves,ct_the,h))) / ((card(h)-1) * 1000 * phi_reserves_share(reserves) *
       (reserves_intercept(reserves) + sum(resres,reserves_slope(reserves,resres
      ) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_R
      ES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) ) ) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_ren)$( ord(reserves) > 2 ) = sum( h , sum(
      scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,r
      eserves,ct_ren,h))) / ((card(h)-1) * 1000 * phi_reserves_share(reserves) *
       (reserves_intercept(reserves) + sum(resres,reserves_slope(reserves,resres
      ) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_R
      ES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) ) ) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,res)$( ord(reserves) > 2 ) = sum( h , sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RES(scen,rese
      rves,res,h))) / ((card(h)-1) * 1000 * phi_reserves_share(reserves) * (rese
      rves_intercept(reserves) + sum(resres,reserves_slope(reserves,resres) * su
      m(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(sce
      n,resres)+lev_N_RES_PRO(scen,resres)))/1000) )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,sto)$( ord(reserves) > 2 ) = sum( h , sum(sce
      n$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,r
      eserves,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      )) , lev_RP_STO_OUT(scen,reserves,sto,h))) / ((card(h)-1) * 1000 * phi_res
      erves_share(reserves) * (reserves_intercept(reserves) + sum(resres,reserve
      s_slope(reserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_
      prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) 
      )) ;
       
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the)$(report_reserves_tech('reserve provi
      sion shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the) < eps_
      rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren)$(report_reserves_tech('reserve provi
      sion shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren) < eps_
      rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res)$(report_reserves_tech('reserve provisio
      n shares',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep_re
      l) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto)$(report_reserves_tech('reserve provisio
      n shares',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_re
      l) = 0 ;
       
      %EV%$ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'ev_cum')$( ord(reserves) > 2 ) = sum( (h,ev)
       , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_
      V2G(scen,reserves,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_RP_EV_G2V(scen,reserves,ev,h))) / ((card(h)-1) * 1000 * p
      hi_reserves_share(reserves) * (reserves_intercept(reserves) + sum(resres,r
      eserves_slope(reserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev
      ,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/
      1000) )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'G2V_cum')$( ord(reserves) > 2 ) = sum( (h,ev
      ) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV
      _G2V(scen,reserves,ev,h))) / ((card(h)-1) * 1000 * phi_reserves_share(rese
      rves) * (reserves_intercept(reserves) + sum(resres,reserves_slope(reserves
      ,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (
      lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )) ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'V2G_cum')$( ord(reserves) > 2 ) = sum( (h,ev
      ) , sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV
      _V2G(scen,reserves,ev,h))) / ((card(h)-1) * 1000 * phi_reserves_share(rese
      rves) * (reserves_intercept(reserves) + sum(resres,reserves_slope(reserves
      ,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (
      lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )) ;
       
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'ev_cum')$(report_reserves_tech('reserve pro
      vision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum') < 
      eps_rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'G2V_cum')$(report_reserves_tech('reserve pr
      ovision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'G2V_cum') 
      < eps_rep_rel) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'V2G_cum')$(report_reserves_tech('reserve pr
      ovision shares',loop_res_share,loop_ev,loop_prosumage,reserves,'V2G_cum') 
      < eps_rep_rel) = 0 ;
      $ontext
2942   
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the)$(ord(reserves) < 3) = sum(h,sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reser
      ves,ct_the,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_call
      (reserves,h) *  phi_reserves_pr* sum( reservesreserves$( ord(reservesreser
      ves) > 2) , 1000 * phi_reserves_share(reservesreserves) * ( reserves_inter
      cept(reservesreserves) + sum(resres , reserves_slope(reservesreserves,resr
      es) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N
      _RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000 ) ) )   ) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren)$(ord(reserves) < 3) = sum(h,sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reser
      ves,ct_ren,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_call
      (reserves,h) *  phi_reserves_pr* sum( reservesreserves$( ord(reservesreser
      ves) > 2) , 1000 * phi_reserves_share(reservesreserves) * ( reserves_inter
      cept(reservesreserves) + sum(resres , reserves_slope(reservesreserves,resr
      es) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N
      _RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000 ) ) )   ) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res)$(ord(reserves) < 3) = sum(h,sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RES(scen,reserves
      ,res,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_call(reser
      ves,h) *  phi_reserves_pr* sum( reservesreserves$( ord(reservesreserves) >
       2) , 1000 * phi_reserves_share(reservesreserves) * ( reserves_intercept(r
      eservesreserves) + sum(resres , reserves_slope(reservesreserves,resres) * 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(s
      cen,resres)+lev_N_RES_PRO(scen,resres)))/1000 ) ) )   ) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto)$(ord(reserves) < 3) = sum(h,(sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,rese
      rves,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
      , lev_RP_STO_OUT(scen,reserves,sto,h)))*phi_reserves_call(reserves,h)) / s
      um( h , phi_reserves_call(reserves,h) *  phi_reserves_pr* sum( reservesres
      erves$( ord(reservesreserves) > 2) , 1000 * phi_reserves_share(reservesres
      erves) * ( reserves_intercept(reservesreserves) + sum(resres , reserves_sl
      ope(reservesreserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,l
      oop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/10
      00 ) ) )   );
       
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct)$(report_reserves_tech('reserve activati
      on shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct) < eps_rep_re
      l) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,res)$(report_reserves_tech('reserve activat
      ion shares',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep_
      rel) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,sto)$(report_reserves_tech('reserve activat
      ion shares',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_
      rel) = 0 ;
       
      %EV%$ontext
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'ev_cum')$(ord(reserves) < 3) = sum((h,ev),(
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2G
      (scen,reserves,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_pros
      umage)) , lev_RP_EV_G2V(scen,reserves,ev,h)))*phi_reserves_call(reserves,h
      )) / sum( h , phi_reserves_call(reserves,h) *  phi_reserves_pr * sum( rese
      rvesreserves$( ord(reservesreserves) > 2) , 1000 * phi_reserves_share(rese
      rvesreserves) * ( reserves_intercept(reservesreserves) + sum(resres , rese
      rves_slope(reservesreserves,resres) * sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resre
      s)))/1000 ) ) )   ) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'G2V_cum')$(ord(reserves) < 3) = sum((h,ev),
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V
      (scen,reserves,ev,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserv
      es_call(reserves,h) *  phi_reserves_pr * sum( reservesreserves$( ord(reser
      vesreserves) > 2) , 1000 * phi_reserves_share(reservesreserves) * ( reserv
      es_intercept(reservesreserves) + sum(resres , reserves_slope(reservesreser
      ves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  
      , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000 ) ) )   ) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'V2G_cum')$(ord(reserves) < 3) = sum((h,ev),
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_V2G
      (scen,reserves,ev,h))*phi_reserves_call(reserves,h)) /  sum( h , phi_reser
      ves_call(reserves,h) *  phi_reserves_pr * sum( reservesreserves$( ord(rese
      rvesreserves) > 2) , 1000 * phi_reserves_share(reservesreserves) * ( reser
      ves_intercept(reservesreserves) + sum(resres , reserves_slope(reservesrese
      rves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) 
       , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000 ) ) )   ) ;
       
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'ev_cum')$(report_reserves_tech('reserve ac
      tivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum') 
      < eps_rep_rel) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'G2V_cum')$(report_reserves_tech('reserve a
      ctivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'G2V_cum'
      ) < eps_rep_rel) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'V2G_cum')$(report_reserves_tech('reserve a
      ctivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'V2G_cum'
      ) < eps_rep_rel) = 0 ;
      $ontext
2963   
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the)$( ord(reserves) > 2 ) = sum(h,sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,res
      erves,ct_the,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_ca
      ll(reserves,h) * 1000 * phi_reserves_share(reserves) * (reserves_intercept
      (reserves) + sum(resres,reserves_slope(reserves,resres) * sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_
      N_RES_PRO(scen,resres)))/1000) )) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren)$( ord(reserves) > 2 ) = sum(h,sum(sc
      en$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_CON(scen,res
      erves,ct_ren,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_ca
      ll(reserves,h) * 1000 * phi_reserves_share(reserves) * (reserves_intercept
      (reserves) + sum(resres,reserves_slope(reserves,resres) * sum(scen$(map(sc
      en,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_
      N_RES_PRO(scen,resres)))/1000) )) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res)$( ord(reserves) > 2 ) = sum(h,sum(scen$
      (map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_RES(scen,reserv
      es,res,h))*phi_reserves_call(reserves,h)) / sum( h , phi_reserves_call(res
      erves,h) * 1000 * phi_reserves_share(reserves) * (reserves_intercept(reser
      ves) + sum(resres,reserves_slope(reserves,resres) * sum(scen$(map(scen,loo
      p_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resres)+lev_N_RES_
      PRO(scen,resres)))/1000) )) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto)$( ord(reserves) > 2 ) = sum(h,(sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,re
      serves,sto,h)) + sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)
      ) , lev_RP_STO_OUT(scen,reserves,sto,h)))*phi_reserves_call(reserves,h)) /
       sum( h , phi_reserves_call(reserves,h) * 1000 * phi_reserves_share(reserv
      es) * (reserves_intercept(reserves) + sum(resres,reserves_slope(reserves,r
      esres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (le
      v_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )) ;
       
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_the)$(report_reserves_tech('reserve acti
      vation shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the) < ep
      s_rep_rel ) = 0;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_ren)$(report_reserves_tech('reserve acti
      vation shares',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren) < ep
      s_rep_rel ) = 0;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,res)$(report_reserves_tech('reserve activat
      ion shares',loop_res_share,loop_ev,loop_prosumage,reserves,res) < eps_rep_
      rel ) = 0;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,sto)$(report_reserves_tech('reserve activat
      ion shares',loop_res_share,loop_ev,loop_prosumage,reserves,sto) < eps_rep_
      rel ) = 0;
       
      %EV%$ontext
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'ev_cum')$( ord(reserves) > 2 ) = (sum((h,ev
      ),(sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_
      V2G(scen,reserves,ev,h))+ sum(scen$(map(scen,loop_res_share,loop_ev,loop_p
      rosumage)) , lev_RP_EV_G2V(scen,reserves,ev,h)))*phi_reserves_call(reserve
      s,h)) / sum( h , phi_reserves_call(reserves,h) * 1000 * phi_reserves_share
      (reserves) * (reserves_intercept(reserves) + sum(resres,reserves_slope(res
      erves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))
        , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) ))) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'G2V_cum')$( ord(reserves) > 2 ) = (sum((h,e
      v),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_
      G2V(scen,reserves,ev,h))*phi_reserves_call(reserves,h)) / sum( h , phi_res
      erves_call(reserves,h) * 1000 * phi_reserves_share(reserves) * (reserves_i
      ntercept(reserves) + sum(resres,reserves_slope(reserves,resres) * sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resr
      es)+lev_N_RES_PRO(scen,resres)))/1000) ))) ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'V2G_cum')$( ord(reserves) > 2 ) = (sum((h,e
      v),sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_
      V2G(scen,reserves,ev,h))*phi_reserves_call(reserves,h)) / sum( h , phi_res
      erves_call(reserves,h) * 1000 * phi_reserves_share(reserves) * (reserves_i
      ntercept(reserves) + sum(resres,reserves_slope(reserves,resres) * sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,resr
      es)+lev_N_RES_PRO(scen,resres)))/1000) ))) ;
       
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'ev_cum')$(report_reserves_tech('reserve ac
      tivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'ev_cum') 
      < eps_rep_rel ) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'G2V_cum')$(report_reserves_tech('reserve a
      ctivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'G2V_cum'
      ) < eps_rep_rel ) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'V2G_cum')$(report_reserves_tech('reserve a
      ctivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,'V2G_cum'
      ) < eps_rep_rel ) = 0 ;
      $ontext
2985   
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,'required',h) = (report_reserves('reserve pro
      vision requirements',loop_res_share,loop_ev,loop_prosumage,reserves)) ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'required',h) = (phi_reserves_call(reserves,
      h) * report_reserves('reserve provision requirements',loop_res_share,loop_
      ev,loop_prosumage,reserves)) ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_the,h) = sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_the,h)) ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the,h) = sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_the,h))*phi_reser
      ves_call(reserves,h) ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ct_ren,h) = sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_ren,h)) ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren,h) = sum(scen$(map(scen,loop_res_shar
      e,loop_ev,loop_prosumage)) , lev_RP_CON(scen,reserves,ct_ren,h))*phi_reser
      ves_call(reserves,h) ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,res,h) = sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_RP_RES(scen,reserves,res,h)) ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res,h) = sum(scen$(map(scen,loop_res_share,l
      oop_ev,loop_prosumage)) , lev_RP_RES(scen,reserves,res,h))*phi_reserves_ca
      ll(reserves,h) ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,sto,h) = (sum(scen$(map(scen,loop_res_share,l
      oop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves,sto,h)) + sum(scen$(
      map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,res
      erves,sto,h))) ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,h) = ((sum(scen$(map(scen,loop_res_share
      ,loop_ev,loop_prosumage)) , lev_RP_STO_IN(scen,reserves,sto,h)) + sum(scen
      $(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_STO_OUT(scen,r
      eserves,sto,h)))*phi_reserves_call(reserves,h)) ;
       
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,'required',h)$(report_reserves_tech_hours('R
      eserves provision',loop_res_share,loop_ev,loop_prosumage,reserves,'require
      d',h) < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,'required',h)$(report_reserves_tech_hours('
      Reserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,'requi
      red',h) < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_the,h)$(report_reserves_tech_hours('Reser
      ves provision',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the,h) < 
      eps_rep_abs ) = 0;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_the,h)$(report_reserves_tech_hours('Rese
      rves activation',loop_res_share,loop_ev,loop_prosumage,reserves,ct_the,h) 
      < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ct_ren,h)$(report_reserves_tech_hours('Reser
      ves provision',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren,h) < 
      eps_rep_abs ) = 0;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ct_ren,h)$(report_reserves_tech_hours('Rese
      rves activation',loop_res_share,loop_ev,loop_prosumage,reserves,ct_ren,h) 
      < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,res,h)$(report_reserves_tech_hours('Reserves
       provision',loop_res_share,loop_ev,loop_prosumage,reserves,res,h) < eps_re
      p_abs ) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,res,h)$(report_reserves_tech_hours('Reserve
      s activation',loop_res_share,loop_ev,loop_prosumage,reserves,res,h) < eps_
      rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,sto,h)$(report_reserves_tech_hours('Reserves
       provision',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h) < eps_re
      p_abs ) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,sto,h)$(report_reserves_tech_hours('Reserve
      s activation',loop_res_share,loop_ev,loop_prosumage,reserves,sto,h) < eps_
      rep_abs ) = 0 ;
       
      %EV%$ontext
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,ev,h) = (sum(scen$(map(scen,loop_res_share,lo
      op_ev,loop_prosumage)) , lev_RP_EV_V2G(scen,reserves,ev,h))+ sum(scen$(map
      (scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,reserve
      s,ev,h)))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ev,h) = ((sum(scen$(map(scen,loop_res_share,
      loop_ev,loop_prosumage)) , lev_RP_EV_V2G(scen,reserves,ev,h))+ sum(scen$(m
      ap(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_EV_G2V(scen,reser
      ves,ev,h)))*phi_reserves_call(reserves,h))  ;
       
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,ev,h)$(report_reserves_tech_hours('Reserves 
      provision',loop_res_share,loop_ev,loop_prosumage,reserves,ev,h) < eps_rep_
      abs ) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,ev,h)$(report_reserves_tech_hours('Reserves
       activation',loop_res_share,loop_ev,loop_prosumage,reserves,ev,h) < eps_re
      p_abs ) = 0 ;
      $ontext
3017   
      %reserves%$ontext
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,dsm_curt)$( ord(reserves) > 2 ) = (sum( h , s
      um(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_CU(
      scen,reserves,dsm_curt,h))) / ( (card(h)-1) * 1000 * phi_reserves_share(re
      serves) * (reserves_intercept(reserves) + sum(resres,reserves_slope(reserv
      es,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  ,
       (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )))  ;
              report_reserves_tech('reserve provision shares',loop_res_share,loo
      p_ev,loop_prosumage,reserves,dsm_shift)$( ord(reserves) > 2 ) = (sum( h , 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_SH
      IFT(scen,reserves,dsm_shift,h))) / ( (card(h)-1) * 1000 * phi_reserves_sha
      re(reserves) * (reserves_intercept(reserves) + sum(resres,reserves_slope(r
      eserves,resres) * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage
      ))  , (lev_N_RES(scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )))   ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_curt)$( ord(reserves) > 2 ) = (sum( h , 
      sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_CU
      (scen,reserves,dsm_curt,h))*phi_reserves_call(reserves,h)) / sum( h , phi_
      reserves_call(reserves,h) * 1000 * phi_reserves_share(reserves) * (reserve
      s_intercept(reserves) + sum(resres,reserves_slope(reserves,resres) * sum(s
      cen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES(scen,r
      esres)+lev_N_RES_PRO(scen,resres)))/1000) )))  ;
              report_reserves_tech('reserve activation shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_shift)$( ord(reserves) > 2 ) = (sum( h ,
       sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage)) , lev_RP_DSM_S
      HIFT(scen,reserves,dsm_shift,h)) * phi_reserves_call(reserves,h)) / sum( h
       , phi_reserves_call(reserves,h) * 1000 * phi_reserves_share(reserves) * (
      reserves_intercept(reserves) + sum(resres,reserves_slope(reserves,resres) 
      * sum(scen$(map(scen,loop_res_share,loop_ev,loop_prosumage))  , (lev_N_RES
      (scen,resres)+lev_N_RES_PRO(scen,resres)))/1000) )))   ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,dsm_shift,h) = sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_RP_DSM_SHIFT(scen,reserves,dsm_shift,h)
      )  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_shift,h) = sum(scen$(map(scen,loop_res_s
      hare,loop_ev,loop_prosumage)) , lev_RP_DSM_SHIFT(scen,reserves,dsm_shift,h
      ))*phi_reserves_call(reserves,h)  ;
              report_reserves_tech_hours('Reserves provision',loop_res_share,loo
      p_ev,loop_prosumage,reserves,dsm_curt,h) = sum(scen$(map(scen,loop_res_sha
      re,loop_ev,loop_prosumage)) , lev_RP_DSM_CU(scen,reserves,dsm_curt,h))  ;
              report_reserves_tech_hours('Reserves activation',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_curt,h) = sum(scen$(map(scen,loop_res_sh
      are,loop_ev,loop_prosumage)) , lev_RP_DSM_CU(scen,reserves,dsm_curt,h))*ph
      i_reserves_call(reserves,h)  ;
       
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_curt)$(report_reserves_tech('reserve pro
      vision shares',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt) < 
      eps_rep_rel ) = 0 ;
               report_reserves_tech('reserve provision shares',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_shift)$(report_reserves_tech('reserve pr
      ovision shares',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift) 
      < eps_rep_rel ) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,dsm_curt)$(report_reserves_tech('reserve ac
      tivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt) 
      < eps_rep_rel ) = 0 ;
               report_reserves_tech('reserve activation shares',loop_res_share,l
      oop_ev,loop_prosumage,reserves,dsm_shift)$(report_reserves_tech('reserve a
      ctivation shares',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift
      ) < eps_rep_rel ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_shift,h)$(report_reserves_tech_hours('Re
      serves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shift
      ,h) < eps_rep_abs) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,dsm_shift,h)$(report_reserves_tech_hours('R
      eserves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_shi
      ft,h) < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves provision',loop_res_share,lo
      op_ev,loop_prosumage,reserves,dsm_curt,h)$(report_reserves_tech_hours('Res
      erves provision',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt,h
      ) < eps_rep_abs ) = 0 ;
               report_reserves_tech_hours('Reserves activation',loop_res_share,l
      oop_ev,loop_prosumage,reserves,dsm_curt,h)$(report_reserves_tech_hours('Re
      serves activation',loop_res_share,loop_ev,loop_prosumage,reserves,dsm_curt
      ,h) < eps_rep_abs ) = 0 ;
      $ontext
3039   
3040   
3041  * ------------------------------------------------------------------------
      ---- *
3042  * ------------------------------------------------------------------------
      ---- *
3043  * ------------------------------------------------------------------------
      ---- *
3044   
3045  *execute_unload "results", report, report_tech, report_tech_hours, report_
      hours ;
3046   
3047  *$ontext
3048  execute_unload "results", report, report_tech, report_tech_hours, report_h
      ours, report_prosumage, report_prosumage_tech, report_prosumage_tech_hours
      , report_market, report_market_tech, report_market_tech_hours ;
3051   
      execute_unload "results", report, report_tech, report_tech_hours, report_h
      ours, report_reserves, report_reserves_tech, report_reserves_tech_hours ;
      $ontext
3056   
3057   
3058  * ------------------------------------------------------------------------
      ---- *
3059  * ------------------------------------------------------------------------
      ---- *
3060  * ------------------------------------------------------------------------
      ---- *
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 08/04/18 18:17:21 Page 2
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Include File Summary


   SEQ   GLOBAL TYPE      PARENT   LOCAL  FILENAME

     1        1 INPUT          0       0  C:\Users\Lenovo\Dropbox\ma_prosumage\C
                                          ode\Source_Code\DIETER_Prosumage\DIETE
                                          R_v1.2.0.gms
     2      156 INCLUDE        1     156  .C:\Users\Lenovo\Dropbox\ma_prosumage\
                                           Code\Source_Code\DIETER_Prosumage\dat
                                           aload.gms
     3      405 CALL           2     249  .gdxxrw Data_Input_2035.xlsx @temp.tmp
                                           o=Data_input
     4      407 GDXIN          2     251  .C:\Users\Lenovo\Dropbox\ma_prosumage\
                                           Code\Source_Code\DIETER_Prosumage\Dat
                                           a_input.gdx
     5     1585 INCLUDE        1    1253  .C:\Users\Lenovo\Dropbox\ma_prosumage\
                                           Code\Source_Code\DIETER_Prosumage\fix
                                           .gms
     6     1842 INCLUDE        1    1254  .C:\Users\Lenovo\Dropbox\ma_prosumage\
                                           Code\Source_Code\DIETER_Prosumage\sce
                                           nario.gms
     7     2026 INCLUDE        1    1360  .C:\Users\Lenovo\Dropbox\ma_prosumage\
                                           Code\Source_Code\DIETER_Prosumage\rep
                                           ort.gms


COMPILATION TIME     =       13.907 SECONDS     21 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 08/04/18 18:17:21 Page 3
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Model Statistics    SOLVE DIETER Using LP From line 2022


MODEL STATISTICS

BLOCKS OF EQUATIONS          43     SINGLE EQUATIONS      902,290
BLOCKS OF VARIABLES          32     SINGLE VARIABLES    1,068,727  2 projected
NON ZERO ELEMENTS     4,616,446     NON LINEAR N-Z        473,038
DERIVATIVE POOL              20     CONSTANT POOL              17
CODE LENGTH             473,044


GENERATION TIME      =      567.047 SECONDS    428 MB  24.7.4 r58773 WEX-WEI


EXECUTION TIME       =      567.359 SECONDS    428 MB  24.7.4 r58773 WEX-WEI
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 08/04/18 18:17:21 Page 4
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
Solution Report     SOLVE DIETER Using LP From line 2022


               S O L V E      S U M M A R Y

     MODEL   DIETER              OBJECTIVE  Z
     TYPE    LP                  DIRECTION  MINIMIZE
     SOLVER  CPLEX               FROM LINE  2022

**** SOLVER STATUS     1 Normal Completion         
**** MODEL STATUS      14 No Solution Returned     
**** OBJECTIVE VALUE                0.0000

 RESOURCE USAGE, LIMIT        228.266  10000000.000
 ITERATION COUNT, LIMIT         0    2000000000

GUSS             24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
Reading parameter(s) from scenario dictionary
>>  Logoption 2
>>  Optfile 1
>>  Skipbasecase 1
--- Scenario Variable with potential updates identified: phi_min_res
--- Scenario Variable with potential updates identified: phi_pro_self

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 60.94sec (det. 18283.21 ticks)
Optimal solution found.
Objective : 34946035218.613487

--- Scenario scen1:     Records read:    2
--- Solution statistics for scenario scen1
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  34946035218.6135
---   Resource Usage   63250
---   Total Time (ms)  63938

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 29.94sec (det. 9886.44 ticks)
Optimal solution found.
Objective : 34954302392.613373

--- Scenario scen2:     Records read:    2
--- Solution statistics for scenario scen2
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  34954302392.6134
---   Resource Usage   32172
---   Total Time (ms)  32765

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 24.64sec (det. 7691.03 ticks)
Optimal solution found.
Objective : 34994545926.547852

--- Scenario scen3:     Records read:    2
--- Solution statistics for scenario scen3
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  34994545926.5479
---   Resource Usage   26765
---   Total Time (ms)  27375

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 25.20sec (det. 7996.20 ticks)
Optimal solution found.
Objective : 35046574514.125931

--- Scenario scen4:     Records read:    2
--- Solution statistics for scenario scen4
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  35046574514.1259
---   Resource Usage   27344
---   Total Time (ms)  27938

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 23.19sec (det. 7845.74 ticks)
Optimal solution found.
Objective : 35109063649.613739

--- Scenario scen5:     Records read:    2
--- Solution statistics for scenario scen5
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  35109063649.6137
---   Resource Usage   25266
---   Total Time (ms)  25812

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 23.28sec (det. 8222.80 ticks)
Optimal solution found.
Objective : 35186073603.850266

--- Scenario scen6:     Records read:    2
--- Solution statistics for scenario scen6
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  35186073603.8503
---   Resource Usage   25391
---   Total Time (ms)  25969

IBM ILOG CPLEX   24.7.4 r58773 Released Sep 19, 2016 WEI x86 64bit/MS Windows 
--- GAMS/Cplex licensed for continuous and discrete problems.
Cplex 12.6.3.0

Reading parameter(s) from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code
                                                    \DIETER_Prosumage\cplex.opt"
>>  lpmethod 4
>>  threads 4
>>  epgap 1e-3
>>  parallelmode -1
>>  barcrossalg -1
>>  barepcomp 1e-8
Finished reading from "C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIE
                                                        TER_Prosumage\cplex.opt"
Depreciated value -1 for BarCrossAlg. Using SolutionType=2
Space for names approximately 67.34 Mb
Use option 'names no' to turn use of names off
LP status(1): optimal
Cplex Time: 26.51sec (det. 9204.20 ticks)
Optimal solution found.
Objective : 35811719658.098190

--- Scenario scen7:     Records read:    2
--- Solution statistics for scenario scen7
---   Solver Status    1 Normal Completion         
---   Model Status     1 Optimal                   
---   Objective Value  35811719658.0982
---   Resource Usage   28594
---   Total Time (ms)  29235

No solution returned
GAMS 24.7.4  r58773 Released Sep 19, 2016 WEX-WEI x86 64bit/MS Windows 08/04/18 18:17:21 Page 5
G e n e r a l   A l g e b r a i c   M o d e l i n g   S y s t e m
E x e c u t i o n


EXECUTION TIME       =       19.985 SECONDS    338 MB  24.7.4 r58773 WEX-WEI


USER: Course License Energy Informatics Computer BaseS180601:0449AO-GEN
      Humboldt-Universitaet zu Berlin, WirtschaftswissenschaftliDC14161
      License for teaching and research at degree granting institutions


**** FILE SUMMARY

Input      C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\DIETER_v1.2.0.gms
Output     C:\Users\Lenovo\Dropbox\ma_prosumage\Code\Source_Code\DIETER_Prosumag
           e\DIETER_v1.2.0.lst
